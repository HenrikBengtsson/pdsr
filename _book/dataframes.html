<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 15 Working with data frames | Programming for Data Science in R</title>
<meta name="author" content="Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><script src="libs/d3-3.5.6/d3.min.js"></script><link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet">
<script src="libs/profvis-0.3.6.9000/profvis.js"></script><script src="libs/profvis-0.3.6.9000/scroll.js"></script><link href="libs/highlight-6.2.0/textmate.css" rel="stylesheet">
<script src="libs/highlight-6.2.0/highlight.js"></script><script src="libs/profvis-binding-0.3.7/profvis.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163213745-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-163213745-1');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="bootstrap.lambdamd.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Programming for Data Science in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">PDSR</a></li>
<li><a class="" href="preface.html"><span class="header-section-number">1</span> Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="Rsetup.html"><span class="header-section-number">3</span> R setup, Packages &amp; Docs</a></li>
<li><a class="" href="basicops.html"><span class="header-section-number">4</span> Basic operations</a></li>
<li><a class="" href="types.html"><span class="header-section-number">5</span> Data Types</a></li>
<li><a class="" href="structures.html"><span class="header-section-number">6</span> Data Structures</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">7</span> Factors</a></li>
<li><a class="" href="indexing.html"><span class="header-section-number">8</span> Indexing - Subsetting - Slicing</a></li>
<li><a class="" href="vectorization.html"><span class="header-section-number">9</span> Vectorized Operations</a></li>
<li><a class="" href="dataio.html"><span class="header-section-number">10</span> Data Input/Output</a></li>
<li><a class="" href="controlflow.html"><span class="header-section-number">11</span> Control flow</a></li>
<li><a class="" href="loopfns.html"><span class="header-section-number">12</span> Loop Functions</a></li>
<li><a class="" href="summarize.html"><span class="header-section-number">13</span> Summarizing Data</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">14</span> Functions</a></li>
<li><a class="active" href="dataframes.html"><span class="header-section-number">15</span> Working with data frames</a></li>
<li><a class="" href="datatrans.html"><span class="header-section-number">16</span> Data Transformations</a></li>
<li><a class="" href="stringops.html"><span class="header-section-number">17</span> String Operations</a></li>
<li><a class="" href="datetime.html"><span class="header-section-number">18</span> Date and Time</a></li>
<li><a class="" href="missingdata.html"><span class="header-section-number">19</span> Handling Missing data</a></li>
<li><a class="" href="classes.html"><span class="header-section-number">20</span> Classes and Object-Oriented Programming</a></li>
<li><a class="" href="datatable.html"><span class="header-section-number">21</span> Efficient data analysis with data.table</a></li>
<li><a class="" href="basegraphics.html"><span class="header-section-number">22</span> Base Graphics</a></li>
<li><a class="" href="graphics3x.html"><span class="header-section-number">23</span> 3x Graphics</a></li>
<li><a class="" href="colors.html"><span class="header-section-number">24</span> Colors in R</a></li>
<li><a class="" href="profiling.html"><span class="header-section-number">25</span> Timing &amp; Profiling</a></li>
<li><a class="" href="optim.html"><span class="header-section-number">26</span> Optimization with optim()</a></li>
<li><a class="" href="glm.html"><span class="header-section-number">27</span> Introduction to the GLM</a></li>
<li><a class="" href="resampling.html"><span class="header-section-number">28</span> Resampling</a></li>
<li><a class="" href="supervised.html"><span class="header-section-number">29</span> Supervised Learning</a></li>
<li><a class="" href="unsupervised.html"><span class="header-section-number">30</span> Unsupervised Learning</a></li>
<li><a class="" href="git.html"><span class="header-section-number">31</span> Git &amp; GitHub: the basics</a></li>
<li><a class="" href="shell.html"><span class="header-section-number">32</span> Introduction to the system shell</a></li>
<li><a class="" href="resources.html"><span class="header-section-number">33</span> Resources</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="dataframes" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> Working with data frames<a class="anchor" aria-label="anchor" href="#dataframes"><i class="fas fa-link"></i></a>
</h1>
<div id="column-and-row-names" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Column and row names<a class="anchor" aria-label="anchor" href="#column-and-row-names"><i class="fas fa-link"></i></a>
</h2>
<p>Example data.frame:</p>
<div class="sourceCode" id="cb927"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>PID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">111</span><span class="op">:</span><span class="fl">119</span><span class="op">)</span>,
                Hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"UCSF"</span>, <span class="st">"HUP"</span>, <span class="st">"Stanford"</span>,
                             <span class="st">"Stanford"</span>, <span class="st">"UCSF"</span>, <span class="st">"HUP"</span>, 
                             <span class="st">"HUP"</span>, <span class="st">"Stanford"</span>, <span class="st">"UCSF"</span><span class="op">)</span>,
                Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">34</span>, <span class="fl">41</span>, <span class="fl">19</span>, <span class="fl">53</span>, <span class="fl">21</span>, <span class="fl">63</span>, <span class="fl">22</span>, <span class="fl">19</span><span class="op">)</span>,
                Sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,
                row.names <span class="op">=</span> <span class="st">"PID"</span><span class="op">)</span></code></pre></div>
<p>Get column names and row names with <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> and <code><a href="https://rdrr.io/r/base/colnames.html">rownames()</a></code>:</p>
<div class="sourceCode" id="cb928"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "Hospital" "Age"      "Sex"     </code></pre>
<div class="sourceCode" id="cb930"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "111" "112" "113" "114" "115" "116" "117" "118" "119"</code></pre>
<p>To set new column or row names use the form</p>
<p><code>colnames(df) &lt;- new.names</code></p>
<p>where <code>new.names</code> is a character vector:</p>
<div class="sourceCode" id="cb932"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Center"</span>, <span class="st">"Age_at_Dx"</span>, <span class="st">"Sex"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Patient_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>
<span class="va">df</span></code></pre></div>
<pre><code>            Center Age_at_Dx Sex
Patient_1     UCSF        22   1
Patient_2      HUP        34   1
Patient_3 Stanford        41   0
Patient_4 Stanford        19   1
Patient_5     UCSF        53   0
Patient_6      HUP        21   0
Patient_7      HUP        63   1
Patient_8 Stanford        22   0
Patient_9     UCSF        19   0</code></pre>
</div>
<div id="delete-columns-or-rows" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Delete columns or rows<a class="anchor" aria-label="anchor" href="#delete-columns-or-rows"><i class="fas fa-link"></i></a>
</h2>
<p>To delete a data.frame column, set it to <a href="types.html#replacing-with-null">NULL</a>:</p>
<div class="sourceCode" id="cb934"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">$</span><span class="va">Sex</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">df</span></code></pre></div>
<pre><code>    Center Age_at_Dx
1     UCSF        22
2      HUP        34
3 Stanford        41
4 Stanford        19
5     UCSF        53
6      HUP        21
7      HUP        63
8 Stanford        22
9     UCSF        19</code></pre>
<p>To delete a data.frame row, you can “index it out.” For example, to remove the third row:</p>
<div class="sourceCode" id="cb936"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span>, <span class="op">]</span>
<span class="va">df</span></code></pre></div>
<pre><code>    Center Age_at_Dx
1     UCSF        22
2      HUP        34
4 Stanford        19
5     UCSF        53
6      HUP        21
7      HUP        63
8 Stanford        22
9     UCSF        19</code></pre>
</div>
<div id="table-joins-i.e.-merging-data.frames" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Table Joins (i.e. Merging data.frames)<a class="anchor" aria-label="anchor" href="#table-joins-i.e.-merging-data.frames"><i class="fas fa-link"></i></a>
</h2>
<p>Scenario: You have received two or more tables with data. Each table consists of a unique identifier (ID), which is shared among the tables, plus a number of variables in columns, which may be unique to each table. You want to merge them into one big table so that for each ID you have all available variables.</p>
<p>Let’s make up some data:</p>
<div class="sourceCode" id="cb938"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>PID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>,
                Hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"UCSF"</span>, <span class="st">"HUP"</span>, <span class="st">"Stanford"</span>,
                             <span class="st">"Stanford"</span>, <span class="st">"UCSF"</span>, <span class="st">"HUP"</span>, 
                             <span class="st">"HUP"</span>, <span class="st">"Stanford"</span>, <span class="st">"UCSF"</span><span class="op">)</span>,
                Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">34</span>, <span class="fl">41</span>, <span class="fl">19</span>, <span class="fl">53</span>, <span class="fl">21</span>, <span class="fl">63</span>, <span class="fl">22</span>, <span class="fl">19</span><span class="op">)</span>,
                Sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="va">b</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>PID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>,
                 V1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">153</span>, <span class="fl">89</span>, <span class="fl">112</span>, <span class="fl">228</span>,  <span class="fl">91</span>, <span class="fl">190</span>, <span class="fl">101</span><span class="op">)</span>,
                 Department <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Neurology"</span>, <span class="st">"Radiology"</span>,
                                <span class="st">"Emergency"</span>, <span class="st">"Cardiology"</span>,
                                <span class="st">"Surgery"</span>, <span class="st">"Neurology"</span>, <span class="st">"Psychiatry"</span><span class="op">)</span><span class="op">)</span>
<span class="va">a</span></code></pre></div>
<pre><code>  PID Hospital Age Sex
1   1     UCSF  22   1
2   2      HUP  34   1
3   3 Stanford  41   0
4   4 Stanford  19   1
5   5     UCSF  53   0
6   6      HUP  21   0
7   7      HUP  63   1
8   8 Stanford  22   0
9   9     UCSF  19   0</code></pre>
<div class="sourceCode" id="cb940"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span></code></pre></div>
<pre><code>  PID  V1 Department
1   6 153  Neurology
2   7  89  Radiology
3   8 112  Emergency
4   9 228 Cardiology
5  10  91    Surgery
6  11 190  Neurology
7  12 101 Psychiatry</code></pre>
<div class="sourceCode" id="cb942"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 9 4</code></pre>
<div class="sourceCode" id="cb944"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 7 3</code></pre>
<p>There are four main types of join operations:</p>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-8"></span>
<img src="R_joins.png" alt="Common Join Operations" width="100%"><p class="caption">
Figure 15.1: Common Join Operations
</p>
</div>
<div id="inner-join" class="section level3" number="15.3.1">
<h3>
<span class="header-section-number">15.3.1</span> Inner join<a class="anchor" aria-label="anchor" href="#inner-join"><i class="fas fa-link"></i></a>
</h3>
<p>The default arguments of <code><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge()</a></code> perform an <strong>inner join</strong>:</p>
<div class="sourceCode" id="cb946"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">ab.inner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  PID Hospital Age Sex  V1 Department
1   6      HUP  21   0 153  Neurology
2   7      HUP  63   1  89  Radiology
3   8 Stanford  22   0 112  Emergency
4   9     UCSF  19   0 228 Cardiology</code></pre>
<div class="sourceCode" id="cb948"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># same as</span>
<span class="op">(</span><span class="va">ab.inner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, by <span class="op">=</span> <span class="st">"PID"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  PID Hospital Age Sex  V1 Department
1   6      HUP  21   0 153  Neurology
2   7      HUP  63   1  89  Radiology
3   8 Stanford  22   0 112  Emergency
4   9     UCSF  19   0 228 Cardiology</code></pre>
<div class="sourceCode" id="cb950"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># same as</span>
<span class="op">(</span><span class="va">ab.inner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  PID Hospital Age Sex  V1 Department
1   6      HUP  21   0 153  Neurology
2   7      HUP  63   1  89  Radiology
3   8 Stanford  22   0 112  Emergency
4   9     UCSF  19   0 228 Cardiology</code></pre>
<p>Note that the resulting table only contains cases found in both data frames (i.e. IDs 6 through 9)</p>
</div>
<div id="outer-join" class="section level3" number="15.3.2">
<h3>
<span class="header-section-number">15.3.2</span> Outer join<a class="anchor" aria-label="anchor" href="#outer-join"><i class="fas fa-link"></i></a>
</h3>
<p>You can perform an <strong>outer join</strong> by specifying <code>all = TRUE</code>:</p>
<div class="sourceCode" id="cb952"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">ab.outer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>   PID Hospital Age Sex  V1 Department
1    1     UCSF  22   1  NA       &lt;NA&gt;
2    2      HUP  34   1  NA       &lt;NA&gt;
3    3 Stanford  41   0  NA       &lt;NA&gt;
4    4 Stanford  19   1  NA       &lt;NA&gt;
5    5     UCSF  53   0  NA       &lt;NA&gt;
6    6      HUP  21   0 153  Neurology
7    7      HUP  63   1  89  Radiology
8    8 Stanford  22   0 112  Emergency
9    9     UCSF  19   0 228 Cardiology
10  10     &lt;NA&gt;  NA  NA  91    Surgery
11  11     &lt;NA&gt;  NA  NA 190  Neurology
12  12     &lt;NA&gt;  NA  NA 101 Psychiatry</code></pre>
<div class="sourceCode" id="cb954"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">ab.outer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, by <span class="op">=</span> <span class="st">"PID"</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>   PID Hospital Age Sex  V1 Department
1    1     UCSF  22   1  NA       &lt;NA&gt;
2    2      HUP  34   1  NA       &lt;NA&gt;
3    3 Stanford  41   0  NA       &lt;NA&gt;
4    4 Stanford  19   1  NA       &lt;NA&gt;
5    5     UCSF  53   0  NA       &lt;NA&gt;
6    6      HUP  21   0 153  Neurology
7    7      HUP  63   1  89  Radiology
8    8 Stanford  22   0 112  Emergency
9    9     UCSF  19   0 228 Cardiology
10  10     &lt;NA&gt;  NA  NA  91    Surgery
11  11     &lt;NA&gt;  NA  NA 190  Neurology
12  12     &lt;NA&gt;  NA  NA 101 Psychiatry</code></pre>
<p>Note that the resulting data frame contains all IDs found in either input data frame and missing values are represented with <code>NA</code></p>
</div>
<div id="left-outer-join" class="section level3" number="15.3.3">
<h3>
<span class="header-section-number">15.3.3</span> Left outer join<a class="anchor" aria-label="anchor" href="#left-outer-join"><i class="fas fa-link"></i></a>
</h3>
<p>You can perform a <strong>left outer join</strong> by specifying <code>all.x = TRUE</code>:</p>
<div class="sourceCode" id="cb956"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">ab.leftOuter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  PID Hospital Age Sex  V1 Department
1   1     UCSF  22   1  NA       &lt;NA&gt;
2   2      HUP  34   1  NA       &lt;NA&gt;
3   3 Stanford  41   0  NA       &lt;NA&gt;
4   4 Stanford  19   1  NA       &lt;NA&gt;
5   5     UCSF  53   0  NA       &lt;NA&gt;
6   6      HUP  21   0 153  Neurology
7   7      HUP  63   1  89  Radiology
8   8 Stanford  22   0 112  Emergency
9   9     UCSF  19   0 228 Cardiology</code></pre>
<p>Note how the resulting data frame contains all IDs present in the left input data frame only.</p>
</div>
<div id="right-outer-join" class="section level3" number="15.3.4">
<h3>
<span class="header-section-number">15.3.4</span> Right outer join<a class="anchor" aria-label="anchor" href="#right-outer-join"><i class="fas fa-link"></i></a>
</h3>
<p>You can perform a <strong>right outer join</strong> by specifying <code>all.y = TRUE</code>:</p>
<div class="sourceCode" id="cb958"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">ab.rightOuter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, all.y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  PID Hospital Age Sex  V1 Department
1   6      HUP  21   0 153  Neurology
2   7      HUP  63   1  89  Radiology
3   8 Stanford  22   0 112  Emergency
4   9     UCSF  19   0 228 Cardiology
5  10     &lt;NA&gt;  NA  NA  91    Surgery
6  11     &lt;NA&gt;  NA  NA 190  Neurology
7  12     &lt;NA&gt;  NA  NA 101 Psychiatry</code></pre>
<p>Note how the resulting data frame contains all IDs present in the right input data frame only.</p>
</div>
</div>
<div id="wide-to-long" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Wide to Long<a class="anchor" aria-label="anchor" href="#wide-to-long"><i class="fas fa-link"></i></a>
</h2>
<div class="figure" style="text-align: center">
<span id="fig:wideLong"></span>
<img src="wide_long.png" alt="Wide and Long data format example. Take a moment to notice how the wide table on the left with 3 cases (3 IDs) and 3 variables gets converted from a 3 x 4 table to a 9 x 3 long table on the right. The values (outlined in magenta) are present once in each table: on the wide table they form an **ID x Variable** matrix, while on the long they are stacked on a **single column**. The IDs have to be repeated on the long table, once for each variable and there is a new 'Variable' column to provide the information present in the wide table's column names." width="100%"><p class="caption">
Figure 15.2: Wide and Long data format example. Take a moment to notice how the wide table on the left with 3 cases (3 IDs) and 3 variables gets converted from a 3 x 4 table to a 9 x 3 long table on the right. The values (outlined in magenta) are present once in each table: on the wide table they form an <strong>ID x Variable</strong> matrix, while on the long they are stacked on a <strong>single column</strong>. The IDs have to be repeated on the long table, once for each variable and there is a new ‘Variable’ column to provide the information present in the wide table’s column names.
</p>
</div>
<div class="sourceCode" id="cb960"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></code></pre></div>
<p>Let’s create an example data frame:</p>
<div class="sourceCode" id="cb961"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dat_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,
                       mango <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">2.1</span>, <span class="fl">3.1</span><span class="op">)</span>,
                       banana <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">2.2</span>, <span class="fl">3.2</span><span class="op">)</span>,
                       tangerine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="fl">2.3</span>, <span class="fl">3.3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  ID mango banana tangerine
1  1   1.1    1.2       1.3
2  2   2.1    2.2       2.3
3  3   3.1    3.2       3.3</code></pre>
<div id="base" class="section level3" number="15.4.1">
<h3>
<span class="header-section-number">15.4.1</span> base<a class="anchor" aria-label="anchor" href="#base"><i class="fas fa-link"></i></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/stats/reshape.html">reshape()</a></code> function is probably one of the most complicated because the documentation is not clear, specifically with regards to which arguments refer to the input vs. output data frame. Use the following figure as a guide to understand <code><a href="https://rdrr.io/r/stats/reshape.html">reshape()</a></code>’s syntax. You can use it as a reference when building your own <code><a href="https://rdrr.io/r/stats/reshape.html">reshape()</a></code> command by following steps 1 through 5:</p>
<div class="figure" style="text-align: center">
<span id="fig:wideLongSyntax"></span>
<img src="R_reshape_wide2long.png" alt="`reshape()` syntax for Wide to Long transformation." width="100%"><p class="caption">
Figure 15.3: <code><a href="https://rdrr.io/r/stats/reshape.html">reshape()</a></code> syntax for Wide to Long transformation.
</p>
</div>
<div class="sourceCode" id="cb963"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_wide2long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span><span class="co"># Data in wide format</span>
                         data <span class="op">=</span> <span class="va">dat_wide</span>,
                         <span class="co"># The column name that defines case ID</span>
                         idvar <span class="op">=</span> <span class="st">"ID"</span>,
                         <span class="co"># The columns whose values we want to keep</span>
                         varying <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,
                         <span class="co"># The name of the new column which will contain all </span>
                         <span class="co"># the values from the columns above</span>
                         v.names <span class="op">=</span> <span class="st">"Score"</span>,
                         <span class="co"># The values/names, of length = (N columns in "varying"), </span>
                         <span class="co">#that will be recycled to indicate which column from the </span>
                         <span class="co">#wide dataset each row corresponds to</span>
                         times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dat_wide</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>,
                         <span class="co"># The name of the new column created to hold the values </span>
                         <span class="co"># defined by "times"</span>
                         timevar <span class="op">=</span> <span class="st">"Fruit"</span>,                  
                         direction <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span> </code></pre></div>
<p>You can also define ‘varying’ with a character vector:<br><code>varying = list(c("mango", "banana","tangerine")</code></p>
<p>Explore the resulting data frame’s attributes:</p>
<div class="sourceCode" id="cb964"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">dat_wide2long</span><span class="op">)</span></code></pre></div>
<pre><code>$row.names
[1] "1.mango"     "2.mango"     "3.mango"     "1.banana"    "2.banana"   
[6] "3.banana"    "1.tangerine" "2.tangerine" "3.tangerine"

$names
[1] "ID"    "Fruit" "Score"

$class
[1] "data.frame"

$reshapeLong
$reshapeLong$varying
$reshapeLong$varying[[1]]
[1] "mango"     "banana"    "tangerine"


$reshapeLong$v.names
[1] "Score"

$reshapeLong$idvar
[1] "ID"

$reshapeLong$timevar
[1] "Fruit"</code></pre>
<p>These attributes and present if and only if a long data set was created from a wide as above. In that case, reshaping back to a wide data frame is as easy as:</p>
<div class="sourceCode" id="cb966"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span><span class="va">dat_wide2long</span><span class="op">)</span></code></pre></div>
<pre><code>        ID mango banana tangerine
1.mango  1   1.1    1.2       1.3
2.mango  2   2.1    2.2       2.3
3.mango  3   3.1    3.2       3.3</code></pre>
</div>
<div id="tidyr" class="section level3" number="15.4.2">
<h3>
<span class="header-section-number">15.4.2</span> tidyr<a class="anchor" aria-label="anchor" href="#tidyr"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb968"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_wide2long_tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">dat_wide</span>,
                           cols <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,
                           names_to <span class="op">=</span> <span class="st">"Fruit"</span>,
                           values_to <span class="op">=</span> <span class="st">"Score"</span><span class="op">)</span>
<span class="va">dat_wide2long_tv</span></code></pre></div>
<pre><code># A tibble: 9 x 3
     ID Fruit     Score
  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1     1 mango       1.1
2     1 banana      1.2
3     1 tangerine   1.3
4     2 mango       2.1
5     2 banana      2.2
6     2 tangerine   2.3
7     3 mango       3.1
8     3 banana      3.2
9     3 tangerine   3.3</code></pre>
</div>
<div id="data.table" class="section level3" number="15.4.3">
<h3>
<span class="header-section-number">15.4.3</span> data.table<a class="anchor" aria-label="anchor" href="#data.table"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb970"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_wide_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">dat_wide</span><span class="op">)</span>
<span class="va">dat_wide2long_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html">melt</a></span><span class="op">(</span><span class="va">dat_wide_dt</span>,
                         id.vars <span class="op">=</span> <span class="fl">1</span>,
                         measure.vars <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,
                         variable.name <span class="op">=</span> <span class="st">"Fruit"</span>,
                         value.name <span class="op">=</span> <span class="st">"Score"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">setorder</a></span><span class="op">(</span><span class="va">dat_wide2long_dt</span>, <span class="st">"ID"</span><span class="op">)</span>
<span class="va">dat_wide2long_dt</span></code></pre></div>
<pre><code>      ID     Fruit Score
   &lt;num&gt;    &lt;fctr&gt; &lt;num&gt;
1:     1     mango   1.1
2:     1    banana   1.2
3:     1 tangerine   1.3
4:     2     mango   2.1
5:     2    banana   2.2
6:     2 tangerine   2.3
7:     3     mango   3.1
8:     3    banana   3.2
9:     3 tangerine   3.3</code></pre>
</div>
</div>
<div id="long-to-wide" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> Long to Wide<a class="anchor" aria-label="anchor" href="#long-to-wide"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s create a long dataset:</p>
<div class="sourceCode" id="cb972"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dat_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,
                       Fruit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mango"</span>, <span class="st">"mango"</span>, <span class="st">"mango"</span>, 
                                 <span class="st">"banana"</span>, <span class="st">"banana"</span>, <span class="st">"banana"</span>, 
                                 <span class="st">"tangerine"</span>, <span class="st">"tangerine"</span>, <span class="st">"tangerine"</span><span class="op">)</span>,
                       Score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">2.1</span>, <span class="fl">3.1</span>, <span class="fl">1.2</span>, <span class="fl">2.2</span>, <span class="fl">3.2</span>, <span class="fl">1.3</span>, <span class="fl">2.3</span>, <span class="fl">3.3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  ID     Fruit Score
1  1     mango   1.1
2  2     mango   2.1
3  3     mango   3.1
4  1    banana   1.2
5  2    banana   2.2
6  3    banana   3.2
7  1 tangerine   1.3
8  2 tangerine   2.3
9  3 tangerine   3.3</code></pre>
<div id="base-1" class="section level3" number="15.5.1">
<h3>
<span class="header-section-number">15.5.1</span> base<a class="anchor" aria-label="anchor" href="#base-1"><i class="fas fa-link"></i></a>
</h3>
<p>Using base <code><a href="https://rdrr.io/r/stats/reshape.html">reshape()</a></code> for long-to-wide transformation is simpler than wide-to-long:</p>
<div class="figure" style="text-align: center">
<span id="fig:longWideSyntax"></span>
<img src="R_reshape_long2wide.png" alt="`reshape()` syntax for Long to Wide transformation." width="100%"><p class="caption">
Figure 15.4: <code><a href="https://rdrr.io/r/stats/reshape.html">reshape()</a></code> syntax for Long to Wide transformation.
</p>
</div>
<div class="sourceCode" id="cb974"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_long2wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span><span class="va">dat_long</span>,
                         idvar <span class="op">=</span> <span class="st">"ID"</span>,
                         timevar <span class="op">=</span> <span class="st">"Fruit"</span>,
                         v.names <span class="op">=</span> <span class="st">"Score"</span>,
                         direction <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span>
<span class="co"># Optionally rename columns</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dat_long2wide</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"Score."</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dat_long2wide</span><span class="op">)</span><span class="op">)</span>
<span class="va">dat_long2wide</span></code></pre></div>
<pre><code>  ID mango banana tangerine
1  1   1.1    1.2       1.3
2  2   2.1    2.2       2.3
3  3   3.1    3.2       3.3</code></pre>
</div>
<div id="tidyr-1" class="section level3" number="15.5.2">
<h3>
<span class="header-section-number">15.5.2</span> tidyr<a class="anchor" aria-label="anchor" href="#tidyr-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb976"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_long2wide_tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span><span class="va">dat_long</span>,
                                id_cols <span class="op">=</span> <span class="st">"ID"</span>,
                                names_from <span class="op">=</span> <span class="st">"Fruit"</span>,
                                values_from <span class="op">=</span> <span class="st">"Score"</span><span class="op">)</span>
<span class="va">dat_long2wide_tv</span></code></pre></div>
<pre><code># A tibble: 3 x 4
     ID mango banana tangerine
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
1     1   1.1    1.2       1.3
2     2   2.1    2.2       2.3
3     3   3.1    3.2       3.3</code></pre>
</div>
<div id="data.table-1" class="section level3" number="15.5.3">
<h3>
<span class="header-section-number">15.5.3</span> data.table<a class="anchor" aria-label="anchor" href="#data.table-1"><i class="fas fa-link"></i></a>
</h3>
<p><code>data.table</code>’s long to wide procedure is defined with a convenient formula notation:</p>
<div class="sourceCode" id="cb978"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_long_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">dat_long</span><span class="op">)</span>
<span class="va">dat_long2wide_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html">dcast</a></span><span class="op">(</span><span class="va">dat_long_dt</span>,
                          <span class="va">ID</span> <span class="op">~</span> <span class="va">Fruit</span>,
                          value.var <span class="op">=</span> <span class="st">"Score"</span><span class="op">)</span>
<span class="va">dat_long2wide_dt</span></code></pre></div>
<pre><code>Key: &lt;ID&gt;
      ID banana mango tangerine
   &lt;num&gt;  &lt;num&gt; &lt;num&gt;     &lt;num&gt;
1:     1    1.2   1.1       1.3
2:     2    2.2   2.1       2.3
3:     3    3.2   3.1       3.3</code></pre>
</div>
</div>
<div id="feature-transformation-with-transform" class="section level2" number="15.6">
<h2>
<span class="header-section-number">15.6</span> Feature transformation with <code>transform()</code><a class="anchor" aria-label="anchor" href="#feature-transformation-with-transform"><i class="fas fa-link"></i></a>
</h2>
<p>Make up some data:</p>
<div class="sourceCode" id="cb980"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
                  Height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.6</span>, <span class="fl">1.55</span>, <span class="fl">1.73</span>, <span class="fl">1.8</span><span class="op">)</span>,
                  Weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">70</span>, <span class="fl">69</span>, <span class="fl">76</span>, <span class="fl">91</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb981"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/transform.data.table.html">transform</a></span><span class="op">(</span><span class="va">dat</span>, BMI <span class="op">=</span> <span class="va">Weight</span><span class="op">/</span><span class="va">Height</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="va">dat</span></code></pre></div>
<pre><code>  Sex Height Weight      BMI
1   0   1.50     55 24.44444
2   0   1.60     70 27.34375
3   1   1.55     69 28.72008
4   1   1.73     76 25.39343
5   0   1.80     91 28.08642</code></pre>
<p><code><a href="https://Rdatatable.gitlab.io/data.table/reference/transform.data.table.html">transform()</a></code> is probably not used too often, because it is trivial to do the same with direct assignment:</p>
<div class="sourceCode" id="cb983"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span><span class="op">$</span><span class="va">BMI</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">Weight</span><span class="op">/</span><span class="va">dat</span><span class="op">$</span><span class="va">Height</span><span class="op">^</span><span class="fl">2</span></code></pre></div>
<p>but can be useful when adding multiple variables and/or used in a <a href="functions.html#pipe">pipe</a>:</p>
<div class="sourceCode" id="cb984"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="va">dat</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">Sex</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/transform.data.table.html">transform</a></span><span class="op">(</span>DeltaWeightFromMean <span class="op">=</span> <span class="va">Weight</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Weight</span><span class="op">)</span>,
            BMI <span class="op">=</span> <span class="va">Weight</span><span class="op">/</span><span class="va">Height</span><span class="op">^</span><span class="fl">2</span>,
            CI <span class="op">=</span> <span class="va">Weight</span><span class="op">/</span><span class="va">Height</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>  Sex Height Weight      BMI DeltaWeightFromMean       CI
1   0    1.5     55 24.44444                 -17 16.29630
2   0    1.6     70 27.34375                  -2 17.08984
5   0    1.8     91 28.08642                  19 15.60357</code></pre>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="functions.html"><span class="header-section-number">14</span> Functions</a></div>
<div class="next"><a href="datatrans.html"><span class="header-section-number">16</span> Data Transformations</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#dataframes"><span class="header-section-number">15</span> Working with data frames</a></li>
<li><a class="nav-link" href="#column-and-row-names"><span class="header-section-number">15.1</span> Column and row names</a></li>
<li><a class="nav-link" href="#delete-columns-or-rows"><span class="header-section-number">15.2</span> Delete columns or rows</a></li>
<li>
<a class="nav-link" href="#table-joins-i.e.-merging-data.frames"><span class="header-section-number">15.3</span> Table Joins (i.e. Merging data.frames)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#inner-join"><span class="header-section-number">15.3.1</span> Inner join</a></li>
<li><a class="nav-link" href="#outer-join"><span class="header-section-number">15.3.2</span> Outer join</a></li>
<li><a class="nav-link" href="#left-outer-join"><span class="header-section-number">15.3.3</span> Left outer join</a></li>
<li><a class="nav-link" href="#right-outer-join"><span class="header-section-number">15.3.4</span> Right outer join</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#wide-to-long"><span class="header-section-number">15.4</span> Wide to Long</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#base"><span class="header-section-number">15.4.1</span> base</a></li>
<li><a class="nav-link" href="#tidyr"><span class="header-section-number">15.4.2</span> tidyr</a></li>
<li><a class="nav-link" href="#data.table"><span class="header-section-number">15.4.3</span> data.table</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#long-to-wide"><span class="header-section-number">15.5</span> Long to Wide</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#base-1"><span class="header-section-number">15.5.1</span> base</a></li>
<li><a class="nav-link" href="#tidyr-1"><span class="header-section-number">15.5.2</span> tidyr</a></li>
<li><a class="nav-link" href="#data.table-1"><span class="header-section-number">15.5.3</span> data.table</a></li>
</ul>
</li>
<li><a class="nav-link" href="#feature-transformation-with-transform"><span class="header-section-number">15.6</span> Feature transformation with transform()</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Programming for Data Science in R</strong>" was written by Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD. It was last built on 2021-07-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
