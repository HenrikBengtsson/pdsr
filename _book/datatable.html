<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 21 Efficient data analysis with data.table | Programming for Data Science in R</title>
<meta name="author" content="Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><script src="libs/d3-3.5.6/d3.min.js"></script><link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet">
<script src="libs/profvis-0.3.6.9000/profvis.js"></script><script src="libs/profvis-0.3.6.9000/scroll.js"></script><link href="libs/highlight-6.2.0/textmate.css" rel="stylesheet">
<script src="libs/highlight-6.2.0/highlight.js"></script><script src="libs/profvis-binding-0.3.7/profvis.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163213745-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-163213745-1');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="bootstrap.lambdamd.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Programming for Data Science in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">PDSR</a></li>
<li><a class="" href="preface.html"><span class="header-section-number">1</span> Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="Rsetup.html"><span class="header-section-number">3</span> R setup, Packages &amp; Docs</a></li>
<li><a class="" href="basicops.html"><span class="header-section-number">4</span> Basic operations</a></li>
<li><a class="" href="types.html"><span class="header-section-number">5</span> Data Types</a></li>
<li><a class="" href="structures.html"><span class="header-section-number">6</span> Data Structures</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">7</span> Factors</a></li>
<li><a class="" href="indexing.html"><span class="header-section-number">8</span> Indexing - Subsetting - Slicing</a></li>
<li><a class="" href="vectorization.html"><span class="header-section-number">9</span> Vectorized Operations</a></li>
<li><a class="" href="dataio.html"><span class="header-section-number">10</span> Data Input/Output</a></li>
<li><a class="" href="controlflow.html"><span class="header-section-number">11</span> Control flow</a></li>
<li><a class="" href="loopfns.html"><span class="header-section-number">12</span> Loop Functions</a></li>
<li><a class="" href="summarize.html"><span class="header-section-number">13</span> Summarizing Data</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">14</span> Functions</a></li>
<li><a class="" href="dataframes.html"><span class="header-section-number">15</span> Working with data frames</a></li>
<li><a class="" href="datatrans.html"><span class="header-section-number">16</span> Data Transformations</a></li>
<li><a class="" href="stringops.html"><span class="header-section-number">17</span> String Operations</a></li>
<li><a class="" href="datetime.html"><span class="header-section-number">18</span> Date and Time</a></li>
<li><a class="" href="missingdata.html"><span class="header-section-number">19</span> Handling Missing data</a></li>
<li><a class="" href="classes.html"><span class="header-section-number">20</span> Classes and Object-Oriented Programming</a></li>
<li><a class="active" href="datatable.html"><span class="header-section-number">21</span> Efficient data analysis with data.table</a></li>
<li><a class="" href="basegraphics.html"><span class="header-section-number">22</span> Base Graphics</a></li>
<li><a class="" href="graphics3x.html"><span class="header-section-number">23</span> 3x Graphics</a></li>
<li><a class="" href="colors.html"><span class="header-section-number">24</span> Colors in R</a></li>
<li><a class="" href="profiling.html"><span class="header-section-number">25</span> Timing &amp; Profiling</a></li>
<li><a class="" href="optim.html"><span class="header-section-number">26</span> Optimization with optim()</a></li>
<li><a class="" href="glm.html"><span class="header-section-number">27</span> Introduction to the GLM</a></li>
<li><a class="" href="resampling.html"><span class="header-section-number">28</span> Resampling</a></li>
<li><a class="" href="supervised.html"><span class="header-section-number">29</span> Supervised Learning</a></li>
<li><a class="" href="unsupervised.html"><span class="header-section-number">30</span> Unsupervised Learning</a></li>
<li><a class="" href="git.html"><span class="header-section-number">31</span> Git &amp; GitHub: the basics</a></li>
<li><a class="" href="shell.html"><span class="header-section-number">32</span> Introduction to the system shell</a></li>
<li><a class="" href="resources.html"><span class="header-section-number">33</span> Resources</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="datatable" class="section level1" number="21">
<h1>
<span class="header-section-number">21</span> Efficient data analysis with <strong>data.table</strong><a class="anchor" aria-label="anchor" href="#datatable"><i class="fas fa-link"></i></a>
</h1>
<style type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>The <a href="https://github.com/Rdatatable/data.table"><strong>data.table</strong></a> package provides a modern and highly optimized version of R’s data.frame structure. It is highly memory efficient and automatically parallelizes internal operations to achieve substantial speed improvements over data.frames. The <strong>data.table</strong> package weighs in at just a few kilobytes, has zero dependencies, and maintains compatibility with R versions going as far back as possible.</p>
<div id="installation" class="section level3" number="21.0.1">
<h3>
<span class="header-section-number">21.0.1</span> Installation<a class="anchor" aria-label="anchor" href="#installation"><i class="fas fa-link"></i></a>
</h3>
<p>You can install <strong>data.table</strong> from CRAN or GitHub. Check out the <a href="https://github.com/Rdatatable/data.table/wiki/Installation">data.table wiki</a> for more info.</p>
</div>
<div id="data.table-significantly-extends-the-data.frame" class="section level3" number="21.0.2">
<h3>
<span class="header-section-number">21.0.2</span> <code>data.table</code> significantly extends the <code>data.frame</code><a class="anchor" aria-label="anchor" href="#data.table-significantly-extends-the-data.frame"><i class="fas fa-link"></i></a>
</h3>
<p>There are two main ways in which a <code>data.table</code> differs from a <code>data.frame</code>:</p>
<ul>
<li>You can perform many operations <strong><em>“in-place”</em></strong> without creating a copy (i.e. make changes to a <code>data.table</code> without having to assign it back to itself).</li>
<li>There is a lot more than indexing and slicing that you can do within a <code>data.table</code>’s “frame” i.e. the square brackets after a <code>data.table</code>, like applying any custom function to specific columns and/or cases.</li>
</ul>
<div class="sourceCode" id="cb1300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rtemis.lambdamd.org">rtemis</a></span><span class="op">)</span></code></pre></div>
<pre><code>  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation &amp; vignettes: https://rtemis.lambdamd.org</code></pre>
<div class="sourceCode" id="cb1302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></code></pre></div>
<pre><code>
Attaching package: 'data.table'</code></pre>
<pre><code>The following object is masked from 'package:rtemis':

    cube</code></pre>
<p><code>data.table</code> operations remain as close as possible to <code>data.frame</code> operations, trying to extend rather than replace the latter’s functionality. This is great because a lot of what an R user would already be familiar with in using data.frames is applicable here as well.</p>
</div>
<div id="create-a-data.table" class="section level2" number="21.1">
<h2>
<span class="header-section-number">21.1</span> Create a <code>data.table</code><a class="anchor" aria-label="anchor" href="#create-a-data.table"><i class="fas fa-link"></i></a>
</h2>
<div id="by-assignment-data.table" class="section level3" number="21.1.1">
<h3>
<span class="header-section-number">21.1.1</span> By assignment: <code>data.table()</code><a class="anchor" aria-label="anchor" href="#by-assignment-data.table"><i class="fas fa-link"></i></a>
</h3>
<p>Same syntax as <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>:</p>
<div class="sourceCode" id="cb1305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
                  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span><span class="op">)</span>,
                  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  A   B C
1 1 1.2 a
2 2 4.3 b
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "data.frame"</code></pre>
<div class="sourceCode" id="cb1309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
                  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span><span class="op">)</span>,
                  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;char&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
<div class="sourceCode" id="cb1311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "data.table" "data.frame"</code></pre>
<p>Notice how <code>data.table</code> inherits from <code>data.frame</code>. This means that if a method does not exist for <code>data.table</code>, the method for <code>data.frame</code> will be used (review <a href="classes.html#classes">classes and generic functions</a>.
One difference from <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>, as you can see above, is that <code>stringsAsFactors</code> defaults to FALSE in <code><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table()</a></code>. As part of improving efficieny, data.tables do away with row names. Instead of using rownames, you can and should add an extra column with the same information - this is advisable when working with data.frames as well.</p>
<p>A rather convenient option is to have data.tables print each column’s class below the column name. You can pass the argument <code>class = TRUE</code> to <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> or set the global option <code>datatable.print.class</code> using <code><a href="https://rdrr.io/r/base/options.html">options()</a></code></p>
<div class="sourceCode" id="cb1313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>datatable.print.class <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;char&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
<div class="sourceCode" id="cb1315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
                  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span><span class="op">)</span>,
                  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span><span class="op">)</span>,
                  stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
</div>
<div id="by-coercion-as.data.table" class="section level3" number="21.1.2">
<h3>
<span class="header-section-number">21.1.2</span> By coercion: <code>as.data.table()</code><a class="anchor" aria-label="anchor" href="#by-coercion-as.data.table"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
                  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span><span class="op">)</span>,
                  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span>
<span class="op">(</span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;char&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
</div>
<div id="by-coercion-in-place-setdt" class="section level3" number="21.1.3">
<h3>
<span class="header-section-number">21.1.3</span> By coercion <strong><em>in-place</em></strong>: <code>setDT()</code><a class="anchor" aria-label="anchor" href="#by-coercion-in-place-setdt"><i class="fas fa-link"></i></a>
</h3>
<p><code>setDT</code> converts a list or data.frame into a <code>data.table</code> in-place. Note: the original object itself is changed, you do not need to assign the output of <code>setDT</code> to a new name.</p>
<div class="sourceCode" id="cb1319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
                  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span><span class="op">)</span>,
                  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "data.frame"</code></pre>
<div class="sourceCode" id="cb1321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "data.table" "data.frame"</code></pre>
<p>You can similarly convert a <code>data.table</code> to a <code>data.frame</code>, in-place:</p>
<div class="sourceCode" id="cb1323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDF.html">setDF</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "data.frame"</code></pre>
</div>
<div id="read-into-data.table-from-file" class="section level3" number="21.1.4">
<h3>
<span class="header-section-number">21.1.4</span> Read into <code>data.table</code> from file<a class="anchor" aria-label="anchor" href="#read-into-data.table-from-file"><i class="fas fa-link"></i></a>
</h3>
<p><strong>data.table</strong> includes the <code><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread()</a></code> function to read data from files, in a similar way as the base functions <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> and <code><a href="https://rdrr.io/r/utils/read.table.html">read.table()</a></code>. It is orders of magnitude faster for very large data (e.g. thousands to millions of rows) and it can read directly from URLs, and zipped files. The <code>sep</code> arguments defines the separator (same as in <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> and <code><a href="https://rdrr.io/r/utils/read.table.html">read.table()</a></code>), but when set to <code>"auto"</code> (the default) it does a great job of figuring it out by itself.</p>
<div class="sourceCode" id="cb1325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"path/to/file.csv"</span><span class="op">)</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"https::/url/to/file.csv.gz"</span><span class="op">)</span></code></pre></div>
<p>For its speed and convenience, <code><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread()</a></code> is recommended over <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code>/<code><a href="https://rdrr.io/r/utils/read.table.html">read.table()</a></code> even if you intend to work with a <code>data.frame</code> exclusively, in which case you can pass the argument <code>data.table = FALSE</code> to <code><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread()</a></code></p>
</div>
<div id="write-a-data.table-to-file-fwrite" class="section level3" number="21.1.5">
<h3>
<span class="header-section-number">21.1.5</span> Write a <code>data.table</code> to file: <code>fwrite()</code><a class="anchor" aria-label="anchor" href="#write-a-data.table-to-file-fwrite"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fwrite.html">fwrite</a></span><span class="op">(</span><span class="va">dt</span>, <span class="st">"/path/to/file.csv"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="combine-data.tables" class="section level2" number="21.2">
<h2>
<span class="header-section-number">21.2</span> Combine <code>data.table</code>s<a class="anchor" aria-label="anchor" href="#combine-data.tables"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code> and <code><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind()</a></code> work on <code>data.table</code>s the same as on <code>data.frame</code>s:</p>
<div class="sourceCode" id="cb1327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="va">dt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dt1</span>, <span class="va">dt2</span><span class="op">)</span></code></pre></div>
<pre><code>       a     b
   &lt;int&gt; &lt;int&gt;
1:     1    11
2:     2    12
3:     3    13
4:     4    14
5:     5    15</code></pre>
<div class="sourceCode" id="cb1329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">dt1</span>, <span class="va">dt1</span><span class="op">)</span></code></pre></div>
<pre><code>        a
    &lt;int&gt;
 1:     1
 2:     2
 3:     3
 4:     4
 5:     5
 6:     1
 7:     2
 8:     3
 9:     4
10:     5</code></pre>
</div>
<div id="str-works-the-same-and-you-should-keep-using-it" class="section level2" number="21.3">
<h2>
<span class="header-section-number">21.3</span> <code>str</code> works the same (and you should keep using it!)<a class="anchor" aria-label="anchor" href="#str-works-the-same-and-you-should-keep-using-it"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb1331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>'data.frame':   5 obs. of  3 variables:
 $ A: int  1 2 3 4 5
 $ B: num  1.2 4.3 9.7 5.6 8.1
 $ C: chr  "a" "b" "b" "a" ...</code></pre>
<div class="sourceCode" id="cb1333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></code></pre></div>
<pre><code>Classes 'data.table' and 'data.frame':  5 obs. of  3 variables:
 $ A: int  1 2 3 4 5
 $ B: num  1.2 4.3 9.7 5.6 8.1
 $ C: Factor w/ 2 levels "a","b": 1 2 2 1 1
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
<div id="indexing-a-data.table" class="section level2" number="21.4">
<h2>
<span class="header-section-number">21.4</span> Indexing a <code>data.table</code><a class="anchor" aria-label="anchor" href="#indexing-a-data.table"><i class="fas fa-link"></i></a>
</h2>
<p>Indexing is largely unchanged, with a few notable exceptions.<br>
Integer indexing is mostly the same:</p>
<div class="sourceCode" id="cb1335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></code></pre></div>
<pre><code>  A   B C
1 1 1.2 a</code></pre>
<div class="sourceCode" id="cb1337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt;
1:     1   1.2      a</code></pre>
<p>Selecting a single column with integer indexing in <code>data.table</code> does not drop to a vector (i.e. similar to <code>drop = FALSE</code> in a data.frame):</p>
<div class="sourceCode" id="cb1339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></code></pre></div>
<pre><code>[1] 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb1341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span>, <span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></code></pre></div>
<pre><code>  A
1 1
2 2
3 3
4 4
5 5</code></pre>
<div class="sourceCode" id="cb1343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></code></pre></div>
<pre><code>       A
   &lt;int&gt;
1:     1
2:     2
3:     3
4:     4
5:     5</code></pre>
<p>In <code>data.table</code>, you can access column names directly without quoting or using <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code>:</p>
<div class="sourceCode" id="cb1345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span>, <span class="st">"B"</span><span class="op">]</span></code></pre></div>
<pre><code>[1] 1.2 4.3 9.7 5.6 8.1</code></pre>
<div class="sourceCode" id="cb1347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">$</span><span class="va">B</span></code></pre></div>
<pre><code>[1] 1.2 4.3 9.7 5.6 8.1</code></pre>
<div class="sourceCode" id="cb1349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">B</span><span class="op">]</span></code></pre></div>
<pre><code>[1] 1.2 4.3 9.7 5.6 8.1</code></pre>
<div class="sourceCode" id="cb1351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">B</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="op">]</span></code></pre></div>
<pre><code>  A   B C
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">df</span><span class="op">[</span><span class="va">B</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>  A   B C
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span><span class="va">B</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="op">]</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt;
1:     3   9.7      b
2:     4   5.6      a
3:     5   8.1      a</code></pre>
<p>Think of working inside the <code>data.table</code> frame (i.e. the “[…]”) like an environment. You have direct access to the variables within it.<br>
If you want to refer to variables outside the <code>data.table</code>, prefix the variable name with <code>..</code>. This is similar to how you access contents of a directory above your current directory in the terminal:</p>
<div class="sourceCode" id="cb1357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">varname</span> <span class="op">=</span> <span class="st">"C"</span>
<span class="va">df</span><span class="op">[</span>, <span class="va">varname</span><span class="op">]</span></code></pre></div>
<pre><code>[1] "a" "b" "b" "a" "a"</code></pre>
<div class="sourceCode" id="cb1359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">..varname</span><span class="op">]</span></code></pre></div>
<pre><code>        C
   &lt;fctr&gt;
1:      a
2:      b
3:      b
4:      a
5:      a</code></pre>
<p>This tells the <code>data.table</code> “don’t look for ‘varname’ in the data.table, go outside to find it”</p>
<div id="conditionally-select-cases" class="section level3" number="21.4.1">
<h3>
<span class="header-section-number">21.4.1</span> Conditionally select cases:<a class="anchor" aria-label="anchor" href="#conditionally-select-cases"><i class="fas fa-link"></i></a>
</h3>
<p>It is easy to select cases by combining conditions by using column names directly. Note that <code>data.table</code> does not require you to add “,” to select all columns after you have specified rows - works just the same if you so include it:</p>
<p>There are a few way to conditionally select in a data.frame:</p>
<div class="sourceCode" id="cb1361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">A</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">A</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">B</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">B</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
<pre><code>  A   B C
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">A</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">B</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  A   B C
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">df</span><span class="op">[</span><span class="va">A</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">B</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>  A   B C
5 5 8.1 a</code></pre>
<p>The data.table equivalent is probably simplest:</p>
<div class="sourceCode" id="cb1367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span><span class="va">A</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">B</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt;
1:     5   8.1      a</code></pre>
<div class="sourceCode" id="cb1369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtemis/man/rnormmat.html">rnormmat</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">2020</span>, return.df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>           V1          V2          V3          V4          V5
1   0.3769721 -0.85312282  2.17436525 -0.81250466  0.90850113
2   0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
3  -1.0980232  1.19637296  0.31822032  1.09534507 -0.30100401
4  -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
5  -2.7965343 -0.12326023  0.83426874  0.38811847 -1.18007703
6   0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
7   0.9391210  1.70399588  1.29784138 -0.28559829 -0.37071130
8  -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
9   1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
10  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364</code></pre>
<div class="sourceCode" id="cb1371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fl">7</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">adt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">V3</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
<pre><code>           V1          V2          V3          V4          V5
2   0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
3  -1.0980232  1.19637296  0.31822032          NA -0.30100401
4  -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
6   0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
8  -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
9   1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
10  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364</code></pre>
<div class="sourceCode" id="cb1374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adt</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">V3</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>           V1          V2          V3          V4          V5
        &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
1:  0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
2: -1.0980232  1.19637296  0.31822032          NA -0.30100401
3: -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
4:  0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
5: -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
6:  1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
7:  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364</code></pre>
</div>
<div id="select-columns" class="section level3" number="21.4.2">
<h3>
<span class="header-section-number">21.4.2</span> Select columns<a class="anchor" aria-label="anchor" href="#select-columns"><i class="fas fa-link"></i></a>
</h3>
<p>by integer index, same as with a data.frame</p>
<div class="sourceCode" id="cb1376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></code></pre></div>
<pre><code>       B
   &lt;num&gt;
1:   1.2
2:   4.3
3:   9.7
4:   5.6
5:   8.1</code></pre>
<div class="sourceCode" id="cb1378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>       B      C
   &lt;num&gt; &lt;fctr&gt;
1:   1.2      a
2:   4.3      b
3:   9.7      b
4:   5.6      a
5:   8.1      a</code></pre>
<div class="sourceCode" id="cb1380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>       A      C
   &lt;int&gt; &lt;fctr&gt;
1:     1      a
2:     2      b
3:     3      b
4:     4      a
5:     5      a</code></pre>
<p>by name: selecting a single column by name returns a vector:</p>
<div class="sourceCode" id="cb1382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">A</span><span class="op">]</span></code></pre></div>
<pre><code>[1] 1 2 3 4 5</code></pre>
<p>by name: selecting one or more columns by name enclosed in <code>.()</code> which, in this case, is short for <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>, return a <code>data.table</code>:</p>
<div class="sourceCode" id="cb1384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>       A
   &lt;int&gt;
1:     1
2:     2
3:     3
4:     4
5:     5</code></pre>
<div class="sourceCode" id="cb1386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>       A     B
   &lt;int&gt; &lt;num&gt;
1:     1   1.2
2:     2   4.3
3:     3   9.7
4:     4   5.6
5:     5   8.1</code></pre>
</div>
</div>
<div id="add-new-columns-in-place" class="section level2" number="21.5">
<h2>
<span class="header-section-number">21.5</span> Add new columns <strong><em>in-place</em></strong><a class="anchor" aria-label="anchor" href="#add-new-columns-in-place"><i class="fas fa-link"></i></a>
</h2>
<p>Use <code>:=</code> assignment to add a new column in the existing <code>data.table</code>.
Once again, in-place means you do not have to assign the result to a variable, the existing <code>data.table</code> will be changed.</p>
<div class="sourceCode" id="cb1388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">AplusC</span> <span class="op">:=</span> <span class="va">A</span> <span class="op">+</span> <span class="va">C</span><span class="op">]</span></code></pre></div>
<pre><code>Warning in Ops.factor(A, C): '+' not meaningful for factors</code></pre>
<div class="sourceCode" id="cb1390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span></code></pre></div>
<pre><code>       A     B      C AplusC
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt; &lt;lgcl&gt;
1:     1   1.2      a     NA
2:     2   4.3      b     NA
3:     3   9.7      b     NA
4:     4   5.6      a     NA
5:     5   8.1      a     NA</code></pre>
</div>
<div id="add-multiple-columns-in-place" class="section level2" number="21.6">
<h2>
<span class="header-section-number">21.6</span> Add multiple columns <strong><em>in-place</em></strong><a class="anchor" aria-label="anchor" href="#add-multiple-columns-in-place"><i class="fas fa-link"></i></a>
</h2>
<p>To add multiple columns, use <code>:=</code> in a little more awkward notation:</p>
<div class="sourceCode" id="cb1392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span>AminusC <span class="op">=</span> <span class="va">A</span> <span class="op">-</span> <span class="va">C</span>, AoverC <span class="op">=</span> <span class="va">A</span> <span class="op">/</span> <span class="va">C</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>Warning in Ops.factor(A, C): '-' not meaningful for factors</code></pre>
<pre><code>Warning in Ops.factor(A, C): '/' not meaningful for factors</code></pre>
<div class="sourceCode" id="cb1395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span></code></pre></div>
<pre><code>       A     B      C AplusC AminusC AoverC
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt; &lt;lgcl&gt;  &lt;lgcl&gt; &lt;lgcl&gt;
1:     1   1.2      a     NA      NA     NA
2:     2   4.3      b     NA      NA     NA
3:     3   9.7      b     NA      NA     NA
4:     4   5.6      a     NA      NA     NA
5:     5   8.1      a     NA      NA     NA</code></pre>
</div>
<div id="convert-column-type" class="section level2" number="21.7">
<h2>
<span class="header-section-number">21.7</span> Convert column type<a class="anchor" aria-label="anchor" href="#convert-column-type"><i class="fas fa-link"></i></a>
</h2>
<p>Use any base R coercion function (<code>as.*</code>) to convert a column in-place using the <code>:=</code> notation</p>
<div class="sourceCode" id="cb1397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">A</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">]</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       A     B      C AplusC AminusC AoverC
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt; &lt;lgcl&gt;  &lt;lgcl&gt; &lt;lgcl&gt;
1:     1   1.2      a     NA      NA     NA
2:     2   4.3      b     NA      NA     NA
3:     3   9.7      b     NA      NA     NA
4:     4   5.6      a     NA      NA     NA
5:     5   8.1      a     NA      NA     NA</code></pre>
</div>
<div id="delete-column-in-place" class="section level2" number="21.8">
<h2>
<span class="header-section-number">21.8</span> Delete column in-place<a class="anchor" aria-label="anchor" href="#delete-column-in-place"><i class="fas fa-link"></i></a>
</h2>
<p>To delete a column, use <code>:=</code> to set it to NULL:</p>
<div class="sourceCode" id="cb1399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">AoverC</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       A     B      C AplusC AminusC
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt; &lt;lgcl&gt;  &lt;lgcl&gt;
1:     1   1.2      a     NA      NA
2:     2   4.3      b     NA      NA
3:     3   9.7      b     NA      NA
4:     4   5.6      a     NA      NA
5:     5   8.1      a     NA      NA</code></pre>
<p>Same awkward notation as earlier to delete multiple columns:</p>
<div class="sourceCode" id="cb1401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span>AplusC <span class="op">=</span> <span class="cn">NULL</span>, AminusC <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">]</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       A     B      C
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
</div>
<div id="summarize-2" class="section level2" number="21.9">
<h2>
<span class="header-section-number">21.9</span> Summarize<a class="anchor" aria-label="anchor" href="#summarize-2"><i class="fas fa-link"></i></a>
</h2>
<p>Create a <em>new</em> data.table using any summary function:</p>
<div class="sourceCode" id="cb1403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Asummary</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>Amax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>, Amin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>, Asd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="va">Asummary</span></code></pre></div>
<pre><code>    Amax  Amin      Asd
   &lt;num&gt; &lt;num&gt;    &lt;num&gt;
1:     5     1 1.581139</code></pre>
<div id="address-object-location-in-memory" class="section level3" number="21.9.1">
<h3>
<span class="header-section-number">21.9.1</span> <code>address</code>: Object location in memory<a class="anchor" aria-label="anchor" href="#address-object-location-in-memory"><i class="fas fa-link"></i></a>
</h3>
<p>When you add a new column to an existing data.frame, the data.frame is copied behind the scenes - you can tell becasue its memory address (where it’s physically stored in your computer) changes:</p>
<div class="sourceCode" id="cb1405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, beta <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79f15ecc8"</code></pre>
<div class="sourceCode" id="cb1407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df1</span><span class="op">$</span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="va">df1</span><span class="op">$</span><span class="va">alpha</span> <span class="op">+</span> <span class="va">df1</span><span class="op">$</span><span class="va">beta</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79f3a1788"</code></pre>
<p>When you add a new column in a data.table <strong><em>in-place</em></strong> its address remains unchanged:</p>
<div class="sourceCode" id="cb1409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, beta <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">dt1</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79d9c1200"</code></pre>
<div class="sourceCode" id="cb1411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt1</span><span class="op">[</span>, <span class="va">gamma</span> <span class="op">:=</span> <span class="va">alpha</span> <span class="op">+</span> <span class="va">beta</span><span class="op">]</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">dt1</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79d9c1200"</code></pre>
</div>
<div id="reference-semantics-at-work" class="section level3" number="21.9.2">
<h3>
<span class="header-section-number">21.9.2</span> Reference semantics at work<a class="anchor" aria-label="anchor" href="#reference-semantics-at-work"><i class="fas fa-link"></i></a>
</h3>
<p>Up to now, you are likely used to working with regular R objects that behave like this:</p>
<div class="sourceCode" id="cb1413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>  a
1 1
2 1
3 1
4 1
5 1</code></pre>
<div class="sourceCode" id="cb1415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df1</span><span class="op">)</span></code></pre></div>
<pre><code>  a
1 1
2 1
3 1
4 1
5 1</code></pre>
<div class="sourceCode" id="cb1417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df2</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">df2</span><span class="op">$</span><span class="va">a</span><span class="op">*</span><span class="fl">2</span>
<span class="va">df2</span></code></pre></div>
<pre><code>  a
1 2
2 2
3 2
4 2
5 2</code></pre>
<div class="sourceCode" id="cb1419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df1</span></code></pre></div>
<pre><code>  a
1 1
2 1
3 1
4 1
5 1</code></pre>
<div class="sourceCode" id="cb1421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79d01f3f0"</code></pre>
<div class="sourceCode" id="cb1423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc798522368"</code></pre>
<p><code>data.table</code> uses “reference semantics” or “pass-by-reference.” Be very careful or you might be mightily confused:</p>
<div class="sourceCode" id="cb1425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     1
2:     1
3:     1
4:     1
5:     1</code></pre>
<div class="sourceCode" id="cb1427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dt2</span> <span class="op">&lt;-</span> <span class="va">dt1</span><span class="op">)</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     1
2:     1
3:     1
4:     1
5:     1</code></pre>
<div class="sourceCode" id="cb1429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt2</span><span class="op">[</span>, <span class="va">a</span> <span class="op">:=</span> <span class="va">a</span> <span class="op">*</span> <span class="fl">2</span><span class="op">]</span>
<span class="va">dt2</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     2
2:     2
3:     2
4:     2
5:     2</code></pre>
<div class="sourceCode" id="cb1431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt1</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     2
2:     2
3:     2
4:     2
5:     2</code></pre>
<div class="sourceCode" id="cb1433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">dt1</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79b695600"</code></pre>
<div class="sourceCode" id="cb1435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">dt2</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79b695600"</code></pre>
<div class="rmdnote">
<p>
If you want to create a copy of a data.table, use <code><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy()</a></code>:
</p>
</div>
<div class="sourceCode" id="cb1437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">dt1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     2
2:     2
3:     2
4:     2
5:     2</code></pre>
<div class="sourceCode" id="cb1439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">dt3</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc7a00f8000"</code></pre>
<div class="sourceCode" id="cb1441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt3</span><span class="op">[</span>, <span class="va">a</span> <span class="op">:=</span> <span class="va">a</span> <span class="op">*</span> <span class="fl">2</span><span class="op">]</span>
<span class="va">dt3</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     4
2:     4
3:     4
4:     4
5:     4</code></pre>
<div class="sourceCode" id="cb1443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt1</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     2
2:     2
3:     2
4:     2
5:     2</code></pre>
</div>
</div>
<div id="set-set-attributes-in-place" class="section level2" number="21.10">
<h2>
<span class="header-section-number">21.10</span> <code>set*()</code>: Set attributes <strong><em>in-place</em></strong><a class="anchor" aria-label="anchor" href="#set-set-attributes-in-place"><i class="fas fa-link"></i></a>
</h2>
<p><code>data.table</code> includes a number of function that begin with <code>set*</code>, all of which change their input <em>by reference</em> and as such require no assignment.<br>
You may be surprised to find out that even an inocuous operation like changing the column names of a data.frame, requires a copy:</p>
<div class="sourceCode" id="cb1445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79ea42ba8"</code></pre>
<div class="sourceCode" id="cb1447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"Group"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc79b69bf08"</code></pre>
<p>Use <code><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html">setnames()</a></code> to edit a <code>data.table</code>’s column names <strong><em>in-place</em></strong>:</p>
<div class="sourceCode" id="cb1449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc7a00ab200"</code></pre>
<div class="sourceCode" id="cb1451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html">setnames</a></span><span class="op">(</span><span class="va">dt</span>, old <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"Group"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html">address</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "0x7fc7a00ab200"</code></pre>
</div>
<div id="setorder-set-order-of-data.table" class="section level2" number="21.11">
<h2>
<span class="header-section-number">21.11</span> <code>setorder()</code>: Set order of <code>data.table</code><a class="anchor" aria-label="anchor" href="#setorder-set-order-of-data.table"><i class="fas fa-link"></i></a>
</h2>
<p>Since this is a <code>set*</code> function, it changes a <code>data.table</code> in-place. You can order by any number of columns, ascending or descending:<br>
Order by Group and then by A:</p>
<div class="sourceCode" id="cb1453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">setorder</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">Group</span>, <span class="va">A</span><span class="op">)</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       A     B  Group
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;
1:     1   1.2      a
2:     4   5.6      a
3:     5   8.1      a
4:     2   4.3      b
5:     3   9.7      b</code></pre>
<p>Order by Group and then by decreasing B:</p>
<div class="sourceCode" id="cb1455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">setorder</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">Group</span>, <span class="op">-</span><span class="va">B</span><span class="op">)</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       A     B  Group
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;
1:     5   8.1      a
2:     4   5.6      a
3:     1   1.2      a
4:     3   9.7      b
5:     2   4.3      b</code></pre>
</div>
<div id="group-according-to-by" class="section level2" number="21.12">
<h2>
<span class="header-section-number">21.12</span> Group according to <code>by</code><a class="anchor" aria-label="anchor" href="#group-according-to-by"><i class="fas fa-link"></i></a>
</h2>
<p>Up to now, we have learned how to use the <code>data.table</code> frame <code>dat[i, j]</code> to filter cases in <code>i</code> or add/remove/transform columns in-place in <code>j</code>. There is a whole other dimension in the <code>data.table</code> frame: <code>by</code>.</p>
<div class="rmdtip">
<p>
The complete <code>data.table</code> syntax is:
</p>
<p>
<code>dt[i, j, by]</code>
</p>
<ul>
<li>
Take data.table <code>dt</code>
</li>
<li>
Subset rows using <code>i</code>
</li>
<li>
Manipulate columns with <code>j</code>
</li>
<li>
Grouped according to <code>by</code>
</li>
</ul>
</div>
<p>Again, using <code>.()</code> or <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> in <code>j</code>, returns a new <code>data.table</code>:</p>
<div class="sourceCode" id="cb1457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>meanAbyGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">Group</span><span class="op">]</span></code></pre></div>
<pre><code>    Group meanAbyGroup
   &lt;fctr&gt;        &lt;num&gt;
1:      a     3.333333
2:      b     2.500000</code></pre>
<div class="sourceCode" id="cb1459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>medianBbyGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">Group</span><span class="op">]</span></code></pre></div>
<pre><code>    Group medianBbyGroup
   &lt;fctr&gt;          &lt;num&gt;
1:      a            5.6
2:      b            7.0</code></pre>
<p>Making an assignment with <code>:=</code> in <code>j</code>, adds a column in-place. Since here we are grouping, the same value will be assigned to all cases of the group:</p>
<div class="sourceCode" id="cb1461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">meanAbyGroup</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">Group</span><span class="op">]</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       A     B  Group meanAbyGroup
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;        &lt;num&gt;
1:     5   8.1      a     3.333333
2:     4   5.6      a     3.333333
3:     1   1.2      a     3.333333
4:     3   9.7      b     2.500000
5:     2   4.3      b     2.500000</code></pre>
<p>For more complex operations, you may need to refer to the slice of the <code>data.table</code> defined by <code>by</code> within <code>j</code>. There is a special notation for this: <code>.SD</code> (think sub-<code>data.table</code>):</p>
<div class="sourceCode" id="cb1463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">A_DiffFromGroupMin</span> <span class="op">:=</span> <span class="va">.SD</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">.SD</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">Group</span><span class="op">]</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       A     B  Group meanAbyGroup A_DiffFromGroupMin
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;        &lt;num&gt;              &lt;num&gt;
1:     5   8.1      a     3.333333                  4
2:     4   5.6      a     3.333333                  3
3:     1   1.2      a     3.333333                  0
4:     3   9.7      b     2.500000                  1
5:     2   4.3      b     2.500000                  0</code></pre>
<div class="rmdnote">
<p>
By now, it should be clearer that the <code>data.table</code> frame provides a very flexible way to perform a very wide range of operations with minimal new notation.
</p>
</div>
</div>
<div id="apply-functions-to-columns" class="section level2" number="21.13">
<h2>
<span class="header-section-number">21.13</span> Apply functions to columns<a class="anchor" aria-label="anchor" href="#apply-functions-to-columns"><i class="fas fa-link"></i></a>
</h2>
<p>Any function that returns a list can be used in <code>j</code> to return a new data.table - therefore lapply is perfect for getting summary on multiple columns:</p>
<div class="sourceCode" id="cb1465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rtemis/man/rnormmat.html">rnormmat</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">3</span>, seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>            V1          V2          V3
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
 1:  0.3769721 -0.85312282  2.17436525
 2:  0.3015484  0.90925918  1.09818265
 3: -1.0980232  1.19637296  0.31822032
 4: -1.1304059 -0.37158390 -0.07314756
 5: -2.7965343 -0.12326023  0.83426874
 6:  0.7205735  1.80004312  0.19875064
 7:  0.9391210  1.70399588  1.29784138
 8: -0.2293777 -3.03876461  0.93671831
 9:  1.7591313 -2.28897495 -0.14743319
10:  0.1173668  0.05830349  0.11043199</code></pre>
<div class="sourceCode" id="cb1467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html">setnames</a></span><span class="op">(</span><span class="va">dt1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alpha"</span>, <span class="st">"Beta"</span>, <span class="st">"Gamma"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dt1</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>        Alpha       Beta     Gamma
        &lt;num&gt;      &lt;num&gt;     &lt;num&gt;
1: -0.1039628 -0.1007732 0.6748199</code></pre>
<p>You can specify which columns to operate on by adding the <code>.SDcols</code> argument:</p>
<div class="sourceCode" id="cb1469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
                  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span><span class="op">)</span>,
                  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,
                  Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dt2</span></code></pre></div>
<pre><code>       A     B          C  Group
   &lt;int&gt; &lt;num&gt;      &lt;num&gt; &lt;char&gt;
1:     1   1.2 -0.8125047      a
2:     2   4.3 -0.7437022      b
3:     3   9.7  1.0953451      b
4:     4   5.6  2.4353737      a
5:     5   8.1  0.3881185      a</code></pre>
<div class="sourceCode" id="cb1471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></code></pre></div>
<pre><code>       A     B
   &lt;num&gt; &lt;num&gt;
1:     3  5.78</code></pre>
<div class="sourceCode" id="cb1473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># same as</span>
<span class="va">dt2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>       A     B
   &lt;num&gt; &lt;num&gt;
1:     3  5.78</code></pre>
<div class="sourceCode" id="cb1475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>
<span class="va">dt2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">cols</span><span class="op">]</span></code></pre></div>
<pre><code>       A     B
   &lt;num&gt; &lt;num&gt;
1:     3  5.78</code></pre>
<p>You can combine <code>.SDcols</code> and <code>by</code>:</p>
<div class="sourceCode" id="cb1477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">median</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">Group</span><span class="op">]</span></code></pre></div>
<pre><code>    Group     B         C
   &lt;char&gt; &lt;num&gt;     &lt;num&gt;
1:      a   5.6 0.3881185
2:      b   7.0 0.1758215</code></pre>
<p>Create multiple new columns from transformation of existing and store with custom prefix:</p>
<div class="sourceCode" id="cb1479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt1</span></code></pre></div>
<pre><code>         Alpha        Beta       Gamma
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
 1:  0.3769721 -0.85312282  2.17436525
 2:  0.3015484  0.90925918  1.09818265
 3: -1.0980232  1.19637296  0.31822032
 4: -1.1304059 -0.37158390 -0.07314756
 5: -2.7965343 -0.12326023  0.83426874
 6:  0.7205735  1.80004312  0.19875064
 7:  0.9391210  1.70399588  1.29784138
 8: -0.2293777 -3.03876461  0.93671831
 9:  1.7591313 -2.28897495 -0.14743319
10:  0.1173668  0.05830349  0.11043199</code></pre>
<div class="sourceCode" id="cb1481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt1</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dt1</span><span class="op">)</span>, <span class="st">"_abs"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">abs</span><span class="op">)</span><span class="op">]</span>
<span class="va">dt1</span></code></pre></div>
<pre><code>         Alpha        Beta       Gamma Alpha_abs   Beta_abs  Gamma_abs
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:  0.3769721 -0.85312282  2.17436525 0.3769721 0.85312282 2.17436525
 2:  0.3015484  0.90925918  1.09818265 0.3015484 0.90925918 1.09818265
 3: -1.0980232  1.19637296  0.31822032 1.0980232 1.19637296 0.31822032
 4: -1.1304059 -0.37158390 -0.07314756 1.1304059 0.37158390 0.07314756
 5: -2.7965343 -0.12326023  0.83426874 2.7965343 0.12326023 0.83426874
 6:  0.7205735  1.80004312  0.19875064 0.7205735 1.80004312 0.19875064
 7:  0.9391210  1.70399588  1.29784138 0.9391210 1.70399588 1.29784138
 8: -0.2293777 -3.03876461  0.93671831 0.2293777 3.03876461 0.93671831
 9:  1.7591313 -2.28897495 -0.14743319 1.7591313 2.28897495 0.14743319
10:  0.1173668  0.05830349  0.11043199 0.1173668 0.05830349 0.11043199</code></pre>
<div class="sourceCode" id="cb1483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt2</span></code></pre></div>
<pre><code>       A     B          C  Group
   &lt;int&gt; &lt;num&gt;      &lt;num&gt; &lt;char&gt;
1:     1   1.2 -0.8125047      a
2:     2   4.3 -0.7437022      b
3:     3   9.7  1.0953451      b
4:     4   5.6  2.4353737      a
5:     5   8.1  0.3881185      a</code></pre>
<div class="sourceCode" id="cb1485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span><span class="op">)</span>
<span class="va">dt2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">cols</span>, <span class="st">"_groupMean"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">cols</span>, by <span class="op">=</span> <span class="va">Group</span><span class="op">]</span>
<span class="va">dt2</span></code></pre></div>
<pre><code>       A     B          C  Group A_groupMean C_groupMean
   &lt;int&gt; &lt;num&gt;      &lt;num&gt; &lt;char&gt;       &lt;num&gt;       &lt;num&gt;
1:     1   1.2 -0.8125047      a    3.333333   0.6703292
2:     2   4.3 -0.7437022      b    2.500000   0.1758215
3:     3   9.7  1.0953451      b    2.500000   0.1758215
4:     4   5.6  2.4353737      a    3.333333   0.6703292
5:     5   8.1  0.3881185      a    3.333333   0.6703292</code></pre>
</div>
<div id="row-wise-operations" class="section level2" number="21.14">
<h2>
<span class="header-section-number">21.14</span> Row-wise operations<a class="anchor" aria-label="anchor" href="#row-wise-operations"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb1487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, b <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">15</span>, c <span class="op">=</span> <span class="fl">21</span><span class="op">:</span><span class="fl">25</span>, d <span class="op">=</span> <span class="fl">31</span><span class="op">:</span><span class="fl">35</span>, e <span class="op">=</span> <span class="fl">41</span><span class="op">:</span><span class="fl">45</span><span class="op">)</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       a     b     c     d     e
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1:     1    11    21    31    41
2:     2    12    22    32    42
3:     3    13    23    33    43
4:     4    14    24    34    44
5:     5    15    25    35    45</code></pre>
<p>To operate row-wise, we can use <code>by = 1:nrow(dt)</code>.
For example, to add a column, in-place, with row-wise sums of variables b through d:</p>
<div class="sourceCode" id="cb1489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span><span class="op">[</span>, <span class="va">bcd.sum</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.SD</span><span class="op">[</span>, <span class="va">b</span><span class="op">:</span><span class="va">d</span><span class="op">]</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">]</span>
<span class="va">dt</span></code></pre></div>
<pre><code>       a     b     c     d     e bcd.sum
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
1:     1    11    21    31    41      63
2:     2    12    22    32    42      66
3:     3    13    23    33    43      69
4:     4    14    24    34    44      72
5:     5    15    25    35    45      75</code></pre>
</div>
<div id="wide-long" class="section level2" number="21.15">
<h2>
<span class="header-section-number">21.15</span> Wide &lt;=&gt; Long<a class="anchor" aria-label="anchor" href="#wide-long"><i class="fas fa-link"></i></a>
</h2>
<div id="melt-wide-to-long" class="section level3" number="21.15.1">
<h3>
<span class="header-section-number">21.15.1</span> <code>melt()</code>: Wide to long<a class="anchor" aria-label="anchor" href="#melt-wide-to-long"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, Timepoint_A <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">14</span>,
                      Timepoint_B <span class="op">=</span> <span class="fl">21</span><span class="op">:</span><span class="fl">24</span>, Timepoint_C <span class="op">=</span> <span class="fl">51</span><span class="op">:</span><span class="fl">54</span><span class="op">)</span>
<span class="va">dt_wide</span></code></pre></div>
<pre><code>      ID Timepoint_A Timepoint_B Timepoint_C
   &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
1:     1          11          21          51
2:     2          12          22          52
3:     3          13          23          53
4:     4          14          24          54</code></pre>
<div class="sourceCode" id="cb1493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html">melt</a></span><span class="op">(</span><span class="va">dt_wide</span>, id.vars <span class="op">=</span> <span class="st">"ID"</span>,
                measure.vars <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="co"># defaults to all non-id columns</span>
                variable.name <span class="op">=</span> <span class="st">"Timepoint"</span>,
                value.name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Score"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dt_long</span></code></pre></div>
<pre><code>       ID   Timepoint Score
    &lt;int&gt;      &lt;fctr&gt; &lt;int&gt;
 1:     1 Timepoint_A    11
 2:     2 Timepoint_A    12
 3:     3 Timepoint_A    13
 4:     4 Timepoint_A    14
 5:     1 Timepoint_B    21
 6:     2 Timepoint_B    22
 7:     3 Timepoint_B    23
 8:     4 Timepoint_B    24
 9:     1 Timepoint_C    51
10:     2 Timepoint_C    52
11:     3 Timepoint_C    53
12:     4 Timepoint_C    54</code></pre>
</div>
<div id="dcast-long-to-wide" class="section level3" number="21.15.2">
<h3>
<span class="header-section-number">21.15.2</span> <code>dcast()</code>: Long to wide<a class="anchor" aria-label="anchor" href="#dcast-long-to-wide"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_long</span></code></pre></div>
<pre><code>       ID   Timepoint Score
    &lt;int&gt;      &lt;fctr&gt; &lt;int&gt;
 1:     1 Timepoint_A    11
 2:     2 Timepoint_A    12
 3:     3 Timepoint_A    13
 4:     4 Timepoint_A    14
 5:     1 Timepoint_B    21
 6:     2 Timepoint_B    22
 7:     3 Timepoint_B    23
 8:     4 Timepoint_B    24
 9:     1 Timepoint_C    51
10:     2 Timepoint_C    52
11:     3 Timepoint_C    53
12:     4 Timepoint_C    54</code></pre>
<div class="sourceCode" id="cb1497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html">dcast</a></span><span class="op">(</span><span class="va">dt_long</span>, <span class="va">ID</span> <span class="op">~</span> <span class="va">Timepoint</span>,
      value.var <span class="op">=</span> <span class="st">"Score"</span><span class="op">)</span></code></pre></div>
<pre><code>Key: &lt;ID&gt;
      ID Timepoint_A Timepoint_B Timepoint_C
   &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
1:     1          11          21          51
2:     2          12          22          52
3:     3          13          23          53
4:     4          14          24          54</code></pre>
</div>
</div>
<div id="table-joins" class="section level2" number="21.16">
<h2>
<span class="header-section-number">21.16</span> Table Joins<a class="anchor" aria-label="anchor" href="#table-joins"><i class="fas fa-link"></i></a>
</h2>
<p><code>data.table</code> allow you to perform table joins with the base <code><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge()</a></code> function using the same syntax as for data.frame objects or the “data.table way” using bracket notation:</p>
<div class="sourceCode" id="cb1499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>PID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>,
                Hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"UCSF"</span>, <span class="st">"HUP"</span>, <span class="st">"Stanford"</span>, 
                             <span class="st">"Stanford"</span>, <span class="st">"UCSF"</span>, <span class="st">"HUP"</span>, 
                             <span class="st">"HUP"</span>, <span class="st">"Stanford"</span>, <span class="st">"UCSF"</span><span class="op">)</span>,
                Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">34</span>, <span class="fl">41</span>, <span class="fl">19</span>, <span class="fl">53</span>, <span class="fl">21</span>, <span class="fl">63</span>, <span class="fl">22</span>, <span class="fl">19</span><span class="op">)</span>,
                Sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,
                key <span class="op">=</span> <span class="st">"PID"</span><span class="op">)</span>
<span class="va">a</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;
1:     1     UCSF    22     1
2:     2      HUP    34     1
3:     3 Stanford    41     0
4:     4 Stanford    19     1
5:     5     UCSF    53     0
6:     6      HUP    21     0
7:     7      HUP    63     1
8:     8 Stanford    22     0
9:     9     UCSF    19     0</code></pre>
<div class="sourceCode" id="cb1501"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>PID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>,
                V1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">153</span>, <span class="fl">89</span>, <span class="fl">112</span>, <span class="fl">228</span>,  <span class="fl">91</span>, <span class="fl">190</span>, <span class="fl">101</span><span class="op">)</span>,
                Department <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Neurology"</span>, <span class="st">"Radiology"</span>, <span class="st">"Emergency"</span>,
                               <span class="st">"Cardiology"</span>, <span class="st">"Surgery"</span>, <span class="st">"Neurology"</span>,
                               <span class="st">"Psychiatry"</span><span class="op">)</span>,
                key <span class="op">=</span> <span class="st">"PID"</span><span class="op">)</span>
<span class="va">b</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID    V1 Department
   &lt;int&gt; &lt;num&gt;     &lt;char&gt;
1:     6   153  Neurology
2:     7    89  Radiology
3:     8   112  Emergency
4:     9   228 Cardiology
5:    10    91    Surgery
6:    11   190  Neurology
7:    12   101 Psychiatry</code></pre>
<p>In the above command we use the <code>key</code> argument to set <code>PID</code> as key. This can be performed after the <code>data.table</code> has been created using the <code><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html">setkey()</a></code> command:</p>
<div class="sourceCode" id="cb1503"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html">setkey</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">PID</span><span class="op">)</span></code></pre></div>
<p>Multiple keys can be set, in order, with the same <code><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html">setkey()</a></code> command, separated by commas, e.g.:</p>
<div class="sourceCode" id="cb1504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html">setkey</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">PID</span>, <span class="va">Hospital</span><span class="op">)</span></code></pre></div>
<p>Keys sort the data.table by the corresponding columns and can be used to perform left and right joins with bracket notation seen later.</p>
<div id="inner" class="section level3" number="21.16.1">
<h3>
<span class="header-section-number">21.16.1</span> Inner<a class="anchor" aria-label="anchor" href="#inner"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1505"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex    V1 Department
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology</code></pre>
</div>
<div id="outer" class="section level3" number="21.16.2">
<h3>
<span class="header-section-number">21.16.2</span> Outer<a class="anchor" aria-label="anchor" href="#outer"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1507"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
      PID Hospital   Age   Sex    V1 Department
    &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
 1:     1     UCSF    22     1    NA       &lt;NA&gt;
 2:     2      HUP    34     1    NA       &lt;NA&gt;
 3:     3 Stanford    41     0    NA       &lt;NA&gt;
 4:     4 Stanford    19     1    NA       &lt;NA&gt;
 5:     5     UCSF    53     0    NA       &lt;NA&gt;
 6:     6      HUP    21     0   153  Neurology
 7:     7      HUP    63     1    89  Radiology
 8:     8 Stanford    22     0   112  Emergency
 9:     9     UCSF    19     0   228 Cardiology
10:    10     &lt;NA&gt;    NA    NA    91    Surgery
11:    11     &lt;NA&gt;    NA    NA   190  Neurology
12:    12     &lt;NA&gt;    NA    NA   101 Psychiatry</code></pre>
</div>
<div id="left-outer" class="section level3" number="21.16.3">
<h3>
<span class="header-section-number">21.16.3</span> Left outer<a class="anchor" aria-label="anchor" href="#left-outer"><i class="fas fa-link"></i></a>
</h3>
<p>Using <code><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge()</a></code>:</p>
<div class="sourceCode" id="cb1509"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex    V1 Department
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
1:     1     UCSF    22     1    NA       &lt;NA&gt;
2:     2      HUP    34     1    NA       &lt;NA&gt;
3:     3 Stanford    41     0    NA       &lt;NA&gt;
4:     4 Stanford    19     1    NA       &lt;NA&gt;
5:     5     UCSF    53     0    NA       &lt;NA&gt;
6:     6      HUP    21     0   153  Neurology
7:     7      HUP    63     1    89  Radiology
8:     8 Stanford    22     0   112  Emergency
9:     9     UCSF    19     0   228 Cardiology</code></pre>
<p>Using bracket notation:</p>
<div class="sourceCode" id="cb1511"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span><span class="op">[</span><span class="va">a</span>, <span class="op">]</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID    V1 Department Hospital   Age   Sex
   &lt;int&gt; &lt;num&gt;     &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;
1:     1    NA       &lt;NA&gt;     UCSF    22     1
2:     2    NA       &lt;NA&gt;      HUP    34     1
3:     3    NA       &lt;NA&gt; Stanford    41     0
4:     4    NA       &lt;NA&gt; Stanford    19     1
5:     5    NA       &lt;NA&gt;     UCSF    53     0
6:     6   153  Neurology      HUP    21     0
7:     7    89  Radiology      HUP    63     1
8:     8   112  Emergency Stanford    22     0
9:     9   228 Cardiology     UCSF    19     0</code></pre>
<p>If keys were not set for a and b, you could specify the column to match on using the <code>on</code> argument:</p>
<div class="sourceCode" id="cb1513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span><span class="op">[</span><span class="va">a</span>, on <span class="op">=</span> <span class="st">"PID"</span><span class="op">]</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID    V1 Department Hospital   Age   Sex
   &lt;int&gt; &lt;num&gt;     &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;
1:     1    NA       &lt;NA&gt;     UCSF    22     1
2:     2    NA       &lt;NA&gt;      HUP    34     1
3:     3    NA       &lt;NA&gt; Stanford    41     0
4:     4    NA       &lt;NA&gt; Stanford    19     1
5:     5    NA       &lt;NA&gt;     UCSF    53     0
6:     6   153  Neurology      HUP    21     0
7:     7    89  Radiology      HUP    63     1
8:     8   112  Emergency Stanford    22     0
9:     9   228 Cardiology     UCSF    19     0</code></pre>
<div class="rmdnote">
<p>
The easy way to understand the bracket notation merges is to think that the data.table inside the bracket is used to index the data.table on the outside, therefore the resulting table will have rows dictated by the inside table’s key.
</p>
</div>
</div>
<div id="right-outer" class="section level3" number="21.16.4">
<h3>
<span class="header-section-number">21.16.4</span> Right outer<a class="anchor" aria-label="anchor" href="#right-outer"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, all.y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex    V1 Department
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology
5:    10     &lt;NA&gt;    NA    NA    91    Surgery
6:    11     &lt;NA&gt;    NA    NA   190  Neurology
7:    12     &lt;NA&gt;    NA    NA   101 Psychiatry</code></pre>
<p>Using bracket notation:</p>
<div class="sourceCode" id="cb1517"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span><span class="op">[</span><span class="va">b</span>, <span class="op">]</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex    V1 Department
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology
5:    10     &lt;NA&gt;    NA    NA    91    Surgery
6:    11     &lt;NA&gt;    NA    NA   190  Neurology
7:    12     &lt;NA&gt;    NA    NA   101 Psychiatry</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="classes.html"><span class="header-section-number">20</span> Classes and Object-Oriented Programming</a></div>
<div class="next"><a href="basegraphics.html"><span class="header-section-number">22</span> Base Graphics</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#datatable"><span class="header-section-number">21</span> Efficient data analysis with data.table</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#installation"><span class="header-section-number">21.0.1</span> Installation</a></li>
<li><a class="nav-link" href="#data.table-significantly-extends-the-data.frame"><span class="header-section-number">21.0.2</span> data.table significantly extends the data.frame</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#create-a-data.table"><span class="header-section-number">21.1</span> Create a data.table</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#by-assignment-data.table"><span class="header-section-number">21.1.1</span> By assignment: data.table()</a></li>
<li><a class="nav-link" href="#by-coercion-as.data.table"><span class="header-section-number">21.1.2</span> By coercion: as.data.table()</a></li>
<li><a class="nav-link" href="#by-coercion-in-place-setdt"><span class="header-section-number">21.1.3</span> By coercion in-place: setDT()</a></li>
<li><a class="nav-link" href="#read-into-data.table-from-file"><span class="header-section-number">21.1.4</span> Read into data.table from file</a></li>
<li><a class="nav-link" href="#write-a-data.table-to-file-fwrite"><span class="header-section-number">21.1.5</span> Write a data.table to file: fwrite()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#combine-data.tables"><span class="header-section-number">21.2</span> Combine data.tables</a></li>
<li><a class="nav-link" href="#str-works-the-same-and-you-should-keep-using-it"><span class="header-section-number">21.3</span> str works the same (and you should keep using it!)</a></li>
<li>
<a class="nav-link" href="#indexing-a-data.table"><span class="header-section-number">21.4</span> Indexing a data.table</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#conditionally-select-cases"><span class="header-section-number">21.4.1</span> Conditionally select cases:</a></li>
<li><a class="nav-link" href="#select-columns"><span class="header-section-number">21.4.2</span> Select columns</a></li>
</ul>
</li>
<li><a class="nav-link" href="#add-new-columns-in-place"><span class="header-section-number">21.5</span> Add new columns in-place</a></li>
<li><a class="nav-link" href="#add-multiple-columns-in-place"><span class="header-section-number">21.6</span> Add multiple columns in-place</a></li>
<li><a class="nav-link" href="#convert-column-type"><span class="header-section-number">21.7</span> Convert column type</a></li>
<li><a class="nav-link" href="#delete-column-in-place"><span class="header-section-number">21.8</span> Delete column in-place</a></li>
<li>
<a class="nav-link" href="#summarize-2"><span class="header-section-number">21.9</span> Summarize</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#address-object-location-in-memory"><span class="header-section-number">21.9.1</span> address: Object location in memory</a></li>
<li><a class="nav-link" href="#reference-semantics-at-work"><span class="header-section-number">21.9.2</span> Reference semantics at work</a></li>
</ul>
</li>
<li><a class="nav-link" href="#set-set-attributes-in-place"><span class="header-section-number">21.10</span> set*(): Set attributes in-place</a></li>
<li><a class="nav-link" href="#setorder-set-order-of-data.table"><span class="header-section-number">21.11</span> setorder(): Set order of data.table</a></li>
<li><a class="nav-link" href="#group-according-to-by"><span class="header-section-number">21.12</span> Group according to by</a></li>
<li><a class="nav-link" href="#apply-functions-to-columns"><span class="header-section-number">21.13</span> Apply functions to columns</a></li>
<li><a class="nav-link" href="#row-wise-operations"><span class="header-section-number">21.14</span> Row-wise operations</a></li>
<li>
<a class="nav-link" href="#wide-long"><span class="header-section-number">21.15</span> Wide &lt;=&gt; Long</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#melt-wide-to-long"><span class="header-section-number">21.15.1</span> melt(): Wide to long</a></li>
<li><a class="nav-link" href="#dcast-long-to-wide"><span class="header-section-number">21.15.2</span> dcast(): Long to wide</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#table-joins"><span class="header-section-number">21.16</span> Table Joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#inner"><span class="header-section-number">21.16.1</span> Inner</a></li>
<li><a class="nav-link" href="#outer"><span class="header-section-number">21.16.2</span> Outer</a></li>
<li><a class="nav-link" href="#left-outer"><span class="header-section-number">21.16.3</span> Left outer</a></li>
<li><a class="nav-link" href="#right-outer"><span class="header-section-number">21.16.4</span> Right outer</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Programming for Data Science in R</strong>" was written by Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD. It was last built on 2021-07-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
