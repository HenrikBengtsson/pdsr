<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14 Functions | Programming for Data Science in R</title>
<meta name="author" content="Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><script src="libs/d3-3.5.6/d3.min.js"></script><link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet">
<script src="libs/profvis-0.3.6.9000/profvis.js"></script><script src="libs/profvis-0.3.6.9000/scroll.js"></script><link href="libs/highlight-6.2.0/textmate.css" rel="stylesheet">
<script src="libs/highlight-6.2.0/highlight.js"></script><script src="libs/profvis-binding-0.3.7/profvis.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163213745-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-163213745-1');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="bootstrap.lambdamd.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Programming for Data Science in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">PDSR</a></li>
<li><a class="" href="preface.html"><span class="header-section-number">1</span> Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="Rsetup.html"><span class="header-section-number">3</span> R setup, Packages &amp; Docs</a></li>
<li><a class="" href="basicops.html"><span class="header-section-number">4</span> Basic operations</a></li>
<li><a class="" href="types.html"><span class="header-section-number">5</span> Data Types</a></li>
<li><a class="" href="structures.html"><span class="header-section-number">6</span> Data Structures</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">7</span> Factors</a></li>
<li><a class="" href="indexing.html"><span class="header-section-number">8</span> Indexing - Subsetting - Slicing</a></li>
<li><a class="" href="vectorization.html"><span class="header-section-number">9</span> Vectorized Operations</a></li>
<li><a class="" href="dataio.html"><span class="header-section-number">10</span> Data Input/Output</a></li>
<li><a class="" href="controlflow.html"><span class="header-section-number">11</span> Control flow</a></li>
<li><a class="" href="loopfns.html"><span class="header-section-number">12</span> Loop Functions</a></li>
<li><a class="" href="summarize.html"><span class="header-section-number">13</span> Summarizing Data</a></li>
<li><a class="active" href="functions.html"><span class="header-section-number">14</span> Functions</a></li>
<li><a class="" href="dataframes.html"><span class="header-section-number">15</span> Working with data frames</a></li>
<li><a class="" href="datatrans.html"><span class="header-section-number">16</span> Data Transformations</a></li>
<li><a class="" href="stringops.html"><span class="header-section-number">17</span> String Operations</a></li>
<li><a class="" href="datetime.html"><span class="header-section-number">18</span> Date and Time</a></li>
<li><a class="" href="missingdata.html"><span class="header-section-number">19</span> Handling Missing data</a></li>
<li><a class="" href="classes.html"><span class="header-section-number">20</span> Classes and Object-Oriented Programming</a></li>
<li><a class="" href="datatable.html"><span class="header-section-number">21</span> Efficient data analysis with data.table</a></li>
<li><a class="" href="basegraphics.html"><span class="header-section-number">22</span> Base Graphics</a></li>
<li><a class="" href="graphics3x.html"><span class="header-section-number">23</span> 3x Graphics</a></li>
<li><a class="" href="colors.html"><span class="header-section-number">24</span> Colors in R</a></li>
<li><a class="" href="profiling.html"><span class="header-section-number">25</span> Timing &amp; Profiling</a></li>
<li><a class="" href="optim.html"><span class="header-section-number">26</span> Optimization with optim()</a></li>
<li><a class="" href="glm.html"><span class="header-section-number">27</span> Introduction to the GLM</a></li>
<li><a class="" href="resampling.html"><span class="header-section-number">28</span> Resampling</a></li>
<li><a class="" href="supervised.html"><span class="header-section-number">29</span> Supervised Learning</a></li>
<li><a class="" href="unsupervised.html"><span class="header-section-number">30</span> Unsupervised Learning</a></li>
<li><a class="" href="git.html"><span class="header-section-number">31</span> Git &amp; GitHub: the basics</a></li>
<li><a class="" href="shell.html"><span class="header-section-number">32</span> Introduction to the system shell</a></li>
<li><a class="" href="resources.html"><span class="header-section-number">33</span> Resources</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="functions" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> Functions<a class="anchor" aria-label="anchor" href="#functions"><i class="fas fa-link"></i></a>
</h1>
<p>Writing functions is a core part of programming.
When should you write a function?<br>
Whenever you find yourself repeating pieces of code.<br>
Why is it important?<br>
Writing functions helps reduce the total amount of code, which reduces the chances of error, and makes your code more readable.</p>
<p>Reminder: Functions in R are “first class objects.”<br>
This means you can pass them in and out of other functions or objects like any other R structure.<br>
For example, we have seen that you can use a command like <code><a href="https://rdrr.io/r/base/apply.html">apply(mat, 2, mean)</a></code></p>
<p>Functions in R are <em>for the most part</em> like mathematical functions: they have one or more inputs and one output. The inputs are known as the function arguments. If you want to return multiple outputs, you can return a list containing any number of R objects.</p>
<div id="simple-functions" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Simple functions<a class="anchor" aria-label="anchor" href="#simple-functions"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s start with a very simple function: single argument with no default value:</p>
<div class="sourceCode" id="cb868"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">square</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span>

<span class="fu">square</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 9</code></pre>
<p>Notice above that <code>x^2</code> is automatically returned by the function. It is the same as explicitly returning it with <code><a href="https://rdrr.io/r/base/function.html">return()</a></code>:</p>
<div class="sourceCode" id="cb870"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">square</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">square</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 16</code></pre>
<p>which is the same as:</p>
<div class="sourceCode" id="cb872"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">square</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span>
  <span class="va">out</span>
<span class="op">}</span>

<span class="fu">square</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 25</code></pre>
<p>A function returns either:</p>
<ul>
<li>an object passed to <code><a href="https://rdrr.io/r/base/function.html">return()</a></code>
</li>
<li>the value of the last expression within the function definition such as <code>out</code> or <code>x^2</code> above.</li>
</ul>
<p>Note that the following function definition does not return anything:</p>
<div class="sourceCode" id="cb874"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span>

<span class="fu">sq</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/function.html">return()</a></code> is a way to end evaluation early:</p>
<div class="sourceCode" id="cb875"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">square.pos</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">x</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The input was left unchanged\n"</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] 9</code></pre>
<div class="sourceCode" id="cb877"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">square.pos</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 81</code></pre>
<p>Multiple arguments, with and without defaults:</p>
<div class="sourceCode" id="cb879"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">power</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">^</span><span class="va">power</span>
<span class="op">}</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] 6</code></pre>
<div class="sourceCode" id="cb881"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">raise</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 36</code></pre>
<div class="sourceCode" id="cb883"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">raise</span><span class="op">(</span><span class="va">x</span>, power <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 216</code></pre>
<div class="sourceCode" id="cb885"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">raise</span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 216</code></pre>
</div>
<div id="arguments-with-prescribed-list-of-allowed-values" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Arguments with prescribed list of allowed values<a class="anchor" aria-label="anchor" href="#arguments-with-prescribed-list-of-allowed-values"><i class="fas fa-link"></i></a>
</h2>
<p>You can match specific values for an argument using <code><a href="https://rdrr.io/r/base/match.arg.html">match.arg()</a></code>:</p>
<div class="sourceCode" id="cb887"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myfn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"gamma"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"You have selected type '"</span>, <span class="va">type</span>, <span class="st">"'\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">myfn</span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span></code></pre></div>
<pre><code>You have selected type 'alpha'</code></pre>
<div class="sourceCode" id="cb889"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">myfn</span><span class="op">(</span><span class="st">"b"</span><span class="op">)</span></code></pre></div>
<pre><code>You have selected type 'beta'</code></pre>
<div class="sourceCode" id="cb891"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">myfn</span><span class="op">(</span><span class="st">"g"</span><span class="op">)</span></code></pre></div>
<pre><code>You have selected type 'gamma'</code></pre>
<div class="sourceCode" id="cb893"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">myfn</span><span class="op">(</span><span class="st">"d"</span><span class="op">)</span></code></pre></div>
<pre><code>Error in match.arg(type): 'arg' should be one of "alpha", "beta", "gamma"</code></pre>
<p>Above you see that partial matching using <code><a href="https://rdrr.io/r/base/match.arg.html">match.arg()</a></code> was able to identify a valid option, and when there was no match, an informative error was printed.</p>
<p>Partial matching is also automatically done on the argument names themselves, but it’s important to avoid depending on that.</p>
<div class="sourceCode" id="cb895"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adsr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">attack</span> <span class="op">=</span> <span class="fl">100</span>,
                 <span class="va">decay</span> <span class="op">=</span> <span class="fl">250</span>,
                 <span class="va">sustain</span> <span class="op">=</span> <span class="fl">40</span>,
                 <span class="va">release</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Attack time:"</span>, <span class="va">attack</span>, <span class="st">"ms\n"</span>,
      <span class="st">"Decay time:"</span>, <span class="va">decay</span>, <span class="st">"ms\n"</span>,
      <span class="st">"Sustain level:"</span>, <span class="va">sustain</span>, <span class="st">"\n"</span>,
      <span class="st">"Release time:"</span>, <span class="va">release</span>, <span class="st">"ms\n"</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">adsr</span><span class="op">(</span><span class="fl">50</span>, s <span class="op">=</span> <span class="fl">100</span>, r <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></code></pre></div>
<pre><code>Attack time: 50 ms
 Decay time: 250 ms
 Sustain level: 100 
 Release time: 500 ms</code></pre>
</div>
<div id="passing-extra-arguments-to-another-function-with-the-...-argument" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Passing extra arguments to another function with the <code>...</code> argument<a class="anchor" aria-label="anchor" href="#passing-extra-arguments-to-another-function-with-the-...-argument"><i class="fas fa-link"></i></a>
</h2>
<p>Many functions include a <code>...</code> argument at the end. Any arguments not otherwise matched are collected there. A common use for this is to pass them to another function:</p>
<div class="sourceCode" id="cb897"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>,
                  <span class="va">cex</span> <span class="op">=</span> <span class="fl">1.5</span>,
                  <span class="va">pch</span> <span class="op">=</span> <span class="fl">16</span>,
                  <span class="va">col</span> <span class="op">=</span> <span class="st">"#18A3AC"</span>,
                  <span class="va">bty</span> <span class="op">=</span> <span class="st">"n"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, cex <span class="op">=</span> <span class="va">cex</span>, pch <span class="op">=</span> <span class="va">pch</span>, col <span class="op">=</span> <span class="va">col</span>, bty <span class="op">=</span> <span class="va">bty</span>, <span class="va">...</span><span class="op">)</span>
                  <span class="op">}</span></code></pre></div>
<p><code>...</code> is also used for variable number of iputs, often as the first argument of a function. For example, look at the documentation of <code>c</code>, <code>cat</code>, <code>cbind</code>, <code>rbind</code>, <code>paste</code></p>
<p>Note: Any arguments after the <code>...</code>, <strong>must</strong> be named fully, i.e. will not be partially matched.</p>
</div>
<div id="return-multiple-objects" class="section level2" number="14.4">
<h2>
<span class="header-section-number">14.4</span> Return multiple objects<a class="anchor" aria-label="anchor" href="#return-multiple-objects"><i class="fas fa-link"></i></a>
</h2>
<p>R function can only return a single object. This is not much of a problem because you can simply put any collection of objects into a list and return it:</p>
<div class="sourceCode" id="cb898"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lfn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">fn</span> <span class="op">=</span> <span class="va">square</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">xfn</span> <span class="op">&lt;-</span> <span class="fu">fn</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>,
       xfn <span class="op">=</span> <span class="va">xfn</span>,
       fn <span class="op">=</span> <span class="va">fn</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">lfn</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>$x
[1] 3

$xfn
[1] 9

$fn
function(x) {
  out &lt;- x^2
  out
}
&lt;bytecode: 0x7fa226688400&gt;</code></pre>
</div>
<div id="warnings-and-errors" class="section level2" number="14.5">
<h2>
<span class="header-section-number">14.5</span> Warnings and errors<a class="anchor" aria-label="anchor" href="#warnings-and-errors"><i class="fas fa-link"></i></a>
</h2>
<p>You can produce a warning at any point during a function evaluation using <code><a href="https://rdrr.io/r/base/warning.html">warning("warning message here")</a></code>. This cause <code>warning message here</code> to be printed to the console as a warning, but does not stop function evaluation.</p>
<p>To stop function execution, e.g. if an error is encountered, use <code><a href="https://rdrr.io/r/base/stop.html">stop()</a></code>. The following function calculates
<span class="math display">\[ e^{log_{10}(x)} \]</span>
which is not defined for negative <code>x</code>. In this case we could let R give an error when it tries to compute <code><a href="https://rdrr.io/r/base/Log.html">log10(x)</a></code>, or check x ourselves and write a custom error:</p>
<div class="sourceCode" id="cb900"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">el10</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"x must be positive"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">el10</span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>Error in el10(-3): x must be positive</code></pre>
<div class="sourceCode" id="cb902"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">el10</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 1.611429</code></pre>
</div>
<div id="scoping" class="section level2" number="14.6">
<h2>
<span class="header-section-number">14.6</span> Scoping<a class="anchor" aria-label="anchor" href="#scoping"><i class="fas fa-link"></i></a>
</h2>
<p>Functions exist in their own environment, i.e. contain their own variable definitions.</p>
<div class="sourceCode" id="cb904"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">*</span><span class="va">x</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">20</span><span class="op">*</span><span class="va">y</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Inside the function, x = "</span>, <span class="va">x</span>, <span class="st">" and y = "</span>, <span class="va">y</span>, <span class="st">"\n"</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">fn</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></code></pre></div>
<pre><code>Inside the function, x =  30  and y =  80 </code></pre>
<div class="sourceCode" id="cb906"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Outside the function, x = "</span>, <span class="va">x</span>, <span class="st">" and y = "</span>, <span class="va">y</span>, <span class="st">"\n"</span><span class="op">)</span></code></pre></div>
<pre><code>Outside the function, x =  3  and y =  4 </code></pre>
<p>However, if a variable is referenced within a function but no local definition exists, the interpreter will look for the variable at the parent directory. It is best to not rely on this and instead make sure all variables are passed to the functions that need them.</p>
<p>In the following example, <code>x</code> is only defined outside the function definition, but referenced within it.</p>
<div class="sourceCode" id="cb908"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">21</span>

<span class="va">itfn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">lr</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">+</span> <span class="va">lr</span> <span class="op">*</span> <span class="va">y</span>
<span class="op">}</span>

<span class="fu">itfn</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 24</code></pre>
<div id="function-vs.-for-loop" class="section level3" number="14.6.1">
<h3>
<span class="header-section-number">14.6.1</span> function vs. for loop<a class="anchor" aria-label="anchor" href="#function-vs.-for-loop"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s z-score the built-in <code>mtcars</code> dataset once with a for loop and once with a custom function. This links back to the example seen earlier in the <a href="#fordata">for loop</a> section. In practice this is performed with the <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code> command:</p>
<p>Within the for loop, we are assigning columns directly to the object outside the loop. In the following example, we print the environment outside and inside the loop function to see that it is the same. This is purely for demonstration:</p>
<div class="sourceCode" id="cb910"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># initialize new object 'mtcars_z'</span>
<span class="va">mtcars_z</span> <span class="op">&lt;-</span> <span class="va">mtcars</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"environment outside for loop is: "</span><span class="op">)</span></code></pre></div>
<pre><code>environment outside for loop is: </code></pre>
<div class="sourceCode" id="cb912"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>&lt;environment: R_GlobalEnv&gt;</code></pre>
<div class="sourceCode" id="cb914"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># z-score one column at a time in a for loop</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mtcars_z</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"environment inside for loop is: "</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;
environment inside for loop is: &lt;environment: R_GlobalEnv&gt;</code></pre>
<p>With a function, all operations remain local within the function and the output must be returned:</p>
<div class="sourceCode" id="cb916"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ztransform</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"environment inside function body is: "</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">z</span>
<span class="op">}</span>
<span class="va">mtcars_z2</span> <span class="op">&lt;-</span> <span class="fu">ztransform</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></code></pre></div>
<pre><code>environment inside function body is: &lt;environment: 0x7fa226b456a0&gt;</code></pre>
<div class="sourceCode" id="cb918"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"environment outside function body is: "</span><span class="op">)</span></code></pre></div>
<pre><code>environment outside function body is: </code></pre>
<div class="sourceCode" id="cb920"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>&lt;environment: R_GlobalEnv&gt;</code></pre>
<p>Notice how the environment outside and inside the loop function is the same, it is the Global environemnt, but the environment within the function is different. That is why any objects created or changed within a function must be returned if we want to make them available.</p>
</div>
</div>
<div id="pipe" class="section level2" number="14.7">
<h2>
<span class="header-section-number">14.7</span> The pipe operator<a class="anchor" aria-label="anchor" href="#pipe"><i class="fas fa-link"></i></a>
</h2>
<div class="figure" style="text-align: center">
<span id="fig:FigRpipes"></span>
<img src="R_pipes.png" alt="Illustration of pipes in R" width="80%"><p class="caption">
Figure 14.1: Illustration of pipes in R
</p>
</div>
<p>A pipe operator was first introduced to R with the <a href="https://magrittr.tidyverse.org/">magrittr</a>
package with the <code>%&gt;%</code> symbol. Note that a number of other packages that allow or endorse the use of pipes export the pipe operator as well.</p>
<p>Starting with R version 4.1, a native pipe operator is included in the language with the <code>|&gt;</code> symbol.</p>
<p>A pipe allows writing <code>f(x)</code> as <code>x |&gt; f()</code> (native pipe) or <code>x %&gt;% f</code> (magrittr).
Note that the native pipe requires parentheses, but magrittr works with or without them.</p>
<p>A pipe is often used to avoid multiple temporary assignments in a multistep procedure, or as an alternative to nesting functions. Some packages and developers promote its use, other discourage it. As always, there is a big subjective component here and you should try and see if and when it suits you.</p>
<p>The following:</p>
<div class="sourceCode" id="cb922"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">f1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">f2</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">f3</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb923"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">f3</span><span class="op">(</span><span class="fu">f2</span><span class="op">(</span><span class="fu">f1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb924"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> |&gt; <span class="fu">f1</span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu">f2</span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu">f3</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb925"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span> |&gt;
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/split.html">split</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>$setosa
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
       5.006        3.428        1.462        0.246 

$versicolor
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
       5.936        2.770        4.260        1.326 

$virginica
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
       6.588        2.974        5.552        2.026 </code></pre>
<p>Pipes are used extensively in the <a href="https://www.tidyverse.org">tidyverse</a> packages.<br>
You can learn more about the pipe operator in the <a href="https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html">magrittr vignette</a></p>
<div class="rmdtip">
<p>
In <a href="https://rstudio.com/">RStudio</a> the keyboard shortcut for the pipe operator is <code>Shift Command M</code> (MacOS) or <code>Ctrl Shift M</code> (Windows)
</p>
</div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="summarize.html"><span class="header-section-number">13</span> Summarizing Data</a></div>
<div class="next"><a href="dataframes.html"><span class="header-section-number">15</span> Working with data frames</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#functions"><span class="header-section-number">14</span> Functions</a></li>
<li><a class="nav-link" href="#simple-functions"><span class="header-section-number">14.1</span> Simple functions</a></li>
<li><a class="nav-link" href="#arguments-with-prescribed-list-of-allowed-values"><span class="header-section-number">14.2</span> Arguments with prescribed list of allowed values</a></li>
<li><a class="nav-link" href="#passing-extra-arguments-to-another-function-with-the-...-argument"><span class="header-section-number">14.3</span> Passing extra arguments to another function with the ... argument</a></li>
<li><a class="nav-link" href="#return-multiple-objects"><span class="header-section-number">14.4</span> Return multiple objects</a></li>
<li><a class="nav-link" href="#warnings-and-errors"><span class="header-section-number">14.5</span> Warnings and errors</a></li>
<li>
<a class="nav-link" href="#scoping"><span class="header-section-number">14.6</span> Scoping</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#function-vs.-for-loop"><span class="header-section-number">14.6.1</span> function vs. for loop</a></li></ul>
</li>
<li><a class="nav-link" href="#pipe"><span class="header-section-number">14.7</span> The pipe operator</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Programming for Data Science in R</strong>" was written by Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD. It was last built on 2021-07-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
