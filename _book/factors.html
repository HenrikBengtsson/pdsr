<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Factors | Programming for Data Science in R</title>
<meta name="author" content="Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><script src="libs/d3-3.5.6/d3.min.js"></script><link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet">
<script src="libs/profvis-0.3.6.9000/profvis.js"></script><script src="libs/profvis-0.3.6.9000/scroll.js"></script><link href="libs/highlight-6.2.0/textmate.css" rel="stylesheet">
<script src="libs/highlight-6.2.0/highlight.js"></script><script src="libs/profvis-binding-0.3.7/profvis.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163213745-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-163213745-1');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="bootstrap.lambdamd.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Programming for Data Science in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">PDSR</a></li>
<li><a class="" href="preface.html"><span class="header-section-number">1</span> Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="Rsetup.html"><span class="header-section-number">3</span> R setup, Packages &amp; Docs</a></li>
<li><a class="" href="basicops.html"><span class="header-section-number">4</span> Basic operations</a></li>
<li><a class="" href="types.html"><span class="header-section-number">5</span> Data Types</a></li>
<li><a class="" href="structures.html"><span class="header-section-number">6</span> Data Structures</a></li>
<li><a class="active" href="factors.html"><span class="header-section-number">7</span> Factors</a></li>
<li><a class="" href="indexing.html"><span class="header-section-number">8</span> Indexing - Subsetting - Slicing</a></li>
<li><a class="" href="vectorization.html"><span class="header-section-number">9</span> Vectorized Operations</a></li>
<li><a class="" href="dataio.html"><span class="header-section-number">10</span> Data Input/Output</a></li>
<li><a class="" href="controlflow.html"><span class="header-section-number">11</span> Control flow</a></li>
<li><a class="" href="loopfns.html"><span class="header-section-number">12</span> Loop Functions</a></li>
<li><a class="" href="summarize.html"><span class="header-section-number">13</span> Summarizing Data</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">14</span> Functions</a></li>
<li><a class="" href="dataframes.html"><span class="header-section-number">15</span> Working with data frames</a></li>
<li><a class="" href="datatrans.html"><span class="header-section-number">16</span> Data Transformations</a></li>
<li><a class="" href="stringops.html"><span class="header-section-number">17</span> String Operations</a></li>
<li><a class="" href="datetime.html"><span class="header-section-number">18</span> Date and Time</a></li>
<li><a class="" href="missingdata.html"><span class="header-section-number">19</span> Handling Missing data</a></li>
<li><a class="" href="classes.html"><span class="header-section-number">20</span> Classes and Object-Oriented Programming</a></li>
<li><a class="" href="datatable.html"><span class="header-section-number">21</span> Efficient data analysis with data.table</a></li>
<li><a class="" href="basegraphics.html"><span class="header-section-number">22</span> Base Graphics</a></li>
<li><a class="" href="graphics3x.html"><span class="header-section-number">23</span> 3x Graphics</a></li>
<li><a class="" href="colors.html"><span class="header-section-number">24</span> Colors in R</a></li>
<li><a class="" href="profiling.html"><span class="header-section-number">25</span> Timing &amp; Profiling</a></li>
<li><a class="" href="optim.html"><span class="header-section-number">26</span> Optimization with optim()</a></li>
<li><a class="" href="glm.html"><span class="header-section-number">27</span> Introduction to the GLM</a></li>
<li><a class="" href="resampling.html"><span class="header-section-number">28</span> Resampling</a></li>
<li><a class="" href="supervised.html"><span class="header-section-number">29</span> Supervised Learning</a></li>
<li><a class="" href="unsupervised.html"><span class="header-section-number">30</span> Unsupervised Learning</a></li>
<li><a class="" href="git.html"><span class="header-section-number">31</span> Git &amp; GitHub: the basics</a></li>
<li><a class="" href="shell.html"><span class="header-section-number">32</span> Introduction to the system shell</a></li>
<li><a class="" href="resources.html"><span class="header-section-number">33</span> Resources</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="factors" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Factors<a class="anchor" aria-label="anchor" href="#factors"><i class="fas fa-link"></i></a>
</h1>
<p>Factors in R are used to store <strong>categorical variables</strong> and therefore have many important uses in statistics / data science / machine learning.</p>
<div class="figure" style="text-align: center">
<span id="fig:FigRFactors"></span>
<img src="R_factors.png" alt="Factors in R - Best to read through this chapter first and then refer back to this figure" width="80%"><p class="caption">
Figure 7.1: Factors in R - Best to read through this chapter first and then refer back to this figure
</p>
</div>
<p>You can create a factor by passing a numeric or character vector to <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> or <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code>.<br>
The difference is that <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> does not accept any arguments while <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> does - and they can be very important. More on this right below.</p>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"c"</span><span class="op">)</span>
<span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">xf</span></code></pre></div>
<pre><code>[1] a c d b a a d c
Levels: a b c d</code></pre>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">xf</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "factor"</code></pre>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xftoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">xftoo</span></code></pre></div>
<pre><code>[1] a c d b a a d c
Levels: a b c d</code></pre>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">xftoo</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "factor"</code></pre>
<div class="rmdnote">
<p>
A factor contains three crucial pieces of information:
</p>
<ol style="list-style-type: decimal">
<li>
<p>
The underlying <strong>integer vector</strong>
</p>
</li>
<li>
<p>
The <strong>mapping of integers to labels</strong>
</p>
</li>
<li>
<p>
Whether the factor is <strong>ordered</strong>
</p>
</li>
</ol>
</div>
<p>Let’s unpack these.</p>
<p>Begin with a simple factor:</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] female female female male   male  
Levels: female male</code></pre>
<p>Internally, the command sees there are two distinct labels, female and male, and defaults to assigning integer numbers alphabetically, in this case female has been mapped to ‘1’ and male to ‘2.’</p>
<p>Printing a factor prints the vector of labels followed by the levels, i.e. the unique labels.</p>
<div id="the-underlying-integer-vector" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> The underlying <strong>integer vector</strong><a class="anchor" aria-label="anchor" href="#the-underlying-integer-vector"><i class="fas fa-link"></i></a>
</h2>
<p>Each level is assigned an integer. (Internally, this is the “data” that forms the elements of a factor vector). You don’t see these integers unless you convert the factor to numeric (<code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code>) or look at the (truncated) output of <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code></p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 1 1 1 2 2</code></pre>
</div>
<div id="the-mapping-of-integers-to-labels" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> The <strong>mapping of integers to labels</strong><a class="anchor" aria-label="anchor" href="#the-mapping-of-integers-to-labels"><i class="fas fa-link"></i></a>
</h2>
<p>This defines which integer is mapped to which label, i.e. whether 1 is mapped to male or female. You can store the same information regardless which one you choose to call 1 and 2.</p>
<p>To get the mapping you can use <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>. It prints the labels in order:</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "female" "male"  </code></pre>
<p>Again, this means that female is mapped to 1 and male is mapped to 2.</p>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code> Factor w/ 2 levels "female","male": 1 1 1 2 2</code></pre>
<p>The above tells you that x is a factor,<br>
it has two levels labeled as “female” and “male,” in that order, i.e. female is level 1 and male is level 2.<br>
The last part shows that the first five elements (in this case the whole vector) consists of three elements of level 1 (female) followed by 2 elements of level 2 (male)</p>
<div id="setting-new-level-labels" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> Setting new level labels<a class="anchor" aria-label="anchor" href="#setting-new-level-labels"><i class="fas fa-link"></i></a>
</h3>
<p>You can use the <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code> command with an assignment to assign new labels to a factor (same syntax to how you use <code><a href="https://rdrr.io/r/base/colnames.html">rownames()</a></code> or <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> to assign new row or column names to a matrix or data frame)</p>
<div class="sourceCode" id="cb430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"patient_status_positive"</span>, <span class="st">"patient_status_negative"</span><span class="op">)</span>, <span class="fl">10</span>, <span class="cn">T</span><span class="op">)</span>,
             levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"patient_status_positive"</span>, <span class="st">"patient_status_negative"</span><span class="op">)</span><span class="op">)</span>
<span class="va">xf</span></code></pre></div>
<pre><code> [1] patient_status_negative patient_status_negative patient_status_negative
 [4] patient_status_negative patient_status_positive patient_status_negative
 [7] patient_status_positive patient_status_negative patient_status_negative
[10] patient_status_negative
Levels: patient_status_positive patient_status_negative</code></pre>
<div class="sourceCode" id="cb432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">xf</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "patient_status_positive" "patient_status_negative"</code></pre>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">xf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"positive"</span>, <span class="st">"negative"</span><span class="op">)</span>
<span class="va">xf</span></code></pre></div>
<pre><code> [1] negative negative negative negative positive negative positive negative
 [9] negative negative
Levels: positive negative</code></pre>
</div>
<div id="defining-the-mapping-of-labels-to-integers" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> Defining the mapping of labels to integers<a class="anchor" aria-label="anchor" href="#defining-the-mapping-of-labels-to-integers"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to define the mapping of labels to their integer representation (and not default to them sorted alphabeticaly), you use the <code>levels</code> arguments of the <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> function.</p>
<p>The vector passed to the <code>levels</code> arguments must include at least all unique values passed to <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>, otherwise you will get <code>NA</code> values</p>
<p>Without defining <code>levels</code> they are assigned alphabeticaly:</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"alpha"</span>, <span class="st">"gamma"</span>, <span class="st">"delta"</span>, <span class="st">"delta"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] alpha alpha gamma delta delta
Levels: alpha delta gamma</code></pre>
<p>Define <code>levels</code>:</p>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"alpha"</span>, <span class="st">"gamma"</span>, <span class="st">"delta"</span>, <span class="st">"delta"</span><span class="op">)</span>,
 levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"gamma"</span>, <span class="st">"delta"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] alpha alpha gamma delta delta
Levels: alpha gamma delta</code></pre>
<p>The <code>table</code> command has a number of useful applications, in it simplest form, it tabulates number of elements with each unique value found in a vector:</p>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>x
alpha gamma delta 
    2     1     2 </code></pre>
<p>If you forget (or choose to exclude) a level, all occurences are replaced by <code>NA</code>:</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"alpha"</span>, <span class="st">"gamma"</span>, <span class="st">"delta"</span>, <span class="st">"delta"</span><span class="op">)</span>,
 levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"gamma"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] alpha alpha gamma &lt;NA&gt;  &lt;NA&gt; 
Levels: alpha gamma</code></pre>
<p>If you know that more levels exist, even if no examples are present in your sample, you can includes these extra levels:</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"alpha"</span>, <span class="st">"gamma"</span>, <span class="st">"delta"</span>, <span class="st">"delta"</span><span class="op">)</span>,
 levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"gamma"</span>, <span class="st">"delta"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] alpha alpha gamma delta delta
Levels: alpha beta gamma delta</code></pre>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>x
alpha  beta gamma delta 
    2     0     1     2 </code></pre>
</div>
</div>
<div id="is-the-factor-ordered" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Is the factor <strong>ordered</strong><a class="anchor" aria-label="anchor" href="#is-the-factor-ordered"><i class="fas fa-link"></i></a>
</h2>
<p>We looked at how you can define the order of levels using the <code>levels</code> argument in <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>, which affects the integer mapping to each label.</p>
<p>This can affect how some applications treat the different levels.</p>
<p>On top of the order of the mapping, you can further define if there is a <em>quantitative relationship</em> among levels of the form <code>level 1 &lt; level 2 &lt; ... &lt; level n</code>. This, in turn, can affect how the factor is treated by some functions, like some functions that fit statistical models.</p>
<div class="rmdnote">
<p>
All factors’ levels appear in some order or other.
</p>
<p>
An <strong>ordered factor</strong> indicates that its levels have a quantitative relationship of the form <code>level 1 &lt; level 2 &lt; … &lt; level n</code>.
</p>
</div>
<p>First an unordered factor:</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"small"</span>, <span class="st">"medium"</span>, <span class="st">"large"</span><span class="op">)</span>, <span class="fl">10</span>, <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code> [1] small  large  small  medium large  large  medium medium medium medium
Levels: large medium small</code></pre>
<p>To make the above into an ordered factor, we need to define the order of the levels with the <code>levels</code> arguments and also specify that it is ordered with the <code>ordered</code> argument:</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat</span>,
            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"small"</span>, <span class="st">"medium"</span>, <span class="st">"large"</span><span class="op">)</span>,
            ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code> [1] small  large  small  medium large  large  medium medium medium medium
Levels: small &lt; medium &lt; large</code></pre>
<p>Note how the levels now include the <code><a href="https://rdrr.io/r/base/Comparison.html">&lt;</a></code> sign between levels to indicate the ordering.</p>
</div>
<div id="change-order-of-levels-or-labels" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Change (order of levels) or (labels)<a class="anchor" aria-label="anchor" href="#change-order-of-levels-or-labels"><i class="fas fa-link"></i></a>
</h2>
<p>We’ve seen how to create a factor with defined order of levels and how to change level labels already. Because these are prone to serious accidents, let’s look at them again, together.</p>
<p><strong>To change the order of levels</strong> of an existing factor use <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>:</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"target"</span>, <span class="st">"target"</span>, <span class="st">"control"</span>, <span class="st">"control"</span>, <span class="st">"control"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] target  target  control control control
Levels: control target</code></pre>
<p>Change the order so that target is first (i.e. corresponds to 1:</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"target"</span>, <span class="st">"control"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] target  target  control control control
Levels: target control</code></pre>
<p><strong>To change the labels of the levels</strong> use <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>:</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span></code></pre></div>
<pre><code>[1] target  target  control control control
Levels: target control</code></pre>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hit"</span>, <span class="st">"decoy"</span><span class="op">)</span>
<span class="va">x</span></code></pre></div>
<pre><code>[1] hit   hit   decoy decoy decoy
Levels: hit decoy</code></pre>
<div class="rmdcaution">
<p>
Changing the levels of a factor with <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code> does not change the internal integer representation but changes every element’s label.
</p>
</div>
</div>
<div id="fatal-error-to-avoid" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Fatal error to avoid<a class="anchor" aria-label="anchor" href="#fatal-error-to-avoid"><i class="fas fa-link"></i></a>
</h2>
<p>Example scenario: You receive a dataset for classification where the outcome is a factor of 1s and 0s:</p>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">outcome</span></code></pre></div>
<pre><code>[1] 1 1 0 0 0 1 0
Levels: 0 1</code></pre>
<p>Some classification procedures expect the first level to be the ‘positive’ outcome, so you decide to reorder the levels.</p>
<p>You mistakenly use <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code> instead of <code><a href="https://rdrr.io/r/base/factor.html">factor(x, levels=c(...))</a></code> hoping to achieve this.</p>
<p>You end up flipping all the outcome values.</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"0"</span><span class="op">)</span>
<span class="va">outcome</span></code></pre></div>
<pre><code>[1] 0 0 1 1 1 0 1
Levels: 1 0</code></pre>
<p>All zeros became ones and ones became zeros.</p>
<p>You don’t notice because how would you.</p>
<p>Your model does the exact opposite of what you intended.</p>
<p>-&gt; Don’t ever do this.</p>
</div>
<div id="factor-to-numeric" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Factor to numeric<a class="anchor" aria-label="anchor" href="#factor-to-numeric"><i class="fas fa-link"></i></a>
</h2>
<p>While it often makes sense to have factors with words for labels, they can be any character and that includes numbers (i.e. numbers which are treated as labels)</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>
<span class="va">f</span></code></pre></div>
<pre><code>[1] 3 7 7 9 3 3 9
Levels: 3 7 9</code></pre>
<p>This behaves just like any other factor with all the rules we learned above.</p>
<p>There is a very easy trap to fall into, if you ever decide to convert such a factor to numeric.</p>
<p>The first thing that usually comes to mind is to use <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code>.</p>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># !don't do this!</span>
<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 1 2 2 3 1 1 3</code></pre>
<p>But! We already know this will return the integer index, it will not return the labels as numbers.</p>
<p>By understanding the internal representation of the factor, i.e. that a factor is an integer vector indexing a set of labels, you can convert labels to numeric exactly by indexing the set of labels:</p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[</span><span class="va">f</span><span class="op">]</span></code></pre></div>
<pre><code>[1] "3" "7" "7" "9" "3" "3" "9"</code></pre>
<p>The above suggests that used as an index within the brackets, <code>f</code> is coerced to integer, therefore to understand the above:</p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "3" "7" "9"</code></pre>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>[1] "3" "7" "7" "9" "3" "3" "9"</code></pre>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># same as</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[</span><span class="va">f</span><span class="op">]</span></code></pre></div>
<pre><code>[1] "3" "7" "7" "9" "3" "3" "9"</code></pre>
<p>A different way around this that may be less confusing is to simply convert the factor to character and then to numeric:</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 3 7 7 9 3 3 9</code></pre>
</div>
<div id="summary" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Summary<a class="anchor" aria-label="anchor" href="#summary"><i class="fas fa-link"></i></a>
</h2>
<div class="rmdnote">
<ul>
<li>
<p>
Factors in R are <strong>integer vectors</strong> with labels.
</p>
</li>
<li>
<p>
A factor’s internal integer values range from 1 to the number of levels, i.e. categories.
</p>
</li>
<li>
<p>
Each integer corresponds to a label.
</p>
</li>
<li>
<p>
Use <code>factor(levels = c(…))</code> to order levels
</p>
</li>
<li>
<p>
Use <code><a href="https://rdrr.io/r/base/levels.html">levels(x)</a></code> to change levels’ labels
</p>
</li>
</ul>
</div>
<div class="rmdnote">
<p>
To avoid confusion, do not use numbers as level labels, if possible.
</p>
</div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="structures.html"><span class="header-section-number">6</span> Data Structures</a></div>
<div class="next"><a href="indexing.html"><span class="header-section-number">8</span> Indexing - Subsetting - Slicing</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#factors"><span class="header-section-number">7</span> Factors</a></li>
<li><a class="nav-link" href="#the-underlying-integer-vector"><span class="header-section-number">7.1</span> The underlying integer vector</a></li>
<li>
<a class="nav-link" href="#the-mapping-of-integers-to-labels"><span class="header-section-number">7.2</span> The mapping of integers to labels</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#setting-new-level-labels"><span class="header-section-number">7.2.1</span> Setting new level labels</a></li>
<li><a class="nav-link" href="#defining-the-mapping-of-labels-to-integers"><span class="header-section-number">7.2.2</span> Defining the mapping of labels to integers</a></li>
</ul>
</li>
<li><a class="nav-link" href="#is-the-factor-ordered"><span class="header-section-number">7.3</span> Is the factor ordered</a></li>
<li><a class="nav-link" href="#change-order-of-levels-or-labels"><span class="header-section-number">7.4</span> Change (order of levels) or (labels)</a></li>
<li><a class="nav-link" href="#fatal-error-to-avoid"><span class="header-section-number">7.5</span> Fatal error to avoid</a></li>
<li><a class="nav-link" href="#factor-to-numeric"><span class="header-section-number">7.6</span> Factor to numeric</a></li>
<li><a class="nav-link" href="#summary"><span class="header-section-number">7.7</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Programming for Data Science in R</strong>" was written by Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD. It was last built on 2021-07-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
