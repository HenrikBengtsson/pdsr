<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>19 Data Transformations | Programming for Data Science in R</title>

    <meta name="author" content="Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD" />
  
   <meta name="description" content="19 Data Transformations | Programming for Data Science in R is a project to build an online resource for (Bio)statisticians / Epidemiologists / (Health) Data Scientists" />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="19 Data Transformations | Programming for Data Science in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="19 Data Transformations | Programming for Data Science in R is a project to build an online resource for (Bio)statisticians / Epidemiologists / (Health) Data Scientists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="19 Data Transformations | Programming for Data Science in R" />
  
  <meta name="twitter:description" content="19 Data Transformations | Programming for Data Science in R is a project to build an online resource for (Bio)statisticians / Epidemiologists / (Health) Data Scientists" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.3.1/transition.js"></script>
    <script src="libs/bs3compat-0.3.1/tabs.js"></script>
    <script src="libs/bs3compat-0.3.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
    <script src="libs/d3-3.5.6/d3.min.js"></script>
    <link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet" />
    <script src="libs/profvis-0.3.6.9000/profvis.js"></script>
    <script src="libs/profvis-0.3.6.9000/scroll.js"></script>
    <link href="libs/highlight-6.2.0/textmate.css" rel="stylesheet" />
    <script src="libs/highlight-6.2.0/highlight.js"></script>
    <script src="libs/profvis-binding-0.3.7/profvis.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-127457544-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-127457544-1');
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="bootstrap.lambdamd.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Programming for Data Science in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="datatrans" class="section level1" number="19">
<h1><span class="header-section-number">19</span> Data Transformations</h1>
<STYLE type='text/css' scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</STYLE>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="datatrans.html#cb1102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtemis)</span></code></pre></div>
<pre><code>  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation &amp; vignettes: https://rtemis.lambdamd.org
  Learn R: https://class.lambdamd.org/pdsr</code></pre>
<div id="continuous-variables" class="section level2" number="19.1">
<h2><span class="header-section-number">19.1</span> Continuous variables</h2>
<div id="zscore" class="section level3" number="19.1.1">
<h3><span class="header-section-number">19.1.1</span> Standardization / Scaling &amp; Centering with <code>scale()</code></h3>
<p><strong>Scaling</strong> of a numeric vector is achieved by elementwise division with the standard deviation. A scaled vector therefore has standard deviation equal to 1.</p>
<p><strong>Centering</strong> of a numeric vector is achieved by elementwise subtraction of its mean. A centered vector therefore has mean equal to 0.</p>
<p><strong>Standardizing</strong>, a.k.a. converting to Z-scores, involves scaling and centering. Scaling and centering is performed in R with the <code>scale()</code> function.</p>
<p>Depending on your modeling needs / the algorithms you plan to use, it is often important to scale and/or center your data. Note that many functions, but not all, may automatically scale and center data internally if it is required by the algorithm. Check the function documentation to see if you should manually scale or not.</p>
<p><code>scale()</code> can be applied to a single vector or a matrix/data.frame.
In the case of a matrix or data.frame, scaling is applied on each column individually.
By default, both arguments <code>scale</code> and <code>center</code> are set to <code>TRUE</code>.</p>
<p>Scale a vector:</p>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1104-1"><a href="datatrans.html#cb1104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris<span class="sc">$</span>Sepal.Length)</span></code></pre></div>
<pre><code>[1] 5.1 4.9 4.7 4.6 5.0 5.4</code></pre>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="datatrans.html#cb1106-1" aria-hidden="true" tabindex="-1"></a>Petal.Length_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(iris<span class="sc">$</span>Petal.Length)</span>
<span id="cb1106-2"><a href="datatrans.html#cb1106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Petal.Length_scaled)</span></code></pre></div>
<pre><code>          [,1]
[1,] -1.335752
[2,] -1.335752
[3,] -1.392399
[4,] -1.279104
[5,] -1.335752
[6,] -1.165809</code></pre>
<p>Scale multiple columns of a matrix/data.frame:</p>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="datatrans.html#cb1108-1" aria-hidden="true" tabindex="-1"></a>iris.scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(iris[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb1108-2"><a href="datatrans.html#cb1108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris.scaled)</span></code></pre></div>
<pre><code>     Sepal.Length Sepal.Width Petal.Length Petal.Width
[1,]   -0.8976739  1.01560199    -1.335752   -1.311052
[2,]   -1.1392005 -0.13153881    -1.335752   -1.311052
[3,]   -1.3807271  0.32731751    -1.392399   -1.311052
[4,]   -1.5014904  0.09788935    -1.279104   -1.311052
[5,]   -1.0184372  1.24503015    -1.335752   -1.311052
[6,]   -0.5353840  1.93331463    -1.165809   -1.048667</code></pre>
<p>First, let’s verify that <code>scale()</code> did what we wanted:</p>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="datatrans.html#cb1110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(iris.scaled)</span></code></pre></div>
<pre><code> Sepal.Length   Sepal.Width  Petal.Length   Petal.Width 
-4.480675e-16  2.035409e-16 -2.844947e-17 -3.714621e-17 </code></pre>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="datatrans.html#cb1112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(iris.scaled, <span class="dv">2</span>, sd)</span></code></pre></div>
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
           1            1            1            1 </code></pre>
<p>We got effectively 0 mean and standard deviation of 1 for each column.</p>
<p><code>scale()</code> outputs the scaled vector(s) along with the scaling and/or centering parameters saved as attributes in the output.</p>
<p>Note that in both cases, whether a vector input or data.frame, the output is a <strong>matrix</strong>:</p>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="datatrans.html#cb1114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Petal.Length_scaled)</span></code></pre></div>
<pre><code>[1] &quot;matrix&quot; &quot;array&quot; </code></pre>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="datatrans.html#cb1116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(iris.scaled)</span></code></pre></div>
<pre><code>[1] &quot;matrix&quot; &quot;array&quot; </code></pre>
<p>Get the output attributes:</p>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1118-1"><a href="datatrans.html#cb1118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(Petal.Length_scaled)</span></code></pre></div>
<pre><code>$dim
[1] 150   1

$`scaled:center`
[1] 3.758

$`scaled:scale`
[1] 1.765298</code></pre>
<p><code>center</code> is the mean:</p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="datatrans.html#cb1120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(iris<span class="sc">$</span>Petal.Length)</span></code></pre></div>
<pre><code>[1] 3.758</code></pre>
<p><code>scale</code> is the standard deviation:</p>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1122-1"><a href="datatrans.html#cb1122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(iris<span class="sc">$</span>Petal.Length)</span></code></pre></div>
<pre><code>[1] 1.765298</code></pre>
<p>For a matrix/data.frame input, you get <code>center</code> and <code>scale</code> attributes per column:</p>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="datatrans.html#cb1124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(iris.scaled)</span></code></pre></div>
<pre><code>$dim
[1] 150   4

$dimnames
$dimnames[[1]]
NULL

$dimnames[[2]]
[1] &quot;Sepal.Length&quot; &quot;Sepal.Width&quot;  &quot;Petal.Length&quot; &quot;Petal.Width&quot; 


$`scaled:center`
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 

$`scaled:scale`
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
   0.8280661    0.4358663    1.7652982    0.7622377 </code></pre>
<p>Let’s save the scale and center attributes and then double check the calculations:</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="datatrans.html#cb1126-1" aria-hidden="true" tabindex="-1"></a>.center <span class="ot">&lt;-</span> <span class="fu">attr</span>(iris.scaled, <span class="st">&quot;scaled:center&quot;</span>)</span>
<span id="cb1126-2"><a href="datatrans.html#cb1126-2" aria-hidden="true" tabindex="-1"></a>.center</span></code></pre></div>
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 </code></pre>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="datatrans.html#cb1128-1" aria-hidden="true" tabindex="-1"></a>.scale <span class="ot">&lt;-</span> <span class="fu">attr</span>(iris.scaled, <span class="st">&quot;scaled:scale&quot;</span>)</span>
<span id="cb1128-2"><a href="datatrans.html#cb1128-2" aria-hidden="true" tabindex="-1"></a>.scale</span></code></pre></div>
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
   0.8280661    0.4358663    1.7652982    0.7622377 </code></pre>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="datatrans.html#cb1130-1" aria-hidden="true" tabindex="-1"></a>Sepal.Length_scaled <span class="ot">&lt;-</span> (iris<span class="sc">$</span>Sepal.Length <span class="sc">-</span> .center[<span class="dv">1</span>]) <span class="sc">/</span> .scale[<span class="dv">1</span>]</span>
<span id="cb1130-2"><a href="datatrans.html#cb1130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(Sepal.Length_scaled <span class="sc">==</span> iris.scaled[, <span class="st">&quot;Sepal.Length&quot;</span>])</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>Note: Due to limitation in numerical precision, checking sets of floats for equality after multiple operations is not recommended. One simple option is to plot:</p>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="datatrans.html#cb1132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mplot3.fit</span>(Sepal.Length_scaled, iris.scaled[, <span class="st">&quot;Sepal.Length&quot;</span>])</span></code></pre></div>
<p><img src="68-DataTrans_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="rmdnote">
<p>
If you are manually scaling and/or centering data for <strong>supervised learning</strong>, you must:
</p>
<ul>
<li>
Perform scaling and centering on your <strong>training data</strong>
</li>
<li>
Save the <strong>centering and scaling parameters</strong> for each feature
</li>
<li>
Apply the training set-derived centering and scaling parameters to the <strong>test set</strong> <em>prior to prediction/inference</em>.
</li>
</ul>
</div>
<p>A common mistake is to either scale training and testing data together in the beginning, or scale them independently.</p>
</div>
<div id="normalization" class="section level3" number="19.1.2">
<h3><span class="header-section-number">19.1.2</span> Normalization</h3>
<p><strong>Normalization</strong> has different meanings in different contexts; in the context of a numeric variable it usually refers to converting to a 0-1 range.</p>
<p>Let’s write a simple function to achieve this:</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="datatrans.html#cb1133-1" aria-hidden="true" tabindex="-1"></a>normalize <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1133-2"><a href="datatrans.html#cb1133-2" aria-hidden="true" tabindex="-1"></a>  .min <span class="ot">&lt;-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1133-3"><a href="datatrans.html#cb1133-3" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> .min) <span class="sc">/</span> <span class="fu">max</span>(x <span class="sc">-</span> .min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1133-4"><a href="datatrans.html#cb1133-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1134-1"><a href="datatrans.html#cb1134-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">13</span>, <span class="fl">1.4</span>)</span>
<span id="cb1134-2"><a href="datatrans.html#cb1134-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code> [1] 10.83098 13.85372 15.90829 10.84521 12.99146 15.98629 14.45367 10.76891
 [9] 11.68909 13.45123 14.20226 13.03553 13.48707 14.31584 12.54122 14.90871
[17] 15.00571 10.59087 15.13602 13.06556</code></pre>
<div class="sourceCode" id="cb1136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1136-1"><a href="datatrans.html#cb1136-1" aria-hidden="true" tabindex="-1"></a>x_normalized <span class="ot">&lt;-</span> <span class="fu">normalize</span>(x)</span>
<span id="cb1136-2"><a href="datatrans.html#cb1136-2" aria-hidden="true" tabindex="-1"></a>x_normalized</span></code></pre></div>
<pre><code> [1] 0.04450344 0.60474597 0.98554399 0.04714007 0.44493199 1.00000000
 [7] 0.71594160 0.03299954 0.20354800 0.53014636 0.66934389 0.45310006
[13] 0.53678957 0.69039517 0.36148257 0.80027994 0.81825693 0.00000000
[19] 0.84241024 0.45866637</code></pre>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="datatrans.html#cb1138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(x_normalized)</span></code></pre></div>
<pre><code>[1] 0</code></pre>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1140-1"><a href="datatrans.html#cb1140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(x_normalized)</span></code></pre></div>
<pre><code>[1] 1</code></pre>
<p>Note that it is easy to make the <code>normalize()</code> function more general, by adding <code>lo</code> and <code>hi</code> arguments to convert to any range:</p>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1142-1"><a href="datatrans.html#cb1142-1" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">lo =</span> <span class="dv">0</span>, <span class="at">hi =</span> <span class="dv">1</span>) {</span>
<span id="cb1142-2"><a href="datatrans.html#cb1142-2" aria-hidden="true" tabindex="-1"></a>    .min <span class="ot">&lt;-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1142-3"><a href="datatrans.html#cb1142-3" aria-hidden="true" tabindex="-1"></a>   (x <span class="sc">-</span> .min) <span class="sc">/</span> <span class="fu">max</span>(x <span class="sc">-</span> .min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> (hi <span class="sc">-</span> lo) <span class="sc">+</span> lo</span>
<span id="cb1142-4"><a href="datatrans.html#cb1142-4" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1143-1"><a href="datatrans.html#cb1143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dr</span>(x, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code> [1] -0.91099311  0.20949194  0.97108798 -0.90571986 -0.11013601  1.00000000
 [7]  0.43188320 -0.93400092 -0.59290399  0.06029272  0.33868778 -0.09379988
[13]  0.07357914  0.38079034 -0.27703486  0.60055988  0.63651386 -1.00000000
[19]  0.68482048 -0.08266725</code></pre>
</div>
<div id="log-transform-with-log" class="section level3" number="19.1.3">
<h3><span class="header-section-number">19.1.3</span> Log-transform with <code>log()</code></h3>
<p>For the following example, <code>x</code> is an unknown feature in a new dataset we were just given.<br />
We start by plotting its distribution:</p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="datatrans.html#cb1145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mplot3.x</span>(x)</span></code></pre></div>
<p><img src="68-DataTrans_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>We can see it is skewed right. A log transform can help here:</p>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1146-1"><a href="datatrans.html#cb1146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mplot3.x</span>(<span class="fu">log</span>(x))</span></code></pre></div>
<p><img src="68-DataTrans_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="data-binning-with-cut" class="section level3" number="19.1.4">
<h3><span class="header-section-number">19.1.4</span> Data binning with <code>cut()</code></h3>
<p>A different approach for the above variable might be to bin it.<br />
Let’s look at a few different ways to bin continuous data.</p>
<div id="evenly-spaced-interval" class="section level4" number="19.1.4.1">
<h4><span class="header-section-number">19.1.4.1</span> Evenly-spaced interval</h4>
<p><code>cut()</code> allows us to bin a numeric variable into evenly-spaced intervals.<br />
The <code>breaks</code> argument defines the number of intervals:</p>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1147-1"><a href="datatrans.html#cb1147-1" aria-hidden="true" tabindex="-1"></a>x_cut4 <span class="ot">&lt;-</span> <span class="fu">cut</span>(x, <span class="at">breaks =</span> <span class="dv">4</span>)</span>
<span id="cb1147-2"><a href="datatrans.html#cb1147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x_cut4)</span></code></pre></div>
<pre><code>[1] (0.291,178] (0.291,178] (0.291,178] (0.291,178] (0.291,178] (0.291,178]
Levels: (0.291,178] (178,355] (355,533] (533,711]</code></pre>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1149-1"><a href="datatrans.html#cb1149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(x_cut4)</span></code></pre></div>
<pre><code>x_cut4
(0.291,178]   (178,355]   (355,533]   (533,711] 
        977          19           3           1 </code></pre>
<div class="rmdimportant">
<p>
<strong>Interval Notation</strong>
</p>
<p>
<code>[3, 9)</code> represents the interval of <a href="https://en.wikipedia.org/wiki/Real_number">real numbers</a> between 3 and 9, <strong>including</strong> 3 and <strong>excluding</strong> 9.
</p>
</div>
<p>Because the data is so skewed, equal intervals are not helpful in this case. The majority of the data points get grouped into a single bin.</p>
<p>Let’s visualize the cuts:</p>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="datatrans.html#cb1151-1" aria-hidden="true" tabindex="-1"></a>xcuts5 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length.out =</span> <span class="dv">5</span>)</span>
<span id="cb1151-2"><a href="datatrans.html#cb1151-2" aria-hidden="true" tabindex="-1"></a>xcuts5</span></code></pre></div>
<pre><code>[1]   1.0000 178.2453 355.4905 532.7358 709.9811</code></pre>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="datatrans.html#cb1153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mplot3.x</span>(x, <span class="at">par.reset =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1153-2"><a href="datatrans.html#cb1153-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(density(x)) # in base R</span></span>
<span id="cb1153-3"><a href="datatrans.html#cb1153-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> xcuts5, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="68-DataTrans_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>[Note: We used <code>par.reset = FALSE</code> to stop <code>mplot3.x()</code> from resetting its custom <code>par()</code> settings so that we can continue adding elements to the same plot, in this case with the <code>abline()</code> command.]</p>
</div>
<div id="quantile-cuts" class="section level4" number="19.1.4.2">
<h4><span class="header-section-number">19.1.4.2</span> Quantile cuts</h4>
<p>Instead of evenly-spaced intervals, we can get quantiles with <code>quantile()</code>. We ask for 5 quantiles using the <code>length.out</code> argument, which corresponds to 4 intervals:</p>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="datatrans.html#cb1154-1" aria-hidden="true" tabindex="-1"></a>xquants5 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(x, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">5</span>))</span>
<span id="cb1154-2"><a href="datatrans.html#cb1154-2" aria-hidden="true" tabindex="-1"></a>xquants5 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(x, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">5</span>))</span>
<span id="cb1154-3"><a href="datatrans.html#cb1154-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mplot3.x</span>(x, <span class="at">par.reset =</span> F)</span>
<span id="cb1154-4"><a href="datatrans.html#cb1154-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(density(x)) # in base R</span></span>
<span id="cb1154-5"><a href="datatrans.html#cb1154-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> xquants5, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="68-DataTrans_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>The <code>breaks</code> argument of <code>cut()</code> allows us to pass either an integer to define the number of evenly-spaced breaks, or a numeric vector defining the position of breaks.</p>
<p>We can therefore pass the quantile values as break points.</p>
<p>Since the quantile values begin at the lowest value in the data, we need to define
<code>include.lowest = TRUE</code> so that the first interval is inclusive of the lowest value:</p>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1155-1"><a href="datatrans.html#cb1155-1" aria-hidden="true" tabindex="-1"></a>x_cutq4 <span class="ot">&lt;-</span> <span class="fu">cut</span>(x, <span class="at">breaks =</span> xquants5, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1155-2"><a href="datatrans.html#cb1155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(x_cutq4)</span></code></pre></div>
<pre><code>x_cutq4
   [1,11.5] (11.5,23.2] (23.2,47.2]  (47.2,710] 
        250         250         250         250 </code></pre>
<p>With quantile cuts, each bin contains roughly the same number of observations (+/- 1).</p>
</div>
</div>
</div>
<div id="categorical-variables" class="section level2" number="19.2">
<h2><span class="header-section-number">19.2</span> Categorical variables</h2>
<p>Many algorithms (or their implementations) do not directly support categorical variables. To use
them, you must therefore convert all categorical variables to some type of numerical encoding.</p>
<div id="integer-encoding" class="section level3" number="19.2.1">
<h3><span class="header-section-number">19.2.1</span> Integer encoding</h3>
<p>If the categorical data is ordinal, you can simply convert it to integers.<br />
For example, the following <strong>ordered factor</strong>:</p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="datatrans.html#cb1157-1" aria-hidden="true" tabindex="-1"></a>brightness <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;bright&quot;</span>, <span class="st">&quot;brightest&quot;</span>, <span class="st">&quot;darkest&quot;</span>,</span>
<span id="cb1157-2"><a href="datatrans.html#cb1157-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;bright&quot;</span>, <span class="st">&quot;dark&quot;</span>, <span class="st">&quot;dim&quot;</span>, <span class="st">&quot;dark&quot;</span>),</span>
<span id="cb1157-3"><a href="datatrans.html#cb1157-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;darkest&quot;</span>, <span class="st">&quot;dark&quot;</span>, <span class="st">&quot;dim&quot;</span>, <span class="st">&quot;bright&quot;</span>, <span class="st">&quot;brightest&quot;</span>),</span>
<span id="cb1157-4"><a href="datatrans.html#cb1157-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1157-5"><a href="datatrans.html#cb1157-5" aria-hidden="true" tabindex="-1"></a>brightness</span></code></pre></div>
<pre><code>[1] bright    brightest darkest   bright    dark      dim       dark     
Levels: darkest &lt; dark &lt; dim &lt; bright &lt; brightest</code></pre>
<p>…can be directly coerced to an integer:</p>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="datatrans.html#cb1159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(brightness)</span></code></pre></div>
<pre><code>[1] 4 5 1 4 2 3 2</code></pre>
</div>
<div id="one-hot-encoding" class="section level3" number="19.2.2">
<h3><span class="header-section-number">19.2.2</span> One-hot encoding</h3>
<p>When categorical features are <strong>not</strong> ordinal, and your algorithm cannot handle them directly, you
can one-hot encode them. In one-hot encoding, each categorical feature is converted to k binary
features, where k = number of unique values in the input, such that only one feature has the value 1
per case. This is similar to creating dummy variables in statistics, with the difference that dummy
variables create <code>k - 1</code> new variables.</p>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1161-1"><a href="datatrans.html#cb1161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">21</span>)</span>
<span id="cb1161-2"><a href="datatrans.html#cb1161-2" aria-hidden="true" tabindex="-1"></a>admission_reasons <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;plannedSurgery&quot;</span>, <span class="st">&quot;emergencySurgery&quot;</span>, <span class="st">&quot;medical&quot;</span>)</span>
<span id="cb1161-3"><a href="datatrans.html#cb1161-3" aria-hidden="true" tabindex="-1"></a>admission <span class="ot">&lt;-</span> <span class="fu">sample</span>(admission_reasons, <span class="dv">12</span>, T)</span>
<span id="cb1161-4"><a href="datatrans.html#cb1161-4" aria-hidden="true" tabindex="-1"></a>admission</span></code></pre></div>
<pre><code> [1] &quot;medical&quot;          &quot;plannedSurgery&quot;   &quot;medical&quot;          &quot;plannedSurgery&quot;  
 [5] &quot;emergencySurgery&quot; &quot;medical&quot;          &quot;plannedSurgery&quot;   &quot;medical&quot;         
 [9] &quot;medical&quot;          &quot;emergencySurgery&quot; &quot;emergencySurgery&quot; &quot;emergencySurgery&quot;</code></pre>
<p>Multiple packages include functions that perform one-hot encoding. It’s a simple operation and we don’t necessarily need to install a large package with many dependencies.</p>
<p>Let’s write a simple function to perform one-hot encoding. (Note: you may have heard that for loops can be slow in R, but that depends on the operations performed. Here, we loop over an integer matrix and it is plenty fast)</p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="datatrans.html#cb1163-1" aria-hidden="true" tabindex="-1"></a>onehot <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">xname =</span> <span class="cn">NULL</span>) {</span>
<span id="cb1163-2"><a href="datatrans.html#cb1163-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(xname)) xname <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(x))</span>
<span id="cb1163-3"><a href="datatrans.html#cb1163-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">factor</span>(x)</span>
<span id="cb1163-4"><a href="datatrans.html#cb1163-4" aria-hidden="true" tabindex="-1"></a>  .levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(x)      <span class="co"># Get factor levels</span></span>
<span id="cb1163-5"><a href="datatrans.html#cb1163-5" aria-hidden="true" tabindex="-1"></a>  ncases <span class="ot">&lt;-</span> <span class="fu">NROW</span>(x)         <span class="co"># Get number of cases</span></span>
<span id="cb1163-6"><a href="datatrans.html#cb1163-6" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(x)    <span class="co"># Convert levels to integer</span></span>
<span id="cb1163-7"><a href="datatrans.html#cb1163-7" aria-hidden="true" tabindex="-1"></a>  oh <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, ncases, <span class="fu">length</span>(.levels))   <span class="co"># Initialize zeros matrix</span></span>
<span id="cb1163-8"><a href="datatrans.html#cb1163-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(oh) <span class="ot">&lt;-</span> <span class="fu">paste</span>(xname, .levels, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)  <span class="co"># Name columns by levels</span></span>
<span id="cb1163-9"><a href="datatrans.html#cb1163-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(ncases)) oh[i, index[i]] <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># Assign &quot;1&quot; to appropriate level</span></span>
<span id="cb1163-10"><a href="datatrans.html#cb1163-10" aria-hidden="true" tabindex="-1"></a>  oh</span>
<span id="cb1163-11"><a href="datatrans.html#cb1163-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s apply our new function to the admission vector:</p>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="datatrans.html#cb1164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">onehot</span>(admission)</span></code></pre></div>
<pre><code>      admission_emergencySurgery admission_medical admission_plannedSurgery
 [1,]                          0                 1                        0
 [2,]                          0                 0                        1
 [3,]                          0                 1                        0
 [4,]                          0                 0                        1
 [5,]                          1                 0                        0
 [6,]                          0                 1                        0
 [7,]                          0                 0                        1
 [8,]                          0                 1                        0
 [9,]                          0                 1                        0
[10,]                          1                 0                        0
[11,]                          1                 0                        0
[12,]                          1                 0                        0</code></pre>
<p>Note: <code>deparse(substitute(x))</code> above is used to automatically get the name of the input object (in this case “admission”). This is similar to how many of R’s internal functions (e.g. <code>plot()</code>) get the names of input objects.</p>

</div>
</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Programming for Data Science in R</strong>" was written by Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD. It was last built on 2021-11-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
