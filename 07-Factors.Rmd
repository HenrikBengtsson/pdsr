# Factors

```{r echo = FALSE}
knitr::opts_chunk$set(fig.width = 5, fig.height = 5,
                      comment = NA, cache = TRUE) 
```

Factors are used to store categorical data and therefore have many important uses in statistics / data science / machine learning.  

You can create factor by passing a numeric or character vector to `factor()` or `as.factor()`.  
The difference is that `as.factor()` does not accept any arguments while `factor()` does - and they can be very important. More on this right below.

```{r}
x <- c("a", "c", "d", "b", "a", "a", "d", "c")
xf <- factor(x)
xf
class(xf)
xftoo <- as.factor(x)
xftoo
class(xftoo)
```

```{block, type="Note"}
A factor contains three crucial pieces of information:

1. The underlying **integer vector**

2. The **mapping of integers to labels**

3. Whether the factor is **ordered**
```

Let's unpack these.  

Begin with a simple factor:

```{r}
x <- factor(c("female", "female", "female", "male", "male"))
x
```

Internally, the command sees there are two distinct labels, female and male, and defaults to assigning integer numbers alphabetically, in this case female has been mapped to '1' and male to '2'.

Printing a factor prints the vector of labels followed by the levels, i.e. the unique labels.  

## 1. The underlying **integer vector**

Each level is assigned an integer. (Internally, this is the "data" that forms the elements of a factor vector). You don't see these integers unless you convert the factor to numeric (`as.numeric()`) or look at the (truncated) output of `str()`

```{r}
as.numeric(x)
```

## 2. The **mapping of integers to labels**

This defines which integer is mapped to which level. i.e. whether 1 is mapped to male or female. You can store the same information regardless which one you choose to call 1 and 2. 

To get the mapping you can use `levels()`. It prints the labels in order:

```{r}
levels(x)
```
Again, this means that female is mapped to 1 and male is mapped to 2.

```{r}
str(x)
```
The above tells you that x is a factor,  
it has two levels labeled as "female" and "male", in that order, i.e. female is level 1 and male is level 2.    
The last part shows that the first five elements (in this case the whole vector) consists of three elements of level 1 (female) followed by 2 elements of level 2 (male)

### Defining the mapping of labels to integers

If you want to define the mapping of labels to their integer representation (and not default to them sorted alphabeticaly), you use the `levels` arguments of the `factor()` function.  

The vector passed to the `levels` arguments must include at least all unique values passed to `factor()`, otherwise you will get `NA` values

Without defining `levels` they are assigned alphabeticaly:

```{r}
x <- factor(c("alpha", "alpha", "gamma", "delta", "delta"))
x
```
Define `levels`:

```{r}
x <- factor(c("alpha", "alpha", "gamma", "delta", "delta"),
 levels = c("alpha", "gamma", "delta"))
x
```

The `table` command has a number of useful applications, in it simplest form, it tabulates number of elements with each unique value found in a vector:

```{r}
table(x)
```

If you know that more levels exist, even if no examples are present in your sample, you can define more levels:

```{r}
x <- factor(c("alpha", "alpha", "gamma", "delta", "delta"),
 levels = c("alpha", "beta", "gamma", "delta"))
x
```

```{r}
table(x)
```


## 3. Whether the factor is **ordered**

We looked at how you can define the order of levels using the `levels` argument in `factor()`, which affects the integer mapping to each label.

Entirely separately from the order of the mapping, you can further define if there is a *quantitative relationship* among levels of the form `level 1 < level 2 < ... < level n`.

```{block, type="Note"}
All factors' levels appear in some order or other.

An **ordered factor** indicates that its levels have a quantitative relationship of the form `level 1 < level 2 < ... < level n`.
```

First an unordered factor:

```{r}
dat <- sample(c("small", "medium", "large"), 10, TRUE)
x <- factor(dat)
x
```

To make the above into an ordered factor, we need to define the order of the levels with the `levels` arguments and also specify that it is ordered with the `ordered` argument:

```{r}
x <- factor(dat,
            levels = c("small", "medium", "large"),
            ordered = TRUE)
x
```

Note how the Levels now include the `<` sign between levels to indicate the ordering.

## Change order or labels

We've seen how to order levels and how to create an ordered factor and what these two mean.

**To change the order of levels** use `factor()`:

Start with a factor

```{r}
x <- factor(c("target", "target", "control", "control", "control"))
x
```

Change the order so that target is first:

```{r}
x <- factor(x, levels = c("target", "control"))
x
```
**To change the labels of the levels** use `levels()`:

```{r}
x
levels(x) <- c("hit", "decoy")
x
```

## Fatal error to avoid

It is common to get a dataset for classification where the outcome is a factor of 1s and 0s:

```{r}
outcome <- factor(c(1, 1, 0, 0, 0, 1, 0))
outcome
```
Some classification procedures expect the first level to be the 'positive' outcome, so you may want to reorder the levels.

If you were to mistakenly use `levels()` instead of `factor()` to achieve this as explained above, you would flip all the outcome values, which would most probably be a horrible disaster:

```{r}
levels(outcome) <- c("1", "0")
outcome
```

Don't ever do this.

## Summary

```{block, type="Note"}
- Factors in R are **integer vectors** with labels.

- A factor's internal integer values range from 1 to the number of levels, i.e. categories.

- Each integer corresponds to a label.

- Use `factor(levels = c(...))` to order levels

- Use `levels(x)` to change levels' labels
```