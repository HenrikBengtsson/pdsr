{
  "hash": "f3f50712099267ca03445902dad505da",
  "result": {
    "markdown": "---\nexecute:\n  cache: true\nknitr:\n  opts_chunk: \n    comment: ''\n---\n\n# Control Flow {#sec-controlflow}\n\nCode is often executed non-linearly (i.e. not line-by-line). Control flow (or flow \nof control) operations define the order in which code segments are executed.\n<br><br>\nExecution is often conditional (using `if - else` or `switch()`).\n<br><br>\nSegments of code may be repeated a defined number of times (`for`-loop) or as \nlong as certain conditions are met (`while`-loop). Any loop can be cut\nshort if needed.\n<br><br>\nControl flow operations form some of the fundamental building blocks of \nprograms. Each operation is very simple - combine enough of them and you can \nbuild up to arbitrary complexity.\n<br><br>\n\n* **`if`** [Condition] [Expression] **`else`** [Alternate Expression]\n* **`for`** [Variable in Sequence] do [Expression]\n* **`while`** [Condition] do [Expression]\n* **`repeat`** [Expression] until **`break`**`\n* **`break`** - break out of **`for`**, **`while`**or **`repeat`**loop\n* **`next`** - skip current iteration and proceed to next\n\n::: callout-tip\nTo access the documentation for `if`, `for`, `while`, or `repeat`, surround the command with backticks, e.g. `?if`. Alternatively, just use `help(\"if\")`.\n:::\n\n## Conditionals \n\n### `if` - `else`\n\nConsider a [systolic blood pressure](https://www.ucsfhealth.org/medical-tests/blood-pressure-measurement) \nmeasurement:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-1_f1bd59fe18f2d56f8583d7a17104fd6a'}\n\n```{.r .cell-code}\nSBP <- 146 # mmHg\nif (SBP <= 120) {\n  cat(\"SBP is normal\")\n} else {\n  cat(\"SBP is high\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSBP is high\n```\n\n\n:::\n:::\n\n\n### `if` - `else if` - `else`\n\nConsider a single [blood sodium](https://www.ucsfhealth.org/medical-tests/sodium-blood-test) result\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-2_cb4f11fdab8cadfa54875231af32c330'}\n\n```{.r .cell-code}\nNa <- 142 # mEq/L\nNa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 142\n```\n\n\n:::\n\n```{.r .cell-code}\nif (Na > 145) {\n  result <- \"Hypernatremia\"\n} else if (Na < 135) {\n  result <- \"Hyponatremia\"\n} else {\n  result <- \"Normal\"\n}\nresult\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Normal\"\n```\n\n\n:::\n:::\n\n\n### Conditional assignment with `if` - `else`\n\nYou can directly assign the output of an `if` statement to an object.\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-3_f64701123e3a13b603a94791bf7cb135'}\n\n```{.r .cell-code}\nNa <- 142 # mEq/L\nresult <- if (Na > 145) {\n  \"Hypernatremia\"\n} else if (Na < 135) {\n  \"Hyponatremia\"\n} else {\n  \"Normal\"\n}\n```\n:::\n\n\n### Conditional assignment with `ifelse()`\n\n`ifelse()` is [vectorized](#vectorization) and can be a great, compact \nmethod of conditional assignment.\n\nConsider a vector of [blood bilirubin levels](https://www.ucsfhealth.org/medical-tests/bilirubin-blood-test):\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-4_c639282e4c5fb41f2be310fdda0e72cb'}\n\n```{.r .cell-code}\nconjBil <- sample(runif(100, 0, .5), 20)\nconjBil\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 0.31811385 0.38968400 0.21499362 0.23203034 0.37526746 0.16426050\n [7] 0.12868840 0.23069969 0.15714545 0.28754730 0.22144313 0.30180910\n[13] 0.10930030 0.05687236 0.08626878 0.01070913 0.39604648 0.15176747\n[19] 0.20924784 0.11686753\n```\n\n\n:::\n:::\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-5_b8a5ed1476aac5a21835416786d58220'}\n\n```{.r .cell-code}\nconjBil_bin <- ifelse(conjBil > .3, \"Hyperbilirubinemia\", \"Normal\")\nconjBil_bin\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Hyperbilirubinemia\" \"Hyperbilirubinemia\" \"Normal\"            \n [4] \"Normal\"             \"Hyperbilirubinemia\" \"Normal\"            \n [7] \"Normal\"             \"Normal\"             \"Normal\"            \n[10] \"Normal\"             \"Normal\"             \"Hyperbilirubinemia\"\n[13] \"Normal\"             \"Normal\"             \"Normal\"            \n[16] \"Normal\"             \"Hyperbilirubinemia\" \"Normal\"            \n[19] \"Normal\"             \"Normal\"            \n```\n\n\n:::\n:::\n\n\nThe values assigned to the \"yes\" and \"no\" conditions can be a vector of the\nsame length as the first argument.\n\nConsider an arbitrary numeric example:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-6_1bb720dfaa7a573aacc8cc0f16d60af9'}\n\n```{.r .cell-code}\na <- 1:10\ny <- ifelse(a > 5, 11:20, 21:30)\ny\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 21 22 23 24 25 16 17 18 19 20\n```\n\n\n:::\n:::\n\n\nSo what did this do?\n\nIt is equivalent to an `if-else` statement within a `for`-loop:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-7_f7eca06c4a98176d798f71058389f2ba'}\n\n```{.r .cell-code}\nidl <- a > 5\nyes <- 11:20\nno <- 21:30\nout <- vector(\"numeric\", 10)\nfor (i in seq(a)) {\n  if (idl[i]) {\n    out[i] <- yes[i]\n  } else {\n    out[i] <- no[i]\n  }\n}\nout\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 21 22 23 24 25 16 17 18 19 20\n```\n\n\n:::\n:::\n\n\ni.e.\n\n* Create a logical index using `test`\n* for each element `i` in `test`:\n    * if the element `i` is TRUE, return `yes[i]`, else `no[i]`\n\nFor another example, lets take integers `1:11` and square the odd ones and cube \nthe even ones. We use the modulo operation `%%` to test if each element is odd \nor even:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-8_5050af2ab3ebc1d88fb2068f68ffcd50'}\n\n```{.r .cell-code}\nx <- 1:11\nxsc <- ifelse(x %% 2 == 0, c(1:11)^3, c(1:11)^2)\nxsc\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]    1    8    9   64   25  216   49  512   81 1000  121\n```\n\n\n:::\n:::\n\n\n## Loops\n\n### `for` loops {#forloops}\n\n::: callout-tip\nUse `for` loops to repeat execution of a block of code a certain number of \ntimes.\n:::\n\nThe for loop syntax is `for (var in vector) expression`.\n\nThe `expression` is usually surrounded by curly brackets and can include any \nnumber of lines, any amount of code:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-9_59e7baeba851d7a6a713fac18e5814e2'}\n\n```{.r .cell-code}\nfor (i in 1:3) {\n  cat(\"This is item\", i, \"\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThis is item 1 \nThis is item 2 \nThis is item 3 \n```\n\n\n:::\n:::\n\n\nThe loop executes for `length(vector)` times.  \nAt iteration `i`, `var = vector[i]`.  \nYou will often use the value of `var` inside the loop - but you don't have to:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-10_29adfdbc1d9a1633a1d99c38c0b7c89b'}\n\n```{.r .cell-code}\nfor (i in seq(10)) {\n  cat(i^2, \"\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1 \n4 \n9 \n16 \n25 \n36 \n49 \n64 \n81 \n100 \n```\n\n\n:::\n:::\n\n\n`letters` is a built-in constant that includes all 26 lowercase letters of the \nRoman alphabet; `LETTERS` similarly includes all 26 uppercase letters.\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-11_7e19485141ffd6b14ca7afab609126a1'}\n\n```{.r .cell-code}\nfor (letter in letters[1:5]) {\n  cat(letter, \"is a letter!\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\na is a letter!\nb is a letter!\nc is a letter!\nd is a letter!\ne is a letter!\n```\n\n\n:::\n:::\n\n\n#### Working on data within a for loop {#fordata}\n\nA common scenario involves working on a data object, whether a vector, matrix, \nlist, data.frame, and performing an operation on each elements, one at a time. \nWhile a lot of these operations are often performed using \n[loop functions](#loopfns) instead, for-loops can also be used.\n\nYou can start by initializing an object of the appropriate class and dimensions \nto hold the output. Then, each iteration of the for loop will assign its output \nto the corresponding element/s of this object.\n\nIn the following example we transform the `mtcars` built-in dataset's features \nto [z-scores](#zscore). The built-in command `scale()` will do this for quickly \nand conveniently, this is for demonstration purposes:\n\nFirst, initialize the output to be the desired class and dimensions:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-12_6679e50dfa8d837fbc72edb624b47548'}\n\n```{.r .cell-code}\nclass(mtcars)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"data.frame\"\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(mtcars)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 32 11\n```\n\n\n:::\n\n```{.r .cell-code}\nmtcars_z <- data.frame(matrix(0, 32, 11))\ncolnames(mtcars_z) <- colnames(mtcars)\n```\n:::\n\n\nor, it is simpler to just make a copy of `mtcars` to be overwritten by the \nfor loop later:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-13_e44eb35049745b8b76e0844e35b575d7'}\n\n```{.r .cell-code}\nmtcars_z <- mtcars\n```\n:::\n\n\nStandardization involves subtracting the mean and dividing by the standard \ndeviation.\n\nHere is the for loop - we iterate through each column and assign the \ntransformed data:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-14_606a65ab66b51083bed1599f1560205f'}\n\n```{.r .cell-code}\nfor (i in 1:ncol(mtcars)) {\n  mtcars_z[, i] <- (mtcars[, i] - mean(mtcars[, i])) / sd(mtcars[, i])\n}\n```\n:::\n\n\nLet's compare to the output of the `scale()` command by print the first 3 rows \nand columns of each:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-15_f1378bac457d2276cb283e40b3d910a9'}\n\n```{.r .cell-code}\nmtcars_z2 <- as.data.frame(scale(mtcars))\nmtcars_z[1:3, 1:3]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    mpg        cyl       disp\nMazda RX4     0.1508848 -0.1049878 -0.5706198\nMazda RX4 Wag 0.1508848 -0.1049878 -0.5706198\nDatsun 710    0.4495434 -1.2248578 -0.9901821\n```\n\n\n:::\n\n```{.r .cell-code}\nmtcars_z2[1:3, 1:3]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    mpg        cyl       disp\nMazda RX4     0.1508848 -0.1049878 -0.5706198\nMazda RX4 Wag 0.1508848 -0.1049878 -0.5706198\nDatsun 710    0.4495434 -1.2248578 -0.9901821\n```\n\n\n:::\n:::\n\n\nNote that we wrapped `scale()` around `as.data.frame()` because it outputs a \nmatrix.\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-16_14ad2b308f5c206a6d17df94698a8276'}\n\n```{.r .cell-code}\nall.equal(mtcars_z, mtcars_z2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n\n#### Nested `for` loops\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-17_4f44e2fe1d316fcd776ae65c7db9cc5b'}\n\n```{.r .cell-code}\na <- matrix(1:9, 3)\nfor (i in seq(3)) {\n  for (j in seq(3)) {\n    cat(\"  a[\", i, \",\", j, \"] is \", a[i, j], \"\\n\", sep = \"\")\n  }\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  a[1,1] is 1\n  a[1,2] is 4\n  a[1,3] is 7\n  a[2,1] is 2\n  a[2,2] is 5\n  a[2,3] is 8\n  a[3,1] is 3\n  a[3,2] is 6\n  a[3,3] is 9\n```\n\n\n:::\n:::\n\n\n#### Printing within a `for` loop\n\nIn the R console objects get printed just by typing their name:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-18_90702146e23597de11262ee4b0475568'}\n\n```{.r .cell-code}\na <- 4\na\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n\n```{.r .cell-code}\n# same as\nprint(a)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n:::\n\n\nThis \"automatic printing\" does not happen within a `for` loop, so you simply \nuse `print()` (or `cat()` as preferred):\n\nThe following loop does not print out anything:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-19_dd3e30db0c7b7aed446df3904a250fa4'}\n\n```{.r .cell-code}\na <- 0\nfor (i in 1:4) {\n  a <- a + i^2\n  a\n}\n```\n:::\n\n\nbut this does:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-20_a181bf7a6a03367486ad99f5f0a10921'}\n\n```{.r .cell-code}\na <- 0\nfor (i in 1:4) {\n  a <- a + i^2\n  print(a)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n[1] 5\n[1] 14\n[1] 30\n```\n\n\n:::\n:::\n\n\n### Conditional assignment with multiple options using `switch()`\n\nInstead of using multiple `if` - `else if` statements, we can build a more \ncompact call using `switch`, which is best suited for options that are of type \ncharacter, rather than numeric.\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-21_81d07a5070ee3d900bc7ec8141d579c0'}\n\n```{.r .cell-code}\ny <- sample(letters[seq(8)], 1)\ny\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"f\"\n```\n\n\n:::\n\n```{.r .cell-code}\noutput <- switch(y,                      # 1. Some expression\n                 a = \"Well done\",        # 2. The possible values of the expression, unquoted\n                 b = \"Not bad\",          #    followed by the `=` and the conditional output\n                 c = \"Nice try\",\n                 d = \"Not a nice try\",\n                 e = \"This is bad\",\n                 f = \"Fail\",\n                 \"This is not even a possible grade\") # 3. An optional last argument is the default\n                                                      #    value, if there is no match above\noutput\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Fail\"\n```\n\n\n:::\n:::\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-22_2e26b6b7f89cc934656a18ab652214fe'}\n\n```{.r .cell-code}\na <- rnorm(1)\na\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2.045822\n```\n\n\n:::\n\n```{.r .cell-code}\nout <- switch(as.integer(a > 0),\n              `1` = \"Input is positive\",\n              `0` = \"Input is not positive\")\nout\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Input is positive\"\n```\n\n\n:::\n:::\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-23_b2ebcf595557d9c16b4b6e9b72ef8828'}\n\n```{.r .cell-code}\na <- rnorm(1)\na\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.398822\n```\n\n\n:::\n\n```{.r .cell-code}\nout <- switch(as.character(a > 0),\n              `TRUE` = \"Input is positive\",\n              `FALSE` = \"Input is not positive\")\nout\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Input is not positive\"\n```\n\n\n:::\n:::\n\n\n#### `switch` example: HTTP Status Codes\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-24_054d3c9bba2bd178fa12ac82354167ee'}\n\n```{.r .cell-code}\nstatus <- sample(400:410, 1)\nstatus\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 410\n```\n\n\n:::\n\n```{.r .cell-code}\nresponse <- switch(as.character(status),\n                   `400` = \"Bad Request\",\n                   `401` = \"Unauthorized\",\n                   `402` = \"Payment Required\",\n                   `403` = \"Forbidden\",\n                   `404` = \"Not Found\",\n                   `405` = \"Method Not Allowed\",\n                   `406` = \"Not Acceptable\",\n                   `407` = \"Proxy Authentication Required\",\n                   `408` = \"Request Timeout\",\n                   `409` = \"Conflict\",\n                   `410` = \"Gone\")\nresponse\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Gone\"\n```\n\n\n:::\n:::\n\n\n### `while` loops\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-25_031c3c802c26269a89a9884e2102f331'}\n\n```{.r .cell-code}\na <- 10\nwhile (a > 0) {\n  a <- a - 1\n  cat(\"a is equal to\", a, \"\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\na is equal to 9 \na is equal to 8 \na is equal to 7 \na is equal to 6 \na is equal to 5 \na is equal to 4 \na is equal to 3 \na is equal to 2 \na is equal to 1 \na is equal to 0 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"when all is said and done, a is\", a)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nwhen all is said and done, a is 0\n```\n\n\n:::\n:::\n\n\n### `break` stops execution of a loop:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-26_4f1f3a5894b678b8bc1fd30ceb26dedc'}\n\n```{.r .cell-code}\nfor (i in seq(10)) {\n  if (i == 5) break\n  cat(i, \"squared is\", i^2, \"\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1 squared is 1 \n2 squared is 4 \n3 squared is 9 \n4 squared is 16 \n```\n\n\n:::\n:::\n\n\n### `next` skips the current iteration:\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-27_65d610efa038af727cdf7c9e1daa58a9'}\n\n```{.r .cell-code}\nfor (i in seq(7)) {\n  if (i == 5) next\n  cat(i, \"squared is\", i^2, \"\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1 squared is 1 \n2 squared is 4 \n3 squared is 9 \n4 squared is 16 \n6 squared is 36 \n7 squared is 49 \n```\n\n\n:::\n:::\n\n\n### `repeat` loops\n\nA `repeat` block initiates an infinite loop and you **must** use `break` to \nexit. They are less commonly used.\n\n\n::: {.cell hash='ControlFlow_cache/html/unnamed-chunk-28_7f124a3915ebca316385adb3413395a2'}\n\n```{.r .cell-code}\ni <- 10\nrepeat {\n  i <- i - 1\n  if (i == 0) break\n  cat(\"i is\", i, \"\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ni is 9 \ni is 8 \ni is 7 \ni is 6 \ni is 5 \ni is 4 \ni is 3 \ni is 2 \ni is 1 \n```\n\n\n:::\n:::\n\n\n::: callout-note\nAny number of control flow operations can be combined and nested as needed.\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}