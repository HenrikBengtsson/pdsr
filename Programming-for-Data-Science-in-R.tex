% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Programming for Data Science in R},
  pdfauthor={Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
% Make links footnotes instead of hotlinks:
\DeclareRobustCommand{\href}[2]{#2\footnote{\url{#1}}}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[3] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1 \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces\fi
  % set entry spacing
  \ifnum #2 > 0
  \setlength{\parskip}{#2\baselineskip}
  \fi
 }%
 {}
\usepackage{calc} % for \widthof, \maxof
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\maxof{\widthof{#1}}{\csllabelwidth}}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth}{#1}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\title{Programming for Data Science in R}
\author{Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD}
\date{2020-12-05}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\hypertarget{pdsr}{%
\chapter*{PDSR}\label{pdsr}}


Welcome to PDSR!\\
This book is aimed as an introductory- to intermediate-level R programming learning resource.\\
It is the online book for UCSF Biostat 213/4, currently being updated regularly.

EDG\\
\href{https://www.ucsf.edu/}{UCSF} \href{https://lambdamd.org/}{LCM},\\
San Francisco, CA, November 2020

\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

Throughout this book you will see boxes with R code followed by its output, if any. The code (or input) is decorated with a teal border on the left to separate it from its output, like in the following example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{200}\NormalTok{)}
\NormalTok{x[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] -0.82847083 -1.58936059  0.26891099  0.16006956  0.97151651  1.06612773
 [7]  2.12868481 -0.82863315  0.20806149  0.79409205 -1.27790280 -0.70165927
[13]  0.43853741 -1.36409009  1.38606876  1.81914918  0.05142488  0.21419057
[19] -0.84332025  0.01965687
\end{verbatim}

Notice that R adds numbers in brackets in the beginning of each row. This happens when R prints the contents of a vector. The number is the integer index of the first element in that row. Therefore, the first one is always \texttt{{[}1{]}} and the number of the subsequent rows depends on how many elements fit in each line. If the output is a single element, it will still have \texttt{{[}1{]}} in front of it.

Also notice that if we enclose the assignment operation of a variable in parentheses, this prints the resulting value of the variable. Therefore, this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(y }\OtherTok{\textless{}{-}} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4
\end{verbatim}

is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4
\end{verbatim}

Note that if you mouse over the input code box, a clickable ``Copy to clipboard'' appears on the top right of the box allowing you to copy paste into an R session or file.

Lastly, you will see the following informational boxes at times:

\begin{rmdnote}
Note
\end{rmdnote}

\begin{rmdtip}
Tip
\end{rmdtip}

\begin{rmdimportant}
Important
\end{rmdimportant}

\begin{rmdwarning}
Warning
\end{rmdwarning}

\begin{rmdcaution}
Caution
\end{rmdcaution}

This book was created using \href{https://CRAN.R-project.org/package=bookdown}{bookdown} (\protect\hyperlink{ref-R-bookdown}{Xie 2020})

\hypertarget{Rsetup}{%
\chapter{R setup, Packages \& Docs}\label{Rsetup}}

\hypertarget{r}{%
\section{R}\label{r}}

This book was compiled using R version 4.0.3 (2020-10-10).\\
Make sure you have the latest version by visiting the \href{https://www.r-project.org}{R project website}

It's a good idea to keep a log of the version of R and installed packages when beginning a new project. An easy way to do this is to save the output of \texttt{sessionInfo()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R version 4.0.3 (2020-10-10)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Catalina 10.15.7

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] compiler_4.0.3       magrittr_1.5         bookdown_0.21.4     
 [4] htmltools_0.5.0.9002 tools_4.0.3          yaml_2.2.1          
 [7] stringi_1.5.3        rmarkdown_2.5.3      knitr_1.30.2        
[10] stringr_1.4.0        digest_0.6.27        xfun_0.19           
[13] rlang_0.4.8          evaluate_0.14       
\end{verbatim}

\hypertarget{r-packages}{%
\section{R packages}\label{r-packages}}

\hypertarget{cran}{%
\subsection{CRAN}\label{cran}}

The Comprehensive R Archive Network (CRAN) is the official R package repository and currently hosts 16271 packages (as of 2020-09-13). To install a package from CRAN, use the builtin \texttt{install.packages} command:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}glmnet\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{check-for-outdated-packages}{%
\subsubsection{Check for outdated packages}\label{check-for-outdated-packages}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{old.packages}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{update-installed-packages}{%
\subsubsection{Update installed packages}\label{update-installed-packages}}

If you don't set \texttt{ask\ =\ FALSE}, you will have to accept each package update separately.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{update.packages}\NormalTok{(}\AttributeTok{ask =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{github}{%
\subsection{GitHub}\label{github}}

GitHub contains a large number of R packages, some of which also exist in CRAN, but the GitHub version may be updated a lot more frequently. To install from GitHub, you need to have the \texttt{remotes} package from CRAN first:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"remotes"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"username/reponame"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note: Running \texttt{remotes::install\_github("user/repo")} will not reinstall a previously installed package, unless it has been updated.

\hypertarget{bioconductor}{%
\subsection{Bioconductor}\label{bioconductor}}

Bioconductor is a repository which includes tools for the analysis and comprehension of high-throughput genomic data, among others. To install package from Bioconductor, first install the \texttt{BiocManager} package from CRAN:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(“BiocManager}\StringTok{")}
\end{Highlighting}
\end{Shaded}

and then use that similar to the builtin \texttt{install.packages}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{BiocManager}\SpecialCharTok{::}\FunctionTok{install}\NormalTok{(}\StringTok{"packageName"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{installed-packages}{%
\subsection{Installed packages}\label{installed-packages}}

List all R packages installed on your system with \texttt{installed.packages()} (the following block has not been run to prevent a very long output)

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{installed.packages}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

List attached packages with \texttt{search()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{search}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] ".GlobalEnv"        "package:stats"     "package:graphics" 
[4] "package:grDevices" "package:utils"     "package:datasets" 
[7] "package:methods"   "Autoloads"         "package:base"     
\end{verbatim}

List attached packages with their system path:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{searchpaths}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] ".GlobalEnv"                                                              
[2] "/Library/Frameworks/R.framework/Versions/4.0/Resources/library/stats"    
[3] "/Library/Frameworks/R.framework/Versions/4.0/Resources/library/graphics" 
[4] "/Library/Frameworks/R.framework/Versions/4.0/Resources/library/grDevices"
[5] "/Library/Frameworks/R.framework/Versions/4.0/Resources/library/utils"    
[6] "/Library/Frameworks/R.framework/Versions/4.0/Resources/library/datasets" 
[7] "/Library/Frameworks/R.framework/Versions/4.0/Resources/library/methods"  
[8] "Autoloads"                                                               
[9] "/Library/Frameworks/R.framework/Resources/library/base"                  
\end{verbatim}

\hypertarget{dependencies}{%
\subsection{Dependencies}\label{dependencies}}

Most R packages, whether in CRAN, Bioconductor, or GitHub, themselves rely on other packages to run. These are called \textbf{dependencies}. Many of these dependencies get installed automatically when you call \texttt{install.packages()} or \texttt{remotes::install\_github()}, etc. This depends largely on whether they are essential for the new package to work. Some packages, especially if they provide a large number of functions that may not all be used by all users, may make some dependencies optional. In that cases, if you try to execute a specific function that depends on uninstalled packages you may get a warning or error or some type of message indicating that you need to install further packages.

\hypertarget{rstudio-ide}{%
\section{RStudio IDE}\label{rstudio-ide}}

\href{https://rstudio.com/}{RStudio} is an Integrated Development Environment (\href{https://en.wikipedia.org/wiki/Integrated_development_environment}{IDE}) for R, which can make work in R easier, more productive, and more fun. Make sure to keep your installation up-to-date; new features are added often.

It is recommended to set up a new RStudio project for each data project: Select File \textgreater{} New Project\ldots{} from the main menu.

\hypertarget{builtin-documentation}{%
\section{Builtin Documentation}\label{builtin-documentation}}

After you've successfully installed R and RStudio, one of the first things to know is how to access and search the builtin documentation.

\hypertarget{get-help-on-a-specific-item}{%
\subsection{Get help on a specific item}\label{get-help-on-a-specific-item}}

If you know the name of what you're looking for (an R function most commonly, but possibly also the name of a dataset, or a package itself), just type \texttt{?} followed by the name of said function, dataset, etc. in the R prompt:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?sample}
\end{Highlighting}
\end{Shaded}

In RStudio, the above example will bring up the documentation for the \texttt{sample} function in the dedicated ``Help'' window, commonly situated at the bottom right (but can be moved by the user freely). If you are running R directly at the system shell, the same information is printed directly at the console.\\
Try running the above example on your system.

\hypertarget{search-the-docs}{%
\subsection{Search the docs}\label{search-the-docs}}

If you do not know the name of what you are looking for, you can use double question marks, \texttt{??}, followed by your query (this is short for the \texttt{help.search} command that provides a number of arguments you can look up using \texttt{?help.search}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{??bootstrap}
\end{Highlighting}
\end{Shaded}

\hypertarget{basicops}{%
\chapter{Basic operations}\label{basicops}}

First, before even learning about data types and structures, it may be worth looking at some of the basic mathematical and statistical operations in R.

\hypertarget{arithmetic}{%
\section{Arithmetic}\label{arithmetic}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{10}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

Standard arithmetic operations are as expected:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{+}\NormalTok{ y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{{-}}\NormalTok{ y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{*}\NormalTok{ y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{/} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.333333
\end{verbatim}

Exponentiation uses \texttt{\^{}}:
(This is worth pointing out, because while \texttt{\^{}} is likely the most common way to represent exponentiation, the symbol used for exponentiation varies across languages)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\SpecialCharTok{\^{}}\DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1000
\end{verbatim}

Square root is \texttt{sqrt()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\DecValTok{81}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 9
\end{verbatim}

Integer division
i.e.~\emph{Divide and forget the remainder}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{\%/\%} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

i.e.~how many times the denominator fits in the numerator, without taking fractions of the denominator. It can be applied on decimals the same way:

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{9.5} \SpecialCharTok{\%/\%} \FloatTok{3.1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

Modulo operation
i.e.~\emph{Divide and return just the remainder}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{\%\%}\NormalTok{ y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ (}\SpecialCharTok{{-}}\DecValTok{10}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)[}\SpecialCharTok{{-}}\DecValTok{11}\NormalTok{]}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{((}\SpecialCharTok{{-}}\DecValTok{10}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)[}\SpecialCharTok{{-}}\DecValTok{11}\NormalTok{], }\DecValTok{20}\NormalTok{)}
\NormalTok{x }\SpecialCharTok{{-}}\NormalTok{ (x }\SpecialCharTok{\%/\%}\NormalTok{ y) }\SpecialCharTok{*}\NormalTok{ y }\SpecialCharTok{==}\NormalTok{ x }\SpecialCharTok{\%\%}\NormalTok{ y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
[16] TRUE TRUE TRUE TRUE TRUE
\end{verbatim}

Try to figure out what the following does:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{)}
\FunctionTok{round}\NormalTok{(x }\SpecialCharTok{{-}}\NormalTok{ (x }\SpecialCharTok{\%/\%}\NormalTok{ y) }\SpecialCharTok{*}\NormalTok{ y, }\DecValTok{5}\NormalTok{) }\SpecialCharTok{==} \FunctionTok{round}\NormalTok{(x }\SpecialCharTok{\%\%}\NormalTok{ y, }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
[16] TRUE TRUE TRUE TRUE TRUE
\end{verbatim}

\begin{rmdtip}
\texttt{round(x,\ digits)} rounds \texttt{x} to the desired number of
digits and is used to overcome rounding errors.
\end{rmdtip}

\hypertarget{logical-operations}{%
\section{Logical operations}\label{logical-operations}}

Logical AND with \texttt{\&}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{T }\SpecialCharTok{\&}\NormalTok{ T}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{T }\SpecialCharTok{\&}\NormalTok{ F}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

Logical OR with \texttt{\textbar{}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{T }\SpecialCharTok{|}\NormalTok{ F}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

Logical negation with \texttt{!}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \ConstantTok{TRUE}
\SpecialCharTok{!}\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

Exclusive OR with \texttt{xor()}
(= one or the other is TRUE but not both)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(T, T, T, F, F, F)}
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(F, F, T, F, T, T)}
\NormalTok{a }\SpecialCharTok{\&}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE FALSE  TRUE FALSE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\SpecialCharTok{|}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{xor}\NormalTok{(a, b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  TRUE  TRUE FALSE FALSE  TRUE  TRUE
\end{verbatim}

Test all elements are TRUE with \texttt{all()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{all}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

Test if any element is TRUE with \texttt{any()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{any}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\hypertarget{common-descriptive-stats}{%
\section{Common descriptive stats}\label{common-descriptive-stats}}

Let's use the \texttt{rnorm} function to draw 200 numbers from a random normal distribution:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{200}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Basic descriptive stat operations:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -0.1153633
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{median}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -0.1068572
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sd}\NormalTok{(x) }\CommentTok{\# standard deviation}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.002306
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{min}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -4.145637
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{max}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2.295354
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -4.145637  2.295354
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-4.1456 -0.7514 -0.1069 -0.1154  0.5050  2.2954 
\end{verbatim}

\hypertarget{types}{%
\chapter{Data Types}\label{types}}

\begin{rmdtip}
In R, everything is an object.

Every ``action'' is a function.

\protect\hyperlink{functions}{Functions} are also objects, which means
they can be passed as arguments to functions or returned from other
functions.

We shall see the relevance of this, for example, in the
\protect\hyperlink{loopfns}{Loop Functions} chapter.
\end{rmdtip}

\hypertarget{base-types}{%
\section{Base types}\label{base-types}}

R includes a number of builtin data types.

These are defined by the R core team: users cannot define their own data types, but they can define their own classes - see section on \protect\hyperlink{classes}{Classes and Object-Oriented Programming}.

Some of the more popular data types in R are:

\begin{itemize}
\tightlist
\item
  Logical (a.k.a. \href{https://en.wikipedia.org/wiki/Boolean_data_type}{Boolean})
\item
  Numeric, integer
\item
  Numeric, \href{https://en.wikipedia.org/wiki/Double-precision_floating-point_format}{double}
\item
  Character
\item
  Environment
\item
  Closure (i.e.~function)
\end{itemize}

\begin{rmdcaution}
Many errors in R occur because a variable is, or gets coerced to, the
wrong type by accident.
\end{rmdcaution}

\begin{rmdtip}
\textbf{Check variable types with \texttt{typeof()} and/or
\texttt{str()}.}
\end{rmdtip}

\hypertarget{assignment}{%
\section{Assignment}\label{assignment}}

Use \texttt{\textless{}-} for all assignments:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{3}
\CommentTok{\# You can add comments within code blocks using the usual "\#" prefix}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
In \href{https://rstudio.com/}{RStudio} the keyboard shortcut for the
assignment operator \texttt{\textless{}-} is \texttt{Option\ -} (MacOS)
or \texttt{Alt\ -} (Windows).
\end{rmdtip}

Typing the name of an object\ldots{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

\ldots is equivalent to printing it

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

You can also place any assignment in parentheses and this will perform the assignment and print the object:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

\begin{rmdnote}
While you \emph{could} use the equal sign `=' for assignment, you should
only use it to pass arguments to functions.
\end{rmdnote}

You can assign the same value to multiple objects - this can be useful when initializing variables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ z }\OtherTok{\textless{}{-}}\NormalTok{ init }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{init}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0
\end{verbatim}

Excitingly, R allows assignment in the opposite direction as well:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{10} \OtherTok{{-}\textgreater{}}\NormalTok{ x}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

We shall see later that the \texttt{-\textgreater{}} assignment can be convenient at the end of a \href{https://class.lambdamd.org/progdatscir/functions.html\#the-pipe-operator}{pipe}.

You can even do this, which is fun (?) but unlikely to be useful:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{7} \OtherTok{{-}\textgreater{}}\NormalTok{ z}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 7
\end{verbatim}

Use \texttt{c()} to combine multiple values into a vector - this is one of the most widely used R functions:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{12}\NormalTok{, }\FloatTok{3.5}\NormalTok{, }\DecValTok{104}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -12.0   3.5 104.0
\end{verbatim}

\hypertarget{initialize---coerce---test-types}{%
\section{Initialize - coerce - test (types)}\label{initialize---coerce---test-types}}

The following summary table lists the functions to \emph{initialize}, \emph{coerce} (=convert), and \emph{test} the core data types, which are shown in more detail in the following paragraphs:

\begin{longtable}[]{@{}rrr@{}}
\toprule
\textbf{Initialize} & \textbf{Coerce} & \textbf{Test}\tabularnewline
\midrule
\endhead
\texttt{logical(n)} & \texttt{as.logical(x)} & \texttt{is.logical(x)}\tabularnewline
\texttt{integer(n)} & \texttt{as.integer(x)} & \texttt{is.integer(x)}\tabularnewline
\texttt{double(n)} & \texttt{as.double(x)} & \texttt{is.double(x)}\tabularnewline
\texttt{character(n)} & \texttt{as.character(x)} & \texttt{is.character(x)}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{logical}{%
\section{Logical}\label{logical}}

If you are writing code, use \texttt{TRUE} and \texttt{FALSE}.\\
On the console, you can abbreviate to \texttt{T} and \texttt{F}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(T, F)}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{b }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{\textgreater{}} \DecValTok{10}
\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 logi FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "logical"
\end{verbatim}

\hypertarget{integer}{%
\section{Integer}\label{integer}}

Create a range of integers using colon notation \texttt{start:end}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \DecValTok{11}\SpecialCharTok{:}\DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 11 12 13 14 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 int [1:5] 11 12 13 14 15
\end{verbatim}

Note that assigning an integer defaults to type double:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "double"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 num 1
\end{verbatim}

You can force it to be stored as integer by adding an \texttt{L} suffix:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ 1L}
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 int 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(1L, 3L, 5L)}
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 int [1:3] 1 3 5
\end{verbatim}

\hypertarget{double}{%
\section{Double}\label{double}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{3.4}\NormalTok{, }\FloatTok{10.987632419834556}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  1.20000  3.40000 10.98763
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "double"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 num [1:3] 1.2 3.4 11
\end{verbatim}

\hypertarget{character}{%
\section{Character}\label{character}}

A character vector consists of one or more elements, each of which consists of one or more actual characters, i.e.~it is \textbf{not} a vector of single characters. (The length of a character vector is the number of individual elements, and is not related to the number of characters in each element)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \StringTok{"word"}
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{, }\StringTok{"delta"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "a"     "b"     "gamma" "delta"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4
\end{verbatim}

\hypertarget{environment}{%
\section{Environment}\label{environment}}

Defining your own environments is probably for advanced use only:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{new.env}\NormalTok{()}
\NormalTok{x}\SpecialCharTok{$}\NormalTok{name }\OtherTok{\textless{}{-}} \StringTok{"Guava"}
\NormalTok{x}\SpecialCharTok{$}\NormalTok{founded }\OtherTok{\textless{}{-}} \DecValTok{2020}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
<environment: 0x7fa72d0c1370>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "environment"
\end{verbatim}

\hypertarget{closure-function}{%
\section{Closure (function)}\label{closure-function}}

Closures are functions - they contain their own variable definitions.\\
Read more on \protect\hyperlink{functions}{functions}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{square }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) x}\SpecialCharTok{\^{}}\DecValTok{2}
\FunctionTok{square}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(square)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "closure"
\end{verbatim}

\hypertarget{initialize-vectors}{%
\section{Initialize vectors}\label{initialize-vectors}}

You can create / initialize vectors of specific type with the \texttt{vector} command and specifying a \texttt{mode} or directly by calling the relevant function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(xl }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\AttributeTok{mode =} \StringTok{"logical"}\NormalTok{, }\AttributeTok{length =} \DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(xd }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\AttributeTok{mode =} \StringTok{"double"}\NormalTok{, }\AttributeTok{length =} \DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0 0 0 0 0 0 0 0 0 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(xn }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\AttributeTok{mode =} \StringTok{"numeric"}\NormalTok{, }\AttributeTok{length =} \DecValTok{10}\NormalTok{)) }\CommentTok{\# same as "double"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0 0 0 0 0 0 0 0 0 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(xi }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\AttributeTok{mode =} \StringTok{"integer"}\NormalTok{, }\AttributeTok{length =} \DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0 0 0 0 0 0 0 0 0 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(xc }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\AttributeTok{mode =} \StringTok{"character"}\NormalTok{, }\AttributeTok{length =} \DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "" "" "" "" "" "" "" "" "" ""
\end{verbatim}

These are aliases of the \texttt{vector} command above (print their source code to see for yourself)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xl }\OtherTok{\textless{}{-}} \FunctionTok{logical}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{xd }\OtherTok{\textless{}{-}} \FunctionTok{double}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{xn }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{(}\DecValTok{10}\NormalTok{) }\CommentTok{\# same as double}
\NormalTok{xi }\OtherTok{\textless{}{-}} \FunctionTok{integer}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{xc }\OtherTok{\textless{}{-}} \FunctionTok{character}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{explicit-coercion}{%
\section{Explicit coercion}\label{explicit-coercion}}

We can explicitly convert objects of one type to a different type using \texttt{as.*} functions:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{2.3}\NormalTok{, }\FloatTok{3.4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.2 2.3 3.4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{as.logical}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE TRUE TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{as.double}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 1 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 1 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{as.integer}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 1 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "1" "1" "1"
\end{verbatim}

Logical vectors are converted to 1s and 0s as expected:

TRUE becomes 1 and FALSE becomes 0

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{as.numeric}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 1 0
\end{verbatim}

Note that converting from numeric to logical \textbf{anything other than zero is TRUE}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, .}\DecValTok{5}\NormalTok{)}
\FunctionTok{as.logical}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE
\end{verbatim}

Not all conversions are possible.\\
There is no meaningful/consistent way to convert a character vector to numeric.\\
The following outputs NA values and prints a (helpful) error message.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"tangerine"}\NormalTok{)}
\FunctionTok{as.numeric}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning: NAs introduced by coercion
\end{verbatim}

\begin{verbatim}
[1] NA NA NA
\end{verbatim}

\hypertarget{implicit-coercion}{%
\section{Implicit coercion}\label{implicit-coercion}}

Remember, the language tries to make life easier and will often automatically coerce from one class to another to make requested operations possible.

For example, you can sum a logical vector.\\
It will automatically be converted to numeric as we saw earlier.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{sum}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

On the other hand, you cannot sum a factor, for example.\\
You get an error with an explanation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"mango"}\NormalTok{))}
\FunctionTok{sum}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in Summary.factor(structure(c(2L, 1L, 2L), .Label = c("banana", : 'sum' not meaningful for factors
\end{verbatim}

\begin{rmdnote}
Note: We had to add \texttt{error\ =\ TRUE} in the Rmarkdown's code
block's options (not visible in the HTML output), because otherwise
compilation of the Rmarkdown document would stop at the error.
\end{rmdnote}

If for some reason it made sense, you could explicitly coerce to numeric and then sum:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"mango"}\NormalTok{))}
\FunctionTok{sum}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 5
\end{verbatim}

\hypertarget{na-missing-values}{%
\section{\texorpdfstring{\texttt{NA}: Missing Values}{NA: Missing Values}}\label{na-missing-values}}

Missing values in any data type - logical, integer, double, or character - are coded using \texttt{NA}.\\
To check for the presence of \texttt{NA} values, use \texttt{is.na()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{5.3}\NormalTok{, }\FloatTok{4.8}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\FloatTok{9.6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.2 5.3 4.8  NA 9.6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.na}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE FALSE FALSE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\StringTok{"sugar"}\NormalTok{, }\StringTok{"ackee"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "mango"  "banana" NA       "sugar"  "ackee" 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.na}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE FALSE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(T, T, F, T, F, F, }\ConstantTok{NA}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  TRUE  TRUE FALSE  TRUE FALSE FALSE    NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.na}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE
\end{verbatim}

\texttt{is.na()} works similarly on matrices:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{x[}\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\FunctionTok{is.na}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      [,1]  [,2]  [,3]  [,4]
[1,] FALSE FALSE FALSE FALSE
[2,] FALSE FALSE FALSE FALSE
[3,] FALSE FALSE FALSE FALSE
[4,] FALSE FALSE  TRUE FALSE
[5,] FALSE FALSE FALSE FALSE
\end{verbatim}

\begin{rmdnote}
Note that \texttt{is.na()} returns a response for each element (i.e.~is
\protect\hyperlink{vectorization}{vectorized}) in contrast to
\texttt{is.numeric()}, \texttt{is.logical()}, etc. It makes sense, since
the latter are chacking the type of a whole object, while the former is
checking individual elements.
\end{rmdnote}

\texttt{anyNA()} is a very useful function to check if there an any NA values in an object:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anyNA}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{rmdnote}
Any operations on an \texttt{NA} results in \texttt{NA}
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{5.3}\NormalTok{, }\FloatTok{4.8}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\FloatTok{9.6}\NormalTok{)}
\NormalTok{x}\SpecialCharTok{*}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  2.4 10.6  9.6   NA 19.2
\end{verbatim}

Multiple functions that accept as input an object with multiple values (a vector, a matrix, a data.frame, etc.) will return \texttt{NA} if \emph{any} element is \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{median}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sd}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{min}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{max}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA NA
\end{verbatim}

First, make sure \texttt{NA} values represent legitimate missing data and not some error.\\
Then, decide how you want to handle it.

In all of the above commands you can pass \texttt{na.rm\ =\ TRUE} to ignore \texttt{NA} values:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 5.225
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{median}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 5.05
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sd}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.441293
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{min}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{max}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 9.6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.2 9.6
\end{verbatim}

The chapter on \protect\hyperlink{missingdata}{Handling Missing Data} describes some approaches to handling missing data in the context of statistics or modeling, commonly supervised learning.

\hypertarget{nan-not-a-number}{%
\section{\texorpdfstring{\texttt{NaN}: Not a number}{NaN: Not a number}}\label{nan-not-a-number}}

\texttt{NaN} is a special case of \texttt{NA} and can be the result of undefined mathematical operations:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{log}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning in log(-4): NaNs produced
\end{verbatim}

Note that \texttt{class()} returns ``numeric'':

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

To test for \texttt{NaN}s, use:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.nan}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\texttt{NaN}s are also \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.na}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

But the opposite is not true:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.nan}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{rmdnote}
\texttt{NaN} can be considered a subtype of \texttt{NA}, as such:
\texttt{is.na(NaN)} is \texttt{TRUE}, but \texttt{is.nan(NA)} is
\texttt{FALSE}.
\end{rmdnote}

\hypertarget{null-the-empty-object}{%
\section{\texorpdfstring{\texttt{NULL}: the empty object}{NULL: the empty object}}\label{null-the-empty-object}}

The \texttt{NULL} object represents an empty object.

\begin{rmdnote}
\texttt{NULL} means empty, \textbf{\emph{not missing}}, and is therefore
entirely different from \texttt{NA}
\end{rmdnote}

\texttt{NULL} shows up for example when initializing a list:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"list"}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
NULL

[[2]]
NULL

[[3]]
NULL

[[4]]
NULL
\end{verbatim}

and it can be replaced normally:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1] 3

[[2]]
NULL

[[3]]
NULL

[[4]]
NULL
\end{verbatim}

\hypertarget{replacing-with-null}{%
\subsection{Replacing with NULL}\label{replacing-with-null}}

You cannot replace one or more elements of a vector/matrix/array with \texttt{NULL} because \texttt{NULL} has length 0 and replacement requires object of equal length:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{11}\SpecialCharTok{:}\DecValTok{15}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 11 12 13 14 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in a[1] <- NULL: replacement has length zero
\end{verbatim}

However, in lists and therefore also data frames, replacing an element with \texttt{NULL} \textbf{\emph{removes that element}}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{al }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{alpha =} \DecValTok{11}\SpecialCharTok{:}\DecValTok{15}\NormalTok{,}
           \AttributeTok{beta =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{),}
           \AttributeTok{gamma =} \FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"tangerine"}\NormalTok{))}
\NormalTok{al}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$alpha
[1] 11 12 13 14 15

$beta
 [1] -0.54550444  1.27050004 -0.88020860  0.98161477  0.59352084  1.55229511
 [7]  0.73903842 -0.54130170 -0.07683973  0.18744721

$gamma
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{al[[}\DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{al}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$alpha
[1] 11 12 13 14 15

$gamma
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

Finally, \texttt{NULL} is often used as the default value in a function's argument. The function definition must then determine what the default behavior/value should be.

\hypertarget{structures}{%
\chapter{Data Structures}\label{structures}}

There are 5 main data structures in R:

\begin{itemize}
\tightlist
\item
  \textbf{Vector}: 1-dimensional; homogeneous collection
\item
  \textbf{Matrix}: 2-dimensional; homogeneous collection
\item
  \textbf{Array}: N-dimensional; homogeneous collection
\item
  \textbf{List}: 1-dimensional, but can be nested; heterogeneous collection
\item
  \textbf{Data frame}: 2-dimensional: A special type of list; heterogeneous collection of columns
\end{itemize}

Homogeneous vs.~hetereogeneous refers to the kind of data types (integer, double, character, logical, factor, etc.) that a structure can hold. This means a matrix can hold only numbers or only characters, but a data frame can hold different types in different columns. That is why data frames are very popular data structure for statistical work.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{./R_datastructures} 

}

\caption{R Data Structure summary - Best to read through this chapter first and then refer back to this figure}\label{fig:FigRDataStructures}
\end{figure}

\begin{rmdtip}
\textbf{Check object class with \texttt{class()} and/or \texttt{str()}.}
\end{rmdtip}

\hypertarget{initialize---coerce---test-structures}{%
\section{Initialize - coerce - test (structures)}\label{initialize---coerce---test-structures}}

The following summary table lists the functions to \emph{initialize}, \emph{coerce} (=convert), and \emph{test} the core data structures, which are shown in more detail in the following paragraphs:

\begin{longtable}[]{@{}rrr@{}}
\toprule
\textbf{Initialize} & \textbf{Coerce} & \textbf{Test}\tabularnewline
\midrule
\endhead
\texttt{vector(n)} & \texttt{as.vector(x)} & \texttt{is.vector(x)}\tabularnewline
\texttt{matrix(n)} & \texttt{as.matrix(x)} & \texttt{is.matrix(x)}\tabularnewline
\texttt{array(n)} & \texttt{as.array(x)} & \texttt{is.array(x)}\tabularnewline
\texttt{list(n)} & \texttt{as.list(x)} & \texttt{is.list(x)}\tabularnewline
\texttt{data.frame(n)} & \texttt{as.data.frame(x)} & \texttt{is.data.frame(x)}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{vectors}{%
\section{Vectors}\label{vectors}}

A vector is the basic structure that contains data in R. Other structures that contain data are made up of one or more vectors.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{7}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 3 5 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "double"
\end{verbatim}

A vector has \texttt{length()} but no \texttt{dim()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x2 }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x3 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  0.03660536 -0.07111658 -0.23890546  0.66077654  0.53269983  0.71958561
 [7] -0.16984797  0.05383130  0.04024986 -1.64348671
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x4 }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x5 }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{), }\DecValTok{20}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 70 28  8  6 78 41 94 62  2 43 56 44 27 96 91 39 49 71 83 10
\end{verbatim}

\hypertarget{generating-sequences-with-seq}{%
\subsection{\texorpdfstring{Generating sequences with \texttt{seq()}}{Generating sequences with seq()}}\label{generating-sequences-with-seq}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  from, to, by
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{, .}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1.0  1.5  2.0  2.5  3.0  3.5  4.0  4.5  5.0  5.5  6.0  6.5  7.0  7.5  8.0
[16]  8.5  9.0  9.5 10.0
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  1:n
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{12}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10 11 12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# or }
\NormalTok{(}\FunctionTok{seq\_len}\NormalTok{(}\DecValTok{12}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10 11 12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# is same as}
\DecValTok{1}\SpecialCharTok{:}\DecValTok{12}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10 11 12
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Along the length of another object
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq\_along}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3 4 5
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  \texttt{from}, \texttt{to} with length \texttt{n}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\DecValTok{12}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{11}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] -5.0 -3.3 -1.6  0.1  1.8  3.5  5.2  6.9  8.6 10.3 12.0
\end{verbatim}

\hypertarget{initializing-a-vector}{%
\subsection{Initializing a vector}\label{initializing-a-vector}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\AttributeTok{length =} \DecValTok{10}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"numeric"}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"list"}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{matrices}{%
\section{Matrices}\label{matrices}}

A matrix is a \textbf{vector with 2 dimensions}.

To create a matrix, you pass a vector to the \texttt{matrix()} command and specify number of rows using \texttt{nrow} and/or number of columns using \texttt{ncol}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{1000}\NormalTok{), }\DecValTok{30}\NormalTok{),}
            \AttributeTok{nrow =} \DecValTok{10}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      [,1] [,2] [,3]
 [1,]    1  762  834
 [2,]  506   26  570
 [3,]  667  902  696
 [4,]  889  765  337
 [5,]  722  622  369
 [6,]  216  257  370
 [7,]  652  973   34
 [8,]  739  329  308
 [9,]  952  671  649
[10,]  533  784  975
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "matrix" "array" 
\end{verbatim}

\begin{rmdnote}
A matrix has length (\texttt{length(x)}) equal to the number of all (i,
j) elements or nrow * ncol (if \texttt{i} is the row index and
\texttt{j} is the column index) and dimensions (\texttt{dim(x)}) as
expected:
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10  3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ncol}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

\hypertarget{construct-by-row-or-by-column}{%
\subsection{Construct by row or by column}\label{construct-by-row-or-by-column}}

By default, vectors are constructed by column (byrow = FALSE)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{10}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{, }\AttributeTok{byrow =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      [,1] [,2]
 [1,]    1   11
 [2,]    2   12
 [3,]    3   13
 [4,]    4   14
 [5,]    5   15
 [6,]    6   16
 [7,]    7   17
 [8,]    8   18
 [9,]    9   19
[10,]   10   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{10}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{, }\AttributeTok{byrow =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      [,1] [,2]
 [1,]    1    2
 [2,]    3    4
 [3,]    5    6
 [4,]    7    8
 [5,]    9   10
 [6,]   11   12
 [7,]   13   14
 [8,]   15   16
 [9,]   17   18
[10,]   19   20
\end{verbatim}

\hypertarget{initialize-a-matrix}{%
\subsection{Initialize a matrix}\label{initialize-a-matrix}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{6}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{0}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{6}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    0    0    0
[3,]    0    0    0    0
[4,]    0    0    0    0
[5,]    0    0    0    0
[6,]    0    0    0    0
\end{verbatim}

\hypertarget{bind-vectors-by-column-or-by-row}{%
\subsection{Bind vectors by column or by row}\label{bind-vectors-by-column-or-by-row}}

Use \texttt{cbind} (``column-bind'') to convert a set of input vectors to columns of a \textbf{matrix}. The vectors must be of the same length:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{11}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\DecValTok{41}\SpecialCharTok{:}\DecValTok{50}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      [,1] [,2] [,3]
 [1,]    1   11   41
 [2,]    2   12   42
 [3,]    3   13   43
 [4,]    4   14   44
 [5,]    5   15   45
 [6,]    6   16   46
 [7,]    7   17   47
 [8,]    8   18   48
 [9,]    9   19   49
[10,]   10   20   50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "matrix" "array" 
\end{verbatim}

Similarly, you can use \texttt{rbind} (``row-bind'') to convert a set of input vectors to rows of a \textbf{matrix}. The vectors again must be of the same length:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{11}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\DecValTok{41}\SpecialCharTok{:}\DecValTok{50}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
[1,]    1    2    3    4    5    6    7    8    9    10
[2,]   11   12   13   14   15   16   17   18   19    20
[3,]   41   42   43   44   45   46   47   48   49    50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "matrix" "array" 
\end{verbatim}

\hypertarget{combine-matrices}{%
\subsection{Combine matrices}\label{combine-matrices}}

\texttt{cbind()} and \texttt{rbind()} can be used to combine two or more matrices together - or vector and matrices:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cbind}\NormalTok{(}\FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{2}\NormalTok{), }\FunctionTok{matrix}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    1    2    2    2    2
[2,]    1    1    2    2    2    2
[3,]    1    1    2    2    2    2
[4,]    1    1    2    2    2    2
[5,]    1    1    2    2    2    2
\end{verbatim}

\hypertarget{arrays}{%
\section{Arrays}\label{arrays}}

Arrays are \textbf{vectors with dimensions}.\\
You can have 1D, 2D or any-D, i.e.~ND arrays.

\hypertarget{d-array}{%
\subsection{1D array}\label{d-array}}

A 1D array is just like a vector but of class \texttt{array} and with \texttt{dim(x)} equal to \texttt{length(x)} (remember, vectors have only \texttt{length(x)} and undefined \texttt{dim(x)}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\NormalTok{xa }\OtherTok{\textless{}{-}} \FunctionTok{array}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{dim =} \DecValTok{10}\NormalTok{)}
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.vector}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(xa)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "array"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.vector}\NormalTok{(xa)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(xa)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(xa)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

It is quite unlikely you will need to use a 1D array instead of a vector.

\hypertarget{d-array-1}{%
\subsection{2D array}\label{d-array-1}}

A 2D array is a matrix:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{array}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{40}\NormalTok{, }\AttributeTok{dim =} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{4}\NormalTok{))}
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "matrix" "array" 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10  4
\end{verbatim}

\hypertarget{nd-array}{%
\subsection{ND array}\label{nd-array}}

You can build an N-dimensional array:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{array}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{60}\NormalTok{, }\AttributeTok{dim =} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
, , 1

     [,1] [,2] [,3] [,4]
[1,]    1    6   11   16
[2,]    2    7   12   17
[3,]    3    8   13   18
[4,]    4    9   14   19
[5,]    5   10   15   20

, , 2

     [,1] [,2] [,3] [,4]
[1,]   21   26   31   36
[2,]   22   27   32   37
[3,]   23   28   33   38
[4,]   24   29   34   39
[5,]   25   30   35   40

, , 3

     [,1] [,2] [,3] [,4]
[1,]   41   46   51   56
[2,]   42   47   52   57
[3,]   43   48   53   58
[4,]   44   49   54   59
[5,]   45   50   55   60
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "array"
\end{verbatim}

You can provide names for each dimensions using the \texttt{dimnames} argument. It accepts a list where each elements is a character vector of legth equal to the dimension length. Using the same example as above, we pass three character vector of length 5, 4, and 3 to match the length of the dimensions:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{array}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{60}\NormalTok{,}
            \AttributeTok{dim =} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{),}
            \AttributeTok{dimnames =} \FunctionTok{list}\NormalTok{(letters[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{],}
                            \FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"beta"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{, }\StringTok{"delta"}\NormalTok{),}
                            \FunctionTok{c}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\StringTok{"y"}\NormalTok{, }\StringTok{"z"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

3D arrays can be used to represent color images. Here, just for fun, we use \texttt{rasterImage} to show how you would visualize such an image:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{array}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{255}\NormalTok{, }\DecValTok{432}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{), }\AttributeTok{dim =} \FunctionTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\FunctionTok{par}\NormalTok{(}\StringTok{"pty"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "m"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{pty =} \StringTok{"s"}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, }\ConstantTok{NULL}\NormalTok{,}
     \AttributeTok{xlim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{), }\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{),}
     \AttributeTok{axes =}\NormalTok{ F, }\AttributeTok{ann =}\NormalTok{ F, }\AttributeTok{pty =} \StringTok{"s"}\NormalTok{)}
\FunctionTok{rasterImage}\NormalTok{(x}\SpecialCharTok{/}\DecValTok{255}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{06-DataStructures_files/figure-latex/unnamed-chunk-24-1.pdf}

\hypertarget{lists}{%
\section{Lists}\label{lists}}

To define a list, we use \texttt{list()} to pass any number of objects.\\
If these objects are passed as named arguments, the names will rename as element names:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{one =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{,}
          \AttributeTok{two =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{, .}\DecValTok{1}\NormalTok{), }\DecValTok{10}\NormalTok{),}
          \AttributeTok{three =} \FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"tangerine"}\NormalTok{),}
          \AttributeTok{four =}\NormalTok{ median)}
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "list"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
List of 4
 $ one  : int [1:4] 1 2 3 4
 $ two  : num [1:10] 78.3 1.9 91.4 6.4 34 42.6 14.9 34.6 36.7 66
 $ three: chr [1:3] "mango" "banana" "tangerine"
 $ four :function (x, na.rm = FALSE, ...)  
\end{verbatim}

\hypertarget{nested-lists}{%
\subsection{Nested lists}\label{nested-lists}}

Since each element can be any object at all, it is simple to build a nested list:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{alpha =}\NormalTok{ letters[}\FunctionTok{sample}\NormalTok{(}\DecValTok{26}\NormalTok{, }\DecValTok{4}\NormalTok{)],}
          \AttributeTok{beta =} \FunctionTok{sample}\NormalTok{(}\DecValTok{12}\NormalTok{),}
          \AttributeTok{gamma =} \FunctionTok{list}\NormalTok{(}\AttributeTok{i =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{),}
                       \AttributeTok{j =} \FunctionTok{runif}\NormalTok{(}\DecValTok{10}\NormalTok{),}
                       \AttributeTok{j =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1000}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{10}\NormalTok{)))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$alpha
[1] "w" "q" "f" "e"

$beta
 [1]  6  4  3  5  1 12  9  2  7  8 11 10

$gamma
$gamma$i
 [1]  0.4588328 -0.5846097 -2.8060155 -1.4877713 -0.1512259  2.6922862
 [7]  1.5844158  0.8366509  1.3358140  0.1389904

$gamma$j
 [1] 0.94366101 0.45336397 0.83402023 0.57217033 0.54702716 0.95788796
 [7] 0.27838675 0.89118828 0.57841011 0.08894841

$gamma$j
 [1]    0.0000  111.1111  222.2222  333.3333  444.4444  555.5556  666.6667
 [8]  777.7778  888.8889 1000.0000
\end{verbatim}

\hypertarget{initialize-a-list}{%
\subsection{Initialize a list}\label{initialize-a-list}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"list"}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
NULL

[[2]]
NULL

[[3]]
NULL

[[4]]
NULL
\end{verbatim}

\hypertarget{combine-lists}{%
\subsection{Combine lists}\label{combine-lists}}

You can combine lists with \texttt{c()} (just like vectors):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l1 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{q =} \DecValTok{11}\SpecialCharTok{:}\DecValTok{14}\NormalTok{, }\AttributeTok{r =}\NormalTok{ letters[}\DecValTok{11}\SpecialCharTok{:}\DecValTok{14}\NormalTok{])}
\NormalTok{l2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{s =}\NormalTok{ LETTERS[}\DecValTok{21}\SpecialCharTok{:}\DecValTok{24}\NormalTok{], }\AttributeTok{t =} \DecValTok{100}\SpecialCharTok{:}\DecValTok{97}\NormalTok{)}
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(l1, l2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$q
[1] 11 12 13 14

$r
[1] "k" "l" "m" "n"

$s
[1] "U" "V" "W" "X"

$t
[1] 100  99  98  97
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4
\end{verbatim}

\hypertarget{mixing-types-with-c}{%
\subsection{\texorpdfstring{Mixing types with \texttt{c()}}{Mixing types with c()}}\label{mixing-types-with-c}}

It's best to use \texttt{c()} to either combine elements of the same type into a vector, or to combine lists, otherwise you must inspect the outcome to be certain it was as intended.

As we've seen, if all arguments passed to \texttt{c()} are of a single type, you get a vector of that type:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{12.9}\NormalTok{, }\FloatTok{94.67}\NormalTok{, }\FloatTok{23.74}\NormalTok{, }\FloatTok{46.901}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 12.900 94.670 23.740 46.901
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

If arguments passed to \texttt{c()} are a mix of numeric and character, they all get \textbf{\emph{coerced to character}}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{23.54}\NormalTok{, }\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\DecValTok{75}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "23.54"  "mango"  "banana" "75"    
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

If you pass more types of objects (which cannot be coerced to character) you get a list, since it is the only structure that can support all of them together:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{42}\NormalTok{, mean, }\StringTok{"potatoes"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1] 42

[[2]]
function (x, ...) 
UseMethod("mean")
<bytecode: 0x7fd80a23ae90>
<environment: namespace:base>

[[3]]
[1] "potatoes"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "list"
\end{verbatim}

\begin{rmdnote}
Other than concatenating vectors of the same type or lists into a larger
list, it probably best to avoid using \texttt{c()} and directly
constructing the object you want using, e.g.~\texttt{list()}.
\end{rmdnote}

\hypertarget{data-frames}{%
\section{Data frames}\label{data-frames}}

\begin{rmdnote}
A data frames is a \textbf{special type of list} where each element has
the same length and forms a column, resulting in a 2D structure. Unlike
matrices, each column can contain a different data type.
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Feat\_1 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                \AttributeTok{Feat\_2 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{5}\NormalTok{),}
                \AttributeTok{Feat\_3 =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"rnd\_"}\NormalTok{, }\FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{), }\DecValTok{5}\NormalTok{)))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Feat_1      Feat_2 Feat_3
1      1 -0.52949644  rnd_3
2      2  1.39255696 rnd_76
3      3 -0.47019936 rnd_83
4      4 -0.35915907 rnd_97
5      5  0.08319403 rnd_57
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
'data.frame':   5 obs. of  3 variables:
 $ Feat_1: int  1 2 3 4 5
 $ Feat_2: num  -0.5295 1.3926 -0.4702 -0.3592 0.0832
 $ Feat_3: chr  "rnd_3" "rnd_76" "rnd_83" "rnd_97" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x}\SpecialCharTok{$}\NormalTok{Feat\_1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{100}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\FunctionTok{length}\NormalTok{(mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(mat)}
\FunctionTok{length}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

\hypertarget{attributes}{%
\section{Attributes}\label{attributes}}

R objects may have some builtin attributes but you can add arbitrary attributes to any R object. These are used to store additional information, sometimes called metadata.

\hypertarget{print-all-attributes}{%
\subsection{Print all attributes}\label{print-all-attributes}}

To print an object's attributes, use \texttt{attributes}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attributes}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$names
[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     

$class
[1] "data.frame"

$row.names
  [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
 [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36
 [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54
 [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
 [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90
 [91]  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108
[109] 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126
[127] 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144
[145] 145 146 147 148 149 150
\end{verbatim}

This returns a named list. In this case we got names, class, and row.names of the iris data frame.

\hypertarget{get-or-set-specific-attributes}{%
\subsection{Get or set specific attributes}\label{get-or-set-specific-attributes}}

You can assign new attributes using \texttt{attr}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attr}\NormalTok{(x, }\StringTok{"name"}\NormalTok{) }\OtherTok{\textless{}{-}} \StringTok{"Very special vector"}
\end{Highlighting}
\end{Shaded}

Printing the vector after adding a new attribute, prints the attribute name and value underneath the vector itself:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
attr(,"name")
[1] "Very special vector"
\end{verbatim}

Our trusty \texttt{str} function will print attributes as well

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 int [1:10] 1 2 3 4 5 6 7 8 9 10
 - attr(*, "name")= chr "Very special vector"
\end{verbatim}

\hypertarget{a-matrix-is-a-vector---a-closer-look}{%
\subsubsection{A matrix is a vector - a closer look}\label{a-matrix-is-a-vector---a-closer-look}}

Let's see how a matrix is literally just a vector with assigned dimensions.\\
Start with a vector of length 20:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{20}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
\end{verbatim}

The vector has no attributes - yet:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attributes}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

To convert to a matrix, we would normally pass our vector to the \texttt{matrix()} function and define number of rows and/or columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xm }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(x, }\DecValTok{5}\NormalTok{)}
\NormalTok{xm}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2] [,3] [,4]
[1,]    1    6   11   16
[2,]    2    7   12   17
[3,]    3    8   13   18
[4,]    4    9   14   19
[5,]    5   10   15   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attributes}\NormalTok{(xm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$dim
[1] 5 4
\end{verbatim}

Just for demonstration, let's instead directly add a dimension attribute to our vector:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attr}\NormalTok{(x, }\StringTok{"dim"}\NormalTok{) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2] [,3] [,4]
[1,]    1    6   11   16
[2,]    2    7   12   17
[3,]    3    8   13   18
[4,]    4    9   14   19
[5,]    5   10   15   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "matrix" "array" 
\end{verbatim}

Just like that, we have a matrix.

\hypertarget{common-builtin-attributes}{%
\subsection{Common builtin attributes}\label{common-builtin-attributes}}

Vectors can have named elements. A new vector has no names, but you can add them:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\FunctionTok{names}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Value"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(x))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Value1      Value2      Value3      Value4      Value5      Value6 
 0.21769873  0.25347312  1.47449076 -0.52973667  0.97180103 -0.90699222 
     Value7      Value8      Value9     Value10 
 0.82876971 -1.33022619  0.50871759  0.08989001 
\end{verbatim}

Matrices and data frames can have column names (\texttt{colnames}) and row names (\texttt{rownames}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{15}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rownames}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Feature"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\DecValTok{3}\NormalTok{))}
\FunctionTok{rownames}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Case"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\DecValTok{5}\NormalTok{))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feature1 Feature2 Feature3
Case1        1        6       11
Case2        2        7       12
Case3        3        8       13
Case4        4        9       14
Case5        5       10       15
\end{verbatim}

Lists are vectors so they have \texttt{names}. These can be defined when a list is created using the name-value pairs or added/changed at any time.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{HospitalName =} \StringTok{"CaliforniaGeneral"}\NormalTok{,}
          \AttributeTok{ParticipatingDepartments =} \FunctionTok{c}\NormalTok{(}\StringTok{"Neurology"}\NormalTok{, }\StringTok{"Psychiatry"}\NormalTok{, }\StringTok{"Neurosurgery"}\NormalTok{),}
          \AttributeTok{PatientIDs =} \DecValTok{1001}\SpecialCharTok{:}\DecValTok{1253}\NormalTok{)}
\FunctionTok{names}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "HospitalName"             "ParticipatingDepartments"
[3] "PatientIDs"              
\end{verbatim}

Add/Change names:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Hospital"}\NormalTok{, }\StringTok{"Departments"}\NormalTok{, }\StringTok{"PIDs"}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$Hospital
[1] "CaliforniaGeneral"

$Departments
[1] "Neurology"    "Psychiatry"   "Neurosurgery"

$PIDs
  [1] 1001 1002 1003 1004 1005 1006 1007 1008 1009 1010 1011 1012 1013 1014 1015
 [16] 1016 1017 1018 1019 1020 1021 1022 1023 1024 1025 1026 1027 1028 1029 1030
 [31] 1031 1032 1033 1034 1035 1036 1037 1038 1039 1040 1041 1042 1043 1044 1045
 [46] 1046 1047 1048 1049 1050 1051 1052 1053 1054 1055 1056 1057 1058 1059 1060
 [61] 1061 1062 1063 1064 1065 1066 1067 1068 1069 1070 1071 1072 1073 1074 1075
 [76] 1076 1077 1078 1079 1080 1081 1082 1083 1084 1085 1086 1087 1088 1089 1090
 [91] 1091 1092 1093 1094 1095 1096 1097 1098 1099 1100 1101 1102 1103 1104 1105
[106] 1106 1107 1108 1109 1110 1111 1112 1113 1114 1115 1116 1117 1118 1119 1120
[121] 1121 1122 1123 1124 1125 1126 1127 1128 1129 1130 1131 1132 1133 1134 1135
[136] 1136 1137 1138 1139 1140 1141 1142 1143 1144 1145 1146 1147 1148 1149 1150
[151] 1151 1152 1153 1154 1155 1156 1157 1158 1159 1160 1161 1162 1163 1164 1165
[166] 1166 1167 1168 1169 1170 1171 1172 1173 1174 1175 1176 1177 1178 1179 1180
[181] 1181 1182 1183 1184 1185 1186 1187 1188 1189 1190 1191 1192 1193 1194 1195
[196] 1196 1197 1198 1199 1200 1201 1202 1203 1204 1205 1206 1207 1208 1209 1210
[211] 1211 1212 1213 1214 1215 1216 1217 1218 1219 1220 1221 1222 1223 1224 1225
[226] 1226 1227 1228 1229 1230 1231 1232 1233 1234 1235 1236 1237 1238 1239 1240
[241] 1241 1242 1243 1244 1245 1246 1247 1248 1249 1250 1251 1252 1253
\end{verbatim}

Remember that data a frame is a special type of list. Therefore in data frames \texttt{colnames} and \texttt{names} are equivalent:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     
\end{verbatim}

Note: As we saw, matrices have \texttt{colnames} and \texttt{rownames.} Using \texttt{names} on a matrix will assign names to \emph{individual elements}, as if it was a long vector - this is not usually very useful.

\hypertarget{factors}{%
\chapter{Factors}\label{factors}}

Factors in R are used to store \textbf{categorical variables} and therefore have many important uses in statistics / data science / machine learning.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{./R_factors} 

}

\caption{Factors in R - Best to read through this chapter first and then refer back to this figure}\label{fig:FigRFactors}
\end{figure}

You can create a factor by passing a numeric or character vector to \texttt{factor()} or \texttt{as.factor()}.\\
The difference is that \texttt{as.factor()} does not accept any arguments while \texttt{factor()} does - and they can be very important. More on this right below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"d"}\NormalTok{, }\StringTok{"c"}\NormalTok{)}
\NormalTok{xf }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(x)}
\NormalTok{xf}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] a c d b a a d c
Levels: a b c d
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(xf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xftoo }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(x)}
\NormalTok{xftoo}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] a c d b a a d c
Levels: a b c d
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(xftoo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

\begin{rmdnote}
A factor contains three crucial pieces of information:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  The underlying \textbf{integer vector}
\item
  The \textbf{mapping of integers to labels}
\item
  Whether the factor is \textbf{ordered}
\end{enumerate}
\end{rmdnote}

Let's unpack these.

Begin with a simple factor:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"female"}\NormalTok{, }\StringTok{"female"}\NormalTok{, }\StringTok{"female"}\NormalTok{, }\StringTok{"male"}\NormalTok{, }\StringTok{"male"}\NormalTok{))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] female female female male   male  
Levels: female male
\end{verbatim}

Internally, the command sees there are two distinct labels, female and male, and defaults to assigning integer numbers alphabetically, in this case female has been mapped to `1' and male to `2.'

Printing a factor prints the vector of labels followed by the levels, i.e.~the unique labels.

\hypertarget{the-underlying-integer-vector}{%
\section{\texorpdfstring{The underlying \textbf{integer vector}}{The underlying integer vector}}\label{the-underlying-integer-vector}}

Each level is assigned an integer. (Internally, this is the ``data'' that forms the elements of a factor vector). You don't see these integers unless you convert the factor to numeric (\texttt{as.numeric()}) or look at the (truncated) output of \texttt{str()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.numeric}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 1 1 2 2
\end{verbatim}

\hypertarget{the-mapping-of-integers-to-labels}{%
\section{\texorpdfstring{The \textbf{mapping of integers to labels}}{The mapping of integers to labels}}\label{the-mapping-of-integers-to-labels}}

This defines which integer is mapped to which label, i.e.~whether 1 is mapped to male or female. You can store the same information regardless which one you choose to call 1 and 2.

To get the mapping you can use \texttt{levels()}. It prints the labels in order:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "female" "male"  
\end{verbatim}

Again, this means that female is mapped to 1 and male is mapped to 2.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 Factor w/ 2 levels "female","male": 1 1 1 2 2
\end{verbatim}

The above tells you that x is a factor,\\
it has two levels labeled as ``female'' and ``male,'' in that order, i.e.~female is level 1 and male is level 2.\\
The last part shows that the first five elements (in this case the whole vector) consists of three elements of level 1 (female) followed by 2 elements of level 2 (male)

\hypertarget{setting-new-level-labels}{%
\subsection{Setting new level labels}\label{setting-new-level-labels}}

You can use the \texttt{levels()} command with an assignment to assign new labels to a factor (same syntax to how you use \texttt{rownames()} or \texttt{colnames()} to assign new row or column names to a matrix or data frame)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xf }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"patient\_status\_positive"}\NormalTok{, }\StringTok{"patient\_status\_negative"}\NormalTok{), }\DecValTok{10}\NormalTok{, T),}
             \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"patient\_status\_positive"}\NormalTok{, }\StringTok{"patient\_status\_negative"}\NormalTok{))}
\NormalTok{xf}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] patient_status_positive patient_status_positive patient_status_positive
 [4] patient_status_positive patient_status_positive patient_status_negative
 [7] patient_status_negative patient_status_negative patient_status_positive
[10] patient_status_positive
Levels: patient_status_positive patient_status_negative
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(xf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "patient_status_positive" "patient_status_negative"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(xf) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"positive"}\NormalTok{, }\StringTok{"negative"}\NormalTok{)}
\NormalTok{xf}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] positive positive positive positive positive negative negative negative
 [9] positive positive
Levels: positive negative
\end{verbatim}

\hypertarget{defining-the-mapping-of-labels-to-integers}{%
\subsection{Defining the mapping of labels to integers}\label{defining-the-mapping-of-labels-to-integers}}

If you want to define the mapping of labels to their integer representation (and not default to them sorted alphabeticaly), you use the \texttt{levels} arguments of the \texttt{factor()} function.

The vector passed to the \texttt{levels} arguments must include at least all unique values passed to \texttt{factor()}, otherwise you will get \texttt{NA} values

Without defining \texttt{levels} they are assigned alphabeticaly:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"alpha"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{, }\StringTok{"delta"}\NormalTok{, }\StringTok{"delta"}\NormalTok{))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] alpha alpha gamma delta delta
Levels: alpha delta gamma
\end{verbatim}

Define \texttt{levels}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"alpha"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{, }\StringTok{"delta"}\NormalTok{, }\StringTok{"delta"}\NormalTok{),}
 \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{, }\StringTok{"delta"}\NormalTok{))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] alpha alpha gamma delta delta
Levels: alpha gamma delta
\end{verbatim}

The \texttt{table} command has a number of useful applications, in it simplest form, it tabulates number of elements with each unique value found in a vector:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
x
alpha gamma delta 
    2     1     2 
\end{verbatim}

If you forget (or choose to exclude) a level, all occurences are replaced by \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"alpha"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{, }\StringTok{"delta"}\NormalTok{, }\StringTok{"delta"}\NormalTok{),}
 \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] alpha alpha gamma <NA>  <NA> 
Levels: alpha gamma
\end{verbatim}

If you know that more levels exist, even if no examples are present in your sample, you can includes these extra levels:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"alpha"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{, }\StringTok{"delta"}\NormalTok{, }\StringTok{"delta"}\NormalTok{),}
 \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"beta"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{, }\StringTok{"delta"}\NormalTok{))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] alpha alpha gamma delta delta
Levels: alpha beta gamma delta
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
x
alpha  beta gamma delta 
    2     0     1     2 
\end{verbatim}

\hypertarget{is-the-factor-ordered}{%
\section{\texorpdfstring{Is the factor \textbf{ordered}}{Is the factor ordered}}\label{is-the-factor-ordered}}

We looked at how you can define the order of levels using the \texttt{levels} argument in \texttt{factor()}, which affects the integer mapping to each label.

This can affect how some applications treat the different levels.

On top of the order of the mapping, you can further define if there is a \emph{quantitative relationship} among levels of the form \texttt{level\ 1\ \textless{}\ level\ 2\ \textless{}\ ...\ \textless{}\ level\ n}. This, in turn, can affect how the factor is treated by some functions, like some functions that fit statistical models.

\begin{rmdnote}
All factors' levels appear in some order or other.

An \textbf{ordered factor} indicates that its levels have a quantitative
relationship of the form
\texttt{level\ 1\ \textless{}\ level\ 2\ \textless{}\ ...\ \textless{}\ level\ n}.
\end{rmdnote}

First an unordered factor:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"small"}\NormalTok{, }\StringTok{"medium"}\NormalTok{, }\StringTok{"large"}\NormalTok{), }\DecValTok{10}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(dat)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] medium small  small  medium small  medium medium medium large  large 
Levels: large medium small
\end{verbatim}

To make the above into an ordered factor, we need to define the order of the levels with the \texttt{levels} arguments and also specify that it is ordered with the \texttt{ordered} argument:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(dat,}
            \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"small"}\NormalTok{, }\StringTok{"medium"}\NormalTok{, }\StringTok{"large"}\NormalTok{),}
            \AttributeTok{ordered =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] medium small  small  medium small  medium medium medium large  large 
Levels: small < medium < large
\end{verbatim}

Note how the levels now include the \texttt{\textless{}} sign between levels to indicate the ordering.

\hypertarget{change-order-of-levels-or-labels}{%
\section{Change (order of levels) or (labels)}\label{change-order-of-levels-or-labels}}

We've seen how to create a factor with defined order of levels and how to change level labels already. Because these are prone to serious accidents, let's look at them again, together.

\textbf{To change the order of levels} of an existing factor use \texttt{factor()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"target"}\NormalTok{, }\StringTok{"target"}\NormalTok{, }\StringTok{"control"}\NormalTok{, }\StringTok{"control"}\NormalTok{, }\StringTok{"control"}\NormalTok{))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] target  target  control control control
Levels: control target
\end{verbatim}

Change the order so that target is first (i.e.~corresponds to 1:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(x, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"target"}\NormalTok{, }\StringTok{"control"}\NormalTok{))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] target  target  control control control
Levels: target control
\end{verbatim}

\textbf{To change the labels of the levels} use \texttt{levels()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] target  target  control control control
Levels: target control
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"hit"}\NormalTok{, }\StringTok{"decoy"}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] hit   hit   decoy decoy decoy
Levels: hit decoy
\end{verbatim}

\begin{rmdcaution}
Changing the levels of a factor with \texttt{levels()} does not change
the internal integer representation but changes every element's label.
\end{rmdcaution}

\hypertarget{fatal-error-to-avoid}{%
\section{Fatal error to avoid}\label{fatal-error-to-avoid}}

Example scenario: You receive a dataset for classification where the outcome is a factor of 1s and 0s:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{outcome }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))}
\NormalTok{outcome}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 1 0 0 0 1 0
Levels: 0 1
\end{verbatim}

Some classification procedures expect the first level to be the `positive' outcome, so you decide to reorder the levels.

You mistakenly use \texttt{levels()} instead of \texttt{factor(x,\ levels=c(...))} hoping to achieve this.

You end up flipping all the outcome values.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(outcome) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{)}
\NormalTok{outcome}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0 0 1 1 1 0 1
Levels: 1 0
\end{verbatim}

All zeros became ones and ones became zeros.

You don't notice because how would you.

Your model does the exact opposite of what you intended.

-\textgreater{} Don't ever do this.

\hypertarget{factor-to-numeric}{%
\section{Factor to numeric}\label{factor-to-numeric}}

While it often makes sense to have factors with words for labels, they can be any character and that includes numbers (i.e.~numbers which are treated as labels)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{f }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{9}\NormalTok{))}
\NormalTok{f}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3 7 7 9 3 3 9
Levels: 3 7 9
\end{verbatim}

This behaves just like any other factor with all the rules we learned above.

There is a very easy trap to fall into, if you ever decide to convert such a factor to numeric.

The first thing that usually comes to mind is to use \texttt{as.numeric()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# !don\textquotesingle{}t do this!}
\FunctionTok{as.numeric}\NormalTok{(f)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 2 3 1 1 3
\end{verbatim}

But! We already know this will return the integer index, it will not return the labels as numbers.

By understanding the internal representation of the factor, i.e.~that a factor is an integer vector indexing a set of labels, you can convert labels to numeric exactly by indexing the set of labels:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(f)[f]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "3" "7" "7" "9" "3" "3" "9"
\end{verbatim}

The above suggests that used as an index within the brackets, \texttt{f} is coerced to integer, therefore to understand the above:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(f)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "3" "7" "9"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(f)[}\FunctionTok{as.integer}\NormalTok{(f)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "3" "7" "7" "9" "3" "3" "9"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# same as}
\FunctionTok{levels}\NormalTok{(f)[f]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "3" "7" "7" "9" "3" "3" "9"
\end{verbatim}

A different way around this that may be less confusing is to simply convert the factor to character and then to numeric:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(f))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3 7 7 9 3 3 9
\end{verbatim}

\hypertarget{summary}{%
\section{Summary}\label{summary}}

\begin{rmdnote}
\begin{itemize}
\item
  Factors in R are \textbf{integer vectors} with labels.
\item
  A factor's internal integer values range from 1 to the number of
  levels, i.e.~categories.
\item
  Each integer corresponds to a label.
\item
  Use \texttt{factor(levels\ =\ c(...))} to order levels
\item
  Use \texttt{levels(x)} to change levels' labels
\end{itemize}
\end{rmdnote}

\begin{rmdnote}
To avoid confusion, do not use numbers as level labels, if possible.
\end{rmdnote}

\hypertarget{indexing}{%
\chapter{Indexing - Subsetting - Slicing}\label{indexing}}

An index is used to select elements of a vector, matrix, array, list or data frame.\\
You can select (or exclude) one or multiple elements at a time.

An index is one of two types:

\begin{itemize}
\tightlist
\item
  logical index: for each elements in an object specify \texttt{TRUE} if you want to include it, or \texttt{FALSE} to exclude it from the selection.
\item
  integer index: define the position of elements to select.
\end{itemize}

The main indexing operator in R is the square bracket \texttt{{[}}.\\
Logical indexes are usually created as the output of a logical operation, e.g.~an elemntwise comparison.\\
Integer indexing in R is 1-based, meaning the first item of a vector is in position 1.\\
(If you are wondering why we even have to mention this, know that many programming languages use \href{https://en.wikipedia.org/wiki/Zero-based_numbering\#Computer_programming}{0-based indexing})

\hypertarget{indexvectors}{%
\section{Vectors}\label{indexvectors}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{15}\SpecialCharTok{:}\DecValTok{24}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 15 16 17 18 19 20 21 22 23 24
\end{verbatim}

Get the 5th element of a vector (integer index):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 19
\end{verbatim}

Get elements 6 through 9 of the same vector (integer index):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\DecValTok{6}\SpecialCharTok{:}\DecValTok{9}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 20 21 22 23
\end{verbatim}

Select elements with value greater than 19 (logical index):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[x }\SpecialCharTok{\textgreater{}} \DecValTok{19}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 20 21 22 23 24
\end{verbatim}

\hypertarget{indexmatrices}{%
\section{Matrices}\label{indexmatrices}}

Reminder:

\begin{itemize}
\tightlist
\item
  A matrix is a 2D vector and contains elements of one type only (numeric, integer, character, factor).\\
\item
  A data frame is a 2D list and each column can contain different type of data.
\end{itemize}

To index a 2D structure, whether a matrix or data frame, we use the form \texttt{{[}row,\ column{]}}\\
The following indexing operations are therefore the same whether applied on a matrix or a data frame.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{40}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(mat) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Feature\_"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\FunctionTok{ncol}\NormalTok{(mat)))}
\FunctionTok{rownames}\NormalTok{(mat) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Row\_"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(mat)))}
\NormalTok{mat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       Feature_1 Feature_2 Feature_3 Feature_4
Row_1          1        11        21        31
Row_2          2        12        22        32
Row_3          3        13        23        33
Row_4          4        14        24        34
Row_5          5        15        25        35
Row_6          6        16        26        36
Row_7          7        17        27        37
Row_8          8        18        28        38
Row_9          9        19        29        39
Row_10        10        20        30        40
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(mat)}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       Feature_1 Feature_2 Feature_3 Feature_4
Row_1          1        11        21        31
Row_2          2        12        22        32
Row_3          3        13        23        33
Row_4          4        14        24        34
Row_5          5        15        25        35
Row_6          6        16        26        36
Row_7          7        17        27        37
Row_8          8        18        28        38
Row_9          9        19        29        39
Row_10        10        20        30        40
\end{verbatim}

To get the contents of the fifth row, second column:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[}\DecValTok{5}\NormalTok{, }\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\DecValTok{5}\NormalTok{, }\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 15
\end{verbatim}

If you want to select an entire row or an entire column, you leave the row or column index blank, but - necessarily - use a comma:

Get the first row:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[}\DecValTok{1}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Feature_1 Feature_2 Feature_3 Feature_4 
        1        11        21        31 
\end{verbatim}

Get the second column:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[, }\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 Row_1  Row_2  Row_3  Row_4  Row_5  Row_6  Row_7  Row_8  Row_9 Row_10 
    11     12     13     14     15     16     17     18     19     20 
\end{verbatim}

Note that colnames and rownames where added to the matrix above for convenience - if they are absent, the labels are not shown above each element.

\hypertarget{range-of-rows-and-columns}{%
\subsection{Range of rows and columns}\label{range-of-rows-and-columns}}

You can define ranges for both rows and columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[}\DecValTok{6}\SpecialCharTok{:}\DecValTok{7}\NormalTok{, }\DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feature_2 Feature_3 Feature_4
Row_6        16        26        36
Row_7        17        27        37
\end{verbatim}

You can return rows and/or columns reversed too if desired:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[}\DecValTok{7}\SpecialCharTok{:}\DecValTok{6}\NormalTok{, }\DecValTok{4}\SpecialCharTok{:}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feature_4 Feature_3 Feature_2
Row_7        37        27        17
Row_6        36        26        16
\end{verbatim}

Or use vectors to specify of any rows and columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{7}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feature_1 Feature_4 Feature_3
Row_2         2        32        22
Row_4         4        34        24
Row_7         7        37        27
\end{verbatim}

\hypertarget{matrix-of-indexes}{%
\subsection{Matrix of indexes}\label{matrix-of-indexes}}

This is quite less common, but potentially useful. It allows you to specify a series of individual \texttt{{[}i,\ j{]}} indexes (i.e.~is a way to select multiple non-contiguous elements)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idm }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DecValTok{3}\NormalTok{)}
\NormalTok{idm}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2]
[1,]    2    4
[2,]    4    3
[3,]    7    1
\end{verbatim}

An n-by-2 matrix can be used to index as a length n vector of \texttt{{[}row,\ colum{]}} indexes. Therefore, the above matrix, will return elements \texttt{{[}2,\ 4{]},\ {[}4,\ 3{]},\ {[}7,\ 1{]}}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[idm]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 32 24  7
\end{verbatim}

\hypertarget{matidl}{%
\subsection{Logical index}\label{matidl}}

Select all rows with values greater than 15 on the second column:

The logical index for this operation is:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[, }\DecValTok{2}\NormalTok{] }\SpecialCharTok{\textgreater{}} \DecValTok{15}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 Row_1  Row_2  Row_3  Row_4  Row_5  Row_6  Row_7  Row_8  Row_9 Row_10 
 FALSE  FALSE  FALSE  FALSE  FALSE   TRUE   TRUE   TRUE   TRUE   TRUE 
\end{verbatim}

It can be used directly to index the matrix:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat[mat[, }\DecValTok{2}\NormalTok{] }\SpecialCharTok{\textgreater{}} \DecValTok{15}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       Feature_1 Feature_2 Feature_3 Feature_4
Row_6          6        16        26        36
Row_7          7        17        27        37
Row_8          8        18        28        38
Row_9          9        19        29        39
Row_10        10        20        30        40
\end{verbatim}

\hypertarget{indexlists}{%
\section{Lists}\label{indexlists}}

Reminder: A list can contain elements of different class and of different length:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{one =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{,}
           \AttributeTok{two =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{, .}\DecValTok{1}\NormalTok{), }\DecValTok{10}\NormalTok{),}
           \AttributeTok{three =} \FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"tangerine"}\NormalTok{),}
           \AttributeTok{four =}\NormalTok{ median))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$one
[1] 1 2 3 4

$two
 [1] 69.2 51.4 84.4 55.7 28.0 87.2 95.6 90.1 75.4 32.4

$three
[1] "mango"     "banana"    "tangerine"

$four
function (x, na.rm = FALSE, ...) 
UseMethod("median")
<bytecode: 0x7f90b30996b0>
<environment: namespace:stats>
\end{verbatim}

You can access a list element with:

\begin{itemize}
\tightlist
\item
  \texttt{\$} followed by name of the element (therefore only works if elements are named)
\item
  using double brackets \texttt{{[}{[}} with either name or integer index
\end{itemize}

To access the third element:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\SpecialCharTok{$}\NormalTok{three}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[[}\StringTok{"three"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[[}\StringTok{"three"}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[[}\DecValTok{3}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

To access an element with a name or integer index stored in a variable, only the bracket notation works - therefore programmatically you would always use double brackets to access different elements:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idi }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{idc }\OtherTok{\textless{}{-}} \StringTok{"three"}
\NormalTok{x[[idi]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[[idc]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

\texttt{\$} or \texttt{{[}{[}} return an element.\\
In contrast, single bracket \texttt{{[}} indexing of a list returns a pruned list:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[[idi]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[[idi]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

vs.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[idi]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$three
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[idi])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "list"
\end{verbatim}

Extract multiple list elements with single brackets, as expected:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$two
 [1] 69.2 51.4 84.4 55.7 28.0 87.2 95.6 90.1 75.4 32.4

$three
[1] "mango"     "banana"    "tangerine"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "list"
\end{verbatim}

Beware (confusing) recursive indexing.\\
(This is probably rarely used).\\
Unlike in the single brackets example above, colon notation in double brackets accesses elements recursively at the given position.\\
The following extracts the 3rd element of the 2nd element of the list:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 84.4
\end{verbatim}

You can convert a list to one lone vector containing all the individual components of the original list using \texttt{unlist()}. Notice how names are automatically created based on the original structure:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{alpha =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{), }\DecValTok{10}\NormalTok{),}
          \AttributeTok{beta =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{), }\DecValTok{10}\NormalTok{),}
          \AttributeTok{gamma =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{), }\DecValTok{10}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$alpha
 [1] 74 80 62 65 99  7 71 36 57  5

$beta
 [1] 34 80 11 89 18 85 41 77 14 64

$gamma
 [1] 100  43  76  60  21  34  68   6  59  53
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{unlist}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 alpha1  alpha2  alpha3  alpha4  alpha5  alpha6  alpha7  alpha8  alpha9 alpha10 
     74      80      62      65      99       7      71      36      57       5 
  beta1   beta2   beta3   beta4   beta5   beta6   beta7   beta8   beta9  beta10 
     34      80      11      89      18      85      41      77      14      64 
 gamma1  gamma2  gamma3  gamma4  gamma5  gamma6  gamma7  gamma8  gamma9 gamma10 
    100      43      76      60      21      34      68       6      59      53 
\end{verbatim}

\hypertarget{idllist}{%
\subsection{Logical index}\label{idllist}}

We can use a logical index on a list as well:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\FunctionTok{c}\NormalTok{(T, F, T, F)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$alpha
 [1] 74 80 62 65 99  7 71 36 57  5

$gamma
 [1] 100  43  76  60  21  34  68   6  59  53
\end{verbatim}

\hypertarget{indexdfs}{%
\section{Data frames}\label{indexdfs}}

We've already seen above that a data frame can be indexed in the same ways as a matrix.\\
At the same time, we know that a data frame is a rectangular list. Like a list, its elements are vectors of any type (integer, double, character, factor, and more) but, unlike a list, they have to be of the same length. A data frame can also be indexed the same way as a list.\\
Similar to indexing a list, notice that some methods return a smaller data frame, while others return vectors.

\begin{rmdtip}
You can index a data frame using all the ways you can index a list and
all the ways you can index a matrix.
\end{rmdtip}

Let's create a simple data frame:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Feat\_1 =} \DecValTok{21}\SpecialCharTok{:}\DecValTok{25}\NormalTok{,}
                \AttributeTok{Feat\_2 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{5}\NormalTok{),}
                \AttributeTok{Feat\_3 =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"rnd\_"}\NormalTok{, }\FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{), }\DecValTok{5}\NormalTok{)))}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Feat_1     Feat_2 Feat_3
1     21  0.2418102 rnd_37
2     22 -0.4120300 rnd_34
3     23  0.6150351 rnd_48
4     24  0.7090338  rnd_1
5     25 -0.6616759 rnd_58
\end{verbatim}

\hypertarget{extract-columns}{%
\subsection{Extract column(s)}\label{extract-columns}}

Just like in a list, using the \texttt{\$} operator returns an element, i.e.~a \textbf{vector}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\SpecialCharTok{$}\NormalTok{Feat\_2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  0.2418102 -0.4120300  0.6150351  0.7090338 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x}\SpecialCharTok{$}\NormalTok{Feat\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

Accessing a column by name with square brackets, returns a single-column \textbf{data.frame}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\StringTok{"Feat\_2"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feat_2
1  0.2418102
2 -0.4120300
3  0.6150351
4  0.7090338
5 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[}\StringTok{"Feat\_2"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

Again, similar to a list, if you double the square brackets, you access the element within the data.frame, which is a vector:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[[}\StringTok{"Feat\_2"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  0.2418102 -0.4120300  0.6150351  0.7090338 -0.6616759
\end{verbatim}

Accessing a column by \texttt{{[}row,\ column{]}} either by position or name, return a vector by default:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[, }\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  0.2418102 -0.4120300  0.6150351  0.7090338 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[, }\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[, }\StringTok{"Feat\_2"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  0.2418102 -0.4120300  0.6150351  0.7090338 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[, }\StringTok{"Feat\_2"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

The above happens, because by default the argument \texttt{drop} is set to \texttt{TRUE}. Set it to \texttt{FALSE} to return a \texttt{data.frame}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[, }\DecValTok{2}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[, }\StringTok{"Feat\_2"}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

As in lists, with the exception of the \texttt{\$} notation, all other indexing and slicing operations work with a variable holding either a column name of or an integer location:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idi }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{idc }\OtherTok{\textless{}{-}} \StringTok{"Feat\_2"}
\NormalTok{x[idi]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feat_2
1  0.2418102
2 -0.4120300
3  0.6150351
4  0.7090338
5 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[idc]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feat_2
1  0.2418102
2 -0.4120300
3  0.6150351
4  0.7090338
5 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[[idi]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  0.2418102 -0.4120300  0.6150351  0.7090338 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[[idc]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  0.2418102 -0.4120300  0.6150351  0.7090338 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[, idi]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  0.2418102 -0.4120300  0.6150351  0.7090338 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[, idc]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  0.2418102 -0.4120300  0.6150351  0.7090338 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[, idi, drop }\OtherTok{=}\NormalTok{ F]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feat_2
1  0.2418102
2 -0.4120300
3  0.6150351
4  0.7090338
5 -0.6616759
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[, idc, drop }\OtherTok{=}\NormalTok{ F]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feat_2
1  0.2418102
2 -0.4120300
3  0.6150351
4  0.7090338
5 -0.6616759
\end{verbatim}

Extracting multiple columns returns a data frame:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[, }\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feat_2 Feat_3
1  0.2418102 rnd_37
2 -0.4120300 rnd_34
3  0.6150351 rnd_48
4  0.7090338  rnd_1
5 -0.6616759 rnd_58
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[, }\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\hypertarget{extract-rows}{%
\subsection{Extract rows}\label{extract-rows}}

A row is a small data.frame, since it contains multiple columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\DecValTok{1}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Feat_1    Feat_2 Feat_3
1     21 0.2418102 rnd_37
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x[}\DecValTok{1}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

Convert into a list using \texttt{c()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{c}\NormalTok{(x[}\DecValTok{1}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$Feat_1
[1] 21

$Feat_2
[1] 0.2418102

$Feat_3
[1] "rnd_37"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(}\FunctionTok{c}\NormalTok{(x[}\DecValTok{1}\NormalTok{, ]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "list"
\end{verbatim}

Convert into a (named) vector using \texttt{unlist()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{unlist}\NormalTok{(x[}\DecValTok{1}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
             Feat_1              Feat_2              Feat_3 
               "21" "0.241810171253664"            "rnd_37" 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(x[}\DecValTok{1}\NormalTok{, ]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\hypertarget{dfidl}{%
\subsection{Logical index}\label{dfidl}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[x}\SpecialCharTok{$}\NormalTok{Feat\_1 }\SpecialCharTok{\textgreater{}} \DecValTok{22}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Feat_1     Feat_2 Feat_3
3     23  0.6150351 rnd_48
4     24  0.7090338  rnd_1
5     25 -0.6616759 rnd_58
\end{verbatim}

\hypertarget{logical---integer-indexing}{%
\section{Logical \textless-\textgreater{} Integer indexing}\label{logical---integer-indexing}}

As we saw, there are two types of indexes/indices: integer and logical.

\begin{rmdnote}
\begin{itemize}
\item
  A logical index needs to be of the same dimensions as the object it is
  indexing (unless you really want to recycle values - see chapter on
  \protect\hyperlink{vectorization}{vectorization}):\\
  you are specifying whether to include or exclude each element
\item
  An integer index will be shorter than the object it is indexing: you
  are specifying which subset of elements to include (or with a
  \texttt{-} in front, which elements to exclude)
\end{itemize}
\end{rmdnote}

It's easy to convert between the two types.

For example, start with a sequence of integers:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{21}\SpecialCharTok{:}\DecValTok{30}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 21 22 23 24 25 26 27 28 29 30
\end{verbatim}

Let's create a logical index based on two inequalities:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{logical\_index }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{\textgreater{}} \DecValTok{23} \SpecialCharTok{\&}\NormalTok{ x }\SpecialCharTok{\textless{}} \DecValTok{28}
\NormalTok{logical\_index}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE
\end{verbatim}

\hypertarget{logical-to-integer-index-with-which}{%
\subsection{\texorpdfstring{Logical to integer index with \texttt{which()}:}{Logical to integer index with which():}}\label{logical-to-integer-index-with-which}}

\begin{rmdcaution}
The common mistake is to attempt to convert a logical index to an
integer index using \texttt{as.integer()}. This results in a vector of
1's and 0's, NOT an integer index.\\
\texttt{which()} converts a logical index to an integer index.
\end{rmdcaution}

\texttt{which()} literally gives the position of all \texttt{TRUE} elements in a vector, thus converting a logical to an integer index:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{integer\_index }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(logical\_index)}
\NormalTok{integer\_index}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4 5 6 7
\end{verbatim}

i.e.~positions 4, 5, 6, 7 of the \texttt{logical\_index} are TRUE

\begin{rmdnote}
A logical and an integer index are equivalent if they select the exact
same elements
\end{rmdnote}

Let's check than when used to index \texttt{x}, they both return the same result:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[logical\_index]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 24 25 26 27
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[integer\_index]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 24 25 26 27
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{all}\NormalTok{(x[logical\_index] }\SpecialCharTok{==}\NormalTok{ x[integer\_index])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\hypertarget{integer-to-logical-index}{%
\subsection{Integer to logical index}\label{integer-to-logical-index}}

On the other hand, if we want to convert an integer index to a logical index, we can begin with a logical vector of the same length or dimension as the object we want to index with all FALSE values:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{logical\_index\_too }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\AttributeTok{length =} \FunctionTok{length}\NormalTok{(x))}
\NormalTok{logical\_index\_too}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
\end{verbatim}

And use the integer index to replace the corresponding elements to TRUE:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{logical\_index\_too[integer\_index] }\OtherTok{\textless{}{-}} \ConstantTok{TRUE}
\NormalTok{logical\_index\_too}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE
\end{verbatim}

This, of course, is the same as the logical index we started with.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{all}\NormalTok{(logical\_index }\SpecialCharTok{==}\NormalTok{ logical\_index\_too)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\hypertarget{exclude-cases-using-an-index}{%
\section{Exclude cases using an index}\label{exclude-cases-using-an-index}}

Very often, we want to use an index, whether logical or integer, to exclude cases instead of to select cases.\\
To do that with a logical integer, we simply use an exclamation point in front of the index to negate each element (convert each TRUE to FALSE and each FALSE to TRUE):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{logical\_index}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{!}\NormalTok{logical\_index}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\SpecialCharTok{!}\NormalTok{logical\_index]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 21 22 23 28 29 30
\end{verbatim}

To exclude elements using an integer index, R allows you to use negative indexing:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\SpecialCharTok{{-}}\NormalTok{integer\_index]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 21 22 23 28 29 30
\end{verbatim}

\begin{rmdnote}
To get the complement of an index, you negate a logical index
(\texttt{!logical\_index}) or you subtract an integer index
(\texttt{-integer\_index}):
\end{rmdnote}

\hypertarget{subset}{%
\section{\texorpdfstring{\texttt{subset()}}{subset()}}\label{subset}}

\texttt{subset()} allows you to filter cases that meet certain conditions using the \texttt{subset} argument, and optionally also select columns using the \texttt{select} argument:

(\texttt{head()} returns the first few lines of a data frame. We use it to avoid printing too many lines)

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa
6          5.4         3.9          1.7         0.4  setosa
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_sl.gt.med }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(iris, Sepal.Length }\SpecialCharTok{\textgreater{}} \FunctionTok{median}\NormalTok{(Sepal.Length))}
\end{Highlighting}
\end{Shaded}

Note: You can use the column name Sepal.Length directly, i.e.~unquoted and you don't need to use \texttt{iris\$Sepal.Length}. (This is called Non-Standard Evaluation, NSE)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{one =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
                \AttributeTok{two =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{),}
                \AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\DecValTok{4}\NormalTok{),  }\FunctionTok{rep}\NormalTok{(}\StringTok{"beta"}\NormalTok{, }\DecValTok{6}\NormalTok{)))}
\FunctionTok{subset}\NormalTok{(x, }\AttributeTok{subset =}\NormalTok{ two }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }\AttributeTok{select =}\NormalTok{ two)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        two
2 0.5728212
5 1.3011505
6 0.1046100
7 0.3968931
8 0.6108076
9 0.5464345
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{subset}\NormalTok{(x, two }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }\SpecialCharTok{{-}}\NormalTok{one)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        two group
2 0.5728212 alpha
5 1.3011505  beta
6 0.1046100  beta
7 0.3968931  beta
8 0.6108076  beta
9 0.5464345  beta
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{subset}\NormalTok{(x, two }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, two}\SpecialCharTok{:}\NormalTok{one)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        two one
2 0.5728212   2
5 1.3011505   5
6 0.1046100   6
7 0.3968931   7
8 0.6108076   8
9 0.5464345   9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{subset}\NormalTok{(x, two }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, two}\SpecialCharTok{:}\NormalTok{group)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        two group
2 0.5728212 alpha
5 1.3011505  beta
6 0.1046100  beta
7 0.3968931  beta
8 0.6108076  beta
9 0.5464345  beta
\end{verbatim}

\hypertarget{split}{%
\section{\texorpdfstring{\texttt{split()}}{split()}}\label{split}}

Split a data frame into multiple data frames by groups defined by a factor:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_by\_group }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(x, x}\SpecialCharTok{$}\NormalTok{group)}
\end{Highlighting}
\end{Shaded}

\hypertarget{with}{%
\section{\texorpdfstring{\texttt{with()}}{with()}}\label{with}}

Within a \texttt{with()} expression, you can access data.frame columns without quoting or using the \texttt{\$} operator:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{with}\NormalTok{(x, x[group }\SpecialCharTok{==} \StringTok{"alpha"}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  one        two group
1   1 -0.2500599 alpha
2   2  0.5728212 alpha
3   3 -0.6953794 alpha
4   4 -0.2418144 alpha
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{with}\NormalTok{(x, x[two }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  one       two group
2   2 0.5728212 alpha
5   5 1.3011505  beta
6   6 0.1046100  beta
7   7 0.3968931  beta
8   8 0.6108076  beta
9   9 0.5464345  beta
\end{verbatim}

\hypertarget{vectorization}{%
\chapter{Vectorized Operations}\label{vectorization}}

Most built-in R functions are vectorized and many functions from external packages are as well.

\begin{rmdtip}
A vectorized function operates on all elements of a vector at the same
time.
\end{rmdtip}

Vectorization is very efficient: it can save both human (your) time and machine time.\\
In many cases, applying a function on all elements simultaneously may seem obvious or expected behavior, but since not all functions are vectorized, make sure to check the documentation if unsure.

\hypertarget{operations-between-vectors-of-equal-length}{%
\section{Operations between vectors of equal length}\label{operations-between-vectors-of-equal-length}}

Such operations are applied between corresponding elements of each vector:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\NormalTok{z }\OtherTok{\textless{}{-}} \DecValTok{11}\SpecialCharTok{:}\DecValTok{20}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 11 12 13 14 15 16 17 18 19 20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{+}\NormalTok{ z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 12 14 16 18 20 22 24 26 28 30
\end{verbatim}

i.e.~the above is equal to \texttt{c(x{[}1{]}\ +\ z{[}1{]},\ x{[}2{]}\ +\ z{[}2{]},\ ...,\ x{[}n{]}\ +\ z{[}n{]})}

\hypertarget{operations-between-a-vector-and-a-scalar}{%
\section{Operations between a vector and a scalar}\label{operations-between-a-vector-and-a-scalar}}

In this cases, the scalar is essentially recycled, i.e.~repeated to match the length of the vector:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\SpecialCharTok{+} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 11 12 13 14 15 16 17 18 19 20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\SpecialCharTok{*} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  2  4  6  8 10 12 14 16 18 20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\SpecialCharTok{/} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\SpecialCharTok{\^{}} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]   1   4   9  16  25  36  49  64  81 100
\end{verbatim}

\hypertarget{operations-between-vectors-of-unequal-length-value-recycling}{%
\section{\texorpdfstring{Operations between vectors of unequal length: \textbf{value recycling}}{Operations between vectors of unequal length: value recycling}}\label{operations-between-vectors-of-unequal-length-value-recycling}}

Operations between a vector and a scalar are a special case of operations between vectors of unequal length. Whenever you perform an operation between two objects of different length, \textbf{\emph{the shorter object's elements are recycled}}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{+} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  3  3  5  5  7  7  9  9 11 11
\end{verbatim}

\begin{rmdcaution}
Operations between objects of unequal length can occur by mistake. If
the shorter object's length is a multiple of the longer object's length,
there will be \emph{no error or warning}, as above. Otherwise, there is
a warning (which may be confusing at first) BUT \textbf{\emph{recycling
still happens and is highly unlikely to be intentional}}:
\end{rmdcaution}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{+} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{9}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning in x + c(1, 3, 9): longer object length is not a multiple of shorter
object length
\end{verbatim}

\begin{verbatim}
 [1]  2  5 12  5  8 15  8 11 18 11
\end{verbatim}

\hypertarget{vectorized-matrix-operations}{%
\section{Vectorized matrix operations}\label{vectorized-matrix-operations}}

Operations between matrices are similarly vectorized, i.e.~performed between corresponding elements:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{11}\SpecialCharTok{:}\DecValTok{14}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2]
[1,]    1    3
[2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2]
[1,]   11   13
[2,]   12   14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\SpecialCharTok{+}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2]
[1,]   12   16
[2,]   14   18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\SpecialCharTok{*}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2]
[1,]   11   39
[2,]   24   56
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\SpecialCharTok{/}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
           [,1]      [,2]
[1,] 0.09090909 0.2307692
[2,] 0.16666667 0.2857143
\end{verbatim}

\hypertarget{vectorized-functions}{%
\section{Vectorized functions}\label{vectorized-functions}}

Some examples of common mathematical operations that are vectorized:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{log}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0.0000000 0.6931472 1.0986123 1.3862944 1.6094379 1.7917595 1.9459101
 [8] 2.0794415 2.1972246 2.3025851
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 1.000000 1.414214 1.732051 2.000000 2.236068 2.449490 2.645751 2.828427
 [9] 3.000000 3.162278
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sin}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  0.8414710  0.9092974  0.1411200 -0.7568025 -0.9589243 -0.2794155
 [7]  0.6569866  0.9893582  0.4121185 -0.5440211
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cos}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  0.5403023 -0.4161468 -0.9899925 -0.6536436  0.2836622  0.9601703
 [7]  0.7539023 -0.1455000 -0.9111303 -0.8390715
\end{verbatim}

\hypertarget{ifelse}{%
\section{\texorpdfstring{\texttt{ifelse()}}{ifelse()}}\label{ifelse}}

\texttt{ifelse()} is vectorized and can be a great and compact alternative to a more complicated expression:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\NormalTok{(y }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(a }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{, }\DecValTok{11}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\DecValTok{21}\SpecialCharTok{:}\DecValTok{30}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 21 22 23 24 25 16 17 18 19 20
\end{verbatim}

so what did this do?

It is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idl }\OtherTok{\textless{}{-}}\NormalTok{ a }\SpecialCharTok{\textgreater{}} \DecValTok{5}
\NormalTok{yes }\OtherTok{\textless{}{-}} \DecValTok{11}\SpecialCharTok{:}\DecValTok{20}
\NormalTok{no }\OtherTok{\textless{}{-}} \DecValTok{21}\SpecialCharTok{:}\DecValTok{30}
\NormalTok{out }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"numeric"}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(a)) \{}
  \ControlFlowTok{if}\NormalTok{ (idl[i]) \{}
\NormalTok{    out[i] }\OtherTok{\textless{}{-}}\NormalTok{ yes[i]}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    out[i] }\OtherTok{\textless{}{-}}\NormalTok{ no[i]}
\NormalTok{  \}}
\NormalTok{\}}
\NormalTok{out}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 21 22 23 24 25 16 17 18 19 20
\end{verbatim}

i.e.

\begin{itemize}
\tightlist
\item
  Create a logical index using \texttt{test}
\item
  for each element \texttt{i} in \texttt{test}:

  \begin{itemize}
  \tightlist
  \item
    if the element \texttt{i} is TRUE, return \texttt{yes{[}i{]}}, else \texttt{no{[}i{]}}
  \end{itemize}
\end{itemize}

For another example, lets take integers \texttt{1:11} and square the odd ones and cube the even ones. We use the modulo operation \texttt{\%\%} to test if each element is odd or even:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{11}
\NormalTok{xsc }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(x }\SpecialCharTok{\%\%} \DecValTok{2} \SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{11}\NormalTok{)}\SpecialCharTok{\^{}}\DecValTok{3}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{11}\NormalTok{)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{xsc}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]    1    8    9   64   25  216   49  512   81 1000  121
\end{verbatim}

\hypertarget{dataio}{%
\chapter{Data Input/Output}\label{dataio}}

\hypertarget{r-datasets}{%
\section{R datasets}\label{r-datasets}}

\hypertarget{datasets-included-with-r-in-package-datasets}{%
\subsection{Datasets included with R (in package `datasets')}\label{datasets-included-with-r-in-package-datasets}}

List built-in datasets with \texttt{data()} and no arguments:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

These built-in datasets are normally readily available in the R console (because the \textbf{datasets} package is automatically loaded)\\
You can check if this is the case using \texttt{search()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{search}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] ".GlobalEnv"        "package:stats"     "package:graphics" 
[4] "package:grDevices" "package:utils"     "package:datasets" 
[7] "package:methods"   "Autoloads"         "package:base"     
\end{verbatim}

\hypertarget{datasets-included-with-other-packages}{%
\subsection{Datasets included with other packages}\label{datasets-included-with-other-packages}}

List a dataset included with some R package:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\AttributeTok{package =} \StringTok{"glmnet"}\NormalTok{)}
\FunctionTok{data}\NormalTok{(}\AttributeTok{package =} \StringTok{"MASS"}\NormalTok{)}
\FunctionTok{data}\NormalTok{(}\AttributeTok{package =} \StringTok{"mlbench"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Load a dataset from some R package:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(Sonar, }\AttributeTok{package =} \StringTok{"mlbench"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note: quotes around ``Sonar'' in the \texttt{data()} command above are optional.

\hypertarget{system-commands}{%
\section{System commands}\label{system-commands}}

Get working directory with \texttt{getwd()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{getwd}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

You can set a different working directory with \texttt{setwd()}

List files in current directory:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dir}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

You can execute a command of you operating system (OS) -i.e.~MacOS, Linux, Windows- from within R using the \texttt{system()} function:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{system}\NormalTok{(}\StringTok{"uname {-}a"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note: See issue \href{https://stackoverflow.com/questions/27388964/rmarkdown-not-outputting-results-of-system-command-to-html-file}{here}

\hypertarget{data-io}{%
\section{Data I/O}\label{data-io}}

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{./R_dataio} 

}

\caption{Common Data Input/Output commands in R}\label{fig:FigRDataIO}
\end{figure}

\hypertarget{read-local-csv}{%
\subsection{Read local CSV}\label{read-local-csv}}

\texttt{read.table()} is the core function that reads data from formatted text files in R, where cases correspond to lines and variables to columns. Its many arguments allow to read different formats.\\
\texttt{read.csv()} is an alias for \texttt{read.table()} that defaults to commas as separators and dots for decimal points. (Run \texttt{read.csv} in the console to print its source and see for yourself and read the documentation with \texttt{?read.table}).

Some important arguments for \texttt{read.table()} listed here with their default values for \texttt{read.csv()}:

\begin{itemize}
\tightlist
\item
  \texttt{sep\ =\ ","}: Character that separate entries. Default is a comma; use "\t" for tab-separated files (default setting in \texttt{read.delim()})
\item
  \texttt{dec\ =\ "."}: Character for the decimal point. Default is a dot; in some cases where a comma is used as the decimal point, the entry separator \texttt{sep} may be a semicolon (default setting in \texttt{read.csv2()})
\item
  \texttt{na.strings\ =\ "NA"}: Character vector of strings to be coded as ``NA''
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{men }\OtherTok{\textless{}{-}}  \FunctionTok{read.csv}\NormalTok{(}\StringTok{"../Data/pone.0204161.s001.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{read-data-from-the-web}{%
\subsection{Read data from the web}\label{read-data-from-the-web}}

\texttt{read.csv()} can directly read an online file. In the second example below, we also define that missing data is coded with \texttt{?} using the \texttt{na.strings} argument:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{parkinsons }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://archive.ics.uci.edu/ml/machine{-}learning{-}databases/parkinsons/parkinsons.data"}\NormalTok{)}

\NormalTok{sleep }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://www.openml.org/data/get\_csv/53273/sleep.arff"}\NormalTok{,}
                  \AttributeTok{na.strings =} \StringTok{"?"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The above files are read from two very popular online \href{https://rtemis.lambdamd.org/resources.html\#datasets}{data repositories}. Confusingly, neither file ends in \texttt{.csv}, but they both work with \texttt{read.csv()}. Always look at the plain text file first to determine if it can work with \texttt{read.table()} /\texttt{read.csv()} and what settings to use.

\hypertarget{read-zipped-data-from-the-web}{%
\subsection{Read zipped data from the web}\label{read-zipped-data-from-the-web}}

\hypertarget{using-gzcon-and-csv.read}{%
\subsubsection{\texorpdfstring{using \texttt{gzcon()} and \texttt{csv.read()}}{using gzcon() and csv.read()}}\label{using-gzcon-and-csv.read}}

\texttt{read.table()} /\texttt{read.csv()} also accepts a ``connection'' as input.\\
Here we define a connection to a zipped file by nesting \texttt{gzcon()} and \texttt{url()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{con }\OtherTok{\textless{}{-}} \FunctionTok{gzcon}\NormalTok{(}\FunctionTok{url}\NormalTok{(}\StringTok{"https://github.com/EpistasisLab/pmlb/raw/master/datasets/breast\_cancer\_wisconsin/breast\_cancer\_wisconsin.tsv.gz"}\NormalTok{),}
             \AttributeTok{text =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

We read the connection and specify the file is tab-separated, or call \texttt{read.delim()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bcw }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(con, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}

\CommentTok{\#same as}
\NormalTok{bcw }\OtherTok{\textless{}{-}} \FunctionTok{read.delim}\NormalTok{(con, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{using-data.tables-fread}{%
\subsubsection{\texorpdfstring{using \textbf{data.table}'s \texttt{fread()}}{using data.table's fread()}}\label{using-data.tables-fread}}

You can also use \textbf{data.table}'s \texttt{fread()}, which will directly handle zipped files:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(data.table)}
\NormalTok{bcw2 }\OtherTok{\textless{}{-}} \FunctionTok{fread}\NormalTok{(}\StringTok{"https://github.com/EpistasisLab/penn{-}ml{-}benchmarks/raw/master/datasets/classification/breast{-}cancer{-}wisconsin/breast{-}cancer{-}wisconsin.tsv.gz"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you want to stick to using data frames, set the argument \texttt{data.table} to \texttt{FALSE}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bcw2 }\OtherTok{\textless{}{-}} \FunctionTok{fread}\NormalTok{(}\StringTok{"https://github.com/EpistasisLab/penn{-}ml{-}benchmarks/raw/master/datasets/classification/breast{-}cancer{-}wisconsin/breast{-}cancer{-}wisconsin.tsv.gz"}\NormalTok{,}
              \AttributeTok{data.table =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{write-to-csv}{%
\subsection{Write to CSV}\label{write-to-csv}}

Use the \texttt{write.csv()} function to write an R object (usually data frame or matrix) to a CSV file. Setting \texttt{row.names\ =\ FALSE} is usually a good idea. (Instead of storing data in rownames, it's usually best to create a new column.)

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write.csv}\NormalTok{(iris, }\StringTok{"../Data/iris.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note that in this case we did not need to save row names (which are just integers 1 to 150 and would add a useless extra column in the output)

\hypertarget{read-.xslx-using-openxlsxread.xlsx}{%
\subsection{\texorpdfstring{Read .xslx using \texttt{openxlsx::read.xlsx()}}{Read .xslx using openxlsx::read.xlsx()}}\label{read-.xslx-using-openxlsxread.xlsx}}

As an example, we can read the csv we saved earlier into Excel and then save it as a .xlsx file.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.path }\OtherTok{\textless{}{-}} \FunctionTok{normalizePath}\NormalTok{(}\StringTok{"../Data/iris.xlsx"}\NormalTok{)}
\NormalTok{iris2 }\OtherTok{\textless{}{-}}\NormalTok{ openxlsx}\SpecialCharTok{::}\FunctionTok{read.xlsx}\NormalTok{(iris.path)}
\end{Highlighting}
\end{Shaded}

Note: \texttt{openxlsx::read.xlsx()} does not work with a relative path like \texttt{"./Data/iris.xlsc"}. Therefore we used the \texttt{normalizePath()} function to give us the full path of the file without having to type it out.

Check that the data is still identical:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{all}\NormalTok{(iris }\SpecialCharTok{==}\NormalTok{ iris2)}
\end{Highlighting}
\end{Shaded}

\hypertarget{write-an-r-object-to-rds}{%
\subsection{Write an R object to RDS}\label{write-an-r-object-to-rds}}

You can write any R object directly to file so that you can recover it at any time, share it, etc. Remember that since a list can contain any number of objects of any type, you can save any collection of objects as an RDS file. For multiple objects, see also the \texttt{save.image()} command below.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{saveRDS}\NormalTok{(iris, }\StringTok{"iris.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

To load an object saved in an rds file, assign it to an object using \texttt{readRDS()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_fromFile }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\StringTok{"iris.rds"}\NormalTok{)}
\FunctionTok{all}\NormalTok{(iris }\SpecialCharTok{==}\NormalTok{ iris\_fromFile)}
\end{Highlighting}
\end{Shaded}

\hypertarget{write-multiple-r-objects-to-rdata-file-using-save}{%
\subsection{\texorpdfstring{Write multiple R objects to RData file using \texttt{save()}}{Write multiple R objects to RData file using save()}}\label{write-multiple-r-objects-to-rdata-file-using-save}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat1 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{seq\_len}\NormalTok{(}\DecValTok{10}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{))}
\NormalTok{mat2 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{seq\_len}\NormalTok{(}\DecValTok{10}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{))}
\FunctionTok{save}\NormalTok{(mat1, mat2, }\AttributeTok{file =} \StringTok{"./mat.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note: we will learn how to use \texttt{sapply()} later under ``Loop functions''

To load the variables in the \texttt{.RData} file you saved, use the \texttt{load()} command:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"./Rmd/mat.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note that \texttt{load()} adds the objects to your workspace using with their original names. You do not assign them to a new object, unlike with the \texttt{readRDS()} call above.

\hypertarget{write-your-entire-workspace-to-a-rdata-image-using-save.image}{%
\subsection{\texorpdfstring{Write your entire workspace to a RData image using \texttt{save.image()}}{Write your entire workspace to a RData image using save.image()}}\label{write-your-entire-workspace-to-a-rdata-image-using-save.image}}

You can save your entire workspace to a RData file using the \texttt{save.image()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{save.image}\NormalTok{(}\StringTok{"workspace\_10\_05\_2020.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Same as above, to re-load the workspace saved in the \texttt{.RData} file, use the \texttt{load()} command:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"workspace\_10\_05\_2020.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{controlflow}{%
\chapter{Control flow}\label{controlflow}}

Code is often not executed linearly (i.e.~line-by-line). Control flow (or flow of control) operations define the order in which code segments are executed.

Execution is often conditional (\texttt{if\ -\ then\ -\ else} or \texttt{switch}).

Segments of code may be repeated multiple times (\texttt{for}) or as long as certain conditions are met (\texttt{while}).

Control flow operations form some of the fundamental building blocks of programs. Each operation is very simple - combine enough of them and you can build up to any amount of complexity.

\begin{itemize}
\tightlist
\item
  \texttt{if} {[}Condition{]} \texttt{then} {[}Expression{]} \texttt{else} {[}Alternate Expression{]}
\item
  \texttt{for} {[}Variable in Sequence{]} do {[}Expression{]}
\item
  \texttt{while} {[}Condition{]} do {[}Expression{]}
\item
  \texttt{repeat} {[}Expression{]} until \texttt{break}
\item
  \texttt{break}: break out of \texttt{for}, \texttt{while} or \texttt{repeat} loop
\item
  \texttt{next}: skip current iteration and proceed to next
\end{itemize}

\hypertarget{if---then---else}{%
\section{\texorpdfstring{\texttt{if} - \texttt{then} - \texttt{else}:}{if - then - else:}}\label{if---then---else}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{4}
\ControlFlowTok{if}\NormalTok{ (a }\SpecialCharTok{\textless{}} \DecValTok{10}\NormalTok{) \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"a is not that big"}\NormalTok{)}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"a is not too small"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
a is not that big
\end{verbatim}

\hypertarget{if---then---else-if---else}{%
\section{\texorpdfstring{\texttt{if} - \texttt{then} - \texttt{else\ if} - \texttt{else}:}{if - then - else if - else:}}\label{if---then---else-if---else}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, .}\DecValTok{5}\NormalTok{), }\DecValTok{1}\NormalTok{)}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (a }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
\NormalTok{  result }\OtherTok{\textless{}{-}} \StringTok{"positive"}
\NormalTok{\} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (a }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
\NormalTok{  result }\OtherTok{\textless{}{-}} \StringTok{"zero"}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{  result }\OtherTok{\textless{}{-}} \StringTok{"negative"}
\NormalTok{\}}
\NormalTok{result}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "negative"
\end{verbatim}

\hypertarget{conditional-assignment-with-if---else}{%
\section{\texorpdfstring{Conditional assignment with \texttt{if} - \texttt{else}:}{Conditional assignment with if - else:}}\label{conditional-assignment-with-if---else}}

You can use an \texttt{if} statement as part of an assignment:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{8}
\NormalTok{y }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (a }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{) \{}
  \DecValTok{10}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \DecValTok{0}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{conditional-assignment-with-ifelse}{%
\section{\texorpdfstring{Conditional assignment with \texttt{ifelse}:}{Conditional assignment with ifelse:}}\label{conditional-assignment-with-ifelse}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{(y }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(a }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{0}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0
\end{verbatim}

\texttt{ifelse} is \protect\hyperlink{vectorization}{vectorized}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\NormalTok{(y }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(a }\SpecialCharTok{\textgreater{}} \DecValTok{7}\NormalTok{, a}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{, a))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]   1   2   3   4   5   6   7  64  81 100
\end{verbatim}

\hypertarget{for-loops}{%
\section{\texorpdfstring{\texttt{for} loops}{for loops}}\label{for-loops}}

\begin{rmdtip}
Use \texttt{for} loops to repeat execution of a block of code a certain
number of times.
\end{rmdtip}

The for loop syntax is \texttt{for\ (var\ in\ vector)\ expression}.\\
The \texttt{expression} is usually surrounded by curly brackets and can include any number of lines, any amount of code:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{) \{}
  \FunctionTok{print}\NormalTok{(}\StringTok{"I love coffee"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "I love coffee"
[1] "I love coffee"
[1] "I love coffee"
[1] "I love coffee"
[1] "I love coffee"
\end{verbatim}

The loop executes for \texttt{length(vector)} times.\\
At iteration \texttt{i}, \texttt{var\ =\ vector{[}i{]}}.\\
You will often use the value of \texttt{var} inside the loop (but you don't have to):

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{)) \{}
  \FunctionTok{cat}\NormalTok{(i}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
1 
4 
9 
16 
25 
36 
49 
64 
81 
100 
\end{verbatim}

\texttt{letters} is a built-in constant that includes all 26 lowercase letters of the Roman alphabet; \texttt{LETTERS} similarly includes all 26 uppercase letters.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (letter }\ControlFlowTok{in}\NormalTok{ letters[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{]) \{}
  \FunctionTok{cat}\NormalTok{(letter, }\StringTok{"is a letter!}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
a is a letter!
b is a letter!
c is a letter!
d is a letter!
e is a letter!
\end{verbatim}

\hypertarget{working-on-data-within-a-for-loop-fordata}{%
\subsection{Working on data within a for loop \{fordata\}}\label{working-on-data-within-a-for-loop-fordata}}

A common scenario involves working on a data object, whether a vector, matrix, list, data.frame, and performing an operation on each elements, one at a time. While a lot of these operations are often performed using \protect\hyperlink{loopfns}{loop functions} instead, for loops can certainly be used.

You can start by initializing an object of the appropriate class and dimensions to hold the output. Then, each iteration of the for loop will assign its output to the corresponding element/s of this object.

In the following example we transform the \texttt{mtcars} built-in dataset's features to \protect\hyperlink{zscore}{z-scores}.
The built-in command \texttt{scale()} will do this for quickly and conveniently, this is for demonstration purposes:

First, initialize the output to be the desired class and dimensions:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 32 11
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_z }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{matrix}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{32}\NormalTok{, }\DecValTok{11}\NormalTok{))}
\FunctionTok{colnames}\NormalTok{(mtcars\_z) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

or, it is much simpler to just make a copy of \texttt{mtcars} to be overwritten by the for loop later:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_z }\OtherTok{\textless{}{-}}\NormalTok{ mtcars}
\end{Highlighting}
\end{Shaded}

Standardization involves subtracting the mean and dividing by the standard deviation.

Here is the for loop - we iterate through each column and assign the transformed data:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(mtcars)) \{}
\NormalTok{  mtcars\_z[, i] }\OtherTok{\textless{}{-}}\NormalTok{ (mtcars[, i] }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(mtcars[, i])) }\SpecialCharTok{/} \FunctionTok{sd}\NormalTok{(mtcars[, i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Let's compare to the output of the \texttt{scale()} command by print the first 3 rows and columns of each:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_z2 }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{scale}\NormalTok{(mtcars))}
\NormalTok{mtcars\_z[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
                    mpg        cyl       disp
Mazda RX4     0.1508848 -0.1049878 -0.5706198
Mazda RX4 Wag 0.1508848 -0.1049878 -0.5706198
Datsun 710    0.4495434 -1.2248578 -0.9901821
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_z2[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
                    mpg        cyl       disp
Mazda RX4     0.1508848 -0.1049878 -0.5706198
Mazda RX4 Wag 0.1508848 -0.1049878 -0.5706198
Datsun 710    0.4495434 -1.2248578 -0.9901821
\end{verbatim}

Note that we wrapped \texttt{scale()} around \texttt{as.data.frame()} because it outputs a matrix.

We can check that all elements are the same with \texttt{all()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{all}\NormalTok{(mtcars\_z }\SpecialCharTok{==}\NormalTok{ mtcars\_z2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\hypertarget{nested-for-loops}{%
\subsection{\texorpdfstring{Nested \texttt{for} loops}{Nested for loops}}\label{nested-for-loops}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\DecValTok{3}\NormalTok{)) \{}
  \ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\DecValTok{3}\NormalTok{)) \{}
    \FunctionTok{cat}\NormalTok{(}\StringTok{"  a["}\NormalTok{, i, }\StringTok{","}\NormalTok{, j, }\StringTok{"] is "}\NormalTok{, a[i, j], }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  a[1,1] is 1
  a[1,2] is 4
  a[1,3] is 7
  a[2,1] is 2
  a[2,2] is 5
  a[2,3] is 8
  a[3,1] is 3
  a[3,2] is 6
  a[3,3] is 9
\end{verbatim}

\hypertarget{select-one-of-multiple-alternatives-with-switch}{%
\section{\texorpdfstring{Select one of multiple alternatives with \texttt{switch}}{Select one of multiple alternatives with switch}}\label{select-one-of-multiple-alternatives-with-switch}}

Instead of using multiple \texttt{if} - \texttt{else\ if} statements, we can build a more compact call using \texttt{switch}. (It is best suited for options that are of type character, rather than numeric)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(letters[}\FunctionTok{seq}\NormalTok{(}\DecValTok{8}\NormalTok{)], }\DecValTok{1}\NormalTok{)}
\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "d"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{output }\OtherTok{\textless{}{-}} \ControlFlowTok{switch}\NormalTok{(y,                      }\CommentTok{\# 1. Some expression}
                 \AttributeTok{a =} \StringTok{"Well done"}\NormalTok{,        }\CommentTok{\# 2. The possible values of the expression, unquoted}
                 \AttributeTok{b =} \StringTok{"Not bad"}\NormalTok{,          }\CommentTok{\#    followed by the \textasciigrave{}=\textasciigrave{} and the conditional output}
                 \AttributeTok{c =} \StringTok{"Nice try"}\NormalTok{,}
                 \AttributeTok{d =} \StringTok{"Not a nice try"}\NormalTok{,}
                 \AttributeTok{e =} \StringTok{"This is bad"}\NormalTok{,}
                 \AttributeTok{f =} \StringTok{"Fail"}\NormalTok{,}
                 \StringTok{"This is not even a possible grade"}\NormalTok{) }\CommentTok{\# 3. An optional last argument is the default}
                                                      \CommentTok{\#    value, if there is no match above}
\NormalTok{output}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Not a nice try"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -0.2408788
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{out }\OtherTok{\textless{}{-}} \ControlFlowTok{switch}\NormalTok{(}\FunctionTok{as.integer}\NormalTok{(a }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{),}
              \StringTok{\textasciigrave{}}\AttributeTok{1}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Input is positive"}\NormalTok{,}
              \StringTok{\textasciigrave{}}\AttributeTok{0}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Input is not positive"}\NormalTok{)}
\NormalTok{out}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.618066
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{out }\OtherTok{\textless{}{-}} \ControlFlowTok{switch}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(a }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{),}
              \StringTok{\textasciigrave{}}\AttributeTok{TRUE}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Input is positive"}\NormalTok{,}
              \StringTok{\textasciigrave{}}\AttributeTok{FALSE}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Input is not positive"}\NormalTok{)}
\NormalTok{out}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Input is positive"
\end{verbatim}

\hypertarget{switch-example-http-status-codes}{%
\subsection{\texorpdfstring{\texttt{switch} example: HTTP Status Codes}{switch example: HTTP Status Codes}}\label{switch-example-http-status-codes}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{status }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\DecValTok{400}\SpecialCharTok{:}\DecValTok{410}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{status}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 408
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{response }\OtherTok{\textless{}{-}} \ControlFlowTok{switch}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(status),}
                   \StringTok{\textasciigrave{}}\AttributeTok{400}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Bad Request"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{401}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Unauthorized"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{402}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Payment Required"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{403}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Forbidden"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{404}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Not Found"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{405}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Method Not Allowed"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{406}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Not Acceptable"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{407}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Proxy Authentication Required"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{408}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Request Timeout"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{409}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Conflict"}\NormalTok{,}
                   \StringTok{\textasciigrave{}}\AttributeTok{410}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"Gone"}\NormalTok{)}
\NormalTok{response}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Request Timeout"
\end{verbatim}

\hypertarget{while-loops}{%
\section{\texorpdfstring{\texttt{while} loops}{while loops}}\label{while-loops}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{10}
\ControlFlowTok{while}\NormalTok{ (a }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
\NormalTok{  a }\OtherTok{\textless{}{-}}\NormalTok{ a }\SpecialCharTok{{-}} \DecValTok{1}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"a is equal to"}\NormalTok{, a, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
a is equal to 9 
a is equal to 8 
a is equal to 7 
a is equal to 6 
a is equal to 5 
a is equal to 4 
a is equal to 3 
a is equal to 2 
a is equal to 1 
a is equal to 0 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"when all is said and done, a is"}\NormalTok{, a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
when all is said and done, a is 0
\end{verbatim}

\hypertarget{break-stops-execution-of-a-loop}{%
\section{\texorpdfstring{\texttt{break} stops execution of a loop:}{break stops execution of a loop:}}\label{break-stops-execution-of-a-loop}}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{)) \{}
  \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \DecValTok{5}\NormalTok{) }\ControlFlowTok{break}\NormalTok{()}
  \FunctionTok{cat}\NormalTok{(i, }\StringTok{"squared is"}\NormalTok{, i}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
1 squared is 1 
2 squared is 4 
3 squared is 9 
4 squared is 16 
\end{verbatim}

\hypertarget{next-skips-the-current-iteration}{%
\section{\texorpdfstring{\texttt{next} skips the current iteration:}{next skips the current iteration:}}\label{next-skips-the-current-iteration}}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\DecValTok{7}\NormalTok{)) \{}
  \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \DecValTok{5}\NormalTok{) }\ControlFlowTok{next}\NormalTok{()}
  \FunctionTok{cat}\NormalTok{(i, }\StringTok{"squared is"}\NormalTok{, i}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
1 squared is 1 
2 squared is 4 
3 squared is 9 
4 squared is 16 
6 squared is 36 
7 squared is 49 
\end{verbatim}

\hypertarget{repeat-loops}{%
\section{\texorpdfstring{\texttt{repeat} loops}{repeat loops}}\label{repeat-loops}}

\texttt{repeat} initiates an infinite loop and you \textbf{must} use \texttt{break} to exit. Probably best to use any other type of loop instead.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i }\OtherTok{\textless{}{-}} \DecValTok{10}
\ControlFlowTok{repeat}\NormalTok{ \{}
\NormalTok{ i }\OtherTok{\textless{}{-}}\NormalTok{ i }\SpecialCharTok{{-}} \DecValTok{1}
 \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\ControlFlowTok{break}\NormalTok{()}
 \FunctionTok{cat}\NormalTok{(}\StringTok{"i is"}\NormalTok{, i, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
i is 9 
i is 8 
i is 7 
i is 6 
i is 5 
i is 4 
i is 3 
i is 2 
i is 1 
\end{verbatim}

\hypertarget{loopfns}{%
\chapter{Loop Functions}\label{loopfns}}

Loop functions are some of the most widely used R functions. They replace longer expressions created with a \texttt{for} loop, for example.\\
They can result in more compact and readable code and are often faster to execute than a \texttt{for} loop.

\begin{itemize}
\tightlist
\item
  \texttt{apply()}: Apply function over array margins (i.e.~over one or more dimensions)
\item
  \texttt{lapply()}: Return a \emph{list} where each element is the result of applying a function to each element of the input
\item
  \texttt{sapply()}: Same as \texttt{lapply()}, but returns the simplest possible R object (instead of always returning a list)
\item
  \texttt{vapply()}: Same as \texttt{sapply()}, but you pre-specify the return type: this is safer and may also be faster
\item
  \texttt{tapply()}: Apply a function to elements of groups defined by a factor
\item
  \texttt{mapply()}: Multivariate version of \texttt{sapply()}: Apply a function using the first elements of the inputs vectors, then using the second, third, and so on
\end{itemize}

\begin{figure}

{\centering \includegraphics[width=0.75\linewidth]{./R_applyfam} 

}

\caption{`*apply()` function family summary (Best to read through this chapter first and then refer back to this figure)}\label{fig:FigRapplyfam}
\end{figure}

Before starting to use the above functions, we need to learn about anonymous functions, which are often used within the apply functions.

\hypertarget{apply}{%
\section{\texorpdfstring{\texttt{apply()}}{apply()}}\label{apply}}

\begin{rmdtip}
\texttt{apply()} applies a function over one or more dimensions of an
array of 2 dimensions or more (this includes matrices) or a data frame:

\texttt{apply(array,\ MARGIN,\ FUN)}
\end{rmdtip}

\texttt{MARGIN} can be an integer vector or character indicating the dimensions over which `FUN' will be applied.

By convention, rows come first (just like in \protect\hyperlink{indexing}{indexing}), therefore:\\
\texttt{MARGIN\ =\ 1}: apply function on each \textbf{\emph{row}}
\texttt{MARGIN\ =\ 2}: apply function on each \textbf{\emph{column}}

Let's calculate the mean value of each of the first four columns of the iris dataset:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{]}
\NormalTok{iris\_column\_mean }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(x, }\AttributeTok{MARGIN =} \DecValTok{2}\NormalTok{, }\AttributeTok{FUN =}\NormalTok{ mean) }
\NormalTok{iris\_column\_mean}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 
\end{verbatim}

\begin{rmdnote}
Hint: It is possibly easiest to think of the ``MARGIN'' as the
\textbf{\emph{dimension you want to keep}}.\\
In the above case, we want the mean for each variable, i.e.~we want to
keep columns and collapse rows.
\end{rmdnote}

The above is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_column\_mean }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{(}\FunctionTok{ncol}\NormalTok{(x))}
\FunctionTok{names}\NormalTok{(iris\_column\_mean) }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(x)}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(x)) \{}
\NormalTok{  iris\_column\_mean[i] }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(x[, i])}
\NormalTok{\}}
\NormalTok{iris\_column\_mean}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 
\end{verbatim}

If you wanted to get the mean of the rows (makes little sense in this case):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(}\FunctionTok{apply}\NormalTok{(x, }\DecValTok{1}\NormalTok{, mean))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2.550 2.375 2.350 2.350 2.550 2.850
\end{verbatim}

\begin{rmdnote}
\texttt{apply()} only works on objects with defined (i.e.~non-NULL)
\texttt{dim()}, i.e.~arrays.
\end{rmdnote}

\begin{rmdnote}
Try to think why you can't use \texttt{apply()} to apply a function
\texttt{fn()} on a vector \texttt{v}.

\ldots{}

\ldots{}

Because that would be \texttt{fn(v)}
\end{rmdnote}

\hypertarget{lapply}{%
\section{\texorpdfstring{\texttt{lapply()}}{lapply()}}\label{lapply}}

\begin{rmdtip}
\texttt{lapply()} applies a \textbf{function} on \textbf{each element of
its input} and returns a \textbf{list} of the outputs.
\end{rmdtip}

Note: The `elements' of a data frame are its columns (remember, a data frame is a list with equal-length elements). The `elements' of a matrix are each cell one by one, by column. Therefore \texttt{lapply()} has a very different effect on a data frame and a matrix. \texttt{lapply()} is commonly used to iterate over the columns of a data frame.

\texttt{lapply()} is the only function of the \texttt{*apply()} family that always returns a list.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.median }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], median)}
\NormalTok{iris.median}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$Sepal.Length
[1] 5.8

$Sepal.Width
[1] 3

$Petal.Length
[1] 4.35

$Petal.Width
[1] 1.3
\end{verbatim}

The above is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.median }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"list"}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\FunctionTok{names}\NormalTok{(iris.median) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{])}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{) \{}
\NormalTok{  iris.median[[i]] }\OtherTok{\textless{}{-}} \FunctionTok{median}\NormalTok{(iris[, }\DecValTok{1}\NormalTok{])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{sapply}{%
\section{\texorpdfstring{\texttt{sapply()}}{sapply()}}\label{sapply}}

\texttt{sapply()} is an alias for \texttt{lapply()}, followed by a call to \texttt{simplify2array()}.\\
(Check the source code for \texttt{sapply()} by typing \texttt{sapply} at the console and hitting Enter).

\begin{rmdnote}
Unlike \texttt{lapply()}, the output of \texttt{sapply()} is variable:
it is the simplest R object that can hold the data type(s) resulting
from the operations, i.e.~a vector, matrix, data frame, or list.
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.median }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], median)}
\NormalTok{iris.median}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
        5.80         3.00         4.35         1.30 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.summary }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Mean =} \FunctionTok{sapply}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], mean),}
                           \AttributeTok{SD =} \FunctionTok{sapply}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], sd))}
\NormalTok{iris.summary}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
                 Mean        SD
Sepal.Length 5.843333 0.8280661
Sepal.Width  3.057333 0.4358663
Petal.Length 3.758000 1.7652982
Petal.Width  1.199333 0.7622377
\end{verbatim}

\hypertarget{vapply}{%
\section{\texorpdfstring{\texttt{vapply()}}{vapply()}}\label{vapply}}

Much less commonly used (possibly \emph{underused}) than \texttt{lapply()} or \texttt{sapply()}, \texttt{vapply()} allows you to specify what the expected output looks like - for example a numeric vector of length 2, a character vector of length 1.

This can have two advantages:

\begin{itemize}
\tightlist
\item
  It is safer against errors
\item
  It will sometimes be a little faster
\end{itemize}

You add the argument \texttt{FUN.VALUE} which must be of the correct \textbf{type} and \textbf{length} of the expected result \textbf{\emph{of each iteration}}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{vapply}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], median, }\AttributeTok{FUN.VALUE =}\NormalTok{ .}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
        5.80         3.00         4.35         1.30 
\end{verbatim}

Here, each iteration returns the median of each column, i.e.~a numeric vector of length 1.
Therefore \texttt{FUN.VALUE} can be any numeric scalar.

For example, if we instead returned the range of each column, \texttt{FUN.VALUE} should be a numeric vector of length 1:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{vapply}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], range, }\AttributeTok{FUN.VALUE =} \FunctionTok{rep}\NormalTok{(.}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Sepal.Length Sepal.Width Petal.Length Petal.Width
[1,]          4.3         2.0          1.0         0.1
[2,]          7.9         4.4          6.9         2.5
\end{verbatim}

If \texttt{FUN.VALUE} does not match the returned value, we get an informative error:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{vapply}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], range, }\AttributeTok{FUN.VALUE =}\NormalTok{ .}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in vapply(iris[, -5], range, FUN.VALUE = 0.1): values must be length 1,
 but FUN(X[[1]]) result is length 2
\end{verbatim}

\hypertarget{tapply}{%
\section{\texorpdfstring{\texttt{tapply()}}{tapply()}}\label{tapply}}

\texttt{tapply()} is one way (of many) to apply a function on \textbf{subgroups of data} as defined by one or more factors.\\
In the following example, we calculate the mean Sepal.Length by species on the iris dataset:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mean\_Sepal.Length\_by\_Species }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Species, mean)}
\NormalTok{mean\_Sepal.Length\_by\_Species}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    setosa versicolor  virginica 
     5.006      5.936      6.588 
\end{verbatim}

The above is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{species }\OtherTok{\textless{}{-}} \FunctionTok{levels}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Species)}
\NormalTok{mean\_Sepal.Length\_by\_Species }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"numeric"}\NormalTok{, }\FunctionTok{length}\NormalTok{(species))}
\FunctionTok{names}\NormalTok{(mean\_Sepal.Length\_by\_Species) }\OtherTok{\textless{}{-}}\NormalTok{ species}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(species)) \{}
\NormalTok{  mean\_Sepal.Length\_by\_Species[i] }\OtherTok{\textless{}{-}} 
    \FunctionTok{mean}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length[iris}\SpecialCharTok{$}\NormalTok{Species }\SpecialCharTok{==}\NormalTok{ species[i]])}
\NormalTok{\}}
\NormalTok{mean\_Sepal.Length\_by\_Species}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    setosa versicolor  virginica 
     5.006      5.936      6.588 
\end{verbatim}

\hypertarget{mapply}{%
\section{\texorpdfstring{\texttt{mapply()}}{mapply()}}\label{mapply}}

The above functions all work well when you iterating over elements of a single object.\\
\texttt{mapply()} allows you to execute a function that accepts two or more inputs, say \texttt{fn(x,\ z)} using the i-th element of each input, and will return:\\
\texttt{fn(x{[}1{]},\ z{[}1{]})}, \texttt{fn(x{[}2{]},\ z{[}2{]})}, \ldots, \texttt{fn(x{[}n{]},\ z{[}n{]})}

Let's create a simple function that accepts two numeric arguments, and two vectors length 5 each:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{raise }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, power) x}\SpecialCharTok{\^{}}\NormalTok{power}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{2}\SpecialCharTok{:}\DecValTok{6}
\NormalTok{p }\OtherTok{\textless{}{-}} \DecValTok{6}\SpecialCharTok{:}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

Use mapply to raise each \texttt{x} to the corresponding \texttt{p}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{out }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(raise, x, p)}
\NormalTok{out}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  64 243 256 125  36
\end{verbatim}

The above is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{out }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"numeric"}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\DecValTok{5}\NormalTok{)) \{}
\NormalTok{  out[i] }\OtherTok{\textless{}{-}} \FunctionTok{raise}\NormalTok{(x[i], p[i])}
\NormalTok{\}}
\NormalTok{out}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  64 243 256 125  36
\end{verbatim}

\hypertarget{iterating-over-a-sequence-instead-of-an-object}{%
\section{Iterating over a sequence instead of an object}\label{iterating-over-a-sequence-instead-of-an-object}}

With \texttt{lapply()}, \texttt{sapply()} and \texttt{vapply()} there is a very simple trick that may often come in handy:\\
Instead of iterating over elements of an object, you can iterate over an integer index of whichever elements you want to access and use it accordingly within the anonymous function.\\
This alternative approach is much closer to how we would use an integer sequence in a \texttt{for} loop.\\
It will be clearer through an example:

Get the mean of the first four columns of iris:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# original way: iterate through elements i.e. columns:}
\FunctionTok{sapply}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{mean}\NormalTok{(i))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# alternative way: iterate over integer index of elements:}
\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{mean}\NormalTok{(iris[, i]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 5.843333 3.057333 3.758000 1.199333
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# equivalent to:}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{) \{}
  \FunctionTok{mean}\NormalTok{(iris[, i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Notice that in the alternative approach, since you are not passing the object (iris, here) as the input to \texttt{lapply()}, therefore it needs to be specified within the anonymous function.

\hypertarget{applying-on-matrices-vs.-data-frames}{%
\section{\texorpdfstring{\texttt{*apply()}ing on matrices vs.~data frames}{*apply()ing on matrices vs.~data frames}}\label{applying-on-matrices-vs.-data-frames}}

To consolidate some of what was learned above, let's focus on the difference between working on a matrix vs.~a data frame.\\
First, let's create a matrix and a data frame with the same data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{amat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{21}\SpecialCharTok{:}\DecValTok{70}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(amat) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Feature\_"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(amat))}
\NormalTok{amat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      Feature_1 Feature_2 Feature_3 Feature_4 Feature_5
 [1,]        21        31        41        51        61
 [2,]        22        32        42        52        62
 [3,]        23        33        43        53        63
 [4,]        24        34        44        54        64
 [5,]        25        35        45        55        65
 [6,]        26        36        46        56        66
 [7,]        27        37        47        57        67
 [8,]        28        38        48        58        68
 [9,]        29        39        49        59        69
[10,]        30        40        50        60        70
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{adf }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(amat)}
\NormalTok{adf}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   Feature_1 Feature_2 Feature_3 Feature_4 Feature_5
1         21        31        41        51        61
2         22        32        42        52        62
3         23        33        43        53        63
4         24        34        44        54        64
5         25        35        45        55        65
6         26        36        46        56        66
7         27        37        47        57        67
8         28        38        48        58        68
9         29        39        49        59        69
10        30        40        50        60        70
\end{verbatim}

We've seen that with \texttt{apply()} we specify the dimension to operate on and it works the same way on both matrices and data frames:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{apply}\NormalTok{(amat, }\DecValTok{2}\NormalTok{, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Feature_1 Feature_2 Feature_3 Feature_4 Feature_5 
     25.5      35.5      45.5      55.5      65.5 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{apply}\NormalTok{(adf, }\DecValTok{2}\NormalTok{, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Feature_1 Feature_2 Feature_3 Feature_4 Feature_5 
     25.5      35.5      45.5      55.5      65.5 
\end{verbatim}

However, \texttt{sapply()} (and \texttt{lapply()}, \texttt{vapply()}) acts on \textbf{\emph{each element}} of the object, therefore it is not meaningful to pass a matrix to it:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sapply}\NormalTok{(amat, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45
[26] 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70
\end{verbatim}

The above returns the mean of each element, i.e.~the element itself, which is pointless.

Since a data frame is a list, and its columns are its elements, it works great for column operations on data frames:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sapply}\NormalTok{(adf, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Feature_1 Feature_2 Feature_3 Feature_4 Feature_5 
     25.5      35.5      45.5      55.5      65.5 
\end{verbatim}

If you want to use \texttt{sapply()} on a matrix, you could iterate over an integer sequence as shown in the previous section:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(amat), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{mean}\NormalTok{(amat[, i]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 25.5 35.5 45.5 55.5 65.5
\end{verbatim}

This is shown to help emphasize the differences between the function and the data structures. In practice, you would use \texttt{apply()} on a matrix.

\hypertarget{anonymous-functions}{%
\section{Anonymous functions}\label{anonymous-functions}}

Anonymous functions are just like regular functions but they are not assigned to an object - i.e.~they are not ``named.''\\
They are usually passed as arguments to other functions to be used once, hence no need to name them.\\
In R, anonymous functions are often used with the apply family of functions.

Example of a simple regular function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{squared }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x}\SpecialCharTok{\^{}}\DecValTok{2}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Because this is a short function definition, it can also be written in a single line without curly brackets:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{squared }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) x}\SpecialCharTok{\^{}}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

The equivalent anonymous function is the same, but omitting the assignment:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{function}\NormalTok{(x) x}\SpecialCharTok{\^{}}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
function(x) x^2
\end{verbatim}

Let's use the \texttt{squared()} function within \texttt{sapply()} to square the first four columns of the iris dataset. In these examples, we often wrap functions around \texttt{head()} which prints the first few lines of an object to avoid:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(iris[, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Sepal.Length Sepal.Width Petal.Length Petal.Width
1          5.1         3.5          1.4         0.2
2          4.9         3.0          1.4         0.2
3          4.7         3.2          1.3         0.2
4          4.6         3.1          1.5         0.2
5          5.0         3.6          1.4         0.2
6          5.4         3.9          1.7         0.4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_sq }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(iris[, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{], squared)}
\FunctionTok{head}\NormalTok{(iris\_sq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Sepal.Length Sepal.Width Petal.Length Petal.Width
[1,]        26.01       12.25         1.96        0.04
[2,]        24.01        9.00         1.96        0.04
[3,]        22.09       10.24         1.69        0.04
[4,]        21.16        9.61         2.25        0.04
[5,]        25.00       12.96         1.96        0.04
[6,]        29.16       15.21         2.89        0.16
\end{verbatim}

Let's do the same as above, but this time using an anonymous function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_sqtoo }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(iris[, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x) x}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\FunctionTok{head}\NormalTok{(iris\_sqtoo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Sepal.Length Sepal.Width Petal.Length Petal.Width
[1,]        26.01       12.25         1.96        0.04
[2,]        24.01        9.00         1.96        0.04
[3,]        22.09       10.24         1.69        0.04
[4,]        21.16        9.61         2.25        0.04
[5,]        25.00       12.96         1.96        0.04
[6,]        29.16       15.21         2.89        0.16
\end{verbatim}

The entire anonymous function definition is passed in the function argument (\texttt{FUN} in the R documentation).

\hypertarget{summarize}{%
\chapter{Summarizing Data}\label{summarize}}

Let's read in a dataset from OpenML:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heart }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://www.openml.org/data/get\_csv/51/dataset\_51\_heart{-}h.arff"}\NormalTok{,}
                  \AttributeTok{na.strings =} \StringTok{"?"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{get-summary-of-an-r-object-with-summary}{%
\section{\texorpdfstring{Get summary of an R object with \texttt{summary()}}{Get summary of an R object with summary()}}\label{get-summary-of-an-r-object-with-summary}}

R includes \texttt{summary()} \protect\hyperlink{s3methods}{methods} for a number of different objects.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(heart)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      age            sex             chest_pain           trestbps    
 Min.   :28.00   Length:294         Length:294         Min.   : 92.0  
 1st Qu.:42.00   Class :character   Class :character   1st Qu.:120.0  
 Median :49.00   Mode  :character   Mode  :character   Median :130.0  
 Mean   :47.83                                         Mean   :132.6  
 3rd Qu.:54.00                                         3rd Qu.:140.0  
 Max.   :66.00                                         Max.   :200.0  
                                                       NA's   :1      
      chol           fbs              restecg             thalach     
 Min.   : 85.0   Length:294         Length:294         Min.   : 82.0  
 1st Qu.:209.0   Class :character   Class :character   1st Qu.:122.0  
 Median :243.0   Mode  :character   Mode  :character   Median :140.0  
 Mean   :250.8                                         Mean   :139.1  
 3rd Qu.:282.5                                         3rd Qu.:155.0  
 Max.   :603.0                                         Max.   :190.0  
 NA's   :23                                            NA's   :1      
    exang              oldpeak          slope                 ca     
 Length:294         Min.   :0.0000   Length:294         Min.   :0    
 Class :character   1st Qu.:0.0000   Class :character   1st Qu.:0    
 Mode  :character   Median :0.0000   Mode  :character   Median :0    
                    Mean   :0.5861                      Mean   :0    
                    3rd Qu.:1.0000                      3rd Qu.:0    
                    Max.   :5.0000                      Max.   :0    
                                                        NA's   :291  
     thal               num           
 Length:294         Length:294        
 Class :character   Class :character  
 Mode  :character   Mode  :character  
                                      
                                      
                                      
                                      
\end{verbatim}

\hypertarget{fast-builtin-column-and-row-operations}{%
\section{Fast builtin column and row operations}\label{fast-builtin-column-and-row-operations}}

We saw in \protect\hyperlink{loopfns}{Loop Functions} how we can apply functions on rows, columns, or other subsets of our data. R has optimized builtin functions for some very common operations, with self-explanatory names:

\begin{itemize}
\tightlist
\item
  \texttt{colSums()}: column sums
\item
  \texttt{rowSums()}: row sums
\item
  \texttt{colMeans()}: column means
\item
  \texttt{rowMeans()}: row means
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     [,1] [,2] [,3] [,4]
[1,]    1    6   11   16
[2,]    2    7   12   17
[3,]    3    8   13   18
[4,]    4    9   14   19
[5,]    5   10   15   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colSums}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 15 40 65 90
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# same as}
\FunctionTok{apply}\NormalTok{(a, }\DecValTok{2}\NormalTok{, sum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 15 40 65 90
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rowSums}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 34 38 42 46 50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# same as}
\FunctionTok{apply}\NormalTok{(a, }\DecValTok{1}\NormalTok{, sum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 34 38 42 46 50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colMeans}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  3  8 13 18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# same as}
\FunctionTok{apply}\NormalTok{(a, }\DecValTok{2}\NormalTok{, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  3  8 13 18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rowMeans}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  8.5  9.5 10.5 11.5 12.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# same as}
\FunctionTok{apply}\NormalTok{(a, }\DecValTok{1}\NormalTok{, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  8.5  9.5 10.5 11.5 12.5
\end{verbatim}

\hypertarget{optimized-matrix-operations-with-matrixstats}{%
\section{\texorpdfstring{Optimized matrix operations with \textbf{matrixStats}}{Optimized matrix operations with matrixStats}}\label{optimized-matrix-operations-with-matrixstats}}

While the builtin operations above are already optimized and faster than the equivalent calls, the \textbf{matrixStats} package (\protect\hyperlink{ref-matrixStats2019}{Bengtsson 2019}) offers a number of futher optimized matrix operations, including drop-in replacements of the above. These should be prefered when dealing with bigger data:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(matrixStats)}
\FunctionTok{colSums2}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 15 40 65 90
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rowSums2}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 34 38 42 46 50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colMeans2}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  3  8 13 18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rowMeans2}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  8.5  9.5 10.5 11.5 12.5
\end{verbatim}

Note: \textbf{matrixStats} provides replacement functions named almost identically to their base counterpart - so they are easy to find - but are different - so they don't mask the base functions (this is important and good software design).

\hypertarget{grouped-summary-statistics-with-aggregate}{%
\section{\texorpdfstring{Grouped summary statistics with \texttt{aggregate()}}{Grouped summary statistics with aggregate()}}\label{grouped-summary-statistics-with-aggregate}}

\texttt{aggregate()} is a powerful way to apply functions on splits of your data. It can replicate functionality of the \texttt{*apply()} family, but can be more flexible/powerful and supports a formula input.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{aggregate}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{], }\AttributeTok{by =} \FunctionTok{list}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Species), mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Group.1 Sepal.Length Sepal.Width Petal.Length Petal.Width
1     setosa        5.006       3.428        1.462       0.246
2 versicolor        5.936       2.770        4.260       1.326
3  virginica        6.588       2.974        5.552       2.026
\end{verbatim}

Alternatively, the more compact \textbf{formula notation} can be used here to get the same result.\\
The \texttt{.} on the left hand side represents all features, excluding those on the right hand side:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{aggregate}\NormalTok{(. }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Species, iris, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Species Sepal.Length Sepal.Width Petal.Length Petal.Width
1     setosa        5.006       3.428        1.462       0.246
2 versicolor        5.936       2.770        4.260       1.326
3  virginica        6.588       2.974        5.552       2.026
\end{verbatim}

To define multiple specific variables on the left hand side of the formula within \texttt{aggregate()}, use \texttt{cbind()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{aggregate}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(Sepal.Length, Sepal.Width) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Species, iris, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Species Sepal.Length Sepal.Width
1     setosa        5.006       3.428
2 versicolor        5.936       2.770
3  virginica        6.588       2.974
\end{verbatim}

Let's make up a second grouping:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{irisd }\OtherTok{\textless{}{-}}\NormalTok{ iris}
\NormalTok{irisd}\SpecialCharTok{$}\NormalTok{Group2 }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\AttributeTok{each =} \DecValTok{25}\NormalTok{)}
\NormalTok{irisd}\SpecialCharTok{$}\NormalTok{Group2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2
 [38] 2 2 2 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 [75] 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 1 1
[112] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
[149] 2 2
\end{verbatim}

This ``Group2'' divides each iris Species in the first and last 25 cases.\\
Let's aggregate by both Species and Group2:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{aggregate}\NormalTok{(irisd[, }\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{6}\NormalTok{)],}
          \AttributeTok{by =} \FunctionTok{list}\NormalTok{(}\AttributeTok{Species =}\NormalTok{ irisd}\SpecialCharTok{$}\NormalTok{Species, }\AttributeTok{Group2 =}\NormalTok{ irisd}\SpecialCharTok{$}\NormalTok{Group2),}
\NormalTok{          mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Species Group2 Sepal.Length Sepal.Width Petal.Length Petal.Width
1     setosa      1        5.028       3.480        1.460       0.248
2 versicolor      1        6.012       2.776        4.312       1.344
3  virginica      1        6.576       2.928        5.640       2.044
4     setosa      2        4.984       3.376        1.464       0.244
5 versicolor      2        5.860       2.764        4.208       1.308
6  virginica      2        6.600       3.020        5.464       2.008
\end{verbatim}

The compact formula notation can be very convenient here:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{aggregate}\NormalTok{(. }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Species }\SpecialCharTok{+}\NormalTok{ Group2, irisd, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     Species Group2 Sepal.Length Sepal.Width Petal.Length Petal.Width
1     setosa      1        5.028       3.480        1.460       0.248
2 versicolor      1        6.012       2.776        4.312       1.344
3  virginica      1        6.576       2.928        5.640       2.044
4     setosa      2        4.984       3.376        1.464       0.244
5 versicolor      2        5.860       2.764        4.208       1.308
6  virginica      2        6.600       3.020        5.464       2.008
\end{verbatim}

Note: Using aggregate with the \texttt{by\ =\ list()} argument is easier to code with. The formula notation might be easier to work with in real time on the console. You \emph{can} code with the formula notation, but if there is an alternative it's unlikely to be worth the extra steps.

\hypertarget{functions}{%
\chapter{Functions}\label{functions}}

Writing functions is a core part of programming.
When should you write a function?\\
Whenever you find yourself repeating pieces of code.\\
Why is it important?\\
Writing functions helps reduce the total amount of code, which reduces the chances of error, and makes your code more readable.

Reminder: Functions in R are ``first class objects.''\\
This means you can pass them in and out of other functions or objects like any other R structure.\\
For example, we have seen that you can use a command like \texttt{apply(mat,\ 2,\ mean)}

Functions in R are \emph{for the most part} like mathematical functions: they have one or more inputs and one output. The inputs are known as the function arguments. If you want to return multiple outputs, you can return a list containing any number of R objects.

\hypertarget{simple-functions}{%
\section{Simple functions}\label{simple-functions}}

Let's start with a very simple function: single argument with no default value:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{square }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x}\SpecialCharTok{\^{}}\DecValTok{2}
\NormalTok{\}}

\FunctionTok{square}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 9
\end{verbatim}

Notice above that \texttt{x\^{}2} is automatically returned by the function. It is the same as explicitly returning it with \texttt{return()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{square }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  out }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{2}
  \FunctionTok{return}\NormalTok{(out)}
\NormalTok{\}}

\FunctionTok{square}\NormalTok{(}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 16
\end{verbatim}

which is the same as:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{square }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  out }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{2}
\NormalTok{  out}
\NormalTok{\}}

\FunctionTok{square}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 25
\end{verbatim}

A function returns either:

\begin{itemize}
\tightlist
\item
  an object passed to \texttt{return()}
\item
  the value of the last expression within the function definition such as \texttt{out} or \texttt{x\^{}2} above.
\end{itemize}

Note that the following function definition does not return anything:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sq }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  out }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{2}
\NormalTok{\}}

\FunctionTok{sq}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\texttt{return()} is a way to end evaluation early:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{square.pos }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(x}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    x}
\NormalTok{  \}}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"The input was left unchanged}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{10}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{square.pos}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
The input was left unchanged
\end{verbatim}

Multiple arguments, with and without defaults:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{raise }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{power =} \DecValTok{2}\NormalTok{) \{}
\NormalTok{  x}\SpecialCharTok{\^{}}\NormalTok{power}
\NormalTok{\}}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{raise}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 81
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{raise}\NormalTok{(x, }\AttributeTok{power =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 729
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{raise}\NormalTok{(x, }\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 729
\end{verbatim}

\hypertarget{arguments-with-prescribed-list-of-allowed-values}{%
\section{Arguments with prescribed list of allowed values}\label{arguments-with-prescribed-list-of-allowed-values}}

You can match specific values for an argument using \texttt{match.arg()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{myfn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{type =} \FunctionTok{c}\NormalTok{(}\StringTok{"alpha"}\NormalTok{, }\StringTok{"beta"}\NormalTok{, }\StringTok{"gamma"}\NormalTok{)) \{}
\NormalTok{  type }\OtherTok{\textless{}{-}} \FunctionTok{match.arg}\NormalTok{(type)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"You have selected type \textquotesingle{}"}\NormalTok{, type, }\StringTok{"\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
\NormalTok{\}}

\FunctionTok{myfn}\NormalTok{(}\StringTok{"a"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
You have selected type 'alpha'
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{myfn}\NormalTok{(}\StringTok{"b"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
You have selected type 'beta'
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{myfn}\NormalTok{(}\StringTok{"g"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
You have selected type 'gamma'
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{myfn}\NormalTok{(}\StringTok{"d"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in match.arg(type): 'arg' should be one of "alpha", "beta", "gamma"
\end{verbatim}

Above you see that partial matching using \texttt{match.arg()} was able to identify a valid option, and when there was no match, an informative error was printed.

Partial matching is also automatically done on the argument names themselves, but it's important to avoid depending on that.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{adsr }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{attack =} \DecValTok{100}\NormalTok{,}
                 \AttributeTok{decay =} \DecValTok{250}\NormalTok{,}
                 \AttributeTok{sustain =} \DecValTok{40}\NormalTok{,}
                 \AttributeTok{release =} \DecValTok{1000}\NormalTok{) \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Attack time:"}\NormalTok{, attack, }\StringTok{"ms}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
      \StringTok{"Decay time:"}\NormalTok{, decay, }\StringTok{"ms}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
      \StringTok{"Sustain level:"}\NormalTok{, sustain, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
      \StringTok{"Release time:"}\NormalTok{, release, }\StringTok{"ms}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}

\FunctionTok{adsr}\NormalTok{(}\DecValTok{50}\NormalTok{, }\AttributeTok{s =} \DecValTok{100}\NormalTok{, }\AttributeTok{r =} \DecValTok{500}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Attack time: 50 ms
 Decay time: 250 ms
 Sustain level: 100 
 Release time: 500 ms
\end{verbatim}

\hypertarget{passing-extra-arguments-to-another-function-with-the-...-argument}{%
\section{\texorpdfstring{Passing extra arguments to another function with the \texttt{...} argument}{Passing extra arguments to another function with the ... argument}}\label{passing-extra-arguments-to-another-function-with-the-...-argument}}

Many functions include a \texttt{...} argument at the end. Any arguments not otherwise matched are collected there. A common use for this is to pass them to another function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cplot }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y,}
                  \AttributeTok{cex =} \FloatTok{1.5}\NormalTok{,}
                  \AttributeTok{pch =} \DecValTok{16}\NormalTok{,}
                  \AttributeTok{col =} \StringTok{"\#18A3AC"}\NormalTok{,}
                  \AttributeTok{bty =} \StringTok{"n"}\NormalTok{, ...) \{}
  \FunctionTok{plot}\NormalTok{(x, y, }\AttributeTok{cex =}\NormalTok{ cex, }\AttributeTok{pch =}\NormalTok{ pch, }\AttributeTok{col =}\NormalTok{ col, }\AttributeTok{bty =}\NormalTok{ bty, ...)}
\NormalTok{                  \}}
\end{Highlighting}
\end{Shaded}

\texttt{...} is also used for variable number of iputs, often as the first argument of a function. For example, look at the documentation of \texttt{c}, \texttt{cat}, \texttt{cbind}, \texttt{rbind}, \texttt{paste}

Note: Any arguments after the \texttt{...}, \textbf{must} be named fully, i.e.~will not be partially matched.

\hypertarget{return-multiple-objects}{%
\section{Return multiple objects}\label{return-multiple-objects}}

R function can only return a single object. This is not much of a problem because you can simply put any collection of objects into a list and return it:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lfn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{fn =}\NormalTok{ square) \{}
\NormalTok{  xfn }\OtherTok{\textless{}{-}} \FunctionTok{fn}\NormalTok{(x)}
  
  \FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x,}
       \AttributeTok{xfn =}\NormalTok{ xfn,}
       \AttributeTok{fn =}\NormalTok{ fn)}
\NormalTok{\}}

\FunctionTok{lfn}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$x
[1] 3

$xfn
[1] 9

$fn
function(x) {
  out <- x^2
  out
}
<bytecode: 0x7fdeb90af048>
\end{verbatim}

\hypertarget{warnings-and-errors}{%
\section{Warnings and errors}\label{warnings-and-errors}}

You can produce a warning at any point during a function evaluation using \texttt{warning("warning\ message\ here")}. This cause \texttt{warning\ message\ here} to be printed to the console as a warning, but does not stop function evaluation.

To stop function execution, e.g.~if an error is encountered, use \texttt{stop()}. The following function calculates
\[ e^{log_{10}(x)} \]
which is not defined for negative \texttt{x}. In this case we could let R give an error when it tries to compute \texttt{log10(x)}, or check x ourselves and write a custom error:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{el10 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{) }\FunctionTok{stop}\NormalTok{(}\StringTok{"x must be positive"}\NormalTok{)}
  \FunctionTok{exp}\NormalTok{(}\FunctionTok{log10}\NormalTok{(x))}
\NormalTok{\}}

\FunctionTok{el10}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in el10(-3): x must be positive
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{el10}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.611429
\end{verbatim}

\hypertarget{scoping}{%
\section{Scoping}\label{scoping}}

Functions exist in their own environment, i.e.~contain their own variable definitions.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{fn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{*}\NormalTok{x}
\NormalTok{  y }\OtherTok{\textless{}{-}} \DecValTok{20}\SpecialCharTok{*}\NormalTok{y}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Inside the function, x = "}\NormalTok{, x, }\StringTok{" and y = "}\NormalTok{, y, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}

\FunctionTok{fn}\NormalTok{(x, y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Inside the function, x =  30  and y =  80 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Outside the function, x = "}\NormalTok{, x, }\StringTok{" and y = "}\NormalTok{, y, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Outside the function, x =  3  and y =  4 
\end{verbatim}

However, if a variable is referenced within a function but no local definition exists, the interpreter will look for the variable at the parent directory. It is best to not rely on this and instead make sure all variables are passed to the functions that need them.

In the following example, \texttt{x} is only defined outside the function definition, but referenced within it.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{21}

\NormalTok{itfn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(y, }\AttributeTok{lr =} \DecValTok{1}\NormalTok{) \{}
\NormalTok{  x }\SpecialCharTok{+}\NormalTok{ lr }\SpecialCharTok{*}\NormalTok{ y}
\NormalTok{\}}

\FunctionTok{itfn}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 24
\end{verbatim}

\hypertarget{function-vs.-for-loop}{%
\subsection{function vs.~for loop}\label{function-vs.-for-loop}}

Let's z-score the built-in \texttt{mtcars} dataset once with a for loop and once with a custom function. This links back to the example seen earlier in the \protect\hyperlink{fordata}{for loop} section. In practice this is performed with the \texttt{scale()} command:

Within the for loop, we are assigning columns directly to the object outside the loop. In the following example, we print the environment outside and inside the loop function to see that it is the same. This is purely for demonstration:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# initialize new object \textquotesingle{}mtcars\_z\textquotesingle{}}
\NormalTok{mtcars\_z }\OtherTok{\textless{}{-}}\NormalTok{ mtcars}
\FunctionTok{cat}\NormalTok{(}\StringTok{"environment outside for loop is: "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
environment outside for loop is: 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
<environment: R_GlobalEnv>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# z{-}score one column at a time in a for loop}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(mtcars)) \{}
\NormalTok{  mtcars\_z[, i] }\OtherTok{\textless{}{-}}\NormalTok{ (mtcars[, i] }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(mtcars[, i])) }\SpecialCharTok{/} \FunctionTok{sd}\NormalTok{(mtcars[, i])}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"environment inside for loop is: "}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
environment inside for loop is: <environment: R_GlobalEnv>
\end{verbatim}

With a function, all operations remain local within the function and the output must be returned:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ztransform }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"environment inside function body is: "}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\NormalTok{  z }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{sapply}\NormalTok{(mtcars, }\ControlFlowTok{function}\NormalTok{(i) (i }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(i))}\SpecialCharTok{/}\FunctionTok{sd}\NormalTok{(i)))}
  \FunctionTok{rownames}\NormalTok{(z) }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(x)}
\NormalTok{  z}
\NormalTok{\}}
\NormalTok{mtcars\_z2 }\OtherTok{\textless{}{-}} \FunctionTok{ztransform}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
environment inside function body is: <environment: 0x7fdeb72e9ed0>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"environment outside function body is: "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
environment outside function body is: 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
<environment: R_GlobalEnv>
\end{verbatim}

Notice how the environment outside and inside the loop function is the same, it is the Global environemnt, but the environment within the function is different. That is why any objects created or changed within a function must be returned if we want to make them available.

\hypertarget{pipe}{%
\section{\texorpdfstring{The pipe operator \texttt{\%\textgreater{}\%}}{The pipe operator \%\textgreater\%}}\label{pipe}}

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{./R_pipes} 

}

\caption{Illustration of pipes in R}\label{fig:FigRpipes}
\end{figure}

A pipe allows writing \texttt{f(x)} as \texttt{x\ \%\textgreater{}\%\ f}. It is often used to replace multiple temporary assignments in a multistep procedure, or as an alternative to nesting functions. Some packages and developers promote its use, other discourage it. As always, there is a big subjective component here and you should try and see if and when it suits you.

The following:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{f1}\NormalTok{(x)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{f2}\NormalTok{(x)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{f3}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{f3}\NormalTok{(}\FunctionTok{f2}\NormalTok{(}\FunctionTok{f1}\NormalTok{(x)))}
\end{Highlighting}
\end{Shaded}

is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ f1 }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ f2 }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ f3}
\end{Highlighting}
\end{Shaded}

The pipe operator was originally introduced in the \textbf{magrittr} package. Note that a number of other packages that allow or endorse the use of pipes export the pipe operator as well.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(magrittr)}
\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{] }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{split}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{lapply}\NormalTok{(}\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{sapply}\NormalTok{(i, mean)) }\OtherTok{{-}\textgreater{}}\NormalTok{ iris\_mean\_bySpecies)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$setosa
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
       5.006        3.428        1.462        0.246 

$versicolor
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
       5.936        2.770        4.260        1.326 

$virginica
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
       6.588        2.974        5.552        2.026 
\end{verbatim}

Pipes are used extensively in the \href{https://www.tidyverse.org}{tidyverse} packages.\\
You can learn more about the pipe operator in the \href{https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html}{magrittr vignette}

\begin{rmdtip}
In \href{https://rstudio.com/}{RStudio} the keyboard shortcut for the
pipe operator \texttt{\%\textgreater{}\%} is \texttt{Shift\ Command\ M}
(MacOS) or \texttt{Ctrl\ Shift\ M} (Windows)
\end{rmdtip}

\hypertarget{dataframes}{%
\chapter{Working with data frames}\label{dataframes}}

\hypertarget{column-and-row-names}{%
\section{Column and row names}\label{column-and-row-names}}

Example data.frame:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{PID =} \FunctionTok{c}\NormalTok{(}\DecValTok{111}\SpecialCharTok{:}\DecValTok{119}\NormalTok{),}
                \AttributeTok{Hospital =} \FunctionTok{c}\NormalTok{(}\StringTok{"UCSF"}\NormalTok{, }\StringTok{"HUP"}\NormalTok{, }\StringTok{"Stanford"}\NormalTok{,}
                             \StringTok{"Stanford"}\NormalTok{, }\StringTok{"UCSF"}\NormalTok{, }\StringTok{"HUP"}\NormalTok{, }
                             \StringTok{"HUP"}\NormalTok{, }\StringTok{"Stanford"}\NormalTok{, }\StringTok{"UCSF"}\NormalTok{),}
                \AttributeTok{Age =} \FunctionTok{c}\NormalTok{(}\DecValTok{22}\NormalTok{, }\DecValTok{34}\NormalTok{, }\DecValTok{41}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{53}\NormalTok{, }\DecValTok{21}\NormalTok{, }\DecValTok{63}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{19}\NormalTok{),}
                \AttributeTok{Sex =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{),}
                \AttributeTok{row.names =} \StringTok{"PID"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Get column names and row names with \texttt{colnames()} and \texttt{rownames()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Hospital" "Age"      "Sex"     
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rownames}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "111" "112" "113" "114" "115" "116" "117" "118" "119"
\end{verbatim}

To set new column or row names use the form \texttt{colnames(df)\ \textless{}-\ new.names}, where new.names is a character vector:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(df) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Center"}\NormalTok{, }\StringTok{"Age\_at\_Dx"}\NormalTok{, }\StringTok{"Sex"}\NormalTok{)}
\FunctionTok{rownames}\NormalTok{(df) }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9}
\end{Highlighting}
\end{Shaded}

\hypertarget{delete-columns-or-rows}{%
\section{Delete columns or rows}\label{delete-columns-or-rows}}

To delete a data.frame column, set it to \protect\hyperlink{replacing-with-null}{NULL}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df}\SpecialCharTok{$}\NormalTok{Sex }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Center Age_at_Dx
1     UCSF        22
2      HUP        34
3 Stanford        41
4 Stanford        19
5     UCSF        53
6      HUP        21
7      HUP        63
8 Stanford        22
9     UCSF        19
\end{verbatim}

To delete a data.frame row, you can ``index it out.'' For example, to remove the third row:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ df[}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, ]}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Center Age_at_Dx
1     UCSF        22
2      HUP        34
4 Stanford        19
5     UCSF        53
6      HUP        21
7      HUP        63
8 Stanford        22
9     UCSF        19
\end{verbatim}

\hypertarget{table-joins-i.e.-merging-data.frames}{%
\section{Table Joins (i.e.~Merging data.frames)}\label{table-joins-i.e.-merging-data.frames}}

Scenario: You have received two or more tables with data. Each table consists of a unique identifier (ID), which is shared among the tables, plus a number of variables in columns, which may be unique to each table. You want to merge them into one big table so that for each ID you have all available variables.

Let's make up some data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{PID =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{),}
                \AttributeTok{Hospital =} \FunctionTok{c}\NormalTok{(}\StringTok{"UCSF"}\NormalTok{, }\StringTok{"HUP"}\NormalTok{, }\StringTok{"Stanford"}\NormalTok{,}
                             \StringTok{"Stanford"}\NormalTok{, }\StringTok{"UCSF"}\NormalTok{, }\StringTok{"HUP"}\NormalTok{, }
                             \StringTok{"HUP"}\NormalTok{, }\StringTok{"Stanford"}\NormalTok{, }\StringTok{"UCSF"}\NormalTok{),}
                \AttributeTok{Age =} \FunctionTok{c}\NormalTok{(}\DecValTok{22}\NormalTok{, }\DecValTok{34}\NormalTok{, }\DecValTok{41}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{53}\NormalTok{, }\DecValTok{21}\NormalTok{, }\DecValTok{63}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{19}\NormalTok{),}
                \AttributeTok{Sex =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{))}

\NormalTok{b  }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{PID =} \FunctionTok{c}\NormalTok{(}\DecValTok{6}\SpecialCharTok{:}\DecValTok{12}\NormalTok{),}
                 \AttributeTok{V1 =} \FunctionTok{c}\NormalTok{(}\DecValTok{153}\NormalTok{, }\DecValTok{89}\NormalTok{, }\DecValTok{112}\NormalTok{, }\DecValTok{228}\NormalTok{,  }\DecValTok{91}\NormalTok{, }\DecValTok{190}\NormalTok{, }\DecValTok{101}\NormalTok{),}
                 \AttributeTok{Department =} \FunctionTok{c}\NormalTok{(}\StringTok{"Neurology"}\NormalTok{, }\StringTok{"Radiology"}\NormalTok{,}
                                \StringTok{"Emergency"}\NormalTok{, }\StringTok{"Cardiology"}\NormalTok{,}
                                \StringTok{"Surgery"}\NormalTok{, }\StringTok{"Neurology"}\NormalTok{, }\StringTok{"Psychiatry"}\NormalTok{))}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  PID Hospital Age Sex
1   1     UCSF  22   1
2   2      HUP  34   1
3   3 Stanford  41   0
4   4 Stanford  19   1
5   5     UCSF  53   0
6   6      HUP  21   0
7   7      HUP  63   1
8   8 Stanford  22   0
9   9     UCSF  19   0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  PID  V1 Department
1   6 153  Neurology
2   7  89  Radiology
3   8 112  Emergency
4   9 228 Cardiology
5  10  91    Surgery
6  11 190  Neurology
7  12 101 Psychiatry
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 9 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 7 3
\end{verbatim}

There are four main types of join operations:

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{R_joins} 

}

\caption{Common Join Operations}\label{fig:unnamed-chunk-8}
\end{figure}

\hypertarget{inner-join}{%
\subsection{Inner join}\label{inner-join}}

The default arguments of \texttt{merge()} perform an \textbf{inner join}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(ab.inner }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(a, b))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  PID Hospital Age Sex  V1 Department
1   6      HUP  21   0 153  Neurology
2   7      HUP  63   1  89  Radiology
3   8 Stanford  22   0 112  Emergency
4   9     UCSF  19   0 228 Cardiology
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# same as}
\NormalTok{(ab.inner }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{by =} \StringTok{"PID"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  PID Hospital Age Sex  V1 Department
1   6      HUP  21   0 153  Neurology
2   7      HUP  63   1  89  Radiology
3   8 Stanford  22   0 112  Emergency
4   9     UCSF  19   0 228 Cardiology
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# same as}
\NormalTok{(ab.inner }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{all =} \ConstantTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  PID Hospital Age Sex  V1 Department
1   6      HUP  21   0 153  Neurology
2   7      HUP  63   1  89  Radiology
3   8 Stanford  22   0 112  Emergency
4   9     UCSF  19   0 228 Cardiology
\end{verbatim}

Note that the resulting table only contains cases found in both data frames (i.e.~IDs 6 through 9)

\hypertarget{outer-join}{%
\subsection{Outer join}\label{outer-join}}

You can perform an \textbf{outer join} by specifying \texttt{all\ =\ TRUE}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(ab.outer }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{all =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   PID Hospital Age Sex  V1 Department
1    1     UCSF  22   1  NA       <NA>
2    2      HUP  34   1  NA       <NA>
3    3 Stanford  41   0  NA       <NA>
4    4 Stanford  19   1  NA       <NA>
5    5     UCSF  53   0  NA       <NA>
6    6      HUP  21   0 153  Neurology
7    7      HUP  63   1  89  Radiology
8    8 Stanford  22   0 112  Emergency
9    9     UCSF  19   0 228 Cardiology
10  10     <NA>  NA  NA  91    Surgery
11  11     <NA>  NA  NA 190  Neurology
12  12     <NA>  NA  NA 101 Psychiatry
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(ab.outer }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{by =} \StringTok{"PID"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   PID Hospital Age Sex  V1 Department
1    1     UCSF  22   1  NA       <NA>
2    2      HUP  34   1  NA       <NA>
3    3 Stanford  41   0  NA       <NA>
4    4 Stanford  19   1  NA       <NA>
5    5     UCSF  53   0  NA       <NA>
6    6      HUP  21   0 153  Neurology
7    7      HUP  63   1  89  Radiology
8    8 Stanford  22   0 112  Emergency
9    9     UCSF  19   0 228 Cardiology
10  10     <NA>  NA  NA  91    Surgery
11  11     <NA>  NA  NA 190  Neurology
12  12     <NA>  NA  NA 101 Psychiatry
\end{verbatim}

Note that the resulting data frame contains all IDs found in either input data frame and missing values are represented with \texttt{NA}

\hypertarget{left-outer-join}{%
\subsection{Left outer join}\label{left-outer-join}}

You can perform a \textbf{left outer join} by specifying \texttt{all.x\ =\ TRUE}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(ab.leftOuter }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  PID Hospital Age Sex  V1 Department
1   1     UCSF  22   1  NA       <NA>
2   2      HUP  34   1  NA       <NA>
3   3 Stanford  41   0  NA       <NA>
4   4 Stanford  19   1  NA       <NA>
5   5     UCSF  53   0  NA       <NA>
6   6      HUP  21   0 153  Neurology
7   7      HUP  63   1  89  Radiology
8   8 Stanford  22   0 112  Emergency
9   9     UCSF  19   0 228 Cardiology
\end{verbatim}

Note how the resulting data frame contains all IDs present in the left input data frame only.

\hypertarget{right-outer-join}{%
\subsection{Right outer join}\label{right-outer-join}}

You can perform a \textbf{right outer join} by specifying \texttt{all.y\ =\ TRUE}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(ab.rightOuter }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{all.y =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  PID Hospital Age Sex  V1 Department
1   6      HUP  21   0 153  Neurology
2   7      HUP  63   1  89  Radiology
3   8 Stanford  22   0 112  Emergency
4   9     UCSF  19   0 228 Cardiology
5  10     <NA>  NA  NA  91    Surgery
6  11     <NA>  NA  NA 190  Neurology
7  12     <NA>  NA  NA 101 Psychiatry
\end{verbatim}

Note how the resulting data frame contains all IDs present in the right input data frame only.

\hypertarget{wide-to-long}{%
\section{Wide to Long}\label{wide-to-long}}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{wide_long} 

}

\caption{Wide and Long data format example. Take a moment to notice how the wide table on the left with 3 cases (3 IDs) and 3 variables gets converted from a 3 x 4 table to a 9 x 3 long table on the right. The values (outlined in magenta) are present once in each table: on the wide table they form an **ID x Variable** matrix, while on the long they are stacked on a **single column**. The IDs have to be repeated on the long table, once for each variable and there is a new 'Variable' column to provide the information present in the wide table's column names.}\label{fig:wideLong}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyr)}
\FunctionTok{library}\NormalTok{(data.table)}
\end{Highlighting}
\end{Shaded}

Let's create an example data frame:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dat\_wide }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{ID =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
                       \AttributeTok{mango =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.1}\NormalTok{, }\FloatTok{2.1}\NormalTok{, }\FloatTok{3.1}\NormalTok{),}
                       \AttributeTok{banana =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{2.2}\NormalTok{, }\FloatTok{3.2}\NormalTok{),}
                       \AttributeTok{tangerine =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.3}\NormalTok{, }\FloatTok{2.3}\NormalTok{, }\FloatTok{3.3}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  ID mango banana tangerine
1  1   1.1    1.2       1.3
2  2   2.1    2.2       2.3
3  3   3.1    3.2       3.3
\end{verbatim}

\hypertarget{base}{%
\subsection{base}\label{base}}

The \texttt{reshape()} function is probably one of the most complicated because the documentation is not clear, specifically with regards to which arguments refer to the input vs.~output data frame. Use the following figure as a guide to understand \texttt{reshape()}'s syntax. You can use it as a reference when building your own \texttt{reshape()} command by following steps 1 through 5:

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{R_reshape_wide2long} 

}

\caption{`reshape()` syntax for Wide to Long transformation.}\label{fig:wideLongSyntax}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_wide2long }\OtherTok{\textless{}{-}} \FunctionTok{reshape}\NormalTok{(}\CommentTok{\# Data in wide format}
                         \AttributeTok{data =}\NormalTok{ dat\_wide,}
                         \CommentTok{\# The column name that defines case ID}
                         \AttributeTok{idvar =} \StringTok{"ID"}\NormalTok{,}
                         \CommentTok{\# The columns whose values we want to keep}
                         \AttributeTok{varying =} \FunctionTok{list}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{),}
                         \CommentTok{\# The name of the new column which will contain all }
                         \CommentTok{\# the values from the columns above}
                         \AttributeTok{v.names =} \StringTok{"Score"}\NormalTok{,}
                         \CommentTok{\# The values/names, of length = (N columns in "varying"), }
                         \CommentTok{\#that will be recycled to indicate which column from the }
                         \CommentTok{\#wide dataset each row corresponds to}
                         \AttributeTok{times =} \FunctionTok{c}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(dat\_wide)[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{]),}
                         \CommentTok{\# The name of the new column created to hold the values }
                         \CommentTok{\# defined by "times"}
                         \AttributeTok{timevar =} \StringTok{"Fruit"}\NormalTok{,                  }
                         \AttributeTok{direction =} \StringTok{"long"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

You can also define `varying' with a character vector:\\
\texttt{varying\ =\ list(c("mango",\ "banana","tangerine")}

Explore the resulting data frame's attributes:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attributes}\NormalTok{(dat\_wide2long)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$row.names
[1] "1.mango"     "2.mango"     "3.mango"     "1.banana"    "2.banana"   
[6] "3.banana"    "1.tangerine" "2.tangerine" "3.tangerine"

$names
[1] "ID"    "Fruit" "Score"

$class
[1] "data.frame"

$reshapeLong
$reshapeLong$varying
$reshapeLong$varying[[1]]
[1] "mango"     "banana"    "tangerine"


$reshapeLong$v.names
[1] "Score"

$reshapeLong$idvar
[1] "ID"

$reshapeLong$timevar
[1] "Fruit"
\end{verbatim}

These attributes and present if and only if a long data set was created from a wide as above. In that case, reshaping back to a wide data frame is as easy as:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{reshape}\NormalTok{(dat\_wide2long)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        ID mango banana tangerine
1.mango  1   1.1    1.2       1.3
2.mango  2   2.1    2.2       2.3
3.mango  3   3.1    3.2       3.3
\end{verbatim}

\hypertarget{tidyr}{%
\subsection{tidyr}\label{tidyr}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_wide2long\_tv }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(dat\_wide,}
                           \AttributeTok{cols =} \DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{,}
                           \AttributeTok{names\_to =} \StringTok{"Fruit"}\NormalTok{,}
                           \AttributeTok{values\_to =} \StringTok{"Score"}\NormalTok{)}
\NormalTok{dat\_wide2long\_tv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 9 x 3
     ID Fruit     Score
  <dbl> <chr>     <dbl>
1     1 mango       1.1
2     1 banana      1.2
3     1 tangerine   1.3
4     2 mango       2.1
5     2 banana      2.2
6     2 tangerine   2.3
7     3 mango       3.1
8     3 banana      3.2
9     3 tangerine   3.3
\end{verbatim}

\hypertarget{data.table}{%
\subsection{data.table}\label{data.table}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_wide\_dt }\OtherTok{\textless{}{-}} \FunctionTok{as.data.table}\NormalTok{(dat\_wide)}
\NormalTok{dat\_wide2long\_dt }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(dat\_wide\_dt,}
                         \AttributeTok{id.vars =} \DecValTok{1}\NormalTok{,}
                         \AttributeTok{measure.vars =} \DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{,}
                         \AttributeTok{variable.name =} \StringTok{"Fruit"}\NormalTok{,}
                         \AttributeTok{value.name =} \StringTok{"Score"}\NormalTok{)}
\FunctionTok{setorder}\NormalTok{(dat\_wide2long\_dt, }\StringTok{"ID"}\NormalTok{)}
\NormalTok{dat\_wide2long\_dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      ID     Fruit Score
   <num>    <fctr> <num>
1:     1     mango   1.1
2:     1    banana   1.2
3:     1 tangerine   1.3
4:     2     mango   2.1
5:     2    banana   2.2
6:     2 tangerine   2.3
7:     3     mango   3.1
8:     3    banana   3.2
9:     3 tangerine   3.3
\end{verbatim}

\hypertarget{long-to-wide}{%
\section{Long to Wide}\label{long-to-wide}}

Let's create a long dataset:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dat\_long }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{ID =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
                       \AttributeTok{Fruit =} \FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"mango"}\NormalTok{, }\StringTok{"mango"}\NormalTok{, }
                                 \StringTok{"banana"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }
                                 \StringTok{"tangerine"}\NormalTok{, }\StringTok{"tangerine"}\NormalTok{, }\StringTok{"tangerine"}\NormalTok{),}
                       \AttributeTok{Score =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.1}\NormalTok{, }\FloatTok{2.1}\NormalTok{, }\FloatTok{3.1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\FloatTok{2.2}\NormalTok{, }\FloatTok{3.2}\NormalTok{, }\FloatTok{1.3}\NormalTok{, }\FloatTok{2.3}\NormalTok{, }\FloatTok{3.3}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  ID     Fruit Score
1  1     mango   1.1
2  2     mango   2.1
3  3     mango   3.1
4  1    banana   1.2
5  2    banana   2.2
6  3    banana   3.2
7  1 tangerine   1.3
8  2 tangerine   2.3
9  3 tangerine   3.3
\end{verbatim}

\hypertarget{base-1}{%
\subsection{base}\label{base-1}}

Using base \texttt{reshape()} for long-to-wide transformation is simpler than wide-to-long:

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{R_reshape_long2wide} 

}

\caption{`reshape()` syntax for Long to Wide transformation.}\label{fig:longWideSyntax}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_long2wide }\OtherTok{\textless{}{-}} \FunctionTok{reshape}\NormalTok{(dat\_long,}
                         \AttributeTok{idvar =} \StringTok{"ID"}\NormalTok{,}
                         \AttributeTok{timevar =} \StringTok{"Fruit"}\NormalTok{,}
                         \AttributeTok{v.names =} \StringTok{"Score"}\NormalTok{,}
                         \AttributeTok{direction =} \StringTok{"wide"}\NormalTok{)}
\CommentTok{\# Optionally rename columns}
\FunctionTok{colnames}\NormalTok{(dat\_long2wide) }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"Score."}\NormalTok{, }\StringTok{""}\NormalTok{, }\FunctionTok{colnames}\NormalTok{(dat\_long2wide))}
\NormalTok{dat\_long2wide}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  ID mango banana tangerine
1  1   1.1    1.2       1.3
2  2   2.1    2.2       2.3
3  3   3.1    3.2       3.3
\end{verbatim}

\hypertarget{tidyr-1}{%
\subsection{tidyr}\label{tidyr-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_long2wide\_tv }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_wider}\NormalTok{(dat\_long,}
                                \AttributeTok{id\_cols =} \StringTok{"ID"}\NormalTok{,}
                                \AttributeTok{names\_from =} \StringTok{"Fruit"}\NormalTok{,}
                                \AttributeTok{values\_from =} \StringTok{"Score"}\NormalTok{)}
\NormalTok{dat\_long2wide\_tv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 3 x 4
     ID mango banana tangerine
  <dbl> <dbl>  <dbl>     <dbl>
1     1   1.1    1.2       1.3
2     2   2.1    2.2       2.3
3     3   3.1    3.2       3.3
\end{verbatim}

\hypertarget{data.table-1}{%
\subsection{data.table}\label{data.table-1}}

\texttt{data.table}'s long to wide procedure is defined with a convenient formula notation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_long\_dt }\OtherTok{\textless{}{-}} \FunctionTok{as.data.table}\NormalTok{(dat\_long)}
\NormalTok{dat\_long2wide\_dt }\OtherTok{\textless{}{-}} \FunctionTok{dcast}\NormalTok{(dat\_long\_dt,}
\NormalTok{                          ID }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Fruit,}
                          \AttributeTok{value.var =} \StringTok{"Score"}\NormalTok{)}
\NormalTok{dat\_long2wide\_dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <ID>
      ID banana mango tangerine
   <num>  <num> <num>     <num>
1:     1    1.2   1.1       1.3
2:     2    2.2   2.1       2.3
3:     3    3.2   3.1       3.3
\end{verbatim}

\hypertarget{feature-transformation-with-transform}{%
\section{\texorpdfstring{Feature transformation with \texttt{transform()}}{Feature transformation with transform()}}\label{feature-transformation-with-transform}}

Make up some data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Sex =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
                  \AttributeTok{Height =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.5}\NormalTok{, }\FloatTok{1.6}\NormalTok{, }\FloatTok{1.55}\NormalTok{, }\FloatTok{1.73}\NormalTok{, }\FloatTok{1.8}\NormalTok{),}
                  \AttributeTok{Weight =} \FunctionTok{c}\NormalTok{(}\DecValTok{55}\NormalTok{, }\DecValTok{70}\NormalTok{, }\DecValTok{69}\NormalTok{, }\DecValTok{76}\NormalTok{, }\DecValTok{91}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{transform}\NormalTok{(dat, }\AttributeTok{BMI =}\NormalTok{ Weight}\SpecialCharTok{/}\NormalTok{Height}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{dat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Sex Height Weight      BMI
1   0   1.50     55 24.44444
2   0   1.60     70 27.34375
3   1   1.55     69 28.72008
4   1   1.73     76 25.39343
5   0   1.80     91 28.08642
\end{verbatim}

\texttt{transform()} is probably not used too often, because it is trivial to do the same with direct assignment:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}\SpecialCharTok{$}\NormalTok{BMI }\OtherTok{\textless{}{-}}\NormalTok{ dat}\SpecialCharTok{$}\NormalTok{Weight}\SpecialCharTok{/}\NormalTok{dat}\SpecialCharTok{$}\NormalTok{Height}\SpecialCharTok{\^{}}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

but can be useful when adding multiple variables and/or used in a \protect\hyperlink{pipe}{pipe}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(magrittr)}
\NormalTok{dat }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{subset}\NormalTok{(Sex }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{transform}\NormalTok{(}\AttributeTok{DeltaWeightFromMean =}\NormalTok{ Weight }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(Weight),}
            \AttributeTok{BMI =}\NormalTok{ Weight}\SpecialCharTok{/}\NormalTok{Height}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{,}
            \AttributeTok{CI =}\NormalTok{ Weight}\SpecialCharTok{/}\NormalTok{Height}\SpecialCharTok{\^{}}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Sex Height Weight      BMI DeltaWeightFromMean       CI
1   0    1.5     55 24.44444                 -17 16.29630
2   0    1.6     70 27.34375                  -2 17.08984
5   0    1.8     91 28.08642                  19 15.60357
\end{verbatim}

\hypertarget{datatrans}{%
\chapter{Data Transformations}\label{datatrans}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rtemis)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

\hypertarget{continuous-variables}{%
\section{Continuous variables}\label{continuous-variables}}

\hypertarget{zscore}{%
\subsection{\texorpdfstring{Standardization / Scaling \& Centering with \texttt{scale()}}{Standardization / Scaling \& Centering with scale()}}\label{zscore}}

Depending on your modeling needs / the algorithms you plan to use, it is often important to scale and/or center your data. Note that many functions, but not all, will automatically scale and center data internally if it is required by the algorithm. Check the function documentation.

Standardizing, i.e.~converting to Z-scores, involves subtracting the mean and dividing by the standard deviation.
Scaling and centering in R is performed with the \texttt{scale} function. By default, both arguments \texttt{scale} and \texttt{center} are set to \texttt{TRUE}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.scaled }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(iris[, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

First, let's check that it did what we were hoping:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colMeans}\NormalTok{(iris.scaled)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 Sepal.Length   Sepal.Width  Petal.Length   Petal.Width 
-4.480675e-16  2.035409e-16 -2.844947e-17 -3.714621e-17 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{apply}\NormalTok{(iris.scaled, }\DecValTok{2}\NormalTok{, sd)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
           1            1            1            1 
\end{verbatim}

Good - We got effectively 0 mean and standard deviation of 1 for each column.

\begin{rmdnote}
If you are manually scaling and/or centering data for \textbf{supervised
learning}, you must:

\begin{itemize}
\tightlist
\item
  Perform scaling and centering on your \textbf{training data}
\item
  Save the \textbf{centering and scaling parameters} for each feature
\item
  Apply the training set-derived centering and scaling parameters to the
  \textbf{test set} \emph{prior to prediction/inference}.
\end{itemize}
\end{rmdnote}

A common mistake is to either scale training and testing data together in the beginning, or scale them independently.\\
Let's get the scale and center attributes:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attributes}\NormalTok{(iris.scaled)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$dim
[1] 150   4

$dimnames
$dimnames[[1]]
NULL

$dimnames[[2]]
[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width" 


$`scaled:center`
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 

$`scaled:scale`
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
   0.8280661    0.4358663    1.7652982    0.7622377 
\end{verbatim}

Let's save the scale and center attributes and then check some values so that we are clear what is happening:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(.center }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(iris.scaled, }\StringTok{"scaled:center"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(.scale }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(iris.scaled, }\StringTok{"scaled:scale"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
   0.8280661    0.4358663    1.7652982    0.7622377 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Sepal.Length\_scaled }\OtherTok{\textless{}{-}}\NormalTok{ (iris}\SpecialCharTok{$}\NormalTok{Sepal.Length }\SpecialCharTok{{-}}\NormalTok{ .center[}\DecValTok{1}\NormalTok{]) }\SpecialCharTok{/}\NormalTok{ .scale[}\DecValTok{1}\NormalTok{]}
\FunctionTok{all}\NormalTok{(Sepal.Length\_scaled }\SpecialCharTok{==}\NormalTok{ iris.scaled[, }\StringTok{"Sepal.Length"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

Note: Due to limitation in numerical precision, checking sets of floats for equality after multiple operations is not recommended. A good option is to plot, if possible:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.fit}\NormalTok{(Sepal.Length\_scaled, iris.scaled[, }\StringTok{"Sepal.Length"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\includegraphics{72-DataTrans_files/figure-latex/unnamed-chunk-10-1.pdf}

\hypertarget{log-transform-with-log}{%
\subsection{\texorpdfstring{Log-transform with \texttt{log()}}{Log-transform with log()}}\label{log-transform-with-log}}

For the following example, \texttt{x} is an unknown feature in a new dataset we were just given.\\
We start by plotting its distribution:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\includegraphics{72-DataTrans_files/figure-latex/unnamed-chunk-12-1.pdf}

We can see it is highly skewed. A log transform may help here.\\
Let's check:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(}\FunctionTok{log}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\includegraphics{72-DataTrans_files/figure-latex/unnamed-chunk-13-1.pdf}

Looks like a good deal.

\hypertarget{data-binning-with-cut}{%
\subsection{\texorpdfstring{Data binning with \texttt{cut()}}{Data binning with cut()}}\label{data-binning-with-cut}}

A different approach for the above variable might be to bin it.\\
Let's look at a few different ways to bin continuous data.

\hypertarget{evenly-spaced-interval}{%
\subsubsection{Evenly-spaced interval}\label{evenly-spaced-interval}}

\texttt{cut()} allows us to bin a numeric variable into evenly-spaced intervals.\\
The \texttt{breaks} argument defines the number of intervals:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_cut4 }\OtherTok{\textless{}{-}} \FunctionTok{cut}\NormalTok{(x, }\AttributeTok{breaks =} \DecValTok{4}\NormalTok{)}
\FunctionTok{head}\NormalTok{(x\_cut4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] (0.291,178] (0.291,178] (0.291,178] (0.291,178] (0.291,178] (0.291,178]
Levels: (0.291,178] (178,355] (355,533] (533,711]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(x\_cut4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
x_cut4
(0.291,178]   (178,355]   (355,533]   (533,711] 
        977          19           3           1 
\end{verbatim}

\begin{rmdtip}
\textbf{Interval Notation}

\texttt{{[}3,\ 9)} represents the interval of
\href{https://en.wikipedia.org/wiki/Real_number}{real numbers} between 3
and 9, \textbf{including} 3 and \textbf{excluding} 9.
\end{rmdtip}

Because the data is so skewed, equal intervals are not helpful in this case. The majority of the data gets grouped into a single bin.\\
Let's visualize the cuts.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(xcuts5 }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(x), }\FunctionTok{max}\NormalTok{(x), }\AttributeTok{length.out =} \DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]   1.0000 178.2453 355.4905 532.7358 709.9811
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(x, }\AttributeTok{par.reset =} \ConstantTok{FALSE}\NormalTok{)}
\CommentTok{\# plot(density(x)) \# in base R}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{v =}\NormalTok{ xcuts5, }\AttributeTok{col =} \StringTok{"red"}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{1.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{72-DataTrans_files/figure-latex/unnamed-chunk-16-1.pdf}

Note: We used \texttt{par.reset\ =\ FALSE} to stop \texttt{mplot3.x()} from resetting its custom \texttt{par()} settings so that we can continue adding elements to the same plot, in this case with the \texttt{abline()} command.

\hypertarget{quantile-cuts}{%
\subsubsection{Quantile cuts}\label{quantile-cuts}}

Instead, we can get quantiles with \texttt{quantile()}. We ask for 5 quantiles using the \texttt{lngth.out} argument, which corresponds to 4 intervals:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(xquants5 }\OtherTok{\textless{}{-}} \FunctionTok{quantile}\NormalTok{(x, }\FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{5}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       0%       25%       50%       75%      100% 
  1.00000  11.53621  23.24769  47.20410 709.98108 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(x, }\AttributeTok{par.reset =}\NormalTok{ F)}
\CommentTok{\# plot(density(x)) \# in base R}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{v =}\NormalTok{ xquants5, }\AttributeTok{col =} \StringTok{"green"}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{1.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{72-DataTrans_files/figure-latex/unnamed-chunk-17-1.pdf}
The \texttt{breaks} argument of \texttt{cut()} allows us to pass either an integer to define evenly-spaced breaks, or a numeric vector define the position of breaks.\\
We can therefore pass the quantile values as break points.\\
Since the quantile values begin at the lowest value in the data, we need to define \texttt{include.lowest\ =\ TRUE} so that the first interval is inclusive of the lowest value:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_cutq4 }\OtherTok{\textless{}{-}} \FunctionTok{cut}\NormalTok{(x, }\AttributeTok{breaks =}\NormalTok{ xquants5, }\AttributeTok{include.lowest =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{table}\NormalTok{(x\_cutq4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
x_cutq4
   [1,11.5] (11.5,23.2] (23.2,47.2]  (47.2,710] 
        250         250         250         250 
\end{verbatim}

With quantile cuts, each bin contains the same or roughly the same number of observations (+/- 1).

\hypertarget{categorical-variables}{%
\section{Categorical variables}\label{categorical-variables}}

Many algorithms (or their implementations) do not directly support categorical variables. To use them, you must therefore convert all categorical variables to some type of numerical encoding.

\hypertarget{integer-encoding}{%
\subsection{Integer encoding}\label{integer-encoding}}

If the categorical data is ordinal, you can simply convert it to integers.\\
For example, the following \textbf{ordered factor}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(brightness }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"bright"}\NormalTok{, }\StringTok{"brightest"}\NormalTok{, }\StringTok{"darkest"}\NormalTok{,}
                        \StringTok{"bright"}\NormalTok{, }\StringTok{"dark"}\NormalTok{, }\StringTok{"dim"}\NormalTok{, }\StringTok{"dark"}\NormalTok{),}
                      \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"darkest"}\NormalTok{, }\StringTok{"dark"}\NormalTok{, }\StringTok{"dim"}\NormalTok{, }\StringTok{"bright"}\NormalTok{, }\StringTok{"brightest"}\NormalTok{),}
                      \AttributeTok{ordered =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] bright    brightest darkest   bright    dark      dim       dark     
Levels: darkest < dark < dim < bright < brightest
\end{verbatim}

\ldots can be directly coerced to integer:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.integer}\NormalTok{(brightness)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4 5 1 4 2 3 2
\end{verbatim}

\hypertarget{one-hot-encoding}{%
\subsection{One-hot encoding}\label{one-hot-encoding}}

When categorical features are \textbf{not} ordinal, and your algorithm cannot handle them directly, you can one-hot encode them. In one-hot encoding, each categorical feature is converted to k binary features, where k = number of unique values in the input, such that only one feature has the value 1 per case. This is similar to creating dummy variables in statistics, with the difference that dummy variables create \texttt{k\ -\ 1} new variables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{admission\_reasons }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"plannedSurgery"}\NormalTok{, }\StringTok{"emergencySurgery"}\NormalTok{, }\StringTok{"medical"}\NormalTok{)}
\NormalTok{(admission }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(admission\_reasons, }\DecValTok{10}\NormalTok{, T))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "emergencySurgery" "medical"          "medical"          "emergencySurgery"
 [5] "medical"          "emergencySurgery" "medical"          "medical"         
 [9] "emergencySurgery" "emergencySurgery"
\end{verbatim}

We can use the \textbf{rtemis} \texttt{oneHot()} function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(admission\_oneHot }\OtherTok{\textless{}{-}} \FunctionTok{oneHot}\NormalTok{(admission))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      admission.emergencySurgery admission.medical
 [1,]                          1                 0
 [2,]                          0                 1
 [3,]                          0                 1
 [4,]                          1                 0
 [5,]                          0                 1
 [6,]                          1                 0
 [7,]                          0                 1
 [8,]                          0                 1
 [9,]                          1                 0
[10,]                          1                 0
\end{verbatim}

\hypertarget{stringops}{%
\chapter{String Operations}\label{stringops}}

\hypertarget{reminder-create---coerce---check}{%
\section{Reminder: create - coerce - check}\label{reminder-create---coerce---check}}

\begin{itemize}
\tightlist
\item
  \texttt{character()}: Initialize empty character vector
\item
  \texttt{as.character()}: Coerce any vector to a character vector
\item
  \texttt{is.character()}: Check object is character
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{character}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "" "" "" "" "" "" "" "" "" ""
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{v }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{43}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(v)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "10" "20" "22" "43"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"PID"}\NormalTok{, }\StringTok{"Age"}\NormalTok{, }\StringTok{"Sex"}\NormalTok{, }\StringTok{"Handedness"}\NormalTok{)}
\FunctionTok{is.character}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\hypertarget{nchar-get-number-of-characters-in-element}{%
\section{\texorpdfstring{\texttt{nchar()}: Get number of characters in element}{nchar(): Get number of characters in element}}\label{nchar-get-number-of-characters-in-element}}

\texttt{nchar()} counts the number of characters in each \textbf{element} of type character in a vector:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"bb"}\NormalTok{, }\StringTok{"ccc"}\NormalTok{)}
\FunctionTok{nchar}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3
\end{verbatim}

\hypertarget{substr-get-substring}{%
\section{\texorpdfstring{\texttt{substr()}: Get substring}{substr(): Get substring}}\label{substr-get-substring}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"001Emergency"}\NormalTok{, }\StringTok{"010Cardiology"}\NormalTok{, }\StringTok{"018Neurology"}\NormalTok{, }
       \StringTok{"020Anesthesia"}\NormalTok{, }\StringTok{"021Surgery"}\NormalTok{, }\StringTok{"051Psychiatry"}\NormalTok{)}
\FunctionTok{substr}\NormalTok{(x, }\AttributeTok{start =} \DecValTok{1}\NormalTok{, }\AttributeTok{stop =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "001" "010" "018" "020" "021" "051"
\end{verbatim}

Neither \texttt{start} nor \texttt{stop} need to be valid character positions.\\
For example, if you want to get all characters from the fourth one to the last one, you can specify a very large \texttt{stop}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{substr}\NormalTok{(x, }\DecValTok{4}\NormalTok{, }\DecValTok{99}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Emergency"  "Cardiology" "Neurology"  "Anesthesia" "Surgery"   
[6] "Psychiatry"
\end{verbatim}

If you start with too high an index, you end up with empty strings:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{substr}\NormalTok{(x, }\DecValTok{20}\NormalTok{, }\DecValTok{24}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "" "" "" "" "" ""
\end{verbatim}

\textbf{Note:} \texttt{substring()} is also available, with similar syntax to \texttt{substr()}: (first, last) instead of (start, stop). It is available for compatibility with S (check its source code to see how it's an alias for \texttt{substr()})

\hypertarget{strsplit-split-strings}{%
\section{\texorpdfstring{\texttt{strsplit()}: Split strings}{strsplit(): Split strings}}\label{strsplit-split-strings}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \StringTok{"This is one sentence"}
\FunctionTok{strsplit}\NormalTok{(x, }\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1] "This"     "is"       "one"      "sentence"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \StringTok{"In the beginning, there was the command line"}
\FunctionTok{strsplit}\NormalTok{(x, }\StringTok{","}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1] "In the beginning"            " there was the command line"
\end{verbatim}

\hypertarget{paste-concatenate-strings}{%
\section{\texorpdfstring{\texttt{paste()}: Concatenate strings}{paste(): Concatenate strings}}\label{paste-concatenate-strings}}

\texttt{paste()} and \texttt{paste0()} are particularly useful commands.\\
In it simplest form, it acts like \texttt{as.character()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{v }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{43}\NormalTok{)}
\FunctionTok{paste}\NormalTok{(v)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "10" "20" "22" "43"
\end{verbatim}

Combine strings from multiple vectors, elementwise:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{id }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"001"}\NormalTok{, }\StringTok{"010"}\NormalTok{, }\StringTok{"018"}\NormalTok{, }\StringTok{"020"}\NormalTok{, }\StringTok{"021"}\NormalTok{, }\StringTok{"051"}\NormalTok{)}
\NormalTok{dept }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Emergency"}\NormalTok{, }\StringTok{"Cardiology"}\NormalTok{, }\StringTok{"Neurology"}\NormalTok{,}
         \StringTok{"Anesthesia"}\NormalTok{, }\StringTok{"Surgery"}\NormalTok{, }\StringTok{"Psychiatry"}\NormalTok{)}
\FunctionTok{paste}\NormalTok{(id, dept)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "001 Emergency"  "010 Cardiology" "018 Neurology"  "020 Anesthesia"
[5] "021 Surgery"    "051 Psychiatry"
\end{verbatim}

Use the \texttt{sep} argument to define separator:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(id, dept, }\AttributeTok{sep =} \StringTok{"+++"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "001+++Emergency"  "010+++Cardiology" "018+++Neurology"  "020+++Anesthesia"
[5] "021+++Surgery"    "051+++Psychiatry"
\end{verbatim}

\texttt{paste0()} is an alias for the commonly used \texttt{paste(...,\ sep\ =\ "")}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste0}\NormalTok{(id, dept)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "001Emergency"  "010Cardiology" "018Neurology"  "020Anesthesia"
[5] "021Surgery"    "051Psychiatry"
\end{verbatim}

As with other vectorized operations, value recycling can be very convenient:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste0}\NormalTok{(}\StringTok{"Feature\_"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "Feature_1"  "Feature_2"  "Feature_3"  "Feature_4"  "Feature_5" 
 [6] "Feature_6"  "Feature_7"  "Feature_8"  "Feature_9"  "Feature_10"
\end{verbatim}

The argument \texttt{collapse} helps output a \emph{single} character element after collapsing with some string:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste0}\NormalTok{(}\StringTok{"Feature\_"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Feature_1, Feature_2, Feature_3, Feature_4, Feature_5, Feature_6, Feature_7, Feature_8, Feature_9, Feature_10"
\end{verbatim}

\hypertarget{cat-concatenate-and-print}{%
\section{\texorpdfstring{\texttt{cat()}: Concatenate and \textbf{print}}{cat(): Concatenate and print}}\label{cat-concatenate-and-print}}

\texttt{cat()} concatenates strings in order to print to screen (console) or to file. It does not return any value. It is therefore useful to produce informative messages in your programs.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sbp }\OtherTok{\textless{}{-}} \DecValTok{130}
\NormalTok{temp }\OtherTok{\textless{}{-}} \FloatTok{98.4}
\FunctionTok{cat}\NormalTok{(}\StringTok{"The blood pressure was"}\NormalTok{, sbp, }\StringTok{"and the temperature was"}\NormalTok{, temp, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
The blood pressure was 130 and the temperature was 98.4 
\end{verbatim}

\hypertarget{string-formatting}{%
\section{String formatting}\label{string-formatting}}

\hypertarget{change-case-with-toupper-and-tolower}{%
\subsection{\texorpdfstring{Change case with \texttt{toupper()} and \texttt{tolower()}}{Change case with toupper() and tolower()}}\label{change-case-with-toupper-and-tolower}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{features }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"id"}\NormalTok{, }\StringTok{"age"}\NormalTok{, }\StringTok{"sex"}\NormalTok{, }\StringTok{"sbp"}\NormalTok{, }\StringTok{"dbp"}\NormalTok{, }\StringTok{"hct"}\NormalTok{, }\StringTok{"urea"}\NormalTok{, }\StringTok{"creatinine"}\NormalTok{)}
\NormalTok{features}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "id"         "age"        "sex"        "sbp"        "dbp"       
[6] "hct"        "urea"       "creatinine"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{toupper}\NormalTok{(features)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "ID"         "AGE"        "SEX"        "SBP"        "DBP"       
[6] "HCT"        "UREA"       "CREATININE"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tolower}\NormalTok{(features)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "id"         "age"        "sex"        "sbp"        "dbp"       
[6] "hct"        "urea"       "creatinine"
\end{verbatim}

\hypertarget{abbreviate}{%
\subsection{\texorpdfstring{\texttt{abbreviate()}}{abbreviate()}}\label{abbreviate}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Emergency"}\NormalTok{, }\StringTok{"Cardiology"}\NormalTok{, }\StringTok{"Surgery"}\NormalTok{, }\StringTok{"Anesthesia"}\NormalTok{, }\StringTok{"Neurology"}\NormalTok{, }\StringTok{"Psychiatry"}\NormalTok{, }\StringTok{"Clinical Psychology"}\NormalTok{)}
\FunctionTok{abbreviate}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
          Emergency          Cardiology             Surgery          Anesthesia 
             "Emrg"              "Crdl"              "Srgr"              "Anst" 
          Neurology          Psychiatry Clinical Psychology 
             "Nrlg"              "Psyc"              "ClnP" 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{abbreviate}\NormalTok{(x, }\AttributeTok{minlength =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
          Emergency          Cardiology             Surgery          Anesthesia 
              "Emr"               "Crd"               "Srg"               "Ans" 
          Neurology          Psychiatry Clinical Psychology 
              "Nrl"               "Psy"               "ClP" 
\end{verbatim}

\hypertarget{pattern-matching}{%
\section{Pattern matching}\label{pattern-matching}}

A very common task in programming is to find +/- replace string patterns in a vector of strings.\\
\texttt{grep()} and \texttt{grepl()} help find strings that contain a given pattern.\\
\texttt{sub()} and \texttt{gsub()} help find and replace strings.

\hypertarget{grep-get-an-integer-index-of-elements-that-include-a-pattern}{%
\subsection{\texorpdfstring{\texttt{grep()}: Get an integer index of elements that include a pattern}{grep(): Get an integer index of elements that include a pattern}}\label{grep-get-an-integer-index-of-elements-that-include-a-pattern}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"001Age"}\NormalTok{, }\StringTok{"002Sex"}\NormalTok{, }\StringTok{"010Temp"}\NormalTok{, }\StringTok{"014SBP"}\NormalTok{, }\StringTok{"018Hct"}\NormalTok{, }\StringTok{"022PFratio"}\NormalTok{, }\StringTok{"030GCS"}\NormalTok{, }\StringTok{"112SBP{-}DBP"}\NormalTok{)}
\FunctionTok{grep}\NormalTok{(}\AttributeTok{pattern =} \StringTok{"SBP"}\NormalTok{, }\AttributeTok{x =}\NormalTok{ x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4 8
\end{verbatim}

\texttt{grep()}'s \texttt{value} arguments which defaults to \texttt{FALSE}, allows returning the matched string itself (the value of the element) instead of its integer index:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"SBP"}\NormalTok{, x, }\AttributeTok{value =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "014SBP"     "112SBP-DBP"
\end{verbatim}

\hypertarget{grepl-get-a-logical-index-of-elements-that-include-a-pattern}{%
\subsection{\texorpdfstring{\texttt{grepl()}: Get a logical index of elements that include a pattern}{grepl(): Get a logical index of elements that include a pattern}}\label{grepl-get-a-logical-index-of-elements-that-include-a-pattern}}

\texttt{grepl()} is similar to \texttt{grep()}, but returns a logical index instead:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grepl}\NormalTok{(}\StringTok{"SBP"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE
\end{verbatim}

\hypertarget{sub-find-replace-first-match-of-a-pattern}{%
\subsection{\texorpdfstring{\texttt{sub()}: Find replace \textbf{first} match of a pattern}{sub(): Find replace first match of a pattern}}\label{sub-find-replace-first-match-of-a-pattern}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"The most important variable was PF ratio. Other significant variables are listed in the supplementary information."}\NormalTok{)}
\FunctionTok{sub}\NormalTok{(}\AttributeTok{pattern =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{replacement =} \StringTok{"feature"}\NormalTok{, }\AttributeTok{x =}\NormalTok{ x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "The most important feature was PF ratio. Other significant variables are listed in the supplementary information."
\end{verbatim}

``First match'' refers to each element of a character vector:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"var 1, var 2"}\NormalTok{, }\StringTok{"var 3, var 4"}\NormalTok{)}
\FunctionTok{sub}\NormalTok{(}\StringTok{"var"}\NormalTok{, }\StringTok{"feat"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "feat 1, var 2" "feat 3, var 4"
\end{verbatim}

\hypertarget{gsub-find-and-replace-all-matches-of-a-pattern}{%
\subsection{\texorpdfstring{\texttt{gsub()}: Find and replace \textbf{all} matches of a pattern}{gsub(): Find and replace all matches of a pattern}}\label{gsub-find-and-replace-all-matches-of-a-pattern}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"The most important variable was PF ratio. Other significant variables are listed in the supplementary information."}\NormalTok{)}
\FunctionTok{gsub}\NormalTok{(}\AttributeTok{pattern =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{replacement =} \StringTok{"feature"}\NormalTok{, }\AttributeTok{x =}\NormalTok{ x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "The most important feature was PF ratio. Other significant features are listed in the supplementary information."
\end{verbatim}

``All matches'' means all matches across all elements:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"var 1, var 2"}\NormalTok{, }\StringTok{"var 3, var 4"}\NormalTok{)}
\FunctionTok{gsub}\NormalTok{(}\StringTok{"var"}\NormalTok{, }\StringTok{"feat"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "feat 1, feat 2" "feat 3, feat 4"
\end{verbatim}

\hypertarget{regular-expressions}{%
\section{Regular expressions}\label{regular-expressions}}

Regular expressions allow you to perform flexible pattern matching. For example, you can look for a pattern specifically at the beginning or the end of a word, or for a variable pattern with certain characteristics.\\
Regular expressions are very powerful and heavily used. They exist in multiple programming languages - with many similarities and a few differences.\\
There are many rules in defining regular expression. You can read the R manual by typing \texttt{?base::regex}.\\
Here are some of the most important rules:

\hypertarget{match-a-pattern-at-the-beginning-of-a-linestring-with}{%
\subsection{\texorpdfstring{Match a pattern at the beginning of a line/string with \texttt{\^{}}/\texttt{\textbackslash{}\textbackslash{}\textless{}}:}{Match a pattern at the beginning of a line/string with \^{}/\textbackslash\textbackslash\textless:}}\label{match-a-pattern-at-the-beginning-of-a-linestring-with}}

Use the caret sign \texttt{\^{}} in the \textbf{beginning} of a pattern to only match strings that begin with this pattern.\\
pattern \texttt{012} matches both 2nd and 3rd elements:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"001xyz993"}\NormalTok{, }\StringTok{"012qwe764"}\NormalTok{, }\StringTok{"029aqw012"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "001xyz993" "012qwe764" "029aqw012"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"012"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2 3
\end{verbatim}

By adding \texttt{\^{}} or \texttt{\textbackslash{}\textbackslash{}\textless{}}, only the 2nd element matches:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"\^{}012"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\textless{}012"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

\hypertarget{match-a-pattern-at-the-end-of-a-linestring-with}{%
\subsection{\texorpdfstring{Match a pattern at the end of a line/string with \texttt{\$}/\texttt{\textbackslash{}\textbackslash{}\textgreater{}}}{Match a pattern at the end of a line/string with \$/\textbackslash\textbackslash\textgreater{}}}\label{match-a-pattern-at-the-end-of-a-linestring-with}}

The dollar sign \texttt{\$} is used at the \textbf{end} of a pattern to only match strings which end with this pattern:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "001xyz993" "012qwe764" "029aqw012"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"012$"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"012}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\textgreater{}"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"1one"}\NormalTok{, }\StringTok{"2one"}\NormalTok{, }\StringTok{"3two"}\NormalTok{, }\StringTok{"3three"}\NormalTok{)}
\FunctionTok{grep}\NormalTok{(}\StringTok{"one$"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"one}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\textgreater{}"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2
\end{verbatim}

\hypertarget{match-any-character}{%
\subsection{\texorpdfstring{\texttt{.}: Match any character}{.: Match any character}}\label{match-any-character}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"e.X"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"eX"}\NormalTok{, }\StringTok{"enX"}\NormalTok{, }\StringTok{"ennX"}\NormalTok{, }\StringTok{"ennnX"}\NormalTok{, }\StringTok{"ennnnX"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

\hypertarget{match-preceding-character-one-or-more-times}{%
\subsection{\texorpdfstring{\texttt{+}: Match preceding character one or more times:}{+: Match preceding character one or more times:}}\label{match-preceding-character-one-or-more-times}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"en+X"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"eX"}\NormalTok{, }\StringTok{"enX"}\NormalTok{, }\StringTok{"ennX"}\NormalTok{, }\StringTok{"ennnX"}\NormalTok{, }\StringTok{"ennnnX"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2 3 4 5
\end{verbatim}

\hypertarget{n-match-preceding-character-n-times}{%
\subsection{\texorpdfstring{\texttt{\{n\}}: Match preceding character \texttt{n} times:}{\{n\}: Match preceding character n times:}}\label{n-match-preceding-character-n-times}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"en\{2\}X"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"eX"}\NormalTok{, }\StringTok{"enX"}\NormalTok{, }\StringTok{"ennX"}\NormalTok{, }\StringTok{"ennnX"}\NormalTok{, }\StringTok{"ennnnX"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

\hypertarget{n-match-preceding-character-n-or-more-times}{%
\subsection{\texorpdfstring{\texttt{\{n,\}}: Match preceding character \texttt{n} or more times:}{\{n,\}: Match preceding character n or more times:}}\label{n-match-preceding-character-n-or-more-times}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"en\{2,\}X"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"eX"}\NormalTok{, }\StringTok{"enX"}\NormalTok{, }\StringTok{"ennX"}\NormalTok{, }\StringTok{"ennnX"}\NormalTok{, }\StringTok{"ennnnX"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3 4 5
\end{verbatim}

\hypertarget{nm-match-preceding-character-at-least-n-times-and-no-more-than-m-times}{%
\subsection{\texorpdfstring{\texttt{\{n,m\}}: Match preceding character at least \texttt{n} times and no more than \texttt{m} times:}{\{n,m\}: Match preceding character at least n times and no more than m times:}}\label{nm-match-preceding-character-at-least-n-times-and-no-more-than-m-times}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grep}\NormalTok{(}\StringTok{"en\{2,3\}X"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"eX"}\NormalTok{, }\StringTok{"enX"}\NormalTok{, }\StringTok{"ennX"}\NormalTok{, }\StringTok{"ennnX"}\NormalTok{, }\StringTok{"ennnnX"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3 4
\end{verbatim}

\hypertarget{escaping-metacharacters}{%
\subsection{Escaping metacharacters}\label{escaping-metacharacters}}

The following are defined as metacharacters, because they have special meaning within a regular expression: \texttt{.\ \textbackslash{}\ \textbar{}\ (\ )\ {[}\ \{\ \^{}\ \$\ *\ +\ ?}.\\
If you want to match one of these characters itself, you must ``escape'' it using a double backslash:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"dn3ONE"}\NormalTok{, }\StringTok{"d.3TWO"}\NormalTok{, }\StringTok{"dx3FIVE"}\NormalTok{)}
\FunctionTok{grep}\NormalTok{(}\StringTok{"d}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.3"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

\hypertarget{match-a-character-class}{%
\subsection{Match a character class}\label{match-a-character-class}}

You can use brackets, \texttt{{[}\ {]}} to define sets of characters to match in any order, if present.\\
Here we want to replace \texttt{\$} and \texttt{@} with an underscore:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Feat1$alpha"}\NormalTok{, }\StringTok{"Feat2$gamma"}\NormalTok{, }\StringTok{"Feat9@field2"}\NormalTok{)}
\FunctionTok{gsub}\NormalTok{(}\StringTok{"[$@]"}\NormalTok{, }\StringTok{"\_"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Feat1_alpha"  "Feat2_gamma"  "Feat9_field2"
\end{verbatim}

A number of character classes are predefined. They are themselves surrounded by brackets - to use them as a character class, you need a seconds set of brackets around them. Some of the most common ones include:

\begin{itemize}
\tightlist
\item
  \texttt{{[}:alnum:{]}}: alphanumeric, i.e.~all letters and numbers
\item
  \texttt{{[}:alpha:{]}}: all letters
\item
  \texttt{{[}:digit:{]}}: all numbers
\item
  \texttt{{[}:lower:{]}}: all lowercase letters
\item
  \texttt{{[}:upper:{]}}: all uppercase letters
\item
  \texttt{{[}:punct:{]}}: all punctuation characters (! " \# \$ \% \& ' ( ) * + , - . / : ; \textless{} = \textgreater{} ? @ {[} ~{]} \^{} \_ ` \{ \textbar{} \} \textasciitilde.)
\item
  \texttt{{[}:blank:{]}}: all spaces and tabs
\item
  \texttt{{[}:space:{]}}: all spaces, tabs, newline characters, and some more
\end{itemize}

Let's look at some examples.\\
Here we us \texttt{{[}:digit:{]}} to remove all numbers:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"001Emergency"}\NormalTok{, }\StringTok{"010Cardiology"}\NormalTok{, }\StringTok{"018Neurology"}\NormalTok{, }\StringTok{"020Anesthesia"}\NormalTok{, }
       \StringTok{"021Surgery"}\NormalTok{, }\StringTok{"051Psychiatry"}\NormalTok{)}
\FunctionTok{gsub}\NormalTok{(}\StringTok{"[[:digit:]]"}\NormalTok{, }\StringTok{""}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Emergency"  "Cardiology" "Neurology"  "Anesthesia" "Surgery"   
[6] "Psychiatry"
\end{verbatim}

We can use \texttt{{[}:alpha:{]}} to remove all letters:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{gsub}\NormalTok{(}\StringTok{"[[:alpha:]]"}\NormalTok{, }\StringTok{""}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "001" "010" "018" "020" "021" "051"
\end{verbatim}

We can use a caret \texttt{\^{}} in the beginning of a character class to match any character \emph{not} in the character set:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"001$Emergency"}\NormalTok{, }\StringTok{"010@Cardiology"}\NormalTok{, }\StringTok{"018*Neurology"}\NormalTok{, }\StringTok{"020!Anesthesia"}\NormalTok{, }
       \StringTok{"021!Surgery"}\NormalTok{, }\StringTok{"051*Psychiatry"}\NormalTok{)}
\FunctionTok{gsub}\NormalTok{(}\StringTok{"[\^{}[:alnum:]]"}\NormalTok{, }\StringTok{"\_"}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "001_Emergency"  "010_Cardiology" "018_Neurology"  "020_Anesthesia"
[5] "021_Surgery"    "051_Psychiatry"
\end{verbatim}

\hypertarget{combine-character-classes}{%
\subsection{Combine character classes}\label{combine-character-classes}}

Use \texttt{\textbar{}} to match from multiple character classes:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"123\#$\%alphaBeta"}\NormalTok{)}
\FunctionTok{gsub}\NormalTok{(}\StringTok{"[[:digit:]|[:punct:]]"}\NormalTok{, }\StringTok{""}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "alphaBeta"
\end{verbatim}

\begin{rmdinfo}
For more information on regular expressions, start by reading the
built-in documentation: \texttt{?regex}
\end{rmdinfo}

\hypertarget{datetime}{%
\chapter{Date and Time}\label{datetime}}

R includes builtin support for working with date +/- time data. A number of external packages further extend this support.

There are three builtin classes:

\begin{itemize}
\tightlist
\item
  \texttt{Date}: Represents \textbf{date} information (not time)
\item
  \texttt{POSIXct}: Represents \textbf{date and time} information as the signed number of seconds since January 1, 1970 (\href{https://en.wikipedia.org/wiki/Unix_time}{Unix Time a.k.a. POSIX time a.k.a. Epoch time})
\item
  \texttt{POSIXlt}: Represents \textbf{date and time} information as a named list (See \texttt{base::DateTimeClasses})
\end{itemize}

Background info: \href{https://en.wikipedia.org/wiki/POSIX}{Portable Operating System Interface (POSIX)} is a set of standards for maintaining compatibility among operating systems.

\hypertarget{date-objects}{%
\section{Date objects}\label{date-objects}}

\hypertarget{character-to-date-as.date}{%
\subsection{\texorpdfstring{Character to Date: \texttt{as.Date()}}{Character to Date: as.Date()}}\label{character-to-date-as.date}}

You can create a \texttt{Date} object from a string:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"1981{-}02{-}12"}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "1981-02-12"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Date"
\end{verbatim}

The \texttt{tryFormats} argument defines which formats are recognized.

The default is \texttt{tryFormats\ =\ c("\%Y-\%m-\%d",\ "\%Y/\%m/\%d")}, i.e.~a date of the form ``2020-11-16'' or ``2020/11/16''

\hypertarget{get-current-date-time}{%
\subsection{Get current date \& time}\label{get-current-date-time}}

Get current data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{today }\OtherTok{\textless{}{-}} \FunctionTok{Sys.Date}\NormalTok{()}
\NormalTok{today}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-12-05"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(today)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Date"
\end{verbatim}

Get current date and time:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{now }\OtherTok{\textless{}{-}} \FunctionTok{Sys.time}\NormalTok{()}
\NormalTok{now}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-12-05 12:27:40 PST"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(now)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "POSIXct" "POSIXt" 
\end{verbatim}

Get local timezone:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{Sys.timezone}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "America/Los_Angeles"
\end{verbatim}

\hypertarget{math-on-dates}{%
\subsection{Math on Dates}\label{math-on-dates}}

The reason we care about Date objects in R is because we can apply useful mathematical operations on them.

For example, we can substract date objects to get time intervals:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{start\_date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}09{-}15"}\NormalTok{)}
\NormalTok{time\_diff }\OtherTok{\textless{}{-}} \FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ start\_date}
\NormalTok{time\_diff}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Time difference of 81 days
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(time\_diff)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "difftime"
\end{verbatim}

Note: While you can use the subtraction operator \texttt{-}, it is advised you use the \texttt{difftime()} function to perform subtraction on dates instead, because it allows you to specify units:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{timepoint1 }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}01{-}07"}\NormalTok{)}
\NormalTok{timepoint2 }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}02{-}03"}\NormalTok{)}
\FunctionTok{difftime}\NormalTok{(timepoint2, timepoint1, }\AttributeTok{units =} \StringTok{"weeks"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Time difference of 3.857143 weeks
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{difftime}\NormalTok{(timepoint2, timepoint1, }\AttributeTok{units =} \StringTok{"days"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Time difference of 27 days
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{difftime}\NormalTok{(timepoint2, timepoint1, }\AttributeTok{units =} \StringTok{"hours"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Time difference of 648 hours
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{difftime}\NormalTok{(timepoint2, timepoint1, }\AttributeTok{units =} \StringTok{"mins"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Time difference of 38880 mins
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{difftime}\NormalTok{(timepoint2, timepoint1, }\AttributeTok{units =} \StringTok{"secs"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Time difference of 2332800 secs
\end{verbatim}

\begin{warning}
Why is there no option for ``months'' or ``years'' in units?

Think about it.

Because, unlike seconds, minutes, hours, days, and weeks, months and
years do not have fixed length, i.e.~literally a month or a year are not
``units'' of time.

You can always get a difference in days and divide by 365 (or
\href{https://www.nist.gov/pml/time-and-frequency-division/popular-links/time-frequency-z/time-and-frequency-z-l}{365.242}.
\end{warning}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DOB }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"1969{-}08{-}04"}\NormalTok{)}
\NormalTok{Age }\OtherTok{\textless{}{-}} \FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ DOB}
\NormalTok{Age}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Time difference of 18751 days
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Age today is"}\NormalTok{, }\FunctionTok{round}\NormalTok{(Age}\SpecialCharTok{/}\DecValTok{365}\NormalTok{), }\StringTok{"years"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Age today is 51 years
\end{verbatim}

\hypertarget{meanmedian-date}{%
\subsection{mean/median Date}\label{meanmedian-date}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{5480}\NormalTok{, }\DecValTok{5723}\NormalTok{, }\DecValTok{5987}\NormalTok{, }\DecValTok{6992}\NormalTok{), }\AttributeTok{origin =} \StringTok{"1970{-}01{-}01"}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "1985-01-02" "1985-09-02" "1986-05-24" "1989-02-22"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "1986-07-21"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{median}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "1986-01-12"
\end{verbatim}

To check the median, we can do a mathematical operation using mmultiplication subtraction and addition, and the result is still a Date(!):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ .}\DecValTok{5} \SpecialCharTok{*}\NormalTok{ (x[}\DecValTok{3}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ x[}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "1986-01-12"
\end{verbatim}

\hypertarget{sequence-of-dates}{%
\subsection{Sequence of dates}\label{sequence-of-dates}}

You can create a sequence of dates using \texttt{seq()}.\\
If an integer is passed to \texttt{by}, the unit is assumed to be days:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{start\_date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}09{-}14"}\NormalTok{)}
\NormalTok{end\_date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}12{-}07"}\NormalTok{)}
\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =}\NormalTok{ start\_date, }\AttributeTok{to =}\NormalTok{ end\_date, }\AttributeTok{by =} \DecValTok{7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "2020-09-14" "2020-09-21" "2020-09-28" "2020-10-05" "2020-10-12"
 [6] "2020-10-19" "2020-10-26" "2020-11-02" "2020-11-09" "2020-11-16"
[11] "2020-11-23" "2020-11-30" "2020-12-07"
\end{verbatim}

Unlike mathematical operations like \texttt{difftime()} which require strict units of time, \texttt{seq()} can work with months and years.

\texttt{by} can be one of:

``day,'' ``week,'' ``month,'' ``quarter,'' ``year.''

The above is therefore equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =}\NormalTok{ start\_date, }\AttributeTok{to =}\NormalTok{ end\_date, }\AttributeTok{by =} \StringTok{"week"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "2020-09-14" "2020-09-21" "2020-09-28" "2020-10-05" "2020-10-12"
 [6] "2020-10-19" "2020-10-26" "2020-11-02" "2020-11-09" "2020-11-16"
[11] "2020-11-23" "2020-11-30" "2020-12-07"
\end{verbatim}

As with numeric sequences, you can also define the \texttt{length.out} argument:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{start\_date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}01{-}20"}\NormalTok{)}
\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =}\NormalTok{ start\_date, }\AttributeTok{by =} \StringTok{"year"}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-01-20" "2021-01-20" "2022-01-20" "2023-01-20"
\end{verbatim}

An integer can be provided as part of character input to \texttt{by}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{start\_date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}01{-}20"}\NormalTok{)}
\NormalTok{end\_date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2021{-}01{-}20"}\NormalTok{)}
\FunctionTok{seq}\NormalTok{(start\_date, end\_date, }\AttributeTok{by =} \StringTok{"2 months"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-01-20" "2020-03-20" "2020-05-20" "2020-07-20" "2020-09-20"
[6] "2020-11-20" "2021-01-20"
\end{verbatim}

\hypertarget{date-time-objects}{%
\section{Date-Time objects}\label{date-time-objects}}

\hypertarget{character-to-date-time-as.posixct-as.posixlt-strptime}{%
\subsection{\texorpdfstring{Character to Date-Time: \texttt{as.POSIXct()}, \texttt{as.POSIXlt()}, \texttt{strptime()}:}{Character to Date-Time: as.POSIXct(), as.POSIXlt(), strptime():}}\label{character-to-date-time-as.posixct-as.posixlt-strptime}}

(As always, it can be very informative to look at the source code. Many of these functions call eachother internally)

Read \texttt{strptime()}'s documentation for conversion specifications. These define the order and format of characters to be read as year, month, day, hour, minute, and second information.

For example, the ISO 8601 international standard is defined as:\\
\texttt{"\%Y-\%m-\%d\ \%H:\%M:\%S"}

\begin{itemize}
\tightlist
\item
  \textbf{\texttt{\%Y}}: Year with century, (0-9999 accepted) e.g.~\texttt{2020}
\item
  \textbf{\texttt{\%m}}: Month, 01-12, e.g.~\texttt{03}
\item
  \textbf{\texttt{\%d}}: Day, 01-31, e.g.~\texttt{04}
\item
  \textbf{\texttt{\%H}}: Hours, 00-23, e.g.~\texttt{13}
\item
  \textbf{\texttt{\%M}}: Minutes, 00-59, e.g.~\texttt{38}
\item
  \textbf{\texttt{\%S}}: Seconds, 00-61 (!) allowing for up to two leap seconds, e.g.~\texttt{54}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt }\OtherTok{\textless{}{-}} \StringTok{"2020{-}03{-}04 13:38:54"}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-03-04 13:38:54"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(dt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

Use \texttt{attributres()} to see the difference between the \texttt{POSIXct} and \texttt{POSIXlt} classes:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_posixct }\OtherTok{\textless{}{-}} \FunctionTok{as.POSIXct}\NormalTok{(dt)}
\NormalTok{dt\_posixct}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-03-04 13:38:54 PST"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(dt\_posixct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "POSIXct" "POSIXt" 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(dt\_posixct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 POSIXct[1:1], format: "2020-03-04 13:38:54"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attributes}\NormalTok{(dt\_posixct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$class
[1] "POSIXct" "POSIXt" 

$tzone
[1] ""
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_posixlt }\OtherTok{\textless{}{-}} \FunctionTok{as.POSIXlt}\NormalTok{(dt)}
\NormalTok{dt\_posixlt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-03-04 13:38:54 PST"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(dt\_posixlt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "POSIXlt" "POSIXt" 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(dt\_posixlt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 POSIXlt[1:1], format: "2020-03-04 13:38:54"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_posixlt}\SpecialCharTok{$}\NormalTok{year}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 120
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attributes}\NormalTok{(dt\_posixlt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$names
 [1] "sec"    "min"    "hour"   "mday"   "mon"    "year"   "wday"   "yday"  
 [9] "isdst"  "zone"   "gmtoff"

$class
[1] "POSIXlt" "POSIXt" 
\end{verbatim}

You can compose a really large number of combination formats to match your data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"03.04.20 01:38.54 pm"}\NormalTok{)}
\NormalTok{dt2\_posix }\OtherTok{\textless{}{-}} \FunctionTok{as.POSIXct}\NormalTok{(dt2, }\AttributeTok{format =} \StringTok{"\%m.\%d.\%y \%I:\%M.\%S \%p"}\NormalTok{)}
\NormalTok{dt2\_posix}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-03-04 13:38:54 PST"
\end{verbatim}

\hypertarget{format-dates}{%
\section{\texorpdfstring{\texttt{format()} Dates}{format() Dates}}\label{format-dates}}

\texttt{format()} operates on Date and POSIX objects to convert between representations

Define Date in US format:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_us }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"07{-}04{-}2020"}\NormalTok{, }\AttributeTok{format =} \StringTok{"\%m{-}\%d{-}\%Y"}\NormalTok{)}
\NormalTok{dt\_us}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-07-04"
\end{verbatim}

Convert to European format:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_eu }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(dt\_us, }\StringTok{"\%d.\%m.\%y"}\NormalTok{)}
\NormalTok{dt\_eu}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "04.07.20"
\end{verbatim}

\hypertarget{extract-partial-date-information}{%
\section{Extract partial date information}\label{extract-partial-date-information}}

\begin{itemize}
\tightlist
\item
  \textbf{weekdays()}: Get name of day of the week
\item
  \textbf{months()}: Get name of month
\item
  \textbf{quarters()}: Get quarter
\item
  \textbf{julia()}: Get number of days since a specific origin
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{18266}\NormalTok{, }\DecValTok{18299}\NormalTok{, }\DecValTok{18359}\NormalTok{, }\DecValTok{18465}\NormalTok{), }\AttributeTok{origin =} \StringTok{"1970{-}01{-}01"}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-01-05" "2020-02-07" "2020-04-07" "2020-07-22"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{weekdays}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Sunday"    "Friday"    "Tuesday"   "Wednesday"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{months}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "January"  "February" "April"    "July"    
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{quarters}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Q1" "Q1" "Q2" "Q3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{julian}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 18266 18299 18359 18465
attr(,"origin")
[1] "1970-01-01"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{julian}\NormalTok{(x, }\AttributeTok{origin =} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}01{-}01"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]   4  37  97 203
attr(,"origin")
[1] "2020-01-01"
\end{verbatim}

\hypertarget{handling-dates-with-lubridate}{%
\section{\texorpdfstring{Handling dates with \textbf{lubridate}}{Handling dates with lubridate}}\label{handling-dates-with-lubridate}}

Instead of defining Date and/or time formats using POSIX standard abbreviations, we can let the \href{https://lubridate.tidyverse.org/}{\textbf{lubridate}} package do some guesswork for us, which works well most of the time.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lubridate)}
\NormalTok{dt }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"2020{-}03{-}04 13:38:54"}\NormalTok{)}
\NormalTok{dt\_posix }\OtherTok{\textless{}{-}} \FunctionTok{as\_datetime}\NormalTok{(dt)}
\NormalTok{dt\_posix}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-03-04 13:38:54 UTC"
\end{verbatim}

Note that timezone defaults to UTC (\href{https://en.wikipedia.org/wiki/Coordinated_Universal_Time}{Coordinated Universal Time}) and must be set manually. PST is defined with ``America/Los\_Angeles'' or the (officially deprecated) ``US/Pacific'' (\href{https://en.wikipedia.org/wiki/List_of_tz_database_time_zones}{tz database})

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_posix }\OtherTok{\textless{}{-}} \FunctionTok{as\_datetime}\NormalTok{(dt, }\AttributeTok{tz =} \StringTok{"America/Los\_Angeles"}\NormalTok{)}
\NormalTok{dt\_posix}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-03-04 13:38:54 PST"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt2\_posix }\OtherTok{\textless{}{-}} \FunctionTok{as\_datetime}\NormalTok{(dt2)}
\NormalTok{dt2\_posix}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2003-04-20 13:38:54 UTC"
\end{verbatim}

\texttt{dt2} got misinterpreted as year-month-day.\\
For these cases, \textbf{lubridate} includes a number of convenient functions to narrow down the guessing. The functions are named using all permutations of \texttt{y}, \texttt{m}, and \texttt{d}. The letter order signifies the order the information appears in the character you are trying to import, i.e.~\texttt{ymd}, \texttt{dmy}, \texttt{mdy}, \texttt{ydm}, \texttt{myd}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"03.04.20 01:38.54 pm"}\NormalTok{)}
\NormalTok{dt2\_posix }\OtherTok{\textless{}{-}} \FunctionTok{mdy\_hms}\NormalTok{(dt2, }\AttributeTok{tz =} \StringTok{"America/Los\_Angeles"}\NormalTok{)}
\NormalTok{dt2\_posix}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2020-03-04 13:38:54 PST"
\end{verbatim}

\hypertarget{missingdata}{%
\chapter{Handling Missing data}\label{missingdata}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rtemis)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

Missing data is a very common issue in statistics and data science.

Data may be missing for a variety of reasons. We often characterize the type of missingness using the following three types(\protect\hyperlink{ref-mack2018managing}{Mack, Su, and Westreich 2018}):

\begin{itemize}
\tightlist
\item
  \textbf{Missing completely at random (MCAR)}:
  ``The fact that the data are missing is independent of the observed and unobserved data''
\item
  \textbf{Missing at random (MAR)}:
  ``The fact that the data are missing is systematically related to the observed but not the unobserved data''
\item
  \textbf{Missing not at random (MNAR)}:
  ``The fact that the data are missing is systematically related to the unobserved data''
\end{itemize}

\hypertarget{check-for-missing-data}{%
\section{Check for missing data}\label{check-for-missing-data}}

You can use your favorite base commands to check for missing data, by row, by column, total, etc.

Let's load the \texttt{PimaIndiansDiabetes2} dataset from package \textbf{mlbench} and make a copy of it to variable \texttt{dat}. Remember to check the class of a new object you didn't create yourself with \texttt{class()}, check its dimensions, if applicable, with \texttt{dim()}, and a get a summary of its structure including data types with \texttt{str()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\StringTok{"PimaIndiansDiabetes2"}\NormalTok{, }\AttributeTok{package =} \StringTok{"mlbench"}\NormalTok{)}
\NormalTok{dat }\OtherTok{\textless{}{-}}\NormalTok{ PimaIndiansDiabetes2}
\FunctionTok{class}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 768   9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
'data.frame':   768 obs. of  9 variables:
 $ pregnant: num  6 1 8 1 0 5 3 10 2 8 ...
 $ glucose : num  148 85 183 89 137 116 78 115 197 125 ...
 $ pressure: num  72 66 64 66 40 74 50 NA 70 96 ...
 $ triceps : num  35 29 NA 23 35 NA 32 NA 45 NA ...
 $ insulin : num  NA NA NA 94 168 NA 88 NA 543 NA ...
 $ mass    : num  33.6 26.6 23.3 28.1 43.1 25.6 31 35.3 30.5 NA ...
 $ pedigree: num  0.627 0.351 0.672 0.167 2.288 ...
 $ age     : num  50 31 32 21 33 30 26 29 53 54 ...
 $ diabetes: Factor w/ 2 levels "neg","pos": 2 1 2 1 2 1 2 1 2 2 ...
\end{verbatim}

Check if there are any missing values anywhere in the data.frame with \texttt{anyNA()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anyNA}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

The above suggests there is at least one \texttt{NA} value in the dataset.

We can create a logical index of NA values using \texttt{is.na()}. This will be the same dimensions as the dataset. We print its first few lines with \texttt{head()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{na\_index }\OtherTok{\textless{}{-}} \FunctionTok{is.na}\NormalTok{(dat)}
\FunctionTok{dim}\NormalTok{(na\_index)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 768   9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(na\_index)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  pregnant glucose pressure triceps insulin  mass pedigree   age diabetes
1    FALSE   FALSE    FALSE   FALSE    TRUE FALSE    FALSE FALSE    FALSE
2    FALSE   FALSE    FALSE   FALSE    TRUE FALSE    FALSE FALSE    FALSE
3    FALSE   FALSE    FALSE    TRUE    TRUE FALSE    FALSE FALSE    FALSE
4    FALSE   FALSE    FALSE   FALSE   FALSE FALSE    FALSE FALSE    FALSE
5    FALSE   FALSE    FALSE   FALSE   FALSE FALSE    FALSE FALSE    FALSE
6    FALSE   FALSE    FALSE    TRUE    TRUE FALSE    FALSE FALSE    FALSE
\end{verbatim}

One way to count missing values is with \texttt{sum(is.na())}. Remember that a logical array is coerced to an integer array for mathematical operations, where \texttt{TRUE} becomes 1 and \texttt{FALSE} becomes 0. Therefore, calling \texttt{sum()} on a logical index counts the number of \texttt{TRUE} elements (and since we are applying it on the index of \texttt{NA} values, it counts the number of elements with missing values):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(dat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 652
\end{verbatim}

There are 652 \texttt{NA} values in total in the data.frame.

Let's count the number of missing values per feature (i.e.~column) using \texttt{sapply()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sapply}\NormalTok{(dat, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(i)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
pregnant  glucose pressure  triceps  insulin     mass pedigree      age 
       0        5       35      227      374       11        0        0 
diabetes 
       0 
\end{verbatim}

The features \texttt{insulin} and \texttt{triceps} have the most NA values.

Let's count the number of missing values per case (i.e.~row):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(dat), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(dat[i, ])))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  [1] 1 1 2 0 0 2 0 3 0 3 2 2 2 0 0 3 0 2 0 0 0 2 2 1 0 0 2 0 0 2 1 0 0 2 1 0 2
 [38] 1 1 0 0 2 1 0 2 1 2 1 1 4 0 0 0 0 0 1 0 0 2 0 4 2 2 0 2 1 1 2 0 0 0 0 2 0
 [75] 1 2 2 1 3 1 1 4 0 1 2 0 1 0 0 1 2 0 0 2 0 0 1 0 0 0 2 2 2 0 2 0 2 0 0 0 0
[112] 0 0 2 0 2 2 2 1 0 0 1 0 2 2 0 0 0 0 2 0 2 0 1 0 0 0 0 2 0 2 1 0 2 0 2 1 0
[149] 2 1 0 2 0 0 2 1 0 0 0 0 1 0 0 1 2 0 1 2 2 0 2 0 2 0 0 0 2 0 2 2 2 0 1 2 2
[186] 1 0 0 0 0 2 0 2 3 1 0 2 0 0 0 1 2 1 0 0 1 0 2 0 1 1 1 1 0 0 0 0 0 1 2 0 2
[223] 3 0 0 0 2 1 0 0 2 0 0 2 0 2 0 1 1 2 1 0 2 0 0 1 2 0 0 1 2 2 0 1 0 1 1 1 0
[260] 0 0 3 1 1 2 0 3 1 2 3 1 0 2 0 2 0 1 0 2 0 2 0 0 2 2 0 0 0 0 0 0 0 0 0 2 0
[297] 0 0 0 2 3 0 0 2 2 0 0 0 0 0 1 0 0 0 1 0 0 2 0 2 0 1 1 0 1 0 0 2 0 0 1 0 3
[334] 2 0 0 3 2 0 2 0 0 2 2 2 0 0 3 0 2 2 2 1 0 2 2 0 2 0 0 0 2 1 2 0 0 2 1 0 0
[371] 0 1 0 0 0 0 0 0 2 0 0 1 0 0 0 0 1 1 0 0 0 2 0 0 2 0 0 1 2 1 2 2 0 1 2 0 2
[408] 2 2 0 1 0 0 0 0 0 1 1 2 0 0 0 0 1 0 0 4 0 0 0 3 0 0 2 1 3 1 2 1 2 1 0 0 2
[445] 1 0 0 0 0 0 0 2 0 3 0 1 2 0 0 0 0 2 0 1 2 0 0 0 3 0 1 1 1 2 2 1 0 0 0 1 0
[482] 1 0 0 3 0 0 0 1 2 0 1 1 0 4 2 2 0 0 0 0 1 2 0 1 2 0 0 0 2 1 0 2 2 0 0 0 2
[519] 2 0 0 0 4 2 2 1 0 0 0 2 0 2 0 3 0 3 2 2 0 0 0 0 1 0 0 0 0 0 0 1 1 0 2 0 0
[556] 0 1 2 1 2 2 0 0 0 2 0 0 0 0 0 2 2 0 0 0 0 0 2 2 1 1 1 1 2 0 1 2 2 0 3 1 0
[593] 2 0 0 0 2 0 2 0 1 3 1 0 3 1 0 0 0 0 0 0 0 1 0 2 2 0 1 3 0 1 2 0 2 0 2 2 2
[630] 1 2 0 2 0 2 2 2 0 0 0 0 2 2 3 0 0 0 0 0 1 0 0 0 2 0 0 0 0 2 0 2 1 0 0 1 0
[667] 1 1 0 0 0 1 0 0 2 2 2 2 2 0 0 1 0 2 3 0 2 1 0 0 2 2 0 0 2 0 0 3 0 2 0 1 1
[704] 3 0 1 4 0 2 0 0 0 1 0 2 0 0 1 0 1 1 0 0 0 2 1 0 1 2 2 0 2 0 0 2 1 0 1 0 2
[741] 0 0 0 2 0 0 1 0 0 2 2 0 1 0 1 0 1 2 2 2 0 1 2 0 1 0 2 1
\end{verbatim}

If we wanted to get the row with the most missing values, we can use \texttt{which.max()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{which.max}\NormalTok{(}\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(dat), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(dat[i, ]))))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(dat[}\DecValTok{50}\NormalTok{, ]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4
\end{verbatim}

Row 50 has 4 missing values.

\hypertarget{visualize}{%
\subsection{Visualize}\label{visualize}}

It may be helpful to visualize missing data to get a quick impression of missingness. With \textbf{rtemis}, you can use \texttt{mplot.missing()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rtemis)}
\FunctionTok{mplot.missing}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\includegraphics{76-MissingData_files/figure-latex/unnamed-chunk-12-1.pdf}

Missing data is shown in magenta by default. The row below the image shows total \texttt{NA} values per column

\hypertarget{summarize-1}{%
\subsection{Summarize}\label{summarize-1}}

Get N of missing per column:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sapply}\NormalTok{(dat, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(i)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
pregnant  glucose pressure  triceps  insulin     mass pedigree      age 
       0        5       35      227      374       11        0        0 
diabetes 
       0 
\end{verbatim}

\texttt{rtemis::checkData()} includes information on missing data:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{checkData}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\hypertarget{handle-missing-data}{%
\section{Handle missing data}\label{handle-missing-data}}

Different approaches can be used to handle missing data:

\begin{itemize}
\tightlist
\item
  Do nothing! - if your algorithm(s) can handle missing data (decision trees!)
\item
  \textbf{Exclude} data: Use complete cases only
\item
  \textbf{Fill in} (make up) data: Replace or Impute

  \begin{itemize}
  \tightlist
  \item
    Replace with median/mean
  \item
    Predict missing from present

    \begin{itemize}
    \tightlist
    \item
      Single imputation
    \item
      Multiple imputation
    \end{itemize}
  \end{itemize}
\end{itemize}

\hypertarget{do-nothing}{%
\subsection{Do nothing}\label{do-nothing}}

Algorithms like decision trees and ensemble methods that use decision trees like random forest and gradient boosting can handle missing data, depending on the particular implementation. For example, \texttt{rpart::rpart()} which is used by \texttt{rtemis::s.CART()} has no trouble with missing data in the predictors:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat.cart }\OtherTok{\textless{}{-}} \FunctionTok{s.CART}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\includegraphics{76-MissingData_files/figure-latex/unnamed-chunk-15-1.pdf}

\hypertarget{use-complete-cases-only}{%
\subsection{Use complete cases only}\label{use-complete-cases-only}}

R's builtin \texttt{complete.cases()} function returns, as the name suggests, a logical index of cases (i.e.~rows) that have no missing values, i.e.~are complete.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 768   9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{index\_cc }\OtherTok{\textless{}{-}} \FunctionTok{complete.cases}\NormalTok{(dat)}
\FunctionTok{class}\NormalTok{(index\_cc)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "logical"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(index\_cc)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 768
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(index\_cc)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE FALSE FALSE  TRUE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_cc }\OtherTok{\textless{}{-}}\NormalTok{ dat[index\_cc, ]}
\FunctionTok{dim}\NormalTok{(dat\_cc)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 392   9
\end{verbatim}

We lost 376 cases in the above example. That's quite a few, so, for this dataset, we probably want to look at options that do not exclude cases.

\hypertarget{replace-with-a-fixed-value}{%
\subsection{Replace with a fixed value}\label{replace-with-a-fixed-value}}

We can manually replace missing values with the mean or median in the case of a continuous variable, or with the mode in the case of a categorical feature.\\
For example, to replace the first feature's missing values with the mean:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pressure\_mean }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{pressure, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{dat\_im }\OtherTok{\textless{}{-}}\NormalTok{ dat}
\NormalTok{dat\_im}\SpecialCharTok{$}\NormalTok{pressure[}\FunctionTok{is.na}\NormalTok{(dat\_im}\SpecialCharTok{$}\NormalTok{pressure)] }\OtherTok{\textless{}{-}}\NormalTok{ pressure\_mean}
\end{Highlighting}
\end{Shaded}

\texttt{rtemis::preprocess()} can replace missing values with mean (for numeric features) and the mode (for factors) for all columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_pre }\OtherTok{\textless{}{-}} \FunctionTok{preprocess}\NormalTok{(dat, }\AttributeTok{impute =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{impute.type =} \StringTok{"meanMode"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Verify there are no missing data by rerunning \texttt{checkData()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{checkData}\NormalTok{(dat\_pre)}
\end{Highlighting}
\end{Shaded}

You may want to include a ``missingness'' column that indicates which cases were imputed to include in your model. You can create this simply by running:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pressure\_missing }\OtherTok{=} \FunctionTok{factor}\NormalTok{(}\FunctionTok{as.integer}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{pressure)))}
\end{Highlighting}
\end{Shaded}

\texttt{preprocess()} includes the option \texttt{missingness} to add corresponding indicator columns after imputation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_pre }\OtherTok{\textless{}{-}} \FunctionTok{preprocess}\NormalTok{(dat, }\AttributeTok{impute =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{impute.type =} \StringTok{"meanMode"}\NormalTok{,}
                      \AttributeTok{missingness =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(dat\_pre)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  pregnant glucose pressure  triceps  insulin mass pedigree age diabetes
1        6     148       72 35.00000 155.5482 33.6    0.627  50      pos
2        1      85       66 29.00000 155.5482 26.6    0.351  31      neg
3        8     183       64 29.15342 155.5482 23.3    0.672  32      pos
4        1      89       66 23.00000  94.0000 28.1    0.167  21      neg
5        0     137       40 35.00000 168.0000 43.1    2.288  33      pos
6        5     116       74 29.15342 155.5482 25.6    0.201  30      neg
  glucose_missing pressure_missing triceps_missing insulin_missing mass_missing
1               0                0               0               1            0
2               0                0               0               1            0
3               0                0               1               1            0
4               0                0               0               0            0
5               0                0               0               0            0
6               0                0               1               1            0
\end{verbatim}

\hypertarget{add-new-level-missing}{%
\subsubsection{Add new level ``missing''}\label{add-new-level-missing}}

One option to handle missing data in categorical variables, is to introduce a new level of ``missing'' to the factor, instead of replacing with the mode, for example. If we bin a continuous variable to convert to categorical, the same can then also be applied.

Since no factors have missing values in the current dataset we create a copy and replace some data with \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat2 }\OtherTok{\textless{}{-}}\NormalTok{ dat}
\NormalTok{dat2}\SpecialCharTok{$}\NormalTok{diabetes[}\FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{NROW}\NormalTok{(dat2), }\DecValTok{35}\NormalTok{)] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(dat2}\SpecialCharTok{$}\NormalTok{diabetes))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 35
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(dat2}\SpecialCharTok{$}\NormalTok{diabetes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "neg" "pos"
\end{verbatim}

Replace \texttt{NA} values with new level \texttt{missing}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_pre2 }\OtherTok{\textless{}{-}} \FunctionTok{preprocess}\NormalTok{(dat2, }\AttributeTok{factorNA2missing =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anyNA}\NormalTok{(dat\_pre2}\SpecialCharTok{$}\NormalTok{diabetes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(dat\_pre2}\SpecialCharTok{$}\NormalTok{diabetes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "neg"     "pos"     "missing"
\end{verbatim}

\hypertarget{last-observation-carried-forward-locf}{%
\subsection{Last observation carried forward (LOCF)}\label{last-observation-carried-forward-locf}}

In longitudinal / timeseries data, we may want to replace missing values with the last observed value. This is called last observation carried forward (LOCF). As always, whether this procedure is appropriate depend the reasons for missingness. The \texttt{zoo} and \texttt{DescTool} packages provide commands to perform LOCF.

Some simulated data. We are missing blood pressure measurements on Saturdays and Sundays:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Day =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Mon"}\NormalTok{, }\StringTok{"Tues"}\NormalTok{, }\StringTok{"Wed"}\NormalTok{, }\StringTok{"Thu"}\NormalTok{, }\StringTok{"Fri"}\NormalTok{, }\StringTok{"Sat"}\NormalTok{, }\StringTok{"Sun"}\NormalTok{), }\DecValTok{3}\NormalTok{),}
                  \AttributeTok{SBP =} \FunctionTok{sample}\NormalTok{(}\DecValTok{105}\SpecialCharTok{:}\DecValTok{125}\NormalTok{, }\DecValTok{21}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{))}
\NormalTok{dat}\SpecialCharTok{$}\NormalTok{SBP[dat}\SpecialCharTok{$}\NormalTok{Day }\SpecialCharTok{==} \StringTok{"Sat"} \SpecialCharTok{|}\NormalTok{ dat}\SpecialCharTok{$}\NormalTok{Day }\SpecialCharTok{==} \StringTok{"Sun"}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{dat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Day SBP
1   Mon 107
2  Tues 108
3   Wed 111
4   Thu 123
5   Fri 118
6   Sat  NA
7   Sun  NA
8   Mon 125
9  Tues 108
10  Wed 122
11  Thu 115
12  Fri 114
13  Sat  NA
14  Sun  NA
15  Mon 114
16 Tues 119
17  Wed 105
18  Thu 118
19  Fri 112
20  Sat  NA
21  Sun  NA
\end{verbatim}

The \textbf{zoo} package includes the \texttt{na.locf()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}\SpecialCharTok{$}\NormalTok{SBPlocf }\OtherTok{\textless{}{-}}\NormalTok{ zoo}\SpecialCharTok{::}\FunctionTok{na.locf}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{SBP)}
\NormalTok{dat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Day SBP SBPlocf
1   Mon 107     107
2  Tues 108     108
3   Wed 111     111
4   Thu 123     123
5   Fri 118     118
6   Sat  NA     118
7   Sun  NA     118
8   Mon 125     125
9  Tues 108     108
10  Wed 122     122
11  Thu 115     115
12  Fri 114     114
13  Sat  NA     114
14  Sun  NA     114
15  Mon 114     114
16 Tues 119     119
17  Wed 105     105
18  Thu 118     118
19  Fri 112     112
20  Sat  NA     112
21  Sun  NA     112
\end{verbatim}

Similar functionality is included in \textbf{DescTools}' \texttt{LOCF()} function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DescTools}\SpecialCharTok{::}\FunctionTok{LOCF}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{SBP)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 107 108 111 123 118 118 118 125 108 122 115 114 114 114 114 119 105 118 112
[20] 112 112
\end{verbatim}

\hypertarget{replace-missing-values-with-estimated-values}{%
\subsection{Replace missing values with estimated values}\label{replace-missing-values-with-estimated-values}}

\hypertarget{single-imputation}{%
\subsubsection{Single imputation}\label{single-imputation}}

You can use non-missing data to predict missing data in an iterative procedure (\protect\hyperlink{ref-buuren2010mice}{Buuren and Groothuis-Oudshoorn 2010})(\protect\hyperlink{ref-stekhoven2012missforest}{Stekhoven and Bühlmann 2012}).
The \texttt{missRanger} package uses the optimized (and parallel-capable) package \texttt{ranger} (\protect\hyperlink{ref-wright2015ranger}{Wright and Ziegler 2015}) to iteratively train random forest models for imputation.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(missRanger)}
\NormalTok{dat }\OtherTok{\textless{}{-}}\NormalTok{ iris}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{dat[}\FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{150}\NormalTok{, }\DecValTok{5}\NormalTok{), }\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ dat[}\FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{150}\NormalTok{, }\DecValTok{22}\NormalTok{), }\DecValTok{4}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ dat[}\FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{150}\NormalTok{, }\DecValTok{18}\NormalTok{), }\DecValTok{4}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{dat\_rfimp }\OtherTok{\textless{}{-}} \FunctionTok{missRanger}\NormalTok{(dat, }\AttributeTok{num.trees =} \DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Missing value imputation by random forests

  Variables to impute:      Sepal.Length, Petal.Width
  Variables used to impute: Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species
iter 1: ..
iter 2: ..
iter 3: ..
iter 4: ..
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(dat\_rfimp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1     5.100000         3.5          1.4         0.2  setosa
2     4.900000         3.0          1.4         0.2  setosa
3     4.732533         3.2          1.3         0.2  setosa
4     4.600000         3.1          1.5         0.2  setosa
5     5.000000         3.6          1.4         0.2  setosa
6     5.400000         3.9          1.7         0.4  setosa
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{checkData}\NormalTok{(dat\_rfimp)}
\end{Highlighting}
\end{Shaded}

Note: The default method for \texttt{preprocess(impute\ =\ TRUE)} is to use \texttt{missRanger}.

\hypertarget{multiple-imputation}{%
\subsubsection{Multiple imputation}\label{multiple-imputation}}

Multiple imputation creates multiple estimates of the missing data. It is more statistically valid for small datasets, especially when the goal is to get accurate estimates of a summary statistics, but may not be practical for larger datasets. It is not usually considered an option for machine learning (where duplicating cases may add bias and complexity in resampling). The package \texttt{mice} is a popular choice for multiple imputation in R.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mice)}
\NormalTok{dat\_mice }\OtherTok{\textless{}{-}} \FunctionTok{mice}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\hypertarget{classes}{%
\chapter{Classes and Object-Oriented Programming}\label{classes}}

Object-Oriented Programming (OOP) is a programming paradigm built around objects with associated data, known as attributes, and functions, known as methods.

There are 4 main class systems in R:

\begin{itemize}
\tightlist
\item
  S3: informally defined, minimal, lean, methods dispatch based on class; \texttt{base} and \texttt{stats} packages use S3 exclusively
\item
  S4: formally defined, allows method dispatch on multiple arguments
\item
  RC: Reference class: Reference semantics; similar to other programming languages; methods are part of the object
\item
  R6: 3rd party class system similar to RC, more lightweight, faster
\end{itemize}

S3 and S4 methods are part of generic functions. RC and R6 methods are part of the object, but you can (and should) write generic functions for them as well.

This chapter will focus on the ubiquitous S3 system. For more advanced (and real OOP) applications, we recommend looking into the \href{https://r6.r-lib.org/index.html}{R6} system.

\hypertarget{s3}{%
\section{S3}\label{s3}}

Most R objects we have been using so far are S3 objects. Data frames are some of the most common S3 objects.

Generic functions are functions that act differently based on the class of the input object. We have already used many of them. For example, \texttt{summary()} works differently on a \texttt{data.frame}, on a \texttt{factor}, or a \texttt{glm} object, etc.

Generic functions in R are saved as \texttt{functionname.classname()} and called automatically, based on the class of the first argument. This allows the same function, e.g.~\texttt{print()}, \texttt{summary()}, \texttt{c()}, to have a different effect on objects of different classes.
For example, the \texttt{print()} function applied on a data frame, will actually call \texttt{print.data.frame()}, while applied on a factor, it will call \texttt{print.factor()}.\\
This means that when you type \texttt{print(iris)} this calls \texttt{print.data.frame(iris)}

Note how the R documentation lists usage information separately for each S3 method, e.g.~\texttt{\#\#\ S3\ method\ for\ class\ \textquotesingle{}factor\textquotesingle{}}

\hypertarget{s3methods}{%
\subsection{\texorpdfstring{\texttt{methods()}}{methods()}}\label{s3methods}}

To get a list of all available methods defined for a specific class,\\
i.e.~\textbf{\emph{``What different functions can I use on this object?''}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{methods}\NormalTok{(}\AttributeTok{class =} \StringTok{"data.frame"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] [             [[            [[<-          [<-           $<-          
 [6] aggregate     anyDuplicated anyNA         as.data.frame as.list      
[11] as.matrix     by            cbind         coerce        dim          
[16] dimnames      dimnames<-    droplevels    duplicated    edit         
[21] format        formula       head          initialize    is.na        
[26] Math          merge         na.exclude    na.omit       Ops          
[31] plot          print         prompt        rbind         row.names    
[36] row.names<-   rowsum        show          slotsFromS3   split        
[41] split<-       stack         str           subset        summary      
[46] Summary       t             tail          transform     type.convert 
[51] unique        unstack       within       
see '?methods' for accessing help and source code
\end{verbatim}

Conversely, to get a list of all available methods for a generic function (i.e.~which classes have)\\
(i.e.~``What objects can I use this function on?'')

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{methods}\NormalTok{(}\AttributeTok{generic.function =} \StringTok{"plot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] plot.acf*           plot.data.frame*    plot.decomposed.ts*
 [4] plot.default        plot.dendrogram*    plot.density*      
 [7] plot.ecdf           plot.factor*        plot.formula*      
[10] plot.function       plot.hclust*        plot.histogram*    
[13] plot.HoltWinters*   plot.isoreg*        plot.lm*           
[16] plot.medpolish*     plot.mlm*           plot.ppr*          
[19] plot.prcomp*        plot.princomp*      plot.profile.nls*  
[22] plot.raster*        plot.spec*          plot.stepfun       
[25] plot.stl*           plot.table*         plot.ts            
[28] plot.tskernel*      plot.TukeyHSD*     
see '?methods' for accessing help and source code
\end{verbatim}

\hypertarget{defining-custom-s3-classes}{%
\subsection{Defining custom S3 classes}\label{defining-custom-s3-classes}}

It very simple to assign an object to a new class.\\
There is no formal class definition, an object is directly assigned to a class by name. An object can belong to multiple classes:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\FunctionTok{class}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"specialvector"}\NormalTok{, }\StringTok{"numeric"}\NormalTok{)}
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "specialvector" "numeric"      
\end{verbatim}

The hierarchy of classes goes left to right, meaning that generic methods are searched for classes in the order they appear in the output of \texttt{class()}.

If we print \texttt{x}, since there is no print method for class \texttt{specialvector} or for \texttt{numeric}, the default \texttt{print.default()} command is automatically called:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
attr(,"class")
[1] "specialvector" "numeric"      
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print.default}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
attr(,"class")
[1] "specialvector" "numeric"      
\end{verbatim}

To create a custom \texttt{print()} function for out new class \texttt{specialvector}, we define a function named \texttt{print.{[}classname{]}}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{print.specialvector }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, ...) \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"This is a special vector of length"}\NormalTok{, }\FunctionTok{length}\NormalTok{(x), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Its mean value is"}\NormalTok{, }\FunctionTok{mean}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), }\StringTok{"and its median is"}\NormalTok{, }\FunctionTok{median}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Here are the first few elements:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\FunctionTok{head}\NormalTok{(x), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Now, when you print an object of class \texttt{specialvector}, the custom \texttt{print()} command is invoked:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
This is a special vector of length 10 
Its mean value is 5.5 and its median is 5.5
Here are the first few elements:
 1 2 3 4 5 6 
\end{verbatim}

If needed, you can call the default or another appropriate method directly:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print.default}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
attr(,"class")
[1] "specialvector" "numeric"      
\end{verbatim}

You can change the vector back to a regular numeric vector, or a different class, just as easily:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(x) }\OtherTok{\textless{}{-}} \StringTok{"numeric"}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\hypertarget{datatable}{%
\chapter{\texorpdfstring{Efficient data analysis with \textbf{data.table}}{Efficient data analysis with data.table}}\label{datatable}}

The \href{https://github.com/Rdatatable/data.table}{\textbf{data.table}} package provides a modern and highly optimized version of R's data.frame structure. It is highly memory efficient and automatically parallelizes internal operations to achieve substantial speed improvements over data.frames. The \textbf{data.table} package weighs in at just a few kilobytes, has zero dependencies, and maintains compatibility with R versions going as far back as possible.

\hypertarget{installation}{%
\subsection{Installation}\label{installation}}

You can install \textbf{data.table} from CRAN or GitHub. Check out the \href{https://github.com/Rdatatable/data.table/wiki/Installation}{data.table wiki} for more info.

\hypertarget{data.table-significantly-extends-the-data.frame}{%
\subsection{\texorpdfstring{\texttt{data.table} significantly extends the \texttt{data.frame}}{data.table significantly extends the data.frame}}\label{data.table-significantly-extends-the-data.frame}}

There are two main ways in which a \texttt{data.table} differs from a \texttt{data.frame}:

\begin{itemize}
\tightlist
\item
  You can perform many operations \textbf{\emph{``in-place''}} without creating a copy (i.e.~make changes to a \texttt{data.table} without having to assign it back to itself).
\item
  There is a lot more than indexing and slicing that you can do within a \texttt{data.table}'s ``frame'' i.e.~the square brackets after a \texttt{data.table}, like applying any custom function to specific columns and/or cases.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rtemis)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(data.table)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Attaching package: 'data.table'
\end{verbatim}

\begin{verbatim}
The following object is masked from 'package:rtemis':

    cube
\end{verbatim}

\texttt{data.table} operations remain as close as possible to \texttt{data.frame} operations, trying to extend rather than replace the latter's functionality. This is great because a lot of what an R user would already be familiar with in using data.frames is applicable here as well.

\hypertarget{create-a-data.table}{%
\section{\texorpdfstring{Create a \texttt{data.table}}{Create a data.table}}\label{create-a-data.table}}

\hypertarget{by-assignment-data.table}{%
\subsection{\texorpdfstring{By assignment: \texttt{data.table()}}{By assignment: data.table()}}\label{by-assignment-data.table}}

Same syntax as \texttt{data.frame()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{A =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                  \AttributeTok{B =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{4.3}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{5.6}\NormalTok{, }\FloatTok{8.1}\NormalTok{),}
                  \AttributeTok{C =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  A   B C
1 1 1.2 a
2 2 4.3 b
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dt }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{A =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                  \AttributeTok{B =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{4.3}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{5.6}\NormalTok{, }\FloatTok{8.1}\NormalTok{),}
                  \AttributeTok{C =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C
   <int> <num> <char>
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(dt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.table" "data.frame"
\end{verbatim}

Notice how \texttt{data.table} inherits from \texttt{data.frame}. This means that if a method does not exist for \texttt{data.table}, the method for \texttt{data.frame} will be used (review \protect\hyperlink{classes}{classes and generic functions}.
One difference from \texttt{data.frame()}, as you can see above, is that \texttt{stringsAsFactors} defaults to FALSE in \texttt{data.table()}. As part of improving efficieny, data.tables do away with row names. Instead of using rownames, you can and should add an extra column with the same information - this is advisable when working with data.frames as well.

A rather convenient option is to have data.tables print each column's class below the column name. You can pass the argument \texttt{class\ =\ TRUE} to \texttt{print()} or set the global option \texttt{datatable.print.class} using \texttt{options()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{options}\NormalTok{(}\AttributeTok{datatable.print.class =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C
   <int> <num> <char>
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dt }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{A =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                  \AttributeTok{B =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{4.3}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{5.6}\NormalTok{, }\FloatTok{8.1}\NormalTok{),}
                  \AttributeTok{C =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{),}
                  \AttributeTok{stringsAsFactors =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C
   <int> <num> <fctr>
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a
\end{verbatim}

\hypertarget{by-coercion-as.data.table}{%
\subsection{\texorpdfstring{By coercion: \texttt{as.data.table()}}{By coercion: as.data.table()}}\label{by-coercion-as.data.table}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{A =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                  \AttributeTok{B =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{4.3}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{5.6}\NormalTok{, }\FloatTok{8.1}\NormalTok{),}
                  \AttributeTok{C =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{))}
\NormalTok{(dat2 }\OtherTok{\textless{}{-}} \FunctionTok{as.data.table}\NormalTok{(dat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C
   <int> <num> <char>
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a
\end{verbatim}

\hypertarget{by-coercion-in-place-setdt}{%
\subsection{\texorpdfstring{By coercion \textbf{\emph{in-place}}: \texttt{setDT()}}{By coercion in-place: setDT()}}\label{by-coercion-in-place-setdt}}

\texttt{setDT} converts a list or data.frame into a \texttt{data.table} in-place. Note: the original object itself is changed, you do not need to assign the output of \texttt{setDT} to a new name.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{A =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                  \AttributeTok{B =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{4.3}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{5.6}\NormalTok{, }\FloatTok{8.1}\NormalTok{),}
                  \AttributeTok{C =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{))}
\FunctionTok{class}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setDT}\NormalTok{(dat)}
\FunctionTok{class}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.table" "data.frame"
\end{verbatim}

You can similarly convert a \texttt{data.table} to a \texttt{data.frame}, in-place:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setDF}\NormalTok{(dat)}
\FunctionTok{class}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\hypertarget{read-into-data.table-from-file}{%
\subsection{\texorpdfstring{Read into \texttt{data.table} from file}{Read into data.table from file}}\label{read-into-data.table-from-file}}

\textbf{data.table} includes the \texttt{fread()} function to read data from files, in a similar way as the base functions \texttt{read.csv()} and \texttt{read.table()}. It is orders of magnitude faster for very large data (e.g.~thousands to millions of rows) and it can read directly from URLs, and zipped files. The \texttt{sep} arguments defines the separator (same as in \texttt{read.csv()} and \texttt{read.table()}), but when set to \texttt{"auto"} (the default) it does a great job of figuring it out by itself.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{fread}\NormalTok{(}\StringTok{"path/to/file.csv"}\NormalTok{)}
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{fread}\NormalTok{(}\StringTok{"https::/url/to/file.csv.gz"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

For its speed and convenience, \texttt{fread()} is recommended over \texttt{read.csv()}/\texttt{read.table()} even if you intend to work with a \texttt{data.frame} exclusively, in which case you can pass the argument \texttt{data.table\ =\ FALSE} to \texttt{fread()}

\hypertarget{write-a-data.table-to-file-fwrite}{%
\subsection{\texorpdfstring{Write a \texttt{data.table} to file: \texttt{fwrite()}}{Write a data.table to file: fwrite()}}\label{write-a-data.table-to-file-fwrite}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fwrite}\NormalTok{(dt, }\StringTok{"/path/to/file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{combine-data.tables}{%
\section{\texorpdfstring{Combine \texttt{data.table}s}{Combine data.tables}}\label{combine-data.tables}}

\texttt{cbind()} and \texttt{rbind()} work on \texttt{data.table}s the same as on \texttt{data.frame}s:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt1 }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{dt2 }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{b =} \DecValTok{11}\SpecialCharTok{:}\DecValTok{15}\NormalTok{)}
\FunctionTok{cbind}\NormalTok{(dt1, dt2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a     b
   <int> <int>
1:     1    11
2:     2    12
3:     3    13
4:     4    14
5:     5    15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rbind}\NormalTok{(dt1, dt1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        a
    <int>
 1:     1
 2:     2
 3:     3
 4:     4
 5:     5
 6:     1
 7:     2
 8:     3
 9:     4
10:     5
\end{verbatim}

\hypertarget{str-works-the-same-and-you-should-keep-using-it}{%
\section{\texorpdfstring{\texttt{str} works the same (and you should keep using it!)}{str works the same (and you should keep using it!)}}\label{str-works-the-same-and-you-should-keep-using-it}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
'data.frame':   5 obs. of  3 variables:
 $ A: int  1 2 3 4 5
 $ B: num  1.2 4.3 9.7 5.6 8.1
 $ C: chr  "a" "b" "b" "a" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(dt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Classes 'data.table' and 'data.frame':  5 obs. of  3 variables:
 $ A: int  1 2 3 4 5
 $ B: num  1.2 4.3 9.7 5.6 8.1
 $ C: Factor w/ 2 levels "a","b": 1 2 2 1 1
 - attr(*, ".internal.selfref")=<externalptr> 
\end{verbatim}

\hypertarget{indexing-a-data.table}{%
\section{\texorpdfstring{Indexing a \texttt{data.table}}{Indexing a data.table}}\label{indexing-a-data.table}}

Indexing is largely unchanged, with a few notable exceptions.\\
Integer indexing is mostly the same:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\DecValTok{1}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  A   B C
1 1 1.2 a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[}\DecValTok{1}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C
   <int> <num> <fctr>
1:     1   1.2      a
\end{verbatim}

Selecting a single column with integer indexing in \texttt{data.table} does not drop to a vector (i.e.~similar to \texttt{drop\ =\ FALSE} in a data.frame):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[, }\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[, }\DecValTok{1}\NormalTok{, drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  A
1 1
2 2
3 3
4 4
5 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, }\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A
   <int>
1:     1
2:     2
3:     3
4:     4
5:     5
\end{verbatim}

In \texttt{data.table}, you can access column names directly without quoting or using \texttt{\$}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[, }\StringTok{"B"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.2 4.3 9.7 5.6 8.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df}\SpecialCharTok{$}\NormalTok{B}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.2 4.3 9.7 5.6 8.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, B]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.2 4.3 9.7 5.6 8.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[df}\SpecialCharTok{$}\NormalTok{B }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  A   B C
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{with}\NormalTok{(df, df[B }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  A   B C
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[B }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C
   <int> <num> <fctr>
1:     3   9.7      b
2:     4   5.6      a
3:     5   8.1      a
\end{verbatim}

Think of working inside the \texttt{data.table} frame (i.e.~the ``{[}\ldots{]}'') like an environment. You have direct access to the variables within it.\\
If you want to refer to variables outside the \texttt{data.table}, prefix the variable name with \texttt{..}. This is similar to how you access contents of a directory above your current directory in the terminal:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{varname }\OtherTok{=} \StringTok{"C"}
\NormalTok{df[, varname]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "a" "b" "b" "a" "a"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, ..varname]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        C
   <fctr>
1:      a
2:      b
3:      b
4:      a
5:      a
\end{verbatim}

This tells the \texttt{data.table} ``don't look for `varname' in the data.table, go outside to find it''

\hypertarget{conditionally-select-cases}{%
\subsection{Conditionally select cases:}\label{conditionally-select-cases}}

It is easy to select cases by combining conditions by using column names directly. Note that \texttt{data.table} does not require you to add ``,'' to select all columns after you have specified rows - works just the same if you so include it:

There are a few way to conditionally select in a data.frame:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[df}\SpecialCharTok{$}\NormalTok{A }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{A) }\SpecialCharTok{\&}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{B }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{B), ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  A   B C
5 5 8.1 a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{subset}\NormalTok{(df, A }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(A) }\SpecialCharTok{\&}\NormalTok{ B }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(B))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  A   B C
5 5 8.1 a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{with}\NormalTok{(df, df[A }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(A) }\SpecialCharTok{\&}\NormalTok{ B }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(B), ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  A   B C
5 5 8.1 a
\end{verbatim}

The data.table equivalent is probably simplest:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[A }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(A) }\SpecialCharTok{\&}\NormalTok{ B }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(B)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C
   <int> <num> <fctr>
1:     5   8.1      a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(a }\OtherTok{\textless{}{-}} \FunctionTok{rnormmat}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{, }\AttributeTok{seed =} \DecValTok{2020}\NormalTok{, }\AttributeTok{return.df =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
           V1          V2          V3          V4          V5
1   0.3769721 -0.85312282  2.17436525 -0.81250466  0.90850113
2   0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
3  -1.0980232  1.19637296  0.31822032  1.09534507 -0.30100401
4  -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
5  -2.7965343 -0.12326023  0.83426874  0.38811847 -1.18007703
6   0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
7   0.9391210  1.70399588  1.29784138 -0.28559829 -0.37071130
8  -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
9   1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
10  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a[}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ a[}\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ a[}\DecValTok{5}\NormalTok{, }\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ a[}\DecValTok{7}\NormalTok{, }\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{adt }\OtherTok{\textless{}{-}} \FunctionTok{as.data.table}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(a}\SpecialCharTok{$}\NormalTok{V3), ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
           V1          V2          V3          V4          V5
2   0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
3  -1.0980232  1.19637296  0.31822032          NA -0.30100401
4  -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
6   0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
8  -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
9   1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
10  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{adt[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(V3)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
           V1          V2          V3          V4          V5
        <num>       <num>       <num>       <num>       <num>
1:  0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
2: -1.0980232  1.19637296  0.31822032          NA -0.30100401
3: -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
4:  0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
5: -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
6:  1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
7:  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364
\end{verbatim}

\hypertarget{select-columns}{%
\subsection{Select columns}\label{select-columns}}

by integer index, same as with a data.frame

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, }\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       B
   <num>
1:   1.2
2:   4.3
3:   9.7
4:   5.6
5:   8.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, }\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       B      C
   <num> <fctr>
1:   1.2      a
2:   4.3      b
3:   9.7      b
4:   5.6      a
5:   8.1      a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A      C
   <int> <fctr>
1:     1      a
2:     2      b
3:     3      b
4:     4      a
5:     5      a
\end{verbatim}

by name: selecting a single column by name returns a vector:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, A]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3 4 5
\end{verbatim}

by name: selecting one or more columns by name enclosed in \texttt{.()} which, in this case, is short for \texttt{list()}, return a \texttt{data.table}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, .(A)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A
   <int>
1:     1
2:     2
3:     3
4:     4
5:     5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, .(A, B)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B
   <int> <num>
1:     1   1.2
2:     2   4.3
3:     3   9.7
4:     4   5.6
5:     5   8.1
\end{verbatim}

\hypertarget{add-new-columns-in-place}{%
\section{\texorpdfstring{Add new columns \textbf{\emph{in-place}}}{Add new columns in-place}}\label{add-new-columns-in-place}}

Use \texttt{:=} assignment to add a new column in the existing \texttt{data.table}.
Once again, in-place means you do not have to assign the result to a variable, the existing \texttt{data.table} will be changed.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, AplusC }\SpecialCharTok{:}\ErrorTok{=}\NormalTok{ A }\SpecialCharTok{+}\NormalTok{ C]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning in Ops.factor(A, C): '+' not meaningful for factors
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C AplusC
   <int> <num> <fctr> <lgcl>
1:     1   1.2      a     NA
2:     2   4.3      b     NA
3:     3   9.7      b     NA
4:     4   5.6      a     NA
5:     5   8.1      a     NA
\end{verbatim}

\hypertarget{add-multiple-columns-in-place}{%
\section{\texorpdfstring{Add multiple columns \textbf{\emph{in-place}}}{Add multiple columns in-place}}\label{add-multiple-columns-in-place}}

To add multiple columns, use \texttt{:=} in a little more awkward notation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, }\StringTok{\textasciigrave{}}\AttributeTok{:=}\StringTok{\textasciigrave{}}\NormalTok{(}\AttributeTok{AminusC =}\NormalTok{ A }\SpecialCharTok{{-}}\NormalTok{ C, }\AttributeTok{AoverC =}\NormalTok{ A }\SpecialCharTok{/}\NormalTok{ C)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning in Ops.factor(A, C): '-' not meaningful for factors
\end{verbatim}

\begin{verbatim}
Warning in Ops.factor(A, C): '/' not meaningful for factors
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C AplusC AminusC AoverC
   <int> <num> <fctr> <lgcl>  <lgcl> <lgcl>
1:     1   1.2      a     NA      NA     NA
2:     2   4.3      b     NA      NA     NA
3:     3   9.7      b     NA      NA     NA
4:     4   5.6      a     NA      NA     NA
5:     5   8.1      a     NA      NA     NA
\end{verbatim}

\hypertarget{convert-column-type}{%
\section{Convert column type}\label{convert-column-type}}

Use any base R coercion function (\texttt{as.*}) to convert a column in-place using the \texttt{:=} notation

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, A }\SpecialCharTok{:}\ErrorTok{=} \FunctionTok{as.numeric}\NormalTok{(A)]}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C AplusC AminusC AoverC
   <num> <num> <fctr> <lgcl>  <lgcl> <lgcl>
1:     1   1.2      a     NA      NA     NA
2:     2   4.3      b     NA      NA     NA
3:     3   9.7      b     NA      NA     NA
4:     4   5.6      a     NA      NA     NA
5:     5   8.1      a     NA      NA     NA
\end{verbatim}

\hypertarget{delete-column-in-place}{%
\section{Delete column in-place}\label{delete-column-in-place}}

To delete a column, use \texttt{:=} to set it to NULL:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, AoverC }\SpecialCharTok{:}\ErrorTok{=} \ConstantTok{NULL}\NormalTok{]}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C AplusC AminusC
   <num> <num> <fctr> <lgcl>  <lgcl>
1:     1   1.2      a     NA      NA
2:     2   4.3      b     NA      NA
3:     3   9.7      b     NA      NA
4:     4   5.6      a     NA      NA
5:     5   8.1      a     NA      NA
\end{verbatim}

Same awkward notation as earlier to delete multiple columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, }\StringTok{\textasciigrave{}}\AttributeTok{:=}\StringTok{\textasciigrave{}}\NormalTok{(}\AttributeTok{AplusC =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{AminusC =} \ConstantTok{NULL}\NormalTok{)]}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B      C
   <num> <num> <fctr>
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a
\end{verbatim}

\hypertarget{summarize-2}{%
\section{Summarize}\label{summarize-2}}

Create a \emph{new} data.table using any summary function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Asummary }\OtherTok{\textless{}{-}}\NormalTok{ dt[, .(}\AttributeTok{Amax =} \FunctionTok{max}\NormalTok{(A), }\AttributeTok{Amin =} \FunctionTok{min}\NormalTok{(A), }\AttributeTok{Asd =} \FunctionTok{sd}\NormalTok{(A))]}
\NormalTok{Asummary}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Amax  Amin      Asd
   <num> <num>    <num>
1:     5     1 1.581139
\end{verbatim}

\hypertarget{address-object-location-in-memory}{%
\subsection{\texorpdfstring{\texttt{address}: Object location in memory}{address: Object location in memory}}\label{address-object-location-in-memory}}

When you add a new column to an existing data.frame, the data.frame is copied behind the scenes - you can tell becasue its memory address (where it's physically stored in your computer) changes:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df1 }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{alpha =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{beta =} \DecValTok{11}\SpecialCharTok{:}\DecValTok{15}\NormalTok{)}
\FunctionTok{address}\NormalTok{(df1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940f4d3488"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df1}\SpecialCharTok{$}\NormalTok{gamma }\OtherTok{\textless{}{-}}\NormalTok{ df1}\SpecialCharTok{$}\NormalTok{alpha }\SpecialCharTok{+}\NormalTok{ df1}\SpecialCharTok{$}\NormalTok{beta}
\FunctionTok{address}\NormalTok{(df1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940d22fec8"
\end{verbatim}

When you add a new column in a data.table \textbf{\emph{in-place}} its address remains unchanged:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt1 }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{alpha =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{beta =} \DecValTok{11}\SpecialCharTok{:}\DecValTok{15}\NormalTok{)}
\FunctionTok{address}\NormalTok{(dt1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940dda4400"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt1[, gamma }\SpecialCharTok{:}\ErrorTok{=}\NormalTok{ alpha }\SpecialCharTok{+}\NormalTok{ beta]}
\FunctionTok{address}\NormalTok{(dt1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940dda4400"
\end{verbatim}

\hypertarget{reference-semantics-at-work}{%
\subsection{Reference semantics at work}\label{reference-semantics-at-work}}

Up to now, you are likely used to working with regular R objects that behave like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(df1 }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{a =} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  a
1 1
2 1
3 1
4 1
5 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(df2 }\OtherTok{\textless{}{-}}\NormalTok{ df1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  a
1 1
2 1
3 1
4 1
5 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df2}\SpecialCharTok{$}\NormalTok{a }\OtherTok{\textless{}{-}}\NormalTok{ df2}\SpecialCharTok{$}\NormalTok{a}\SpecialCharTok{*}\DecValTok{2}
\NormalTok{df2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  a
1 2
2 2
3 2
4 2
5 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  a
1 1
2 1
3 1
4 1
5 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{address}\NormalTok{(df1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940d9671e0"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{address}\NormalTok{(df2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940c78a680"
\end{verbatim}

\texttt{data.table} uses ``reference semantics'' or ``pass-by-reference.'' Be very careful or you might be mightily confused:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dt1 }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{a =} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a
   <num>
1:     1
2:     1
3:     1
4:     1
5:     1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dt2 }\OtherTok{\textless{}{-}}\NormalTok{ dt1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a
   <num>
1:     1
2:     1
3:     1
4:     1
5:     1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt2[, a }\SpecialCharTok{:}\ErrorTok{=}\NormalTok{ a }\SpecialCharTok{*} \DecValTok{2}\NormalTok{]}
\NormalTok{dt2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a
   <num>
1:     2
2:     2
3:     2
4:     2
5:     2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a
   <num>
1:     2
2:     2
3:     2
4:     2
5:     2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{address}\NormalTok{(dt1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940cc21000"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{address}\NormalTok{(dt2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940cc21000"
\end{verbatim}

\begin{rmdnote}
If you want to create a copy of a data.table, use \texttt{copy()}:
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dt3 }\OtherTok{\textless{}{-}} \FunctionTok{copy}\NormalTok{(dt1))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a
   <num>
1:     2
2:     2
3:     2
4:     2
5:     2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{address}\NormalTok{(dt3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940f4ee400"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt3[, a }\SpecialCharTok{:}\ErrorTok{=}\NormalTok{ a }\SpecialCharTok{*} \DecValTok{2}\NormalTok{]}
\NormalTok{dt3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a
   <num>
1:     4
2:     4
3:     4
4:     4
5:     4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a
   <num>
1:     2
2:     2
3:     2
4:     2
5:     2
\end{verbatim}

\hypertarget{set-set-attributes-in-place}{%
\section{\texorpdfstring{\texttt{set*()}: Set attributes \textbf{\emph{in-place}}}{set*(): Set attributes in-place}}\label{set-set-attributes-in-place}}

\texttt{data.table} includes a number of function that begin with \texttt{set*}, all of which change their input \emph{by reference} and as such require no assignment.\\
You may be surprised to find out that even an inocuous operation like changing the column names of a data.frame, requires a copy:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{address}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940d5844a8"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(df) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"Group"}\NormalTok{)}
\FunctionTok{address}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940dd4bf58"
\end{verbatim}

Use \texttt{setnames()} to edit a \texttt{data.table}'s column names \textbf{\emph{in-place}}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{address}\NormalTok{(dt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940f2f6200"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setnames}\NormalTok{(dt, }\AttributeTok{old =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{, }\AttributeTok{new =} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"Group"}\NormalTok{))}
\FunctionTok{address}\NormalTok{(dt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0x7f940f2f6200"
\end{verbatim}

\hypertarget{setorder-set-order-of-data.table}{%
\section{\texorpdfstring{\texttt{setorder()}: Set order of \texttt{data.table}}{setorder(): Set order of data.table}}\label{setorder-set-order-of-data.table}}

Since this is a \texttt{set*} function, it changes a \texttt{data.table} in-place. You can order by any number of columns, ascending or descending:\\
Order by Group and then by A:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setorder}\NormalTok{(dt, Group, A)}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B  Group
   <num> <num> <fctr>
1:     1   1.2      a
2:     4   5.6      a
3:     5   8.1      a
4:     2   4.3      b
5:     3   9.7      b
\end{verbatim}

Order by Group and then by decreasing B:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setorder}\NormalTok{(dt, Group, }\SpecialCharTok{{-}}\NormalTok{B)}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B  Group
   <num> <num> <fctr>
1:     5   8.1      a
2:     4   5.6      a
3:     1   1.2      a
4:     3   9.7      b
5:     2   4.3      b
\end{verbatim}

\hypertarget{group-according-to-by}{%
\section{\texorpdfstring{Group according to \texttt{by}}{Group according to by}}\label{group-according-to-by}}

Up to now, we have learned how to use the \texttt{data.table} frame \texttt{dat{[}i,\ j{]}} to filter cases in \texttt{i} or add/remove/transform columns in-place in \texttt{j}. There is a whole other dimension in the \texttt{data.table} frame: \texttt{by}.

\begin{rmdtip}
The complete \texttt{data.table} syntax is:

\texttt{dt{[}i,\ j,\ by{]}}

\begin{itemize}
\tightlist
\item
  Take data.table \texttt{dt}
\item
  Subset rows using \texttt{i}
\item
  Manipulate columns with \texttt{j}
\item
  Grouped according to \texttt{by}
\end{itemize}
\end{rmdtip}

Again, using \texttt{.()} or \texttt{list()} in \texttt{j}, returns a new \texttt{data.table}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, .(}\AttributeTok{meanAbyGroup =} \FunctionTok{mean}\NormalTok{(A)), by }\OtherTok{=}\NormalTok{ Group]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Group meanAbyGroup
   <fctr>        <num>
1:      a     3.333333
2:      b     2.500000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, }\FunctionTok{list}\NormalTok{(}\AttributeTok{medianBbyGroup =} \FunctionTok{median}\NormalTok{(B)), by }\OtherTok{=}\NormalTok{ Group]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Group medianBbyGroup
   <fctr>          <num>
1:      a            5.6
2:      b            7.0
\end{verbatim}

Making an assignment with \texttt{:=} in \texttt{j}, adds a column in-place. Since here we are grouping, the same value will be assigned to all cases of the group:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, meanAbyGroup }\SpecialCharTok{:}\ErrorTok{=} \FunctionTok{mean}\NormalTok{(A), by }\OtherTok{=}\NormalTok{ Group]}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B  Group meanAbyGroup
   <num> <num> <fctr>        <num>
1:     5   8.1      a     3.333333
2:     4   5.6      a     3.333333
3:     1   1.2      a     3.333333
4:     3   9.7      b     2.500000
5:     2   4.3      b     2.500000
\end{verbatim}

For more complex operations, you may need to refer to the slice of the \texttt{data.table} defined by \texttt{by} within \texttt{j}. There is a special notation for this: \texttt{.SD} (think sub-\texttt{data.table}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, A\_DiffFromGroupMin }\SpecialCharTok{:}\ErrorTok{=}\NormalTok{ .SD[, }\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(.SD[, }\DecValTok{1}\NormalTok{]), by }\OtherTok{=}\NormalTok{ Group]}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B  Group meanAbyGroup A_DiffFromGroupMin
   <num> <num> <fctr>        <num>              <num>
1:     5   8.1      a     3.333333                  4
2:     4   5.6      a     3.333333                  3
3:     1   1.2      a     3.333333                  0
4:     3   9.7      b     2.500000                  1
5:     2   4.3      b     2.500000                  0
\end{verbatim}

\begin{rmdnote}
By now, it should be clearer that the \texttt{data.table} frame provides
a very flexible way to perform a very wide range of operations with
minimal new notation.
\end{rmdnote}

\hypertarget{apply-functions-to-columns}{%
\section{Apply functions to columns}\label{apply-functions-to-columns}}

Any function that returns a list can be used in \texttt{j} to return a new data.table - therefore lapply is perfect for getting summary on multiple columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dt1 }\OtherTok{\textless{}{-}} \FunctionTok{as.data.table}\NormalTok{(}\FunctionTok{rnormmat}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{3}\NormalTok{, }\AttributeTok{seed =} \DecValTok{2020}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
            V1          V2          V3
         <num>       <num>       <num>
 1:  0.3769721 -0.85312282  2.17436525
 2:  0.3015484  0.90925918  1.09818265
 3: -1.0980232  1.19637296  0.31822032
 4: -1.1304059 -0.37158390 -0.07314756
 5: -2.7965343 -0.12326023  0.83426874
 6:  0.7205735  1.80004312  0.19875064
 7:  0.9391210  1.70399588  1.29784138
 8: -0.2293777 -3.03876461  0.93671831
 9:  1.7591313 -2.28897495 -0.14743319
10:  0.1173668  0.05830349  0.11043199
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setnames}\NormalTok{(dt1, }\FunctionTok{c}\NormalTok{(}\StringTok{"Alpha"}\NormalTok{, }\StringTok{"Beta"}\NormalTok{, }\StringTok{"Gamma"}\NormalTok{))}
\NormalTok{dt1[, }\FunctionTok{lapply}\NormalTok{(.SD, mean)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        Alpha       Beta     Gamma
        <num>      <num>     <num>
1: -0.1039628 -0.1007732 0.6748199
\end{verbatim}

You can specify which columns to operate on by adding the \texttt{.SDcols} argument:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt2 }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{A =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                  \AttributeTok{B =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{4.3}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{5.6}\NormalTok{, }\FloatTok{8.1}\NormalTok{),}
                  \AttributeTok{C =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{5}\NormalTok{),}
                  \AttributeTok{Group =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{))}
\NormalTok{dt2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B          C  Group
   <int> <num>      <num> <char>
1:     1   1.2 -0.8125047      a
2:     2   4.3 -0.7437022      b
3:     3   9.7  1.0953451      b
4:     4   5.6  2.4353737      a
5:     5   8.1  0.3881185      a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt2[, }\FunctionTok{lapply}\NormalTok{(.SD, mean), .SDcols }\OtherTok{=} \DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B
   <num> <num>
1:     3  5.78
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# same as}
\NormalTok{dt2[, }\FunctionTok{lapply}\NormalTok{(.SD, mean), .SDcols }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B
   <num> <num>
1:     3  5.78
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cols }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{)}
\NormalTok{dt2[, }\FunctionTok{lapply}\NormalTok{(.SD, mean), .SDcols }\OtherTok{=}\NormalTok{ cols]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B
   <num> <num>
1:     3  5.78
\end{verbatim}

You can combine \texttt{.SDcols} and \texttt{by}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt2[, }\FunctionTok{lapply}\NormalTok{(.SD, median), .SDcols }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"B"}\NormalTok{, }\StringTok{"C"}\NormalTok{), by }\OtherTok{=}\NormalTok{ Group]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Group     B         C
   <char> <num>     <num>
1:      a   5.6 0.3881185
2:      b   7.0 0.1758215
\end{verbatim}

Create multiple new columns from transformation of existing and store with custom prefix:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
         Alpha        Beta       Gamma
         <num>       <num>       <num>
 1:  0.3769721 -0.85312282  2.17436525
 2:  0.3015484  0.90925918  1.09818265
 3: -1.0980232  1.19637296  0.31822032
 4: -1.1304059 -0.37158390 -0.07314756
 5: -2.7965343 -0.12326023  0.83426874
 6:  0.7205735  1.80004312  0.19875064
 7:  0.9391210  1.70399588  1.29784138
 8: -0.2293777 -3.03876461  0.93671831
 9:  1.7591313 -2.28897495 -0.14743319
10:  0.1173668  0.05830349  0.11043199
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt1[, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{names}\NormalTok{(dt1), }\StringTok{"\_abs"}\NormalTok{) }\SpecialCharTok{:}\ErrorTok{=} \FunctionTok{lapply}\NormalTok{(.SD, abs)]}
\NormalTok{dt1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
         Alpha        Beta       Gamma Alpha_abs   Beta_abs  Gamma_abs
         <num>       <num>       <num>     <num>      <num>      <num>
 1:  0.3769721 -0.85312282  2.17436525 0.3769721 0.85312282 2.17436525
 2:  0.3015484  0.90925918  1.09818265 0.3015484 0.90925918 1.09818265
 3: -1.0980232  1.19637296  0.31822032 1.0980232 1.19637296 0.31822032
 4: -1.1304059 -0.37158390 -0.07314756 1.1304059 0.37158390 0.07314756
 5: -2.7965343 -0.12326023  0.83426874 2.7965343 0.12326023 0.83426874
 6:  0.7205735  1.80004312  0.19875064 0.7205735 1.80004312 0.19875064
 7:  0.9391210  1.70399588  1.29784138 0.9391210 1.70399588 1.29784138
 8: -0.2293777 -3.03876461  0.93671831 0.2293777 3.03876461 0.93671831
 9:  1.7591313 -2.28897495 -0.14743319 1.7591313 2.28897495 0.14743319
10:  0.1173668  0.05830349  0.11043199 0.1173668 0.05830349 0.11043199
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B          C  Group
   <int> <num>      <num> <char>
1:     1   1.2 -0.8125047      a
2:     2   4.3 -0.7437022      b
3:     3   9.7  1.0953451      b
4:     4   5.6  2.4353737      a
5:     5   8.1  0.3881185      a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cols }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"C"}\NormalTok{)}
\NormalTok{dt2[, }\FunctionTok{paste0}\NormalTok{(cols, }\StringTok{"\_groupMean"}\NormalTok{) }\SpecialCharTok{:}\ErrorTok{=} \FunctionTok{lapply}\NormalTok{(.SD, mean), .SDcols }\OtherTok{=}\NormalTok{ cols, by }\OtherTok{=}\NormalTok{ Group]}
\NormalTok{dt2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       A     B          C  Group A_groupMean C_groupMean
   <int> <num>      <num> <char>       <num>       <num>
1:     1   1.2 -0.8125047      a    3.333333   0.6703292
2:     2   4.3 -0.7437022      b    2.500000   0.1758215
3:     3   9.7  1.0953451      b    2.500000   0.1758215
4:     4   5.6  2.4353737      a    3.333333   0.6703292
5:     5   8.1  0.3881185      a    3.333333   0.6703292
\end{verbatim}

\hypertarget{row-wise-operations}{%
\section{Row-wise operations}\label{row-wise-operations}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{b =} \DecValTok{11}\SpecialCharTok{:}\DecValTok{15}\NormalTok{, }\AttributeTok{c =} \DecValTok{21}\SpecialCharTok{:}\DecValTok{25}\NormalTok{, }\AttributeTok{d =} \DecValTok{31}\SpecialCharTok{:}\DecValTok{35}\NormalTok{, }\AttributeTok{e =} \DecValTok{41}\SpecialCharTok{:}\DecValTok{45}\NormalTok{)}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a     b     c     d     e
   <int> <int> <int> <int> <int>
1:     1    11    21    31    41
2:     2    12    22    32    42
3:     3    13    23    33    43
4:     4    14    24    34    44
5:     5    15    25    35    45
\end{verbatim}

To operate row-wise, we can use \texttt{by\ =\ 1:nrow(dt)}.
For example, to add a column, in-place, with row-wise sums of variables b through d:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, bcd.sum }\SpecialCharTok{:}\ErrorTok{=} \FunctionTok{sum}\NormalTok{(.SD[, b}\SpecialCharTok{:}\NormalTok{d]), by }\OtherTok{=} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(dt)]}
\NormalTok{dt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       a     b     c     d     e bcd.sum
   <int> <int> <int> <int> <int>   <int>
1:     1    11    21    31    41      63
2:     2    12    22    32    42      66
3:     3    13    23    33    43      69
4:     4    14    24    34    44      72
5:     5    15    25    35    45      75
\end{verbatim}

\hypertarget{wide-long}{%
\section{Wide \textless=\textgreater{} Long}\label{wide-long}}

\hypertarget{melt-wide-to-long}{%
\subsection{\texorpdfstring{\texttt{melt()}: Wide to long}{melt(): Wide to long}}\label{melt-wide-to-long}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_wide }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{ID =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\AttributeTok{Timepoint\_A =} \DecValTok{11}\SpecialCharTok{:}\DecValTok{14}\NormalTok{,}
                      \AttributeTok{Timepoint\_B =} \DecValTok{21}\SpecialCharTok{:}\DecValTok{24}\NormalTok{, }\AttributeTok{Timepoint\_C =} \DecValTok{51}\SpecialCharTok{:}\DecValTok{54}\NormalTok{)}
\NormalTok{dt\_wide}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      ID Timepoint_A Timepoint_B Timepoint_C
   <int>       <int>       <int>       <int>
1:     1          11          21          51
2:     2          12          22          52
3:     3          13          23          53
4:     4          14          24          54
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_long }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(dt\_wide, }\AttributeTok{id.vars =} \StringTok{"ID"}\NormalTok{,}
                \AttributeTok{measure.vars =} \DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\CommentTok{\# defaults to all non{-}id columns}
                \AttributeTok{variable.name =} \StringTok{"Timepoint"}\NormalTok{,}
                \AttributeTok{value.name =} \FunctionTok{c}\NormalTok{(}\StringTok{"Score"}\NormalTok{))}
\NormalTok{dt\_long}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       ID   Timepoint Score
    <int>      <fctr> <int>
 1:     1 Timepoint_A    11
 2:     2 Timepoint_A    12
 3:     3 Timepoint_A    13
 4:     4 Timepoint_A    14
 5:     1 Timepoint_B    21
 6:     2 Timepoint_B    22
 7:     3 Timepoint_B    23
 8:     4 Timepoint_B    24
 9:     1 Timepoint_C    51
10:     2 Timepoint_C    52
11:     3 Timepoint_C    53
12:     4 Timepoint_C    54
\end{verbatim}

\hypertarget{dcast-long-to-wide}{%
\subsection{\texorpdfstring{\texttt{dcast()}: Long to wide}{dcast(): Long to wide}}\label{dcast-long-to-wide}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt\_long}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       ID   Timepoint Score
    <int>      <fctr> <int>
 1:     1 Timepoint_A    11
 2:     2 Timepoint_A    12
 3:     3 Timepoint_A    13
 4:     4 Timepoint_A    14
 5:     1 Timepoint_B    21
 6:     2 Timepoint_B    22
 7:     3 Timepoint_B    23
 8:     4 Timepoint_B    24
 9:     1 Timepoint_C    51
10:     2 Timepoint_C    52
11:     3 Timepoint_C    53
12:     4 Timepoint_C    54
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dcast}\NormalTok{(dt\_long, ID }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Timepoint,}
      \AttributeTok{value.var =} \StringTok{"Score"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <ID>
      ID Timepoint_A Timepoint_B Timepoint_C
   <int>       <int>       <int>       <int>
1:     1          11          21          51
2:     2          12          22          52
3:     3          13          23          53
4:     4          14          24          54
\end{verbatim}

\hypertarget{table-joins}{%
\section{Table Joins}\label{table-joins}}

\texttt{data.table} allow you to perform table joins with the base \texttt{merge()} function using the same syntax as for data.frame objects or the ``data.table way'' using bracket notation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{PID =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{),}
                \AttributeTok{Hospital =} \FunctionTok{c}\NormalTok{(}\StringTok{"UCSF"}\NormalTok{, }\StringTok{"HUP"}\NormalTok{, }\StringTok{"Stanford"}\NormalTok{, }
                             \StringTok{"Stanford"}\NormalTok{, }\StringTok{"UCSF"}\NormalTok{, }\StringTok{"HUP"}\NormalTok{, }
                             \StringTok{"HUP"}\NormalTok{, }\StringTok{"Stanford"}\NormalTok{, }\StringTok{"UCSF"}\NormalTok{),}
                \AttributeTok{Age =} \FunctionTok{c}\NormalTok{(}\DecValTok{22}\NormalTok{, }\DecValTok{34}\NormalTok{, }\DecValTok{41}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{53}\NormalTok{, }\DecValTok{21}\NormalTok{, }\DecValTok{63}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{19}\NormalTok{),}
                \AttributeTok{Sex =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{),}
                \AttributeTok{key =} \StringTok{"PID"}\NormalTok{)}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
     PID Hospital   Age   Sex
   <int>   <char> <num> <num>
1:     1     UCSF    22     1
2:     2      HUP    34     1
3:     3 Stanford    41     0
4:     4 Stanford    19     1
5:     5     UCSF    53     0
6:     6      HUP    21     0
7:     7      HUP    63     1
8:     8 Stanford    22     0
9:     9     UCSF    19     0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{PID =} \FunctionTok{c}\NormalTok{(}\DecValTok{6}\SpecialCharTok{:}\DecValTok{12}\NormalTok{),}
                \AttributeTok{V1 =} \FunctionTok{c}\NormalTok{(}\DecValTok{153}\NormalTok{, }\DecValTok{89}\NormalTok{, }\DecValTok{112}\NormalTok{, }\DecValTok{228}\NormalTok{,  }\DecValTok{91}\NormalTok{, }\DecValTok{190}\NormalTok{, }\DecValTok{101}\NormalTok{),}
                \AttributeTok{Department =} \FunctionTok{c}\NormalTok{(}\StringTok{"Neurology"}\NormalTok{, }\StringTok{"Radiology"}\NormalTok{, }\StringTok{"Emergency"}\NormalTok{,}
                               \StringTok{"Cardiology"}\NormalTok{, }\StringTok{"Surgery"}\NormalTok{, }\StringTok{"Neurology"}\NormalTok{,}
                               \StringTok{"Psychiatry"}\NormalTok{),}
                \AttributeTok{key =} \StringTok{"PID"}\NormalTok{)}
\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
     PID    V1 Department
   <int> <num>     <char>
1:     6   153  Neurology
2:     7    89  Radiology
3:     8   112  Emergency
4:     9   228 Cardiology
5:    10    91    Surgery
6:    11   190  Neurology
7:    12   101 Psychiatry
\end{verbatim}

In the above command we use the \texttt{key} argument to set \texttt{PID} as key. This can be performed after the \texttt{data.table} has been created using the \texttt{setkey()} command:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setkey}\NormalTok{(a, PID)}
\end{Highlighting}
\end{Shaded}

Multiple keys can be set, in order, with the same \texttt{setkey()} command, separated by commas, e.g.:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setkey}\NormalTok{(a, PID, Hospital)}
\end{Highlighting}
\end{Shaded}

Keys sort the data.table by the corresponding columns and can be used to perform left and right joins with bracket notation seen later.

\hypertarget{inner}{%
\subsection{Inner}\label{inner}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{merge}\NormalTok{(a, b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
     PID Hospital   Age   Sex    V1 Department
   <int>   <char> <num> <num> <num>     <char>
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology
\end{verbatim}

\hypertarget{outer}{%
\subsection{Outer}\label{outer}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{all =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
      PID Hospital   Age   Sex    V1 Department
    <int>   <char> <num> <num> <num>     <char>
 1:     1     UCSF    22     1    NA       <NA>
 2:     2      HUP    34     1    NA       <NA>
 3:     3 Stanford    41     0    NA       <NA>
 4:     4 Stanford    19     1    NA       <NA>
 5:     5     UCSF    53     0    NA       <NA>
 6:     6      HUP    21     0   153  Neurology
 7:     7      HUP    63     1    89  Radiology
 8:     8 Stanford    22     0   112  Emergency
 9:     9     UCSF    19     0   228 Cardiology
10:    10     <NA>    NA    NA    91    Surgery
11:    11     <NA>    NA    NA   190  Neurology
12:    12     <NA>    NA    NA   101 Psychiatry
\end{verbatim}

\hypertarget{left-outer}{%
\subsection{Left outer}\label{left-outer}}

Using \texttt{merge()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
     PID Hospital   Age   Sex    V1 Department
   <int>   <char> <num> <num> <num>     <char>
1:     1     UCSF    22     1    NA       <NA>
2:     2      HUP    34     1    NA       <NA>
3:     3 Stanford    41     0    NA       <NA>
4:     4 Stanford    19     1    NA       <NA>
5:     5     UCSF    53     0    NA       <NA>
6:     6      HUP    21     0   153  Neurology
7:     7      HUP    63     1    89  Radiology
8:     8 Stanford    22     0   112  Emergency
9:     9     UCSF    19     0   228 Cardiology
\end{verbatim}

Using bracket notation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b[a, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
     PID    V1 Department Hospital   Age   Sex
   <int> <num>     <char>   <char> <num> <num>
1:     1    NA       <NA>     UCSF    22     1
2:     2    NA       <NA>      HUP    34     1
3:     3    NA       <NA> Stanford    41     0
4:     4    NA       <NA> Stanford    19     1
5:     5    NA       <NA>     UCSF    53     0
6:     6   153  Neurology      HUP    21     0
7:     7    89  Radiology      HUP    63     1
8:     8   112  Emergency Stanford    22     0
9:     9   228 Cardiology     UCSF    19     0
\end{verbatim}

If keys were not set for a and b, you could specify the column to match on using the \texttt{on} argument:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b[a, on }\OtherTok{=} \StringTok{"PID"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
     PID    V1 Department Hospital   Age   Sex
   <int> <num>     <char>   <char> <num> <num>
1:     1    NA       <NA>     UCSF    22     1
2:     2    NA       <NA>      HUP    34     1
3:     3    NA       <NA> Stanford    41     0
4:     4    NA       <NA> Stanford    19     1
5:     5    NA       <NA>     UCSF    53     0
6:     6   153  Neurology      HUP    21     0
7:     7    89  Radiology      HUP    63     1
8:     8   112  Emergency Stanford    22     0
9:     9   228 Cardiology     UCSF    19     0
\end{verbatim}

\begin{rmdnote}
The easy way to understand the bracket notation merges is to think that
the data.table inside the bracket is used to index the data.table on the
outside, therefore the resulting table will have rows dictated by the
inside table's key.
\end{rmdnote}

\hypertarget{right-outer}{%
\subsection{Right outer}\label{right-outer}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{merge}\NormalTok{(a, b, }\AttributeTok{all.y =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
     PID Hospital   Age   Sex    V1 Department
   <int>   <char> <num> <num> <num>     <char>
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology
5:    10     <NA>    NA    NA    91    Surgery
6:    11     <NA>    NA    NA   190  Neurology
7:    12     <NA>    NA    NA   101 Psychiatry
\end{verbatim}

Using bracket notation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a[b, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Key: <PID>
     PID Hospital   Age   Sex    V1 Department
   <int>   <char> <num> <num> <num>     <char>
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology
5:    10     <NA>    NA    NA    91    Surgery
6:    11     <NA>    NA    NA   190  Neurology
7:    12     <NA>    NA    NA   101 Psychiatry
\end{verbatim}

\hypertarget{basegraphics}{%
\chapter{Base Graphics}\label{basegraphics}}

R has powerful graphical capabilities built in to the core language. This chapter is an introduction to what is known as base graphics which is provided by the \textbf{graphics} built-in package. Their defaults produce minimalist plots, but they can be customized extensively. In this chapter we shall begin with default plots and demonstrate some of the more common/useful ways to customize them.

\begin{longtable}[]{@{}rl@{}}
\toprule
Plot type & Command\tabularnewline
\midrule
\endhead
Scatterplot & \texttt{plot(x,\ y)}\tabularnewline
Line plot & \texttt{plot(x,\ y,\ type\ =\ \textquotesingle{}l\textquotesingle{})}\tabularnewline
Histogram & \texttt{hist(x)}\tabularnewline
Density plot & \texttt{plot(density(x))}\tabularnewline
Barplot & \texttt{barplot(x)}\tabularnewline
Boxplot & \texttt{boxplot(x)}\tabularnewline
Heatmap & \texttt{heatmap(x)}\tabularnewline
\bottomrule
\end{longtable}

R documentation for each of the above commands provides extensive coverage of graphical parameters. \texttt{?par} gives the main documentation file for a long list of graphical parameters. These can be set either with the \texttt{par()} command before using any plotting command.

Let's create some synthetic data:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{300}\NormalTok{)}
\NormalTok{y\_true }\OtherTok{\textless{}{-}} \DecValTok{12} \SpecialCharTok{+}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{3}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{12} \SpecialCharTok{+}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{3} \SpecialCharTok{+} \FloatTok{2.5} \SpecialCharTok{*} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{300}\NormalTok{)}\SpecialCharTok{*}\FloatTok{1.5}
\end{Highlighting}
\end{Shaded}

\hypertarget{scatter-plot}{%
\section{Scatter plot}\label{scatter-plot}}

Input: 2 \textbf{numeric vectors}

A 2D scatterplot displays of two numeric vectors as X and Y coordinates.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-4-1.pdf}

\hypertarget{col-point-color}{%
\subsection{\texorpdfstring{\textbf{\texttt{col}}: point color}{col: point color}}\label{col-point-color}}

See \protect\hyperlink{colors}{Colors in R} to learn about the different ways to define colors in R.

Some common ways include:

\begin{itemize}
\tightlist
\item
  By name using one of 657 names given by \texttt{colors()}, e.g.~``red,'' ``magenta,'' ``blue,'' ``navy,'' ``cyan''
\item
  By RGB code
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y, }\AttributeTok{col =} \StringTok{"slateblue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-5-1.pdf}

\hypertarget{bty-box-type}{%
\subsection{\texorpdfstring{\textbf{\texttt{bty}}: box type}{bty: box type}}\label{bty-box-type}}

There are 7 bty options: ``o'' ``l,'' ``7,'' ``c,'' ``u,'' or ``{]}'' and ``none.''
They produce a box that resembles the corresponding symbol.
``none'' draws no box but allows the axes to show:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y, }\AttributeTok{bty =} \StringTok{"l"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-6-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y, }\AttributeTok{bty =} \StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-7-1.pdf}

\hypertarget{pch-point-character}{%
\subsection{\texorpdfstring{\textbf{\texttt{pch}}: point character}{pch: point character}}\label{pch-point-character}}

The default point character is a circle as seen above. This helps visualize overlapping points (especially for devices that do not support transparency).

There are 25 point characters, designated by integers 1 through 25.

Here's a preview of all 25 \texttt{pch} options.
\texttt{pch} types 21 through 25 can be filled by a color specified by \texttt{bg}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{25}\NormalTok{, }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{25}\NormalTok{), }\AttributeTok{pch =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{25}\NormalTok{, }\AttributeTok{bg =} \StringTok{"blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-8-1.pdf}

Let's use a solid disc:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y, }\AttributeTok{bty =} \StringTok{"n"}\NormalTok{, }\AttributeTok{pch =} \DecValTok{16}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-9-1.pdf}

We cannot tell how many points are overlapping in the middle and therefore it's a good idea to make the points a little transparent.

There are different ways to add transparency (see \protect\hyperlink{colors}{Colors}). The easiest way is probably to use \texttt{adjustcolor()}. In the context of colors, \texttt{alpha} refers to transparency: \texttt{a\ =\ 1} is opaque and \texttt{a\ =\ 0} is completely transparent (therefore use a value greater than 0).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y,}
     \AttributeTok{bty =} \StringTok{"n"}\NormalTok{, }\AttributeTok{pch =} \DecValTok{16}\NormalTok{,}
     \AttributeTok{col =} \FunctionTok{adjustcolor}\NormalTok{(}\StringTok{"slateblue"}\NormalTok{, }\AttributeTok{alpha.f =}\NormalTok{ .}\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-10-1.pdf}

\hypertarget{grid}{%
\subsection{grid}\label{grid}}

We can add a grid behind the plot area using the \texttt{panel.first} argument, which accepts a graphical expression (a function that draws something), which will be evaluated before plotting the points on the graph (therefore appears behind the points).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y,}
     \AttributeTok{bty =} \StringTok{"n"}\NormalTok{, }\AttributeTok{pch =} \DecValTok{16}\NormalTok{,}
     \AttributeTok{col =} \FunctionTok{adjustcolor}\NormalTok{(}\StringTok{"slateblue"}\NormalTok{, }\AttributeTok{alpha.f =}\NormalTok{ .}\DecValTok{5}\NormalTok{),}
     \AttributeTok{panel.first =} \FunctionTok{grid}\NormalTok{(}\AttributeTok{lty =} \DecValTok{1}\NormalTok{, }\AttributeTok{col =} \StringTok{\textquotesingle{}gray90\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-11-1.pdf}

\hypertarget{main-xlab-ylab-title-and-axes-labels}{%
\subsection{\texorpdfstring{\textbf{\texttt{main}}, \textbf{\texttt{xlab}}, \textbf{\texttt{ylab}}: Title and axes labels}{main, xlab, ylab: Title and axes labels}}\label{main-xlab-ylab-title-and-axes-labels}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y,}
     \AttributeTok{bty =} \StringTok{"n"}\NormalTok{, }\AttributeTok{pch =} \DecValTok{16}\NormalTok{,}
     \AttributeTok{col =} \FunctionTok{adjustcolor}\NormalTok{(}\StringTok{"slateblue"}\NormalTok{, }\AttributeTok{alpha.f =}\NormalTok{ .}\DecValTok{5}\NormalTok{),}
     \AttributeTok{panel.first =} \FunctionTok{grid}\NormalTok{(}\AttributeTok{lty =} \DecValTok{1}\NormalTok{, }\AttributeTok{col =} \StringTok{\textquotesingle{}gray90\textquotesingle{}}\NormalTok{),}
     \AttributeTok{main =} \StringTok{"y vs. x"}\NormalTok{,}
     \AttributeTok{xlab =} \StringTok{"Variable x (xunits)"}\NormalTok{,}
     \AttributeTok{ylab =} \StringTok{"Variable y (yunits)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-12-1.pdf}

Note that depending on where you intend to display the plot, you may leave the title blank and instead place it in the figure caption along with an explanation of the data (e.g.~in a journal article)

\hypertarget{histogram}{%
\section{Histogram}\label{histogram}}

Input: \textbf{numeric vector}

A histogram displays an approximation of the distribution of a numeric vector. First the data is binned and then the number of elements that falls in each bin is counted. The histogram plot draws bars for each bin whose heights corresponds to the count of elements in the corresponding interval.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-13-1.pdf}

\hypertarget{col-bar-color}{%
\subsection{\texorpdfstring{\textbf{\texttt{col}}: bar color}{col: bar color}}\label{col-bar-color}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(x, }\AttributeTok{col =} \StringTok{"slategrey"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-14-1.pdf}

\hypertarget{border-border-color}{%
\subsection{\texorpdfstring{\textbf{\texttt{border}}: border color}{border: border color}}\label{border-border-color}}

Setting border color to the same as the background gives a clean look:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(x, }\AttributeTok{col =} \StringTok{"slategrey"}\NormalTok{, }\AttributeTok{border =} \StringTok{"white"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-15-1.pdf}

\hypertarget{breaks-number-or-value-of-breakpoints}{%
\subsection{\texorpdfstring{\texttt{breaks}: number or value of breakpoints}{breaks: number or value of breakpoints}}\label{breaks-number-or-value-of-breakpoints}}

The \texttt{breaks} argument can be used to define the breakpoints to use for the binning of the values of the input to \texttt{hist()}. See the documentation in \texttt{?hist} for the full range of options. An easy way to control the number of bins is to pass an integer to the \texttt{breaks} argument. Depending on the length of x and its distribution, it may or may not be possible to use the exact number requested, but the closest possible number will be automatically chosen.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(x, }\AttributeTok{col =} \StringTok{"slategrey"}\NormalTok{, }\AttributeTok{border =} \StringTok{"white"}\NormalTok{,}
     \AttributeTok{breaks =} \DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-16-1.pdf}

\hypertarget{density-plot}{%
\section{Density plot}\label{density-plot}}

Input: numeric vector

A density plot is a different way to display an approximation of the distribution of a numeric vector. The \texttt{density()} function estimates the density of x and can be passed to \texttt{plot()} directly:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\FunctionTok{density}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-17-1.pdf}

You can use \texttt{main\ =\ NA} or \texttt{main\ =\ ""} to suppress printing a title.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\FunctionTok{density}\NormalTok{(x), }\AttributeTok{col =} \StringTok{"blue"}\NormalTok{,}
     \AttributeTok{bty =} \StringTok{"n"}\NormalTok{,}
     \AttributeTok{main =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-18-1.pdf}

\hypertarget{barplot}{%
\section{Barplot}\label{barplot}}

Input: \textbf{vector} or \textbf{matrix}

Let's look at the VADeaths built-in dataset which describes death rater per 1000 population per year broken down by age range and population group.

\hypertarget{single-vector}{%
\subsection{Single vector}\label{single-vector}}

We can plot a single column or row. Note how R automatically gets the corresponding dimension names:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(VADeaths[, }\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-19-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(VADeaths[}\DecValTok{1}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-20-1.pdf}

\hypertarget{col-and-border-bar-fill-and-border-color}{%
\subsubsection{\texorpdfstring{\textbf{\texttt{col}} and \textbf{\texttt{border}}: bar fill and border color}{col and border: bar fill and border color}}\label{col-and-border-bar-fill-and-border-color}}

As in most plotting functions, color is controlled by the \textbf{\texttt{col}} argument. \textbf{\texttt{border}} can be set to any color separately, or to \texttt{NA} to omit, which gives a clean look:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(VADeaths[, }\DecValTok{1}\NormalTok{],}
        \AttributeTok{col =} \StringTok{"aquamarine3"}\NormalTok{, }\AttributeTok{border =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-21-1.pdf}

\hypertarget{matrix}{%
\subsection{Matrix}\label{matrix}}

We can draw barplots of multiple columns at the same time by passing a matrix input. The grouping on the x-axis is based on the columns. By default, data from different rows is stacked. The argument \texttt{legend.text} can be used to add a legend with the row labels:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(VADeaths, }\AttributeTok{legend.text =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-22-1.pdf}

Alternatively, we can draw groups of bars beside each other with the argument \texttt{beside\ =\ TRUE}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(VADeaths, }\AttributeTok{beside =} \ConstantTok{TRUE}\NormalTok{,}
        \AttributeTok{legend.text =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{args.legend =} \FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \StringTok{"topright"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-23-1.pdf}

To use custom colors, we pass a vector of length equal to the number of bars within each group. These will get recycled across groups, giving a consistent color coding.\\
Here, we use the \texttt{adjustcolor()} function again to produce 5 shades of navy.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{col }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{seq}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{8}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{5}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{adjustcolor}\NormalTok{(}\StringTok{"navy"}\NormalTok{, i))}
\FunctionTok{barplot}\NormalTok{(VADeaths,}
        \AttributeTok{col =}\NormalTok{ col,}
        \AttributeTok{border =} \ConstantTok{NA}\NormalTok{,}
        \AttributeTok{beside =} \ConstantTok{TRUE}\NormalTok{,}
        \AttributeTok{legend.text =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{args.legend =} \FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \StringTok{"topright"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-24-1.pdf}

\hypertarget{formula-interface}{%
\subsection{Formula interface}\label{formula-interface}}

\hypertarget{boxplot}{%
\section{Boxplot}\label{boxplot}}

Input: One or more \textbf{vectors} of any length

A boxplot is another way to visualize the distribution of one or more vectors. Each vector does not need to be of the same length. For example if you are plotting lab results of a patient and control group, they do not have to contain the same number of individuals.

There are two ways to use the \texttt{boxplot()} function. Either pass two separate vectors of data (whet)

\texttt{boxplot()} makes it easy to plot your data from different objects. It can accept:

\begin{itemize}
\tightlist
\item
  individual vectors
\item
  columns of a matrix, columns/elements of a data.frame, elements of a list
\item
  formula interface of the form \texttt{variable\ \textasciitilde{}\ factor}
\end{itemize}

\hypertarget{single-vector-1}{%
\subsection{Single vector}\label{single-vector-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{, }\AttributeTok{mean =} \DecValTok{12}\NormalTok{, }\AttributeTok{sd =} \DecValTok{2}\NormalTok{)}
\FunctionTok{boxplot}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-25-1.pdf}

\hypertarget{anatomy-of-a-boxplot}{%
\subsection{Anatomy of a boxplot}\label{anatomy-of-a-boxplot}}

A boxplot shows:

\begin{itemize}
\tightlist
\item
  the median
\item
  first and third quartiles
\item
  outliers (defined as \texttt{x\ \textless{}\ Q1\ -\ 1.5\ *\ IQR\ \textbar{}\ x\ \textgreater{}\ Q3\ +\ 1.5\ *\ IQR})
\item
  range after excluding outliers
\end{itemize}

\begin{figure}
\centering
\includegraphics{79-BaseGraphics_files/figure-latex/boxanat-1.pdf}
\caption{\label{fig:boxanat}Boxplot anatomy}
\end{figure}

Some synthetic data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{alpha }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{beta }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{gamma }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{dl }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{alpha =}\NormalTok{ alpha, }\AttributeTok{beta =}\NormalTok{ beta, }\AttributeTok{gamma =}\NormalTok{ gamma)}
\end{Highlighting}
\end{Shaded}

\hypertarget{multiple-vectors}{%
\subsection{Multiple vectors}\label{multiple-vectors}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(alpha, beta, gamma)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-27-1.pdf}

\hypertarget{list}{%
\subsection{List}\label{list}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(dl)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-28-1.pdf}

\hypertarget{matrix-1}{%
\subsection{Matrix}\label{matrix-1}}

Passing a matrix to \texttt{boxplot()} draws one boxplot per column:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{5}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\FunctionTok{boxplot}\NormalTok{(mat)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-29-1.pdf}

\hypertarget{formula-interface-1}{%
\subsection{Formula interface}\label{formula-interface-1}}

The formula interface can be used to group any vector by a factor of the same length.

Let's use the built-in \texttt{sleep} dataset which shows the effect of two different drugs in increasing hours of sleep compared to a control group.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(extra }\SpecialCharTok{\textasciitilde{}}\NormalTok{ group, sleep)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-30-1.pdf}

The \textbf{\texttt{col}} and \textbf{\texttt{border}} arguments work as expected. Here we define two custom colors using their hexadecimal RGB code and use the solid version for the border and a 50\% transparent version for the fill. Note that we do not need two separate colors to produce an unambiguous plot since they are clearly labeled in the y-axis. It is often considered desirable/preferred to use the minimum number of different colors that is necessary. (Color coding like the following could be useful if for example data from the two groups were used on a different plot, like a scatterplot, in a multi-panel figure).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{border }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"\#18A3AC"}\NormalTok{, }\StringTok{"\#F48024"}\NormalTok{)}
\NormalTok{col }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{adjustcolor}\NormalTok{(}\StringTok{"\#18A3AC"}\NormalTok{, .}\DecValTok{5}\NormalTok{), }\FunctionTok{adjustcolor}\NormalTok{(}\StringTok{"\#F48024"}\NormalTok{, .}\DecValTok{5}\NormalTok{))}
\FunctionTok{boxplot}\NormalTok{(extra }\SpecialCharTok{\textasciitilde{}}\NormalTok{ group, sleep,}
        \AttributeTok{col =}\NormalTok{ col, }\AttributeTok{border =}\NormalTok{ border)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-31-1.pdf}

\hypertarget{names-group-labels}{%
\subsection{\texorpdfstring{\textbf{\texttt{names}}: group labels}{names: group labels}}\label{names-group-labels}}

The x-axis group names can be defined with the \texttt{names} argument:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(extra }\SpecialCharTok{\textasciitilde{}}\NormalTok{ group, sleep,}
        \AttributeTok{col =}\NormalTok{ col, }\AttributeTok{border =}\NormalTok{ border,}
        \AttributeTok{names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Drug A"}\NormalTok{, }\StringTok{"Drug B"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-32-1.pdf}

\hypertarget{heatmap}{%
\section{Heatmap}\label{heatmap}}

Input: \textbf{matrix}

A heatmap is a 2D matrix-like plot with x- and y-axis labels and a value in each cell. It can be used to display many different types of data. A common usage in data science is to plot the correlation matrix of a set of numerical features. In many cases, the rows and/or columns of a heatmap can be reordered based on hierarchical clustering.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\NormalTok{x\_cor }\OtherTok{\textless{}{-}} \FunctionTok{cor}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

By default, the \texttt{heatmap()} function draws marginal dendrograms and rearranges rows and columns. We can prevent that by setting \texttt{Rowv} and \texttt{Colv} to \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{heatmap}\NormalTok{(x\_cor, }\AttributeTok{Rowv =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{Colv =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-34-1.pdf}

To allow clustering and row and column reordering, use the defaults:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{heatmap}\NormalTok{(x\_cor)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-35-1.pdf}

\hypertarget{graphical-parameters}{%
\section{Graphical parameters}\label{graphical-parameters}}

The \texttt{par} function allows setting or querying graphical parameters of the base graphics system. Have a look at its documentation (\texttt{?par}).\\
Some graphical parameters can only be set with a call to \texttt{par} prior to using a base plotting function. However, many parameters can also be passed using the \texttt{...} construct of each base plotting function.

Some common base graphical parameters:

\begin{itemize}
\tightlist
\item
  \emph{pch}: Point character
\item
  \emph{col}: Color
\item
  \emph{cex}: Character expansion, i.e.~relative size
\item
  \emph{bty}: Box type
\item
  \emph{xlab}: x-axis label
\item
  \emph{ylab}: y-axis label
\item
  \emph{main}: Main title
\end{itemize}

Always make sure that your plotting characters, axis labels and titles are legible. You must avoid, at all costs, ever using a huge graph with tiny letters spread over an entire slide in a presentation.

\begin{itemize}
\tightlist
\item
  \emph{cex}: Character expansion for the plotting characters
\item
  \emph{cex.axis}: cex for axis annotation
\item
  \emph{cex.lab}: cex for x and y labels
\item
  \emph{cex.main}: cex for main title
\end{itemize}

Note: All of these can be set either with a call to \texttt{par()} prior to plotting or passed as arguments in a plotting command, like \texttt{plot()}.

There is one important distinction: \texttt{cex} set with \texttt{par()} (which defaults to 1), sets the baseline and all other \texttt{cex} parameters multiply it. However, \texttt{cex} set within \texttt{plot()} still multiplies \texttt{cex} set with \texttt{par()}, but only affects the plotting character size.

\hypertarget{multipanel-plots}{%
\section{Multipanel plots}\label{multipanel-plots}}

There are different ways to create multipanel plots, but probably the most straightforward is to use either the \texttt{mfrow} or the \texttt{mfcol} argument of \texttt{par()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{3} \SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{) }\SpecialCharTok{*} \DecValTok{2}
\NormalTok{z }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Both \texttt{mfrow} and \texttt{mfcol} accept an integer vector of length 2 indicating number of rows and number of columns, respectively. With \texttt{mfrow}, the plots are drawn row-wise and with \texttt{mfcol} they are drawn column-wise. Remember to reset \texttt{mfrow} or \texttt{mfcol} back to \texttt{c(1,\ 1)}

For example, let's plot a 2-by-3 panel of plots, drawn row-wise:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{mfrow =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\FunctionTok{hist}\NormalTok{(x)}
\FunctionTok{hist}\NormalTok{(y)}
\FunctionTok{hist}\NormalTok{(z)}
\FunctionTok{plot}\NormalTok{(x, y)}
\FunctionTok{plot}\NormalTok{(x, z)}
\FunctionTok{plot}\NormalTok{(y, z)}
\end{Highlighting}
\end{Shaded}

\includegraphics{79-BaseGraphics_files/figure-latex/unnamed-chunk-37-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{mfrow =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{graphics3x}{%
\chapter{3x Graphics}\label{graphics3x}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rtemis)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(plotly)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Attaching package: 'plotly'
\end{verbatim}

\begin{verbatim}
The following object is masked from 'package:ggplot2':

    last_plot
\end{verbatim}

\begin{verbatim}
The following object is masked from 'package:stats':

    filter
\end{verbatim}

\begin{verbatim}
The following object is masked from 'package:graphics':

    layout
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mgcv)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Loading required package: nlme
\end{verbatim}

\begin{verbatim}
This is mgcv 1.8-33. For overview type 'help("mgcv-package")'.
\end{verbatim}

Visualization is central to statistics and data science. It is used to check data, explore data, and communicate results.

R has powerful graphical capabilities built in to the core language. It contains two largely separate graphics systems: `base' graphics in the \texttt{graphics} package, inherited from the S language, and `grid' graphics in the \texttt{grid} package: a ``rewrite of the graphics layout capabilities.'' There is limited support for interaction between the two. In practice, for a given application, choose one or the other. There are no high level functions for the grid graphics system built into the base R distribution, but a few very popular packages have been built on top of it. Both graphics systems can produce beautiful, layered, high quality graphics. It is possible to build functions using either system to produce most, if not all, types of plots.

\hypertarget{base-graphics}{%
\section{Base graphics}\label{base-graphics}}

Common R plotting functions like \texttt{plot}, \texttt{barplot}, \texttt{boxplot}, \texttt{heatmap}, etc. are built ontop of base graphics (\protect\hyperlink{ref-murrell2018r}{Murrell 2018}). Their default arguments provide a minimalist output, but can be tweaked extensively. An advantage of base graphics is they are very fast and relatively easy to extend.

The \texttt{par} function allows setting or querying graphical parameters of the base graphics system. Have a look at its documentation (\texttt{?par}).\\
Some graphical parameters can only be set with a call to \texttt{par} prior to using a base plotting function. However, many parameters can also be passed using the \texttt{...} construct of each base plotting function.

Some common base graphical parameters:

\begin{itemize}
\tightlist
\item
  \emph{pch}: Point character
\item
  \emph{col}: Color
\item
  \emph{cex}: Character expansion, i.e.~relative size
\item
  \emph{bty}: Box type
\item
  \emph{xlab}: x-axis label
\item
  \emph{ylab}: y-axis label
\item
  \emph{main}: Main title
\end{itemize}

Always make sure that your plotting characters, axis labels and titles are legible. You must avoid, at all costs, ever using a huge graph with tiny letters spread over a whole slide in a presentation.

\begin{itemize}
\tightlist
\item
  \emph{cex}: Character expansion for the plotting characters
\item
  \emph{cex.axis}: cex for axis annotation
\item
  \emph{cex.lab}: cex for x and y labels
\item
  \emph{cex.main}: cex for main title
\end{itemize}

Note: All of these can be set either with a call to \texttt{pa()r} prior to plotting or passed as arguments in a plotting command, like \texttt{plot()}.\\
However, there is one important distinction: \texttt{cex} set with \texttt{par()} (which defaults to 1), sets the baseline and all other \texttt{cex} parameters multiply it. However, \texttt{cex} set within \texttt{plot()} stil multiplies \texttt{cex} set with \texttt{par()}, but only affectts the plotting character size.

\hypertarget{grid-graphics}{%
\section{Grid graphics}\label{grid-graphics}}

The two most popular packages built on top of the \texttt{grid} package are:

\begin{itemize}
\tightlist
\item
  \href{https://cran.r-project.org/web/packages/lattice/lattice.pdf}{lattice}
\item
  \href{https://ggplot2.tidyverse.org}{ggplot2} (\protect\hyperlink{ref-wickham2011ggplot2}{Wickham 2011})
\end{itemize}

\hypertarget{ggplot2}{%
\subsection{\texorpdfstring{\texttt{ggplot2}}{ggplot2}}\label{ggplot2}}

\texttt{ggplot2}, created by Hadley Wickham (\protect\hyperlink{ref-wickham2011ggplot2}{Wickham 2011}), follows the \href{https://www.springer.com/statistics/computational/book/978-0-387-24544-7}{Grammar of Graphics} approach of Leland Wilkinson (\protect\hyperlink{ref-wilkinson2012grammar}{Wilkinson 2012}) and has a very different syntax than base functions.\\
The general idea is to start by defining the data and then add and/or modify graphical elements in a stepwise manner, which allows one to build complex and layered visualizations. A simplified interface to \texttt{ggplot} graphics is provided in the \texttt{qplot} function of \texttt{ggplot2} (but you should avoid it and use learn to use the \texttt{ggplot} command which is fun and much more flexible and useful to know)

\hypertarget{rd-party-apis}{%
\section{3rd party APIs}\label{rd-party-apis}}

There are also third party libraries with R APIs that provide even more modern graphic capabilities to the R user:

\begin{itemize}
\tightlist
\item
  \href{https://plot.ly}{plotly} (\protect\hyperlink{ref-sievert2017plotly}{Sievert et al. 2017})
\item
  \href{https://hafen.github.io/rbokeh/index.html}{rbokeh}
\end{itemize}

Both build interactive plots, which can be viewed in a web browser or exported to bitmap graphics, and both also follow the grammar of graphics paradigm, and therefore follow similar syntax to \texttt{ggplot2}.

The \href{https://rtemis.lambdamd.org}{\textbf{rtemis}} package (\protect\hyperlink{ref-gennatas2017towards}{Gennatas 2017}) provides visualization functions built on top of base graphics (for speed and extendability) and \textbf{plotly} (for interactivity):

\begin{itemize}
\tightlist
\item
  \href{https://rtemis.lambdamd.org/staticgraphics.html}{mplot3} static graphics (base)
\item
  \href{https://rtemis.lambdamd.org/interactivegraphics.html}{dplot3} interactive graphics (plotly)
\end{itemize}

Let's go over the most common plot types using base graphics, mplot3, dplot3, and ggplot.\\
You should be familiar with the basic functionality of both base graphics and ggplot as they are extensively used.

\hypertarget{scatterplot}{%
\section{Scatterplot}\label{scatterplot}}

\hypertarget{base-2}{%
\subsection{base}\label{base-2}}

A default base graphics plot is rather minimalist:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-4-1.pdf}

By tweaking a few parameters, we get a perhaps prettier result:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length,}
     \AttributeTok{pch =} \DecValTok{16}\NormalTok{,}
     \AttributeTok{col =} \StringTok{"\#18A3AC66"}\NormalTok{,}
     \AttributeTok{cex =} \FloatTok{1.4}\NormalTok{,}
     \AttributeTok{bty =} \StringTok{"n"}\NormalTok{,}
     \AttributeTok{xlab =} \StringTok{"Sepal Length"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"Petal Length"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-5-1.pdf}

\hypertarget{mplot3}{%
\subsection{\texorpdfstring{\textbf{mplot3}}{mplot3}}\label{mplot3}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-6-1.pdf}

\href{https://rtemis.lambdamd.org/interactivegraphics.html}{\texttt{dplot3()}} provides similar functionality to \texttt{mplot3()}, built on top of \textbf{plotly}. Notice how you can interact with the plot using the mouse:

\hypertarget{dplot3}{%
\subsection{\texorpdfstring{\textbf{dplot3}}{dplot3}}\label{dplot3}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.xy}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-7-1.pdf}

\hypertarget{ggplot2-1}{%
\subsection{\texorpdfstring{\textbf{ggplot2}}{ggplot2}}\label{ggplot2-1}}

Note: The name of the package is \texttt{ggplot2}, the name of the function is \texttt{ggplot}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(Sepal.Length, Petal.Length)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-8-1.pdf}

\hypertarget{plotly}{%
\subsection{\texorpdfstring{\textbf{plotly}}{plotly}}\label{plotly}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{plot\_ly}\NormalTok{(iris, }\AttributeTok{x =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Sepal.Length, }\AttributeTok{y =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Petal.Length) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_trace}\NormalTok{(}\AttributeTok{type =} \StringTok{"scatter"}\NormalTok{, }\AttributeTok{mode =} \StringTok{"markers"}\NormalTok{)}
\NormalTok{p}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-9-1.pdf}

\hypertarget{grouped}{%
\subsection{Grouped}\label{grouped}}

In \texttt{mplot3()} and \texttt{dplot3()}, add a \texttt{group} argument:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length,}
          \AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-10-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.xy}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length,}
          \AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-11-1.pdf}

In \textbf{ggplot2}, specify \texttt{color} within \texttt{aes}.\\
\texttt{ggplot} plots can be assigned to an object. Print the object to view it.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(Sepal.Length, Petal.Length, }\AttributeTok{color =}\NormalTok{ Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\NormalTok{p}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-12-1.pdf}

In \textbf{plotly} define the \texttt{color} argument:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{plot\_ly}\NormalTok{(iris, }\AttributeTok{x =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Sepal.Length, }\AttributeTok{y =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Petal.Length, }\AttributeTok{color =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Species) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_trace}\NormalTok{(}\AttributeTok{type =} \StringTok{"scatter"}\NormalTok{, }\AttributeTok{mode =} \StringTok{"markers"}\NormalTok{)}
\NormalTok{p}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-13-1.pdf}

\hypertarget{scatterplot-with-fit}{%
\section{Scatterplot with fit}\label{scatterplot-with-fit}}

\hypertarget{mplot3-1}{%
\subsection{\texorpdfstring{\textbf{mplot3}}{mplot3}}\label{mplot3-1}}

In \texttt{mplot3.xy()}, define the algorithm to use to fit a curve, with \texttt{fit}. \texttt{se.fit} allows plotting the standard error bar (if it can be provided by the algorithm in \texttt{fit})

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length,}
          \AttributeTok{fit =} \StringTok{"gam"}\NormalTok{, }\AttributeTok{se.fit =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-14-1.pdf}

Passing a \texttt{group} argument, automatically fits separate models:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length,}
          \AttributeTok{fit =} \StringTok{"gam"}\NormalTok{, }\AttributeTok{se.fit =}\NormalTok{ T,}
          \AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-15-1.pdf}

\hypertarget{dplot3-1}{%
\subsection{\texorpdfstring{\textbf{dplot3}}{dplot3}}\label{dplot3-1}}

Same syntax as \texttt{mplot3.xy()} above:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.xy}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length,}
          \AttributeTok{fit =} \StringTok{"gam"}\NormalTok{, }\AttributeTok{se.fit =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-16-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.xy}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length,}
          \AttributeTok{fit =} \StringTok{"gam"}\NormalTok{, }\AttributeTok{se.fit =}\NormalTok{ T,}
          \AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-17-1.pdf}

\hypertarget{ggplot2-2}{%
\subsection{\texorpdfstring{\textbf{ggplot2}}{ggplot2}}\label{ggplot2-2}}

In \texttt{ggplot()}, add a \texttt{geom\_smooth}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length, }\AttributeTok{y =}\NormalTok{ Petal.Length)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{\textquotesingle{}gam\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
`geom_smooth()` using formula 'y ~ s(x, bs = "cs")'
\end{verbatim}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-18-1.pdf}

To group, again, use \texttt{color}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length, }\AttributeTok{y =}\NormalTok{ Petal.Length, }\AttributeTok{color =}\NormalTok{ Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{\textquotesingle{}gam\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
`geom_smooth()` using formula 'y ~ s(x, bs = "cs")'
\end{verbatim}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-19-1.pdf}

\hypertarget{plotly-1}{%
\subsection{\texorpdfstring{\textbf{plotly}}{plotly}}\label{plotly-1}}

In \texttt{plot\_ly()}, \texttt{add\_lines()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mgcv)}
\NormalTok{mod.gam }\OtherTok{\textless{}{-}} \FunctionTok{gam}\NormalTok{(Petal.Length }\SpecialCharTok{\textasciitilde{}} \FunctionTok{s}\NormalTok{(Sepal.Length), }\AttributeTok{data =}\NormalTok{ iris)}
\FunctionTok{plot\_ly}\NormalTok{(iris, }\AttributeTok{x =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Sepal.Length) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{add\_trace}\NormalTok{(}\AttributeTok{y =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Petal.Length, }\AttributeTok{type =} \StringTok{"scatter"}\NormalTok{, }\AttributeTok{mode =} \StringTok{"markers"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_lines}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mod.gam}\SpecialCharTok{$}\NormalTok{fitted.values)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-20-1.pdf}

To get fit by group, you add all elements one after the other - one way would be this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.bySpecies }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(iris, iris}\SpecialCharTok{$}\NormalTok{Species)}
\NormalTok{gam.fitted }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(iris.bySpecies, }\ControlFlowTok{function}\NormalTok{(i) \{}
  \FunctionTok{gam}\NormalTok{(Petal.Length }\SpecialCharTok{\textasciitilde{}} \FunctionTok{s}\NormalTok{(Sepal.Length), }\AttributeTok{data =}\NormalTok{ i)}\SpecialCharTok{$}\NormalTok{fitted}
\NormalTok{\})}
\NormalTok{index }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(iris.bySpecies, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{order}\NormalTok{(i}\SpecialCharTok{$}\NormalTok{Sepal.Length))}
\NormalTok{col }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"\#44A6AC"}\NormalTok{, }\StringTok{"\#F4A362"}\NormalTok{, }\StringTok{"\#3574A7"}\NormalTok{)}
\NormalTok{.names }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(iris.bySpecies)}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{plot\_ly}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(iris.bySpecies)) \{}
\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{add\_trace}\NormalTok{(p, }\AttributeTok{x =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Sepal.Length, }\AttributeTok{y =} \SpecialCharTok{\textasciitilde{}}\NormalTok{Petal.Length, }
                 \AttributeTok{type =} \StringTok{"scatter"}\NormalTok{, }\AttributeTok{mode =} \StringTok{"markers"}\NormalTok{,}
                 \AttributeTok{data =}\NormalTok{ iris.bySpecies[[i]],}
                 \AttributeTok{name =}\NormalTok{ .names[i],}
                 \AttributeTok{color =}\NormalTok{ col[i])}
\NormalTok{\}}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(iris.bySpecies)) \{}
\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{add\_lines}\NormalTok{(p, }\AttributeTok{x =}\NormalTok{ iris.bySpecies[[i]]}\SpecialCharTok{$}\NormalTok{Sepal.Length[index[[i]]],}
                 \AttributeTok{y =}\NormalTok{ gam.fitted[[i]][index[[i]]], }
                 \CommentTok{\# type = "scatter", mode = "markers",}
                 \AttributeTok{data =}\NormalTok{ iris.bySpecies[[i]],}
                 \AttributeTok{name =} \FunctionTok{paste}\NormalTok{(.names[i], }\StringTok{"GAM fit"}\NormalTok{),}
                 \AttributeTok{color =}\NormalTok{ col[i])}
\NormalTok{\}}
\NormalTok{p}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-21-1.pdf}

It's a lot of work, and that's why \texttt{dplot3()} exists.

\hypertarget{density-plot-1}{%
\section{Density plot}\label{density-plot-1}}

There is no builtin density plot, but you can get x and y coordinates from the \texttt{density} function and add a polygon:

\hypertarget{base-3}{%
\subsection{base}\label{base-3}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{.density }\OtherTok{\textless{}{-}} \FunctionTok{density}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length)}
\FunctionTok{class}\NormalTok{(.density)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "density"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(.density}\SpecialCharTok{$}\NormalTok{x, .density}\SpecialCharTok{$}\NormalTok{y,}
     \AttributeTok{type =} \StringTok{"l"}\NormalTok{, }\AttributeTok{yaxs =} \StringTok{"i"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-22-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(.density}\SpecialCharTok{$}\NormalTok{x, .density}\SpecialCharTok{$}\NormalTok{y,}
     \AttributeTok{type =} \StringTok{\textquotesingle{}l\textquotesingle{}}\NormalTok{, }\AttributeTok{yaxs =} \StringTok{"i"}\NormalTok{,}
     \AttributeTok{bty =} \StringTok{"n"}\NormalTok{,}
     \AttributeTok{xlab =} \StringTok{""}\NormalTok{,  }\AttributeTok{ylab =} \StringTok{"Density"}\NormalTok{,}
     \AttributeTok{col =} \StringTok{"\#18A3AC66"}\NormalTok{,}
     \AttributeTok{main =} \StringTok{"Sepal Length Density"}\NormalTok{)}
\FunctionTok{polygon}\NormalTok{(}\FunctionTok{c}\NormalTok{(.density}\SpecialCharTok{$}\NormalTok{x, }\FunctionTok{rev}\NormalTok{(.density}\SpecialCharTok{$}\NormalTok{x)), }\FunctionTok{c}\NormalTok{(.density}\SpecialCharTok{$}\NormalTok{y, }\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{length}\NormalTok{(.density}\SpecialCharTok{$}\NormalTok{y))),}
        \AttributeTok{col =} \StringTok{"\#18A3AC66"}\NormalTok{, }\AttributeTok{border =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-22-2.pdf}

\hypertarget{mplot3-2}{%
\subsection{\texorpdfstring{\textbf{mplot3}}{mplot3}}\label{mplot3-2}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, }\StringTok{\textquotesingle{}density\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-23-1.pdf}

\hypertarget{dplot3-2}{%
\subsection{\texorpdfstring{\textbf{dplot3}}{dplot3}}\label{dplot3-2}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.x}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-24-1.pdf}

\hypertarget{ggplot2-3}{%
\subsection{\texorpdfstring{\textbf{ggplot2}}{ggplot2}}\label{ggplot2-3}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-25-1.pdf}

Add color:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{color =} \StringTok{"\#18A3AC66"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#18A3AC66"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-26-1.pdf}

\hypertarget{grouped-1}{%
\subsubsection{Grouped}\label{grouped-1}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, }\AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-27-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.x}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, }\AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-28-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(Sepal.Length, }\AttributeTok{color =}\NormalTok{ Species, }\AttributeTok{fill =}\NormalTok{ Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha =}\NormalTok{ .}\DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#44A6AC"}\NormalTok{, }\StringTok{"\#F4A362"}\NormalTok{, }\StringTok{"\#3574A7"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#44A6AC"}\NormalTok{, }\StringTok{"\#F4A362"}\NormalTok{, }\StringTok{"\#3574A7"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"Sepal Length"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Density"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-29-1.pdf}

\hypertarget{histogram-1}{%
\section{Histogram}\label{histogram-1}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{base-4}{%
\subsection{base}\label{base-4}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-31-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(a, }\AttributeTok{col =} \StringTok{"\#18A3AC66"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-31-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(a, }\AttributeTok{col =} \StringTok{"\#18A3AC99"}\NormalTok{, }\AttributeTok{border =} \StringTok{"white"}\NormalTok{, }\AttributeTok{main =} \StringTok{""}\NormalTok{, }\AttributeTok{breaks =} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-31-3.pdf}

\hypertarget{mplot3-3}{%
\subsection{\texorpdfstring{\textbf{mplot3}}{mplot3}}\label{mplot3-3}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(a, }\StringTok{"histogram"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-32-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(a, }\StringTok{"histogram"}\NormalTok{, }\AttributeTok{hist.breaks =} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-32-2.pdf}

\hypertarget{dplot3-3}{%
\subsection{\texorpdfstring{\textbf{dplot3}}{dplot3}}\label{dplot3-3}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.x}\NormalTok{(a, }\StringTok{"hist"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-33-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.x}\NormalTok{(a, }\StringTok{"hist"}\NormalTok{, }\AttributeTok{hist.n.bins =} \DecValTok{40}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-33-2.pdf}

\hypertarget{ggplot2-4}{%
\subsection{\texorpdfstring{\textbf{ggplot2}}{ggplot2}}\label{ggplot2-4}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(a)) }\SpecialCharTok{+} \FunctionTok{geom\_histogram}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-34-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(a)) }\SpecialCharTok{+} \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =}\NormalTok{ .}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-34-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(a)) }\SpecialCharTok{+}
    \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#18A3AC99"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-34-3.pdf}

\hypertarget{grouped-2}{%
\subsubsection{Grouped}\label{grouped-2}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.x}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Petal.Length, }\StringTok{\textquotesingle{}h\textquotesingle{}}\NormalTok{, }\AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species, }\AttributeTok{hist.breaks =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-35-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.x}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, }\StringTok{\textquotesingle{}h\textquotesingle{}}\NormalTok{, }\AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-36-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length, }\AttributeTok{fill =}\NormalTok{ Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =}\NormalTok{ .}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-37-1.pdf}

\hypertarget{barplot-1}{%
\subsection{Barplot}\label{barplot-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{schools }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{UCSF =} \DecValTok{4}\NormalTok{, }\AttributeTok{Stanford =} \DecValTok{7}\NormalTok{, }\AttributeTok{Penn =} \DecValTok{12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{base-5}{%
\subsection{base}\label{base-5}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(}\FunctionTok{as.matrix}\NormalTok{(schools))}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-39-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(}\FunctionTok{as.matrix}\NormalTok{(schools), }\AttributeTok{col =} \StringTok{"dodgerblue3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-39-2.pdf}

\hypertarget{mplot3-4}{%
\subsection{\texorpdfstring{\textbf{mplot3}}{mplot3}}\label{mplot3-4}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.bar}\NormalTok{(schools)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-40-1.pdf}

\hypertarget{dplot3-4}{%
\subsection{\texorpdfstring{\textbf{dplot3}}{dplot3}}\label{dplot3-4}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.bar}\NormalTok{(schools)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-41-1.pdf}

\hypertarget{ggplot2-5}{%
\subsection{\texorpdfstring{\textbf{ggplot2}}{ggplot2}}\label{ggplot2-5}}

\texttt{ggplot} requires an explicit column in the data that define the categorical x-axis:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{schools.df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{University =} \FunctionTok{colnames}\NormalTok{(schools),}
                         \AttributeTok{N\_schools =} \FunctionTok{as.numeric}\NormalTok{(schools[}\DecValTok{1}\NormalTok{, ]))}
\FunctionTok{ggplot}\NormalTok{(schools.df, }\FunctionTok{aes}\NormalTok{(University, N\_schools)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{color =} \StringTok{"\#18A3AC"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#18A3AC"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-42-1.pdf}

\hypertarget{box-plot}{%
\section{Box plot}\label{box-plot}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnormmat}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{4}\NormalTok{, }\AttributeTok{return.df =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{seed =} \DecValTok{2019}\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"mango"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"tangerine"}\NormalTok{, }\StringTok{"sugar"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{base-6}{%
\subsection{base}\label{base-6}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-44-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(x, }\AttributeTok{col =} \StringTok{"steelblue4"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-45-1.pdf}

\hypertarget{mplot3-5}{%
\subsection{\texorpdfstring{\textbf{mplot3}}{mplot3}}\label{mplot3-5}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.box}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-46-1.pdf}

\hypertarget{dplot3-5}{%
\subsection{\texorpdfstring{\textbf{dplot3}}{dplot3}}\label{dplot3-5}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.box}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-47-1.pdf}

\hypertarget{ggplot2-6}{%
\subsection{\texorpdfstring{\textbf{ggplot2}}{ggplot2}}\label{ggplot2-6}}

Again, ggplot requires an explicit categorical x-axis, which is this case means a conversion from wide to long dataset:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyr)}
\NormalTok{(x.long }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(x, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\AttributeTok{names\_to =} \StringTok{"Fruit"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"Feature"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(x.long, }\FunctionTok{aes}\NormalTok{(Fruit, Feature)) }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-48-1.pdf}

Add some color:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(x.long, }\FunctionTok{aes}\NormalTok{(Fruit, Feature)) }\SpecialCharTok{+}
   \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#44A6AC66"}\NormalTok{, }\StringTok{"\#F4A36266"}\NormalTok{, }\StringTok{"\#3574A766"}\NormalTok{, }\StringTok{"\#C23A7066"}\NormalTok{),}
                \AttributeTok{colour =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#44A6ACFF"}\NormalTok{, }\StringTok{"\#F4A362FF"}\NormalTok{, }\StringTok{"\#3574A7FF"}\NormalTok{, }\StringTok{"\#C23A70FF"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-49-1.pdf}

\hypertarget{heatmap-1}{%
\section{Heatmap}\label{heatmap-1}}

Let's create some synthetic correlation data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnormmat}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{20}\NormalTok{, }\AttributeTok{seed =} \DecValTok{2020}\NormalTok{)}
\NormalTok{x.cor }\OtherTok{\textless{}{-}} \FunctionTok{cor}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\hypertarget{base-7}{%
\subsection{base}\label{base-7}}

R has a great builtin heatmap function, which supports hierarchical clustering and plots the dendrogram in the margins by default:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{heatmap}\NormalTok{(x.cor)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-51-1.pdf}

It may be a little surprising that clustering is on by default. To disable row and column dendrograms, set \texttt{Rowv} and \texttt{Colv} to \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{heatmap}\NormalTok{(x.cor, }\AttributeTok{Rowv =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{Colv =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-52-1.pdf}

\hypertarget{mplot3-6}{%
\subsection{\texorpdfstring{\textbf{mplot3}}{mplot3}}\label{mplot3-6}}

mplot3 adds a colorbar to the side of the heatmap. Notice there are 10 circles above and 10 circles below zero to represent 10\% increments.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.heatmap}\NormalTok{(x.cor)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-53-1.pdf}

\hypertarget{dplot3-6}{%
\subsection{\texorpdfstring{\textbf{dplot3}}{dplot3}}\label{dplot3-6}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dplot3.heatmap}\NormalTok{(x.cor)}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-54-1.pdf}

\hypertarget{ggplot2-7}{%
\subsection{\texorpdfstring{\textbf{ggplot2}}{ggplot2}}\label{ggplot2-7}}

ggplot does not have a builtin heatmap function per se, but you can use \texttt{geom\_tile} to build one. It also needs a data frame input in long form once again:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x.cor.dat }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(x.cor)}
\FunctionTok{colnames}\NormalTok{(x.cor.dat) }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(x.cor.dat) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"V"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\FunctionTok{colnames}\NormalTok{(x.cor) }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(x.cor) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"V"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\NormalTok{x.cor.long }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{NodeA =} \FunctionTok{rownames}\NormalTok{(x.cor)[}\FunctionTok{row}\NormalTok{(x.cor)],}
                         \AttributeTok{NodeB =} \FunctionTok{colnames}\NormalTok{(x.cor)[}\FunctionTok{col}\NormalTok{(x.cor)],}
                         \AttributeTok{Weight =} \FunctionTok{c}\NormalTok{(x.cor))}
\NormalTok{(p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(x.cor.long, }\FunctionTok{aes}\NormalTok{(NodeA, NodeB, }\AttributeTok{fill =}\NormalTok{ Weight)) }\SpecialCharTok{+}
    \FunctionTok{geom\_tile}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{coord\_equal}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\includegraphics{80-3xGraphics_files/figure-latex/unnamed-chunk-55-1.pdf}

\hypertarget{saving-plots-to-file}{%
\section{Saving plots to file}\label{saving-plots-to-file}}

\hypertarget{base-8}{%
\subsection{base}\label{base-8}}

You can save base graphics to disk using a number of different file formats. To do this, you have to:

\begin{itemize}
\tightlist
\item
  Open a graphic device - e.g.~\texttt{pdf("path/to/xy\_scatter.pdf")}
\item
  Write to it - e.g.~\texttt{plot(x,\ y)}
\item
  Close graphic device - \texttt{dev.off()}
\end{itemize}

The following commands are used to open graphical devices that will save to a file of the corresponding type:

\begin{itemize}
\tightlist
\item
  \texttt{bmp(filename\ =\ "path/to/file",\ width\ =\ {[}in\ pixels{]},\ height\ =\ {[}in\ pixels{]})}
\item
  \texttt{jpeg(filename\ =\ "path/to/file",\ width\ =\ {[}in\ pixels{]},\ height\ =\ {[}in\ pixels{]})}
\item
  \texttt{png(filename\ =\ "path/to/file",\ width\ =\ {[}in\ pixels{]},\ height\ =\ {[}in\ pixels{]})}
\item
  \texttt{tiff(filename\ =\ "path/to/file",\ width\ =\ {[}in\ pixels{]},\ height\ =\ {[}in\ pixels{]})}
\item
  \texttt{svg(filename\ =\ "path/to/file",\ width\ =\ {[}in\ INCHES{]},\ height\ =\ {[}in\ INCHES{]}}
\item
  \texttt{pdf(file\ =\ "path/to/file",\ width\ =\ {[}in\ INCHES{]},\ height\ =\ {[}in\ INCHES{]})}
\end{itemize}

Notice that when writing to a vector graphics format (svg and pdf), you defined width and height in inches, not pixels. Also, you specify \texttt{file} instead of \texttt{filename} in
Notice the difference when writing to PDF: you define a \texttt{file} instead of a \texttt{filename}, and width and height are in INCHES, not pixels.\\
It is recommended to save plots in PDF format because it handles vector graphics therefore plots will scale, and it is easy to export to other graphics formats later on if needed.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pdf}\NormalTok{(}\StringTok{"\textasciitilde{}/Desktop/plot.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{5}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Petal.Length,}
     \AttributeTok{pch =} \DecValTok{16}\NormalTok{,}
     \AttributeTok{col =} \StringTok{"\#18A3AC66"}\NormalTok{,}
     \AttributeTok{cex =} \FloatTok{1.8}\NormalTok{,}
     \AttributeTok{bty =} \StringTok{"n"}\NormalTok{, }\CommentTok{\# also try "l"}
     \AttributeTok{xlab =} \StringTok{"Sepal Length"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"Petal Length"}\NormalTok{)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{colors}{%
\chapter{Colors in R}\label{colors}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rtemis)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

Colors in R can be defined in many different ways:

\begin{itemize}
\tightlist
\item
  Using names: \texttt{colors()} gives all available options
\item
  Using a \href{https://en.wikipedia.org/wiki/Hexadecimal}{hexadecimal} \href{https://en.wikipedia.org/wiki/RGB_color_model}{RGB} code in the form \texttt{\#RRGGBBAA}, e.g.~\texttt{\#FF0000FF} for opaque red
\item
  Using the \texttt{rgb(red,\ green,\ blue,\ alpha)} function (outputs a hex number)
\item
  Using the \texttt{hsv(h,\ s,\ v,\ alpha)} function for the \href{https://en.wikipedia.org/wiki/HSL_and_HSV}{HSV color system} (also outputs a hex number)
\item
  Using integers: these index the output of \texttt{palette()}, whose defaults can be changed by the user (e.g.~\texttt{palette("cyan",\ "blue",\ "magenta",\ "red")})
\end{itemize}

\hypertarget{color-names}{%
\section{Color names}\label{color-names}}

There is a long list of color names R understands, and can be listed using \texttt{colors()}.\\
They can be passed directly as characters.\\
Shades of gray are provided as \texttt{gray0}/\texttt{grey0} (white) to \texttt{gray100}/\texttt{grey100} (black).\\
Absurdly wide PDFs with all built-in R colors, excluding the grays/greys, are available sorted \href{https://rtemis.netlify.com/RColors.pdf}{alphabeticaly} and sorted by \href{https://rtemis.netlify.com/RColors_incRed_decBlueGreen.pdf}{increasing Red and decreasing Green and Blue values}

\hypertarget{hexadecimal-codes}{%
\section{Hexadecimal codes}\label{hexadecimal-codes}}

Hexadecimal color codes are characters starting with the pound sign, followed by 4 pairs of hex codes representing Red, Green, Blue, and Alpha values. Since RGB values go from 0 to 255, hex goes from 00 to FF. You can convert decimal to hex using \texttt{as.hexmode}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.hexmode}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "0"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.hexmode}\NormalTok{(}\DecValTok{127}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "7f"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.hexmode}\NormalTok{(}\DecValTok{255}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "ff"
\end{verbatim}

The last two values for the alpha setting are optional: if not included, defaults to max (opaque)

\hypertarget{rgb}{%
\section{RGB}\label{rgb}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rgb}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "#0000FF"
\end{verbatim}

Note the default \texttt{maxColorValue\ =\ 1}, set to 255 to use the usual RGB range of 0 to 255:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rgb}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{255}\NormalTok{, }\AttributeTok{maxColorValue =} \DecValTok{255}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "#0000FF"
\end{verbatim}

\hypertarget{hsv}{%
\section{HSV}\label{hsv}}

Color can also be parameterized using the hue, saturation, and value system (\href{https://en.wikipedia.org/wiki/HSL_and_HSV}{HSV}). Each range from 0 to 1.\\
Simplistically: Hue controls the color. Saturation 1 is max color and 0 is white. Value 1 is max color and 0 is black.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hsv}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "#FF0000"
\end{verbatim}

In the following plot, the values around the polar plot represent hue. Moving inwards to the center, saturation changes from 1 to 0.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot.hsv}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{81-Colors_files/figure-latex/unnamed-chunk-8-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot.hsv}\NormalTok{(}\AttributeTok{v =}\NormalTok{ .}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{81-Colors_files/figure-latex/unnamed-chunk-8-2.pdf}

\hypertarget{profiling}{%
\chapter{Timing \& Profiling}\label{profiling}}

Profiling your code involves timing the execution of different steps of a program. This is usually performed in order to identify bottlenecks that slow down the execution of your code and it helps you prioritize which parts to optimize. A

\hypertarget{time-the-execution-of-an-expression-with-system.time}{%
\section{\texorpdfstring{Time the execution of an expression with \texttt{system.time}}{Time the execution of an expression with system.time}}\label{time-the-execution-of-an-expression-with-system.time}}

If you want to time how long it takes for an R expression to complete, you can use the base command \texttt{system.time}.\\
``elapsed'' time is real time in seconds. ``user'' and ``system'' are time used by the CPU on different types of tasks (see \texttt{?proc.time})

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{9999}\NormalTok{)}
\FunctionTok{system.time}\NormalTok{(\{}
\NormalTok{    y }\OtherTok{\textless{}{-}} \FunctionTok{vector}\NormalTok{(}\StringTok{"numeric"}\NormalTok{, }\DecValTok{9999}\NormalTok{)}
    \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9999}\NormalTok{) y[i] }\OtherTok{\textless{}{-}}\NormalTok{ x[i]}\SpecialCharTok{\^{}}\DecValTok{3}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   user  system elapsed 
  0.009   0.000   0.025 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{system.time}\NormalTok{(x}\SpecialCharTok{\^{}}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   user  system elapsed 
      0       0       0 
\end{verbatim}

You can use \texttt{replicate()} to get a measure of time over multiple executions and average it:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mgcv)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Loading required package: nlme
\end{verbatim}

\begin{verbatim}
This is mgcv 1.8-33. For overview type 'help("mgcv-package")'.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(glmnet)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Loading required package: Matrix
\end{verbatim}

\begin{verbatim}
Loaded glmnet 4.0-2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\DecValTok{100}\NormalTok{, }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{5000}\NormalTok{))}
\NormalTok{y }\OtherTok{\textless{}{-}}\NormalTok{ x[, }\DecValTok{1}\NormalTok{]}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{+}\NormalTok{ x[, }\DecValTok{5}\NormalTok{]}\SpecialCharTok{\^{}}\DecValTok{3} \SpecialCharTok{+} \DecValTok{12} \SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{5000}\NormalTok{)}
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(x, y)}
\NormalTok{fit.glm }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(dat) mod }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{family =}\NormalTok{ gaussian, }\AttributeTok{data =}\NormalTok{ dat)}
\NormalTok{fit.gam }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(dat) mod }\OtherTok{\textless{}{-}} \FunctionTok{gam}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{family =}\NormalTok{ gaussian, }\AttributeTok{data =}\NormalTok{ dat)}
    
\FunctionTok{system.time}\NormalTok{(}\FunctionTok{replicate}\NormalTok{(}\DecValTok{1000}\NormalTok{, fit.glm))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   user  system elapsed 
  0.002   0.000   0.002 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{system.time}\NormalTok{(}\FunctionTok{replicate}\NormalTok{(}\DecValTok{1000}\NormalTok{, fit.gam))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   user  system elapsed 
  0.002   0.001   0.002 
\end{verbatim}

\hypertarget{compare-execution-times-of-different-expressions-with-microbenchmark}{%
\section{\texorpdfstring{Compare execution times of different expressions with \texttt{microbenchmark()}}{Compare execution times of different expressions with microbenchmark()}}\label{compare-execution-times-of-different-expressions-with-microbenchmark}}

\texttt{microbenchmark()} allows you to time the execution of multiple expressions with sub-millisecond accuracy. It will execute each command a number of times as defined by the \texttt{times} argument (default = 100), and output statistics of execution time per expression in nanoseconds. Using \texttt{plot()} on the output produces a boxplot comparing the time distributions.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(microbenchmark)}
\end{Highlighting}
\end{Shaded}

To start, we compare two very simple and fast operations, using base and dplyr to add two columns of 1000 integers:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2000}\NormalTok{, }\DecValTok{1000}\NormalTok{))}
\FunctionTok{dim}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1000    2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Attaching package: 'dplyr'
\end{verbatim}

\begin{verbatim}
The following object is masked from 'package:nlme':

    collapse
\end{verbatim}

\begin{verbatim}
The following objects are masked from 'package:stats':

    filter, lag
\end{verbatim}

\begin{verbatim}
The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{add2k }\OtherTok{\textless{}{-}} \FunctionTok{microbenchmark}\NormalTok{(}
  \AttributeTok{base =}\NormalTok{ dat}\SpecialCharTok{$}\NormalTok{V1 }\SpecialCharTok{+}\NormalTok{ dat}\SpecialCharTok{$}\NormalTok{V2,}
  \AttributeTok{dplyr =} \FunctionTok{mutate}\NormalTok{(dat, }\AttributeTok{a =}\NormalTok{ V1 }\SpecialCharTok{+}\NormalTok{ V2))}
\end{Highlighting}
\end{Shaded}

You can print microbenchmark's output:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{add2k}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Unit: microseconds
  expr      min        lq       mean   median        uq       max neval
  base    5.309    9.7365   12.73019   11.344   15.7725    25.192   100
 dplyr 1592.700 2899.1205 4141.33201 3486.591 4175.6945 15852.130   100
\end{verbatim}

and plot it:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(add2k)}
\end{Highlighting}
\end{Shaded}

\includegraphics{82-Profiling_files/figure-latex/unnamed-chunk-10-1.pdf}

Now let's use the \textbf{nycflights13} dataset which includes data on 336776 flights that departed from any of the three NY area airports in 2013. Because the data comes as a \href{https://tibble.tidyverse.org/}{tibble}, we shall perform all operations on the tibble and a data.frame of the same data to compare.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(nycflights13)}
\FunctionTok{class}\NormalTok{(flights)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "tbl_df"     "tbl"        "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(flights)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 336776     19
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{flightsDF }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(flights)}
\end{Highlighting}
\end{Shaded}

Compare performance base R vs.~dplyr in calculating mean arrival delay by carrier using either a data.frame or a tibble:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dbc }\OtherTok{\textless{}{-}} \FunctionTok{microbenchmark}\NormalTok{(}
  \AttributeTok{df\_aggregate =} \FunctionTok{aggregate}\NormalTok{(flightsDF}\SpecialCharTok{$}\NormalTok{arr\_delay, }\AttributeTok{by =} \FunctionTok{list}\NormalTok{(flightsDF}\SpecialCharTok{$}\NormalTok{carrier), mean, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{tb\_aggregate =} \FunctionTok{aggregate}\NormalTok{(flights}\SpecialCharTok{$}\NormalTok{arr\_delay, }\AttributeTok{by =} \FunctionTok{list}\NormalTok{(flights}\SpecialCharTok{$}\NormalTok{carrier), mean, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{df\_tapply =} \FunctionTok{tapply}\NormalTok{(flightsDF}\SpecialCharTok{$}\NormalTok{arr\_delay, flightsDF}\SpecialCharTok{$}\NormalTok{carrier, mean, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{tb\_tapply =} \FunctionTok{tapply}\NormalTok{(flights}\SpecialCharTok{$}\NormalTok{arr\_delay, flights}\SpecialCharTok{$}\NormalTok{carrier, mean, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{df\_dplyr =}\NormalTok{ flightsDF }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(carrier) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarize}\NormalTok{(}\FunctionTok{mean}\NormalTok{(arr\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)),}
  \AttributeTok{tb\_dplyr =}\NormalTok{ flights }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(carrier) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarize}\NormalTok{(}\FunctionTok{mean}\NormalTok{(arr\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dbc}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Unit: milliseconds
         expr       min        lq      mean    median        uq      max neval
 df_aggregate 145.18933 166.15032 200.49377 181.17381 204.82293 511.5237   100
 tb_aggregate 142.63626 173.04446 212.69023 192.43706 214.19815 545.5704   100
    df_tapply  28.82071  37.13181  50.59273  44.15174  54.77855 234.0097   100
    tb_tapply  26.45343  35.06375  51.39519  42.73230  55.47136 212.5443   100
     df_dplyr  18.65289  26.69642  34.68732  29.81424  37.77431 108.7151   100
     tb_dplyr  20.98778  26.15729  36.95620  29.65130  43.18180 124.7991   100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(dbc)}
\end{Highlighting}
\end{Shaded}

\includegraphics{82-Profiling_files/figure-latex/unnamed-chunk-13-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rpart)}
\FunctionTok{data}\NormalTok{(Sonar, }\AttributeTok{package =} \StringTok{"mlbench"}\NormalTok{)}

\NormalTok{glmVSrpart }\OtherTok{\textless{}{-}} \FunctionTok{microbenchmark}\NormalTok{(}
  \AttributeTok{glm =} \FunctionTok{glm}\NormalTok{(Class }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{family =} \StringTok{"binomial"}\NormalTok{, Sonar),}
  \AttributeTok{rpart =} \FunctionTok{rpart}\NormalTok{(Class }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., Sonar, }\AttributeTok{method =} \StringTok{"class"}\NormalTok{),}
  \AttributeTok{times =} \DecValTok{50}\NormalTok{)}

\FunctionTok{plot}\NormalTok{(glmVSrpart)}
\end{Highlighting}
\end{Shaded}

\includegraphics{82-Profiling_files/figure-latex/unnamed-chunk-14-1.pdf}

\hypertarget{profile-a-function-with-profvis}{%
\section{\texorpdfstring{Profile a function with \texttt{profvis()}}{Profile a function with profvis()}}\label{profile-a-function-with-profvis}}

\texttt{profvis} provides an interactive output to visualize how much time is spent in different calls within an algorithm.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(profvis)}
\FunctionTok{library}\NormalTok{(rtemis)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(Sonar, }\AttributeTok{package =} \StringTok{\textquotesingle{}mlbench\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{profvis}\NormalTok{(rpart}\SpecialCharTok{::}\FunctionTok{rpart}\NormalTok{(Class }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., Sonar))}
\end{Highlighting}
\end{Shaded}

\includegraphics{82-Profiling_files/figure-latex/unnamed-chunk-16-1.pdf}

\hypertarget{optim}{%
\chapter{\texorpdfstring{Optimization with \texttt{optim()}}{Optimization with optim()}}\label{optim}}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

R provides a general purpose optimization tool, \texttt{optim()}. You can use it to estimate parameters that minimize any defined function.\\
Supervised and unsupervised learning involves defining a loss function to minimize or an objective function to minimize or maximize.\\
To learn how \texttt{optim()} works, let's write a simple function that returns linear coefficients by minimizing squared error.

\hypertarget{data}{%
\section{Data}\label{data}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{))}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{12} \SpecialCharTok{+} \FloatTok{1.5} \SpecialCharTok{*}\NormalTok{ x[, }\DecValTok{3}\NormalTok{] }\SpecialCharTok{+} \FloatTok{3.2} \SpecialCharTok{*}\NormalTok{ x[, }\DecValTok{7}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ .}\DecValTok{5} \SpecialCharTok{*}\NormalTok{ x[, }\DecValTok{9}\NormalTok{] }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{glm-glm-s.glm}{%
\section{\texorpdfstring{GLM (\texttt{glm}, \texttt{s.GLM})}{GLM (glm, s.GLM)}}\label{glm-glm-s.glm}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{yx.glm }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x)}
\FunctionTok{summary}\NormalTok{(yx.glm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Call:
glm(formula = y ~ x)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.38739  -0.67391   0.00312   0.65531   3.08524  

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) 11.979070   0.043252 276.962   <2e-16 ***
x1           0.061798   0.040916   1.510   0.1316    
x2          -0.003873   0.043271  -0.090   0.9287    
x3           1.488113   0.042476  35.034   <2e-16 ***
x4           0.031115   0.044015   0.707   0.4800    
x5           0.034217   0.043664   0.784   0.4336    
x6           0.034716   0.042189   0.823   0.4110    
x7           3.183398   0.040605  78.399   <2e-16 ***
x8          -0.034252   0.043141  -0.794   0.4276    
x9           0.541219   0.046550  11.627   <2e-16 ***
x10          0.087120   0.044000   1.980   0.0483 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 0.9207315)

    Null deviance: 7339.42  on 499  degrees of freedom
Residual deviance:  450.24  on 489  degrees of freedom
AIC: 1390.5

Number of Fisher Scoring iterations: 2
\end{verbatim}

Or, using \emph{rtemis}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod.glm }\OtherTok{\textless{}{-}} \FunctionTok{s.GLM}\NormalTok{(x, y)}
\end{Highlighting}
\end{Shaded}

\includegraphics{83-Optimization_files/figure-latex/unnamed-chunk-6-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(mod.glm}\SpecialCharTok{$}\NormalTok{mod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Call:
glm(formula = .formula, family = family, data = df.train, weights = .weights, 
    na.action = na.action)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.38739  -0.67391   0.00312   0.65531   3.08524  

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) 11.979070   0.043252 276.962   <2e-16 ***
V1           0.061798   0.040916   1.510   0.1316    
V2          -0.003873   0.043271  -0.090   0.9287    
V3           1.488113   0.042476  35.034   <2e-16 ***
V4           0.031115   0.044015   0.707   0.4800    
V5           0.034217   0.043664   0.784   0.4336    
V6           0.034716   0.042189   0.823   0.4110    
V7           3.183398   0.040605  78.399   <2e-16 ***
V8          -0.034252   0.043141  -0.794   0.4276    
V9           0.541219   0.046550  11.627   <2e-16 ***
V10          0.087120   0.044000   1.980   0.0483 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 0.9207315)

    Null deviance: 7339.42  on 499  degrees of freedom
Residual deviance:  450.24  on 489  degrees of freedom
AIC: 1390.5

Number of Fisher Scoring iterations: 2
\end{verbatim}

\hypertarget{optim-1}{%
\section{\texorpdfstring{\texttt{optim}}{optim}}\label{optim-1}}

Basic usage of \texttt{optim} to find values of parameters that minimize a function:

\begin{itemize}
\tightlist
\item
  Define a list of initial parameter values
\item
  Define a loss function whose first argument is the above list of initial parameter values
\item
  Pass parameter list and objective function to \texttt{optim}
\end{itemize}

In the following example, we wrap these three steps in a function called \texttt{linearcoeffs}, which will output the linear coefficients that minimize squared error, given a matrix/data.frame of features \texttt{x} and an outcome \texttt{y}. We also specify the optimization method to be used (See \texttt{?base::optim} for details):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{linearcoeffs }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y, }\AttributeTok{method =} \StringTok{"BFGS"}\NormalTok{) \{}
  
  \CommentTok{\# 1. List of initial parameter values}
\NormalTok{  params }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{mean}\NormalTok{(y), }\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{NCOL}\NormalTok{(x))))}
  \FunctionTok{names}\NormalTok{(params) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Intercept"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"Coefficient"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\FunctionTok{NCOL}\NormalTok{(x))))}
  
  \CommentTok{\# 2. Loss function: first argument is parameter list}
\NormalTok{  loss }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(params, x, y) \{}
\NormalTok{    estimated }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(params[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ x }\SpecialCharTok{\%*\%} \FunctionTok{unlist}\NormalTok{(params[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]))}
    \FunctionTok{mean}\NormalTok{((y }\SpecialCharTok{{-}}\NormalTok{ estimated)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{  \}}
  
  \CommentTok{\# 3. optim!}
\NormalTok{  coeffs }\OtherTok{\textless{}{-}} \FunctionTok{optim}\NormalTok{(params, loss, }\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{method =}\NormalTok{ method)}
  
  \CommentTok{\# The values that minimize the loss function are stored in $par}
\NormalTok{  coeffs}\SpecialCharTok{$}\NormalTok{par}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{coeffs.optim }\OtherTok{\textless{}{-}} \FunctionTok{linearcoeffs}\NormalTok{(x, y)}
\NormalTok{estimated.optim }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{, x) }\SpecialCharTok{\%*\%}\NormalTok{ coeffs.optim}
\FunctionTok{mplot3.fit}\NormalTok{(y, estimated.optim)}
\end{Highlighting}
\end{Shaded}

\includegraphics{83-Optimization_files/figure-latex/unnamed-chunk-9-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{coeffs.glm }\OtherTok{\textless{}{-}}\NormalTok{ mod.glm}\SpecialCharTok{$}\NormalTok{mod}\SpecialCharTok{$}\NormalTok{coefficients}
\NormalTok{estimated.glm }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{, x) }\SpecialCharTok{\%*\%}\NormalTok{ coeffs.glm}
\FunctionTok{mplot3.fit}\NormalTok{(y, estimated.glm)}
\end{Highlighting}
\end{Shaded}

\includegraphics{83-Optimization_files/figure-latex/unnamed-chunk-9-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.fit}\NormalTok{(coeffs.glm, coeffs.optim)}
\end{Highlighting}
\end{Shaded}

\includegraphics{83-Optimization_files/figure-latex/unnamed-chunk-10-1.pdf}

\hypertarget{glm}{%
\chapter{Introduction to the GLM}\label{glm}}

\begin{verbatim}
##   .:rtemis 0.8.1: Welcome, egenn
##   [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
##   Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

\hypertarget{generalized-linear-model-glm}{%
\section{Generalized Linear Model (GLM)}\label{generalized-linear-model-glm}}

The Generalized Linear Model is one of the most common and important models in statistics.\\
Let's look at an example using the GLM for regression. We will use the \texttt{mtcars} builtin dataset to predict horsepower (\texttt{hp}) of 32 cars from 10 other features:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
'data.frame':   32 obs. of  11 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
 $ disp: num  160 160 108 258 360 ...
 $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
 $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
 $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
 $ qsec: num  16.5 17 18.6 19.4 17 ...
 $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
 $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
 $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
 $ carb: num  4 4 1 1 2 1 4 2 2 4 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(hp }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{family =} \StringTok{"gaussian"}\NormalTok{, }\AttributeTok{data =}\NormalTok{ mtcars)}
\NormalTok{mod}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Call:  glm(formula = hp ~ ., family = "gaussian", data = mtcars)

Coefficients:
(Intercept)          mpg          cyl         disp         drat           wt  
     79.048       -2.063        8.204        0.439       -4.619      -27.660  
       qsec           vs           am         gear         carb  
     -1.784       25.813        9.486        7.216       18.749  

Degrees of Freedom: 31 Total (i.e. Null);  21 Residual
Null Deviance:      145700 
Residual Deviance: 14160    AIC: 309.8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(mod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "glm" "lm" 
\end{verbatim}

The \texttt{glm()} function accepts a formula that defines the model.\\
The formula \texttt{hp\ \textasciitilde{}\ .} means ``regress hp on all other variables.'' The \texttt{family} argument defines we are performing regression and the \texttt{data} argument points to the data frame where the covariates used in the formula are found.

For a gaussian output, we can also use the \texttt{lm()} function. There are minor differences in the output created, but the model is the same:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(hp }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ mtcars)}
\NormalTok{mod}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Call:
lm(formula = hp ~ ., data = mtcars)

Coefficients:
(Intercept)          mpg          cyl         disp         drat           wt  
     79.048       -2.063        8.204        0.439       -4.619      -27.660  
       qsec           vs           am         gear         carb  
     -1.784       25.813        9.486        7.216       18.749  
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(mod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "lm"
\end{verbatim}

\hypertarget{summary-1}{%
\subsection{Summary}\label{summary-1}}

Get summary of the model using \texttt{summary()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(mod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Call:
lm(formula = hp ~ ., data = mtcars)

Residuals:
    Min      1Q  Median      3Q     Max 
-38.681 -15.558   0.799  18.106  34.718 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)   
(Intercept)  79.0484   184.5041   0.428  0.67270   
mpg          -2.0631     2.0906  -0.987  0.33496   
cyl           8.2037    10.0861   0.813  0.42513   
disp          0.4390     0.1492   2.942  0.00778 **
drat         -4.6185    16.0829  -0.287  0.77680   
wt          -27.6600    19.2704  -1.435  0.16591   
qsec         -1.7844     7.3639  -0.242  0.81089   
vs           25.8129    19.8512   1.300  0.20758   
am            9.4863    20.7599   0.457  0.65240   
gear          7.2164    14.6160   0.494  0.62662   
carb         18.7487     7.0288   2.667  0.01441 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 25.97 on 21 degrees of freedom
Multiple R-squared:  0.9028,    Adjusted R-squared:  0.8565 
F-statistic:  19.5 on 10 and 21 DF,  p-value: 1.898e-08
\end{verbatim}

Note how R prints stars next to covariates whose p-values falls within certain limits, described right below the table of estimates.\\
Above, for example, the p-value for \texttt{disp} falls between 0.001 and 0.01 and therefore gets highlighted with 2 stars.

\hypertarget{coefficients}{%
\subsection{Coefficients}\label{coefficients}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{coefficients}\NormalTok{(mod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept)         mpg         cyl        disp        drat          wt 
 79.0483879  -2.0630545   8.2037204   0.4390024  -4.6185488 -27.6600472 
       qsec          vs          am        gear        carb 
 -1.7843654  25.8128774   9.4862914   7.2164047  18.7486691 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# or}
\NormalTok{mod}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept)         mpg         cyl        disp        drat          wt 
 79.0483879  -2.0630545   8.2037204   0.4390024  -4.6185488 -27.6600472 
       qsec          vs          am        gear        carb 
 -1.7843654  25.8128774   9.4862914   7.2164047  18.7486691 
\end{verbatim}

\hypertarget{fitted-values}{%
\subsection{Fitted values}\label{fitted-values}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fitted}\NormalTok{(mod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
          Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
          148.68122           140.62866            79.99158           125.75448 
  Hornet Sportabout             Valiant          Duster 360           Merc 240D 
          183.21756           111.38490           228.02497            77.13692 
           Merc 230            Merc 280           Merc 280C          Merc 450SE 
           72.71717           146.00088           147.81854           152.01285 
         Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
          159.20364           161.43931           236.24493           226.12625 
  Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
          210.31169            48.04587            83.55415            50.29692 
      Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
           65.46675           171.23732           165.49280           216.59542 
   Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
          188.81358            67.04615            84.64992           110.35672 
     Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
          253.68881           188.34908           300.28196            93.42896 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# or}
\NormalTok{mod}\SpecialCharTok{$}\NormalTok{fitted.values}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
          Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
          148.68122           140.62866            79.99158           125.75448 
  Hornet Sportabout             Valiant          Duster 360           Merc 240D 
          183.21756           111.38490           228.02497            77.13692 
           Merc 230            Merc 280           Merc 280C          Merc 450SE 
           72.71717           146.00088           147.81854           152.01285 
         Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
          159.20364           161.43931           236.24493           226.12625 
  Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
          210.31169            48.04587            83.55415            50.29692 
      Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
           65.46675           171.23732           165.49280           216.59542 
   Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
          188.81358            67.04615            84.64992           110.35672 
     Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
          253.68881           188.34908           300.28196            93.42896 
\end{verbatim}

\hypertarget{residuals}{%
\subsection{Residuals}\label{residuals}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{residuals}\NormalTok{(mod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
          Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
         -38.681220          -30.628664           13.008418          -15.754483 
  Hornet Sportabout             Valiant          Duster 360           Merc 240D 
          -8.217565           -6.384902           16.975025          -15.136925 
           Merc 230            Merc 280           Merc 280C          Merc 450SE 
          22.282827          -23.000881          -24.818538           27.987149 
         Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
          20.796356           18.560690          -31.244931          -11.126253 
  Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
          19.688306           17.954127          -31.554152           14.703084 
      Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
          31.533250          -21.237322          -15.492798           28.404576 
   Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
         -13.813582           -1.046152            6.350078            2.643283 
     Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
          10.311194          -13.349075           34.718037           15.571042 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# or}
\NormalTok{mod}\SpecialCharTok{$}\NormalTok{residuals}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
          Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
         -38.681220          -30.628664           13.008418          -15.754483 
  Hornet Sportabout             Valiant          Duster 360           Merc 240D 
          -8.217565           -6.384902           16.975025          -15.136925 
           Merc 230            Merc 280           Merc 280C          Merc 450SE 
          22.282827          -23.000881          -24.818538           27.987149 
         Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
          20.796356           18.560690          -31.244931          -11.126253 
  Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
          19.688306           17.954127          -31.554152           14.703084 
      Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
          31.533250          -21.237322          -15.492798           28.404576 
   Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
         -13.813582           -1.046152            6.350078            2.643283 
     Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
          10.311194          -13.349075           34.718037           15.571042 
\end{verbatim}

\hypertarget{p-values}{%
\subsection{p-values}\label{p-values}}

To extract the p-values of the intercept and each coefficient, we use \texttt{coef()} on \texttt{summary()}. The final (4th) column lists the p-values:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{coef}\NormalTok{(}\FunctionTok{summary}\NormalTok{(mod))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
               Estimate  Std. Error    t value    Pr(>|t|)
(Intercept)  79.0483879 184.5040756  0.4284371 0.672695339
mpg          -2.0630545   2.0905650 -0.9868407 0.334955314
cyl           8.2037204  10.0861425  0.8133655 0.425134929
disp          0.4390024   0.1492007  2.9423609 0.007779725
drat         -4.6185488  16.0829171 -0.2871711 0.776795845
wt          -27.6600472  19.2703681 -1.4353668 0.165910518
qsec         -1.7843654   7.3639133 -0.2423121 0.810889101
vs           25.8128774  19.8512410  1.3003156 0.207583411
am            9.4862914  20.7599371  0.4569518 0.652397317
gear          7.2164047  14.6160152  0.4937327 0.626619355
carb         18.7486691   7.0287674  2.6674192 0.014412403
\end{verbatim}

\hypertarget{plot-linear-fit}{%
\subsection{Plot linear fit}\label{plot-linear-fit}}

You use \texttt{lines()} to add a line on top of a scatterplot drawn with \texttt{plot()}.\\
\texttt{lines()} accepts \texttt{x} and \texttt{y} vectors of coordinates:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{73} \SpecialCharTok{*}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ .}\DecValTok{5} \SpecialCharTok{*} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\NormalTok{xy.fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(y}\SpecialCharTok{\textasciitilde{}}\NormalTok{x)}\SpecialCharTok{$}\NormalTok{fitted}
\FunctionTok{plot}\NormalTok{(x, y, }\AttributeTok{pch =} \DecValTok{16}\NormalTok{, }\AttributeTok{col =} \StringTok{"\#18A3AC99"}\NormalTok{)}
\FunctionTok{lines}\NormalTok{(x, xy.fit, }\AttributeTok{col =} \StringTok{"\#178CCB"}\NormalTok{, }\AttributeTok{lwd =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{85-GLM_files/figure-latex/unnamed-chunk-11-1.pdf}

In \textbf{rtemis}, you can use argument \texttt{fit} to use any supported algorithm (see \texttt{modSelect()}) to estimate the fit:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(x, y, }\AttributeTok{fit =} \StringTok{"glm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{85-GLM_files/figure-latex/unnamed-chunk-12-1.pdf}

\hypertarget{mass-univariate-analysis}{%
\section{Mass-univariate analysis}\label{mass-univariate-analysis}}

There are many cases where we have a large number of predictors and, along with any other number of tests or models, we may want to regress our outcome of interest on each covariate, one at a time.

Let's create some synthetic data with 1000 cases and 100 covariates\\
The outcome is generated using just 4 of those 100 covariates and has added noise.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{n\_col }\OtherTok{\textless{}{-}} \DecValTok{100}
\NormalTok{n\_row }\OtherTok{\textless{}{-}} \DecValTok{1000}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(}\FunctionTok{seq}\NormalTok{(n\_col), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rnorm}\NormalTok{(n\_row)),}
                   \AttributeTok{col.names =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Feature\_"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(n\_col)))}
\FunctionTok{dim}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1000  100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{7} \SpecialCharTok{+}\NormalTok{ x[, }\DecValTok{10}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ .}\DecValTok{3} \SpecialCharTok{*}\NormalTok{ x[, }\DecValTok{20}\NormalTok{] }\SpecialCharTok{+} \FloatTok{1.3} \SpecialCharTok{*}\NormalTok{ x[, }\DecValTok{30}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ x[, }\DecValTok{50}\NormalTok{] }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Let's fit a linear model regressing y on each column of x using \texttt{lm}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod.xy.massuni }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{seq}\NormalTok{(x), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{lm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x[, i]))}
\FunctionTok{length}\NormalTok{(mod.xy.massuni)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(mod.xy.massuni) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"mod"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

To extract p-values for each model, we must find where exactly to look.\\
Let's look into the first model:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(ms1 }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(mod.xy.massuni}\SpecialCharTok{$}\NormalTok{mod1))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Call:
lm(formula = y ~ x[, i])

Residuals:
    Min      1Q  Median      3Q     Max 
-8.5402 -1.4881 -0.0618  1.4968  5.8152 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.61800    0.06878   8.985   <2e-16 ***
x[, i]       0.08346    0.06634   1.258    0.209    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.174 on 998 degrees of freedom
Multiple R-squared:  0.001584,  Adjusted R-squared:  0.0005831 
F-statistic: 1.583 on 1 and 998 DF,  p-value: 0.2086
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ms1}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
              Estimate Std. Error  t value     Pr(>|t|)
(Intercept) 0.61800326 0.06878142 8.985032 1.266204e-18
x[, i]      0.08346393 0.06634074 1.258110 2.086464e-01
\end{verbatim}

The p-values for each feature is stored in row 1, column 4 fo the coefficients matrix. Let's extract all of them:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod.xy.massuni.pvals }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(mod.xy.massuni, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{summary}\NormalTok{(i)}\SpecialCharTok{$}\NormalTok{coefficients[}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

Let's see which variable are significant at the 0.05:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{which}\NormalTok{(mod.xy.massuni.pvals }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{05}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 mod5 mod10 mod12 mod20 mod28 mod30 mod42 mod50 mod61 mod65 mod72 mod82 mod85 
    5    10    12    20    28    30    42    50    61    65    72    82    85 
mod91 mod94 mod99 
   91    94    99 
\end{verbatim}

\ldots and which are significant at the 0.01 level:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{which}\NormalTok{(mod.xy.massuni.pvals }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{01}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
mod10 mod20 mod28 mod30 mod50 
   10    20    28    30    50 
\end{verbatim}

\hypertarget{multiple-comparison-correction}{%
\section{Multiple comparison correction}\label{multiple-comparison-correction}}

We've performed a large number of tests and before reporting the results, we need to control for \href{https://en.wikipedia.org/wiki/Multiple_comparisons_problem}{multiple comparisons}.\\
To do that, we use R's \texttt{p.adjust()} function. It adjusts a vector of p-values to account for multiple comparisons using one of multiple methods. The default, and recommended, is the \href{https://en.wikipedia.org/wiki/Holm\%E2\%80\%93Bonferroni_method}{Holm method}. It ensures that \texttt{FWER\ \textless{}\ α}, i.e.~controls the \href{https://en.wikipedia.org/wiki/Family-wise_error_rate}{family-wise error rate}, a.k.a. the probability of making one or more false discoveries (Type I errors)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod.xy.massuni.pvals.holm\_adjusted }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(mod.xy.massuni.pvals)}
\end{Highlighting}
\end{Shaded}

Now, let's see which features' p-values survive the magical .05 threshold:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{which}\NormalTok{(mod.xy.massuni.pvals.holm\_adjusted }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{05}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
mod10 mod20 mod30 mod50 
   10    20    30    50 
\end{verbatim}

These are indeed the correct features (not surprisingly, still reassuringly).

\hypertarget{resampling}{%
\chapter{Resampling}\label{resampling}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rtemis)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

\textbf{Resampling} refers to a collection of techniques for selecting cases from a sample. It is central to many machine learning algorithms and pipelines. The two core uses of resampling in predictive modeling / machinbe learning are \textbf{model selection (a.k.a. tuning)} and \textbf{model assessment}. By convention, we use the terms \textbf{\emph{training}} and \textbf{\emph{validation}} set when refering to model selection, and \textbf{\emph{training}} and \textbf{\emph{testing}} set when refering to model assessment. The terminology is unfortunately not intuitive and has led to much confusion. Some people reverse the terms, but we use the terms training, validation, and testing as they are used in the \href{https://web.stanford.edu/~hastie/ElemStatLearn/}{Elements of Statistical Learning} (p.~222, Second edition, 12th printing).

\hypertarget{model-selection-and-assessment}{%
\section{Model Selection and Assessment}\label{model-selection-and-assessment}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Model Selection} aka \textbf{Hyperparameter tuning}
\end{enumerate}

Resamples of the training set are drawn creating multiple \textbf{\emph{training}} and \textbf{\emph{validation}} sets. For each resample, a combination of hyperparameters is used to train a model. The mean validation-set error across resamples is calculated. The combination of hyperparameters with the minimum loss on average across validation-set resamples is selected to train the full training sample.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  \textbf{Model assessment}
\end{enumerate}

Resamples of the full sample are drawn, resulting into multiple training - testing sets. A model is trained on each training set and its performance assessed on the corresponding test set. Model performance is averaged across all test sets.

\textbf{Nested resampling} or \textbf{nested crossvalidation} is the procedure where 1. and 2. are nested so that hyperparameter tuning (resampling of the training set) is performed within each of multiple training resamples and performance is tested in each corresponding test set. {[}elevate{]} performs automatic nested resampling and is one of the core supervised learning functions in \textbf{rtemis}.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{./kfold} 

}

\caption{10-fold crossvalidation}\label{fig:kfold}
\end{figure}

\hypertarget{the-resample-function}{%
\section{The resample function}\label{the-resample-function}}

The \texttt{resample()} function is responsible for all resampling in \textbf{rtemis}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(res)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "resample" "list"    
\end{verbatim}

It outputs a list which is an S3 object of class \texttt{resample}, with print and plot methods.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(res)}
\end{Highlighting}
\end{Shaded}

\includegraphics{86-Resampling_files/figure-latex/unnamed-chunk-3-1.pdf}

The teal-colored lines represent the training cases selected for each resample, the white are testing cases (held out).

\texttt{resample()} supports 5 types of resampling:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{k-fold crossvalidation (Stratified)}
\end{enumerate}

You split the cases into k sets (folds). Each set is used once as the validation or testing set. This means each cases is left out exactly once and there is no overlap between different validation/test sets. In \textbf{rtemis}, the folds are also stratified by default on the outcome unless otherwise chosen. Stratification tries to maintain the full sample's distribution in both training and left-out sets. This is crucial for non-normally distributed continuous outcomes or \protect\hyperlink{imbalanced}{imbalanced datasets}. 10 is a common value for k, called 10-fold. Note that the size of the training and left-out sets depends on the sample size.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res}\FloatTok{.10}\NormalTok{fold }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(x, }\DecValTok{10}\NormalTok{, }\StringTok{"kfold"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  \textbf{Stratified subsampling}
\end{enumerate}

Draw \texttt{n.resamples} stratified samples from the data given a certain probability (\texttt{train.p}) that each case belongs to the training set. Since you are randomly sampling from the full sample each time, there will be overlap in the test set cases, but you control the training-to-testing ratio and number of resamples independently, unlike in k-fold resampling.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res}\FloatTok{.25}\NormalTok{ss }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(x, }\DecValTok{25}\NormalTok{, }\StringTok{"strat.sub"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  \textbf{Bootstrap}
\end{enumerate}

The \href{https://en.wikipedia.org/wiki/Bootstrapping_(statistics)}{bootstrap}: random sampling with replacement. Since cases are replicated, you should use bootstrap as the outer resampler if you will also have inner resampling for tuning, since the same case may end up in both training and validation sets.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res}\FloatTok{.100}\NormalTok{boot }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(x, }\DecValTok{100}\NormalTok{, }\StringTok{"bootstrap"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  \textbf{Stratified Bootstrap}
\end{enumerate}

This is stratified subsampling with random replication of cases to match the length of the original sample. Same as the bootstrap, do not use if you will be further resampling each resample.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res}\FloatTok{.100}\NormalTok{sboot }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(x, }\DecValTok{100}\NormalTok{, }\StringTok{"strat.boot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  \textbf{Leave-One-Out-Crossvalidation (LOOCV)}
\end{enumerate}

This is k-fold crossvalidation where \(k = N\), where \(N\) is number of data points/cases in the whole sample. It has been included for experimentation and completenes, but it is not recommended either for model selection or assessment over the other resampling methods.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res.loocv }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(x, }\AttributeTok{resampler =} \StringTok{"loocv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{example-stratified-vs-random-sampling-in-a-binomial-distribution}{%
\section{Example: Stratified vs random sampling in a binomial distribution}\label{example-stratified-vs-random-sampling-in-a-binomial-distribution}}

Imagine \texttt{y} is the outcome of interest where events occur with a probability of .1 - a common scenario in many fields.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rbinom}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{)}
\FunctionTok{mplot3.x}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\includegraphics{86-Resampling_files/figure-latex/unnamed-chunk-9-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{freq }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(x)}
\NormalTok{prob }\OtherTok{\textless{}{-}}\NormalTok{ freq[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(freq)}
\NormalTok{res.nonstrat }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(x), .}\DecValTok{75}\SpecialCharTok{*}\FunctionTok{length}\NormalTok{(x)))}
\NormalTok{res.strat }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prob.nonstrat }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(i) \{}
\NormalTok{  freq }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(x[res.nonstrat[[i]]])}
\NormalTok{  freq[}\DecValTok{2}\NormalTok{]}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{(freq)}
\NormalTok{\})}
\NormalTok{prob.strat }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(i) \{}
\NormalTok{  freq }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(x[res.strat[[i]]])}
\NormalTok{  freq[}\DecValTok{2}\NormalTok{]}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{(freq)}
\NormalTok{\})}
\NormalTok{prob.nonstrat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
         1          1          1          1          1          1          1 
0.09333333 0.08000000 0.08000000 0.06666667 0.06666667 0.10666667 0.10666667 
         1          1          1 
0.10666667 0.09333333 0.08000000 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sd}\NormalTok{(prob.nonstrat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.0156505
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prob.strat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
         1          1          1          1          1          1          1 
0.08108108 0.08108108 0.08108108 0.08108108 0.08108108 0.08108108 0.08108108 
         1          1          1 
0.08108108 0.08108108 0.08108108 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sd}\NormalTok{(prob.strat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0
\end{verbatim}

As expected, the random sampling resulted in different event probability in each resample, whereas stratified subsampling maintained a constant probability across resamples.

\hypertarget{supervised}{%
\chapter{Supervised Learning}\label{supervised}}

This is a very brief introduction to machine learning using the \href{https://rtemis.lambdamd.org}{\textbf{rtemis}} package. \textbf{rtemis} includes functions for:

\begin{itemize}
\tightlist
\item
  Visualization: static \& interactive plots
\item
  Data preprocessing
\item
  Unsupervised learning: clustering \& dimensionality reduction
\item
  Supervised learning: regression \& classification
\end{itemize}

\hypertarget{installation-1}{%
\section{Installation}\label{installation-1}}

install the \textbf{remotes} package, if you don't have it:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"remotes"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Install \textbf{rtemis}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"egenn/rtemis"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{rtemis} uses a large number of packages under the hood. Since you would not need to use all of them, they are not installed by default. Each time an \textbf{rtemis} function is called, a dependency check is run and a message is printed if any packages need to be installed.

For this short tutorial, start by installing \textbf{ranger}, if it is not already installed on your system:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"ranger"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Load \textbf{rtemis}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rtemis)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

\hypertarget{data-input-for-supervised-learning}{%
\section{Data Input for Supervised Learning}\label{data-input-for-supervised-learning}}

All \textbf{rtemis} supervised learning functions begin with \texttt{s.} (``supervised'').\\
They accept the same first four arguments:\\
\texttt{x}, \texttt{y}, \texttt{x.test}, \texttt{y.test}\\
but are flexible and allow you to also provide combined (x, y) and (x.test, y.test) data frames, as explained below.

\hypertarget{scenario-1-x.train-y.train-x.test-y.test}{%
\subsection{\texorpdfstring{Scenario 1 (\texttt{x.train,\ y.train,\ x.test,\ y.test})}{Scenario 1 (x.train, y.train, x.test, y.test)}}\label{scenario-1-x.train-y.train-x.test-y.test}}

In the most straightforward case, provide each featureset and outcome individually:

\begin{itemize}
\tightlist
\item
  \texttt{x}: Training set features
\item
  \texttt{y}: Training set outcome
\item
  \texttt{x.test}: Testing set features (Optional)
\item
  \texttt{y.test}: Testing set outcome (Optional)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnormmat}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{10}\NormalTok{, }\AttributeTok{seed =} \DecValTok{2019}\NormalTok{)}
\NormalTok{w }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{\%*\%}\NormalTok{ w }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{200}\NormalTok{)}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(y, }\AttributeTok{seed =} \DecValTok{2020}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x.train }\OtherTok{\textless{}{-}}\NormalTok{ x[res}\SpecialCharTok{$}\NormalTok{Subsample\_1, ]}
\NormalTok{x.test }\OtherTok{\textless{}{-}}\NormalTok{ x[}\SpecialCharTok{{-}}\NormalTok{res}\SpecialCharTok{$}\NormalTok{Subsample\_1, ]}
\NormalTok{y.train }\OtherTok{\textless{}{-}}\NormalTok{ y[res}\SpecialCharTok{$}\NormalTok{Subsample\_1]}
\NormalTok{y.test }\OtherTok{\textless{}{-}}\NormalTok{ y[}\SpecialCharTok{{-}}\NormalTok{res}\SpecialCharTok{$}\NormalTok{Subsample\_1]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod.glm }\OtherTok{\textless{}{-}} \FunctionTok{s.GLM}\NormalTok{(x.train, y.train, x.test, y.test)}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-7-1.pdf}

\hypertarget{scenario-2-x.train-x.test}{%
\subsection{\texorpdfstring{Scenario 2: (\texttt{x.train,\ x.test})}{Scenario 2: (x.train, x.test)}}\label{scenario-2-x.train-x.test}}

You can provide training and testing sets as a single data.frame each, where the last column is the outcome. Now \texttt{x} is the full training data and \texttt{y} the full testing data:

\begin{itemize}
\tightlist
\item
  \texttt{x}: data.frame(x.train, y.train)
\item
  \texttt{y}: data.frame(x.test, y.test)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnormmat}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{10}\NormalTok{, }\AttributeTok{seed =} \DecValTok{2019}\NormalTok{)}
\NormalTok{w }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{\%*\%}\NormalTok{ w }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{200}\NormalTok{)}
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(x, y)}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(dat, }\AttributeTok{seed =} \DecValTok{2020}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat.train }\OtherTok{\textless{}{-}}\NormalTok{ dat[res}\SpecialCharTok{$}\NormalTok{Subsample\_1, ]}
\NormalTok{dat.test }\OtherTok{\textless{}{-}}\NormalTok{ dat[}\SpecialCharTok{{-}}\NormalTok{res}\SpecialCharTok{$}\NormalTok{Subsample\_1, ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod.glm }\OtherTok{\textless{}{-}} \FunctionTok{s.GLM}\NormalTok{(dat.train, dat.test)}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-9-1.pdf}

The \texttt{dataPrepare()} function will check data dimensions and determine whether data was input as separate feature and outcome sets or combined and ensure the correct number of cases and features was provided.

In either scenario, Regression will be performed if the outcome is numeric and Classification if the outcome is a factor.

\hypertarget{regression}{%
\section{Regression}\label{regression}}

\hypertarget{check-data-with-checkdata}{%
\subsection{\texorpdfstring{Check Data with \texttt{checkData()}}{Check Data with checkData()}}\label{check-data-with-checkdata}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnormmat}\NormalTok{(}\DecValTok{500}\NormalTok{, }\DecValTok{50}\NormalTok{, }\AttributeTok{seed =} \DecValTok{2019}\NormalTok{)}
\NormalTok{w }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{50}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{\%*\%}\NormalTok{ w }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(x, y)}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat.train }\OtherTok{\textless{}{-}}\NormalTok{ dat[res}\SpecialCharTok{$}\NormalTok{Subsample\_1, ]}
\NormalTok{dat.test }\OtherTok{\textless{}{-}}\NormalTok{ dat[}\SpecialCharTok{{-}}\NormalTok{res}\SpecialCharTok{$}\NormalTok{Subsample\_1, ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{checkData}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\hypertarget{single-model}{%
\subsection{Single Model}\label{single-model}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod }\OtherTok{\textless{}{-}} \FunctionTok{s.GLM}\NormalTok{(dat.train, dat.test)}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-11-1.pdf}

\hypertarget{crossvalidated-model}{%
\subsection{Crossvalidated Model}\label{crossvalidated-model}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod }\OtherTok{\textless{}{-}} \FunctionTok{elevate}\NormalTok{(dat, }\AttributeTok{mod =} \StringTok{"glm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-12-1.pdf}

Use the \texttt{describe()} function to get a summary in (plain) English:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod}\SpecialCharTok{$}\FunctionTok{describe}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Regression was performed using Generalized Linear Model. Model generalizability was assessed using 10 stratified subsamples. The mean R-squared across all resamples was 0.97.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod}\SpecialCharTok{$}\FunctionTok{plot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-14-1.pdf}

\hypertarget{classification}{%
\section{Classification}\label{classification}}

\hypertarget{check-data}{%
\subsection{Check Data}\label{check-data}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(Sonar, }\AttributeTok{package =} \StringTok{\textquotesingle{}mlbench\textquotesingle{}}\NormalTok{)}
\FunctionTok{checkData}\NormalTok{(Sonar)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{resample}\NormalTok{(Sonar)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sonar.train }\OtherTok{\textless{}{-}}\NormalTok{ Sonar[res}\SpecialCharTok{$}\NormalTok{Subsample\_1, ]}
\NormalTok{sonar.test }\OtherTok{\textless{}{-}}\NormalTok{ Sonar[}\SpecialCharTok{{-}}\NormalTok{res}\SpecialCharTok{$}\NormalTok{Subsample\_1, ]}
\end{Highlighting}
\end{Shaded}

\hypertarget{single-model-1}{%
\subsection{Single model}\label{single-model-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod }\OtherTok{\textless{}{-}} \FunctionTok{s.RANGER}\NormalTok{(sonar.train, sonar.test)}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-16-1.pdf}

\hypertarget{crossvalidated-model-1}{%
\subsection{Crossvalidated Model}\label{crossvalidated-model-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod }\OtherTok{\textless{}{-}} \FunctionTok{elevate}\NormalTok{(Sonar)}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-17-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod}\SpecialCharTok{$}\FunctionTok{describe}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Classification was performed using Random Forest (ranger). Model generalizability was assessed using 10 stratified subsamples. The mean Balanced Accuracy across all resamples was 0.83.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod}\SpecialCharTok{$}\FunctionTok{plot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-19-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod}\SpecialCharTok{$}\FunctionTok{plotROC}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-20-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod}\SpecialCharTok{$}\FunctionTok{plotPR}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-21-1.pdf}

\hypertarget{evaluation-of-a-binary-classifier}{%
\subsection{Evaluation of a binary classifier}\label{evaluation-of-a-binary-classifier}}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{./Classification} 

}

\caption{Evaluation metrics for a binary classifier}\label{fig:Classification}
\end{figure}

\hypertarget{understanding-overfitting}{%
\section{Understanding Overfitting}\label{understanding-overfitting}}

Overfitting occurs when a model fits noise in the outcome. To make this clear, consider the following example:

Assume a random variable \textbf{x}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

and a data-generating function \texttt{fn()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) }\DecValTok{12} \SpecialCharTok{+}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{5}
\end{Highlighting}
\end{Shaded}

The true y is therefore equal to \texttt{fn(x)}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y\_true }\OtherTok{\textless{}{-}} \FunctionTok{fn}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

However, assume y is recorded with some noise, in this case gaussian:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y\_noise }\OtherTok{\textless{}{-}} \FunctionTok{fn}\NormalTok{(x) }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{500}\NormalTok{, }\AttributeTok{sd =} \FunctionTok{sd}\NormalTok{(y\_true))}
\end{Highlighting}
\end{Shaded}

We plot:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{y\_noise =}\NormalTok{ y\_noise, }\AttributeTok{y\_true =}\NormalTok{ y\_true))}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-26-1.pdf}

We want to find a model that best approximates \texttt{y\_true}, but we only know \texttt{y\_noise}.

A maximally overfitted model would model noise perfectly:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{Overfitted\_model =}\NormalTok{ y\_noise, }\AttributeTok{Ideal\_model =}\NormalTok{ y\_true), }\AttributeTok{type =} \StringTok{"l"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-27-1.pdf}

An example of an SVM set up to overfit heavily:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(x, y\_noise, }\AttributeTok{fit =} \StringTok{"svm"}\NormalTok{,}
          \AttributeTok{fit.params =} \FunctionTok{list}\NormalTok{(}\AttributeTok{kernel =} \StringTok{"radial"}\NormalTok{, }\AttributeTok{cost =} \DecValTok{100}\NormalTok{, }\AttributeTok{gamma =} \DecValTok{100}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-28-1.pdf}

An example of a good approximation of \texttt{fn} using a GAM with penalized splines:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(x, y\_noise, }\AttributeTok{fit =} \StringTok{"gam"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{87-Supervised_files/figure-latex/unnamed-chunk-29-1.pdf}

\hypertarget{rtemis-documentation}{%
\section{\texorpdfstring{\textbf{rtemis} Documentation}{rtemis Documentation}}\label{rtemis-documentation}}

For more information on using \textbf{rtemis}, see the \href{https://rtemis.lambdamd.prg}{rtemis online documentation and vignettes}

\hypertarget{unsupervised}{%
\chapter{Unsupervised Learning}\label{unsupervised}}

\begin{verbatim}
  .:rtemis 0.8.1: Welcome, egenn
  [x86_64-apple-darwin17.0 (64-bit): Defaulting to 4/4 available cores]
  Documentation & vignettes: https://rtemis.lambdamd.org
\end{verbatim}

Unsupervised learning aims to learn relationships within a dataset without focusing at a particular outcome. You will often hear of unsupervised learning being performed on unlabeled data. To be clear, it means it does not use the labels to guide learning - whether labels are available or not. You might, for example, perform unsupervised learning ahead of supervised learning as we shall see later. Unsupervised learning includes a number of approaches, most of which can be divided into two categories:

\begin{itemize}
\tightlist
\item
  \textbf{Clustering}: Cases are grouped together based on some derived measure of similarity / distance metric.
\item
  \textbf{Dimensionality Reduction / Matrix decomposition}: Variables are combined / projected into a lower dimensional space.
\end{itemize}

In \textbf{rtemis}, clustering algorithms begin with \texttt{u.} and decomposition/dimensionality reduction algorithms begin with \texttt{d.} (We use \texttt{u.} because \texttt{c.} is reserved for the builtin R function)

\hypertarget{decomposition}{%
\section{Decomposition / Dimensionality Reduction}\label{decomposition}}

Use \texttt{decomSelect()} to get a listing of available decomposition algorithms:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{decomSelect}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
.:decomSelect
rtemis supports the following decomposition algorithms:

    Name                                   Description
     CUR                      CUR Matrix Approximation
   H2OAE                               H2O Autoencoder
 H2OGLRM                H2O Generalized Low-Rank Model
     ICA                Independent Component Analysis
  ISOMAP                                        ISOMAP
    KPCA           Kernel Principal Component Analysis
     LLE                      Locally Linear Embedding
     MDS                      Multidimensional Scaling
     NMF             Non-negative Matrix Factorization
     PCA                  Principal Component Analysis
    SPCA           Sparse Principal Component Analysis
     SVD                  Singular Value Decomposition
    TSNE   t-distributed Stochastic Neighbor Embedding
    UMAP Uniform Manifold Approximation and Projection
\end{verbatim}

We can further divide decomposition algorithms into linear (e.g.~PCA, ICA, NMF) and nonlinear dimensionality reduction, (also called manifold learning, like LLE and tSNE).

\hypertarget{principal-component-analysic-pca}{%
\subsubsection{Principal Component Analysic (PCA)}\label{principal-component-analysic-pca}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ iris[, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{]}
\NormalTok{iris.PCA }\OtherTok{\textless{}{-}} \FunctionTok{d.PCA}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris.PCA}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{1}\NormalTok{], iris.PCA}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{2}\NormalTok{], }\AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species,}
          \AttributeTok{xlab =} \StringTok{"1st PCA component"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"2nd PCA component"}\NormalTok{, }\AttributeTok{main =} \StringTok{"PCA on iris"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{88-Unsupervised_files/figure-latex/unnamed-chunk-5-1.pdf}

\hypertarget{independent-component-analysis-ica}{%
\subsubsection{Independent Component Analysis (ICA)}\label{independent-component-analysis-ica}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.ICA }\OtherTok{\textless{}{-}} \FunctionTok{d.ICA}\NormalTok{(x, }\AttributeTok{k =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris.ICA}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{1}\NormalTok{], iris.ICA}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{2}\NormalTok{], }\AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species,}
          \AttributeTok{xlab =} \StringTok{"1st ICA component"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"2nd ICA component"}\NormalTok{, }\AttributeTok{main =} \StringTok{"ICA on iris"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{88-Unsupervised_files/figure-latex/unnamed-chunk-6-1.pdf}

\hypertarget{non-negative-matrix-factorization-nmf}{%
\subsubsection{Non-negative Matrix Factorization (NMF)}\label{non-negative-matrix-factorization-nmf}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.NMF }\OtherTok{\textless{}{-}} \FunctionTok{d.NMF}\NormalTok{(x, }\AttributeTok{k =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris.NMF}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{1}\NormalTok{], iris.NMF}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{2}\NormalTok{], }\AttributeTok{group =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Species,}
          \AttributeTok{xlab =} \StringTok{"1st NMF component"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"2nd NMF component"}\NormalTok{, }\AttributeTok{main =} \StringTok{"NMF on iris"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{88-Unsupervised_files/figure-latex/unnamed-chunk-7-1.pdf}

\hypertarget{clustering}{%
\section{Clustering}\label{clustering}}

Use \texttt{clustSelect()} to get a listing of available clustering algorithms:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{clustSelect}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
.:clustSelect
rtemis supports the following clustering algorithms:

      Name                                             Description
    CMEANS                                Fuzzy C-means Clustering
       EMC                     Expectation Maximization Clustering
    HARDCL                               Hard Competitive Learning
    HOPACH Hierarchical Ordered Partitioning And Collapsing Hybrid
 H2OKMEANS                                  H2O K-Means Clustering
    KMEANS                                      K-Means Clustering
      NGAS                                   Neural Gas Clustering
       PAM                             Partitioning Around Medoids
      PAMK           Partitioning Around Medoids with k estimation
      SPEC                                     Spectral Clustering
\end{verbatim}

Let's cluster iris and we shall also use an NMF decomposition as we saw above to project to 2 dimensions.\\
We'll use two of the most popular clustering algorithms, K-means and PAM, aka K-medoids.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ iris[, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{]}
\NormalTok{iris.NMF }\OtherTok{\textless{}{-}} \FunctionTok{d.NMF}\NormalTok{(x, }\AttributeTok{k =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{k-means}{%
\subsection{K-Means}\label{k-means}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.KMEANS }\OtherTok{\textless{}{-}} \FunctionTok{u.KMEANS}\NormalTok{(x, }\AttributeTok{k =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris.NMF}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{1}\NormalTok{], iris.NMF}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{2}\NormalTok{],}
          \AttributeTok{group =}\NormalTok{ iris.KMEANS}\SpecialCharTok{$}\NormalTok{clusters.train,}
          \AttributeTok{xlab =} \StringTok{"1st NMF component"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"2nd NMF component"}\NormalTok{, }\AttributeTok{main =} \StringTok{"KMEANS on iris"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{88-Unsupervised_files/figure-latex/unnamed-chunk-10-1.pdf}

\hypertarget{partitioning-around-medoids-with-k-estimation-pamk}{%
\subsection{Partitioning Around Medoids with k estimation (PAMK)}\label{partitioning-around-medoids-with-k-estimation-pamk}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.pamk }\OtherTok{\textless{}{-}} \FunctionTok{u.PAMK}\NormalTok{(x, }\AttributeTok{krange =} \DecValTok{3}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mplot3.xy}\NormalTok{(iris.NMF}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{1}\NormalTok{], iris.NMF}\SpecialCharTok{$}\NormalTok{projections.train[, }\DecValTok{2}\NormalTok{],}
          \AttributeTok{group =}\NormalTok{ iris.pamk}\SpecialCharTok{$}\NormalTok{clusters.train,}
          \AttributeTok{xlab =} \StringTok{"1st NMF component"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"2nd NMF component"}\NormalTok{, }\AttributeTok{main =} \StringTok{"PAM on iris"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{88-Unsupervised_files/figure-latex/unnamed-chunk-11-1.pdf}

\hypertarget{git}{%
\chapter{Git \& GitHub: the basics}\label{git}}

\texttt{git} is famously powerful and notoriously complex. This is a very brief introduction to a very small subset of \texttt{git}'s functionality. Multiple online resources can help you delve into \texttt{git} in considerably more depth.

First, some important definitions:

\begin{itemize}
\tightlist
\item
  \textbf{Git}: System that tracks changes to code from multiple users

  \begin{itemize}
  \tightlist
  \item
    Free and open source distributed version control system
  \item
    Developed in 2005 by Linus Torvalds to support Linux kernel development
  \item
    Used by 87.2\% of developers as of 2018, according to Stack Overflow
  \end{itemize}
\item
  \textbf{Repository}: Data (code) + metadata (i.e.~log of changes over time)

  \begin{itemize}
  \tightlist
  \item
    Data structure that holds metadata for a set of directories / files (set of commit objects, historical record of changes)
  \end{itemize}
\item
  \textbf{GitHub}: Online service that holds Git repositories (public \& private)

  \begin{itemize}
  \tightlist
  \item
    Git repository hosting service
  \item
    Largest source code host in the world: \textgreater{} 40M users, \textgreater{} 100M repositories
  \item
    Acquired by Microsoft for \$7.5 billion in 2018.
  \end{itemize}
\end{itemize}

\hypertarget{installing-git}{%
\section{Installing git}\label{installing-git}}

Check if you system already includes an installation of git. If not you can download it from the official \href{https://git-scm.com/downloads}{git website}

\hypertarget{basic-git-usage}{%
\section{Basic git usage}\label{basic-git-usage}}

In the system terminal, all git commanda begin with \texttt{git} and are followed by a command name:

\hypertarget{cloning-downloading}{%
\subsection{Cloning (``Downloading'')}\label{cloning-downloading}}

Download a repository to your computer for the first time. Replace ``user'' with the username and ``repo'' with the repository name.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ clone https://github.com/user/repo.git}
\end{Highlighting}
\end{Shaded}

This will clone the remote repository to a folder name `repo.' You can optionally provide a different folder name after the URL.

To update a previously cloned repository:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ pull}
\end{Highlighting}
\end{Shaded}

\hypertarget{pushing-uploading}{%
\subsection{Pushing (``Uploading'')}\label{pushing-uploading}}

Get info on local changes to repository:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ status}
\end{Highlighting}
\end{Shaded}

Working locally, stage new or modified files:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ add /path/to/file}
\end{Highlighting}
\end{Shaded}

Still working locally, commit changes with an informative message:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ commit {-}m Fixed this or added that}
\end{Highlighting}
\end{Shaded}

(Note that the previous steps did not require an internet connection - this one does)
Push one or multiple commits to remote repository:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ push}
\end{Highlighting}
\end{Shaded}

\hypertarget{collaborating}{%
\subsection{Collaborating}\label{collaborating}}

The main way of contributing to a project is by a) making a new ``branch'' of the repository, b) making your edits, and c) either merging to master yourself or requesting your edits be merged by the owner/s of the repository.
This allows multiple people to work on the codebase without getting in each other's way.

\hypertarget{branching-and-merging}{%
\subsection{Branching and merging}\label{branching-and-merging}}

Scenario: you are working on \textbf{your own} project, hosted on its own repository. You want to develop a new feature, which may take some time to code and test before you make it part of your official project code.\\
* Create a new branch, e.g.~\texttt{devel}
* Work in your new branch until all testing is successful
* Merge back to \texttt{master} branch

Always from your system terminal, from within a directory in your repository:
Create a new branch:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ branch devel}
\end{Highlighting}
\end{Shaded}

Switch to your new branch:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ checkout devel}
\end{Highlighting}
\end{Shaded}

Work on your code, using git add/commit/push as per usual.\\
When you are done testing and are happy to merge back to master:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ checkout master}
\FunctionTok{git}\NormalTok{ merge devel}
\FunctionTok{git}\NormalTok{ push}
\end{Highlighting}
\end{Shaded}

All the commits performed while you were working in the \texttt{devel} branch will be included in that last git push from \texttt{master}.

\hypertarget{pull-request}{%
\subsection{Pull request}\label{pull-request}}

Scenario: You are contributing to a repository along with other collaborators. You want to suggest a new feature is added to the code:

\begin{itemize}
\tightlist
\item
  Create a new branch, e.g.~\texttt{mynewfeature}
\item
  Work in new branch until you are ready happy to share and testing is complete
\item
  Go on to the repository website, select your branch and perform a ``Pull request'' asking that the changes in your \texttt{mynewfeature} branch are merged into \texttt{master}
\item
  The repository owner/s will review the request and can merge
\end{itemize}

\hypertarget{gists}{%
\section{Gists}\label{gists}}

GitHub also offers a very convenient \href{https://en.wikipedia.org/wiki/Pastebin}{pastebin}-like service called Gist, which lets you quickly and easily share code snippets.

To share some R code using a gist:

\begin{itemize}
\tightlist
\item
  Vist the \href{https://gist.github.com/}{gist site}.
\item
  Write in/copy-paste some code
\item
  Add a name including a \texttt{.R} suffix at the top left of the entry box
\item
  Copy-paste the URL to share with others
\end{itemize}

\hypertarget{git-resources}{%
\section{Git Resources}\label{git-resources}}

Git and GitHub are very powerful and flexible, with a great deal of functionality. Some resources to learn (a great deal) more:

\begin{itemize}
\tightlist
\item
  \href{https://education.github.com/git-cheat-sheet-education.pdf}{Git cheat sheet}
\item
  \href{https://guides.github.com/}{GitHub guides}
  \# \href{https://git-scm.com/book/en/v2}{Pro Git Book} by Scott Chacon and Ben Straub
\end{itemize}

\hypertarget{git-and-github-for-open-and-reproducible-science}{%
\section{Git and GitHub for open and reproducible science}\label{git-and-github-for-open-and-reproducible-science}}

It is recommended to create a new GitHub repository for each new research project. It may be worthwhile creating a new repository when it's time to publish a paper, to include all final working code that should accompany the publication (and e.g.~exclude all trial-and-error, testing, etc. code). As Always, make sure to follow journal requirements for reporting data deposition (includes code) and accessibility.

\hypertarget{applications-with-builtin-git-support}{%
\section{Applications with builtin git support}\label{applications-with-builtin-git-support}}

Many applications support git, and allow you to pull / add / commit / push and more directly from the app using their GUI.\\
A couple of interest for the R user:

\begin{itemize}
\tightlist
\item
  \href{https://rstudio.com/}{RStudio}
  Out trusty IDE has a Git panel enabled when a project is in a directory that's part of a git repository
\item
  The \href{https://atom.io}{Atom} editor
  GitHub's own feature-packed text editor is naturally built around git and GitHub support. It offers its own package manager with access to a large and growing ecosystem of packages. Packages are available that transform Atom to a very capable and customizable IDE.
\end{itemize}

\hypertarget{shell}{%
\chapter{Introduction to the system shell}\label{shell}}

This is a very brief introduction to some of the most commonly used shell commands.\\
A shell is a command line interface allowing access to an operating system's services. Multiple different shells exist, the most popular is probably \textbf{bash} (default in most Linux installations), which \textbf{zsh} was recently made the default in MacOS (was bash previously). The commands listed here will work similarly in all/most shells.

\hypertarget{common-shell-commands}{%
\section{Common shell commands}\label{common-shell-commands}}

The first thing to look for in a new environment is the help system. In the shell, this is accessed with \texttt{man}:

\begin{itemize}
\tightlist
\item
  \texttt{man}: Print the manual pages
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{man}\NormalTok{ man}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{pwd}: Print working directory (the directory you are currently in)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{pwd}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{cd}: Set working directory to \texttt{/path/to/dir}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{cd}\NormalTok{ /path/to/dir}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{mv}: Move \texttt{file} from \texttt{/current/dir/} to \texttt{/new/dir}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mv}\NormalTok{ /current/dir/file /new/dir}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{mv}: Rename \texttt{file} to \texttt{newfilename}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mv}\NormalTok{ /current/dir/file /current/dir/newfilename}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{cp}: Make a copy of \texttt{file} from \texttt{currentPath} into \texttt{altPath}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cp}\NormalTok{ /currentPath/file /altPath/file}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{mkdir}: Create a new directory named `newdir'
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mkdir}\NormalTok{ /path/to/newdir}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{rmdir}: Remove (i.e.~delete) \texttt{uselessFile}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]

\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{rm}: Remove (i.e.~delete) \texttt{uselessFile}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rm}\NormalTok{ /path/to/uselessFile}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{cat}: Print contents of \texttt{file} to the console
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{ /path/to/file}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{uname}: Get system information
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uname}\NormalTok{ {-}a}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{whoami}: When you forget the basics
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{whoami}
\end{Highlighting}
\end{Shaded}

\hypertarget{running-system-commands-within-r}{%
\section{Running system commands within R}\label{running-system-commands-within-r}}

You can execute any system command within R using the \texttt{system()} command:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{system}\NormalTok{(}\StringTok{"uname {-}a"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{resources}{%
\chapter{Resources}\label{resources}}

\hypertarget{r-project}{%
\section{R Project}\label{r-project}}

\href{https://cran.r-project.org/manuals.html}{The R Manuals} include a number of resources, including:

\begin{itemize}
\tightlist
\item
  \href{https://cran.r-project.org/doc/manuals/r-release/R-intro.html}{Introduction to R}
\item
  \href{https://cran.r-project.org/web/views/}{CRAN task views} offer curated lists of packages by topic
\end{itemize}

\hypertarget{r-markdown}{%
\section{R markdown}\label{r-markdown}}

\begin{itemize}
\tightlist
\item
  \href{https://bookdown.org/yihui/rmarkdown/}{R Markdown: The Definitive Guide} by Yihui Xie, J. J. Allaire, Garrett Grolemund
\item
  \href{https://bookdown.org/yihui/bookdown/}{bookdown: Authoring Books and Technical Documents with R Markdown}: how to make websites like this one you are on right now
\end{itemize}

\hypertarget{documentation}{%
\section{Documentation}\label{documentation}}

\begin{itemize}
\tightlist
\item
  \href{https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html}{Documentation with roxygen2}
\end{itemize}

\hypertarget{r-for-data-science}{%
\section{R for data science}\label{r-for-data-science}}

\begin{itemize}
\tightlist
\item
  \href{https://bookdown.org/rdpeng/rprogdatascience/}{R Programming for Data Science} by Roger D. Peng, based mostly on base R, and also covers the basics of \textbf{dplyr}.
\item
  \href{https://r4ds.had.co.nz}{R for Data Science} by Hadley Wickham \& Garrett Grolemund, based on the \href{https://www.tidyverse.org}{tidyverse}
\item
  \href{https://stat545.com/}{Data wrangling, exploration, and analysis with R}
\end{itemize}

\hypertarget{graphics}{%
\section{Graphics}\label{graphics}}

\hypertarget{ggplot2-8}{%
\subsection{ggplot2}\label{ggplot2-8}}

\begin{itemize}
\tightlist
\item
  \href{https://ggplot2.tidyverse.org/}{ggplot2}
\end{itemize}

\hypertarget{plotly-2}{%
\subsection{Plotly}\label{plotly-2}}

\begin{itemize}
\tightlist
\item
  \href{https://plot.ly/r/}{Plotly R API}
\item
  \href{https://plotly-r.com}{Interactive web-based data visualization with R, plotly, and shiny}
\end{itemize}

\hypertarget{advanced-r}{%
\section{Advanced R}\label{advanced-r}}

\begin{itemize}
\tightlist
\item
  \href{https://bookdown.org/csgillespie/efficientR/}{Efficient R Programming} by Colin Gillespie \& Robin Lovelace
\item
  \href{http://adv-r.had.co.nz/Rcpp.html}{High performance functions with Rcpp}
\end{itemize}

\hypertarget{git-and-github}{%
\section{Git and GitHub}\label{git-and-github}}

\begin{itemize}
\tightlist
\item
  \href{https://guides.github.com/}{GitHub guides}
\item
  \href{https://git-scm.com/book/en/v2}{Pro Git Book} by Scott Chacon and Ben Straub
\end{itemize}

\hypertarget{machine-learning}{%
\section{Machine Learning}\label{machine-learning}}

\begin{itemize}
\tightlist
\item
  \href{https://www-bcf.usc.edu/~gareth/ISL/}{An Introduction to Statistical Learning} offers an accessible view of core learning algorithms, without being math-heavy.
\item
  \href{https://web.stanford.edu/~hastie/ElemStatLearn/}{Elements of Statistical Learning} offers a deeper and more extensive view on learning algorithms.
\item
  \href{https://rtemis.lambdamd.org/}{Machine Learning with rtemis}
\end{itemize}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\hypertarget{ref-matrixStats2019}{}%
Bengtsson, Henrik. 2019. \emph{matrixStats: Functions That Apply to Rows and Columns of Matrices (and to Vectors)}. \url{https://CRAN.R-project.org/package=matrixStats}.

\leavevmode\hypertarget{ref-buuren2010mice}{}%
Buuren, S van, and Karin Groothuis-Oudshoorn. 2010. {``Mice: Multivariate Imputation by Chained Equations in r.''} \emph{Journal of Statistical Software}, 1--68.

\leavevmode\hypertarget{ref-gennatas2017towards}{}%
Gennatas, Efstathios Dimitrios. 2017. {``Towards Precision Psychiatry: Gray Matter Development and Cognition in Adolescence.''}

\leavevmode\hypertarget{ref-mack2018managing}{}%
Mack, Christina, Zhaohui Su, and Daniel Westreich. 2018. {``Managing Missing Data in Patient Registries: Addendum to Registries for Evaluating Patient Outcomes: A User's Guide, {[}internet{]}.''}

\leavevmode\hypertarget{ref-murrell2018r}{}%
Murrell, Paul. 2018. \emph{R Graphics}. CRC Press.

\leavevmode\hypertarget{ref-sievert2017plotly}{}%
Sievert, Carson, Chris Parmer, Toby Hocking, Scott Chamberlain, Karthik Ram, Marianne Corvellec, and Pedro Despouy. 2017. {``Plotly: Create Interactive Web Graphics via {`Plotly. Js'}.''} \emph{R Package Version} 4 (1): 110.

\leavevmode\hypertarget{ref-stekhoven2012missforest}{}%
Stekhoven, Daniel J, and Peter Bühlmann. 2012. {``MissForest---Non-Parametric Missing Value Imputation for Mixed-Type Data.''} \emph{Bioinformatics} 28 (1): 112--18.

\leavevmode\hypertarget{ref-wickham2011ggplot2}{}%
Wickham, Hadley. 2011. {``Ggplot2.''} \emph{Wiley Interdisciplinary Reviews: Computational Statistics} 3 (2): 180--85.

\leavevmode\hypertarget{ref-wilkinson2012grammar}{}%
Wilkinson, Leland. 2012. {``The Grammar of Graphics.''} In \emph{Handbook of Computational Statistics}, 375--414. Springer.

\leavevmode\hypertarget{ref-wright2015ranger}{}%
Wright, Marvin N, and Andreas Ziegler. 2015. {``Ranger: A Fast Implementation of Random Forests for High Dimensional Data in c++ and r.''} \emph{arXiv Preprint arXiv:1508.04409}.

\leavevmode\hypertarget{ref-R-bookdown}{}%
Xie, Yihui. 2020. \emph{Bookdown: Authoring Books and Technical Documents with r Markdown}. \url{https://github.com/rstudio/bookdown}.

\end{CSLReferences}

\backmatter

\let\hyperlink=\oldhyperlink % Restore old hyperlink behaviour
\cleardoublepage
\markboth{Index}{Index}

\printindex


\printindex[code]


\end{document}
