# Data frames {#dataframes}

```{r echo = FALSE}
knitr::opts_chunk$set(fig.width = 5, fig.height = 5,
                      comment = NA, cache = TRUE)
```

R's data.frame is the main object used to hold data for statistical analysis, visualization, and predictive modeling.

See the [Data frames](#dataframes) section in the [Data Structures](#structures) chapter for basic info on data.frames.

## Column and row names

Let's start with a simple example data.frame:

```{r}
df <- data.frame(PID = c(111:119),
                 Hospital = c("UCSF", "HUP", "Stanford",
                             "Stanford", "UCSF", "HUP", 
                             "HUP", "Stanford", "UCSF"),
                Age = c(22, 34, 41, 19, 53, 21, 63, 22, 19),
                Sex = c(1, 1, 0, 1, 0, 0, 1, 0, 0),
                row.names = "PID")
```

We can get column names and row names with `colnames()` and `rownames()`, respectively:

```{r}
colnames(df)
rownames(df)
```

To set new column or row names use the form:

`colnames(df) <- new.colnames` 

`rownames(df) <- new.rownames` 

where `new.colnames` and `new.rownames` is a character vector.

You can rename all columns/rows or use indexing to replace specific names:

Rename all rows:

```{r}
rownames(df) <- paste0("Patient_", 1:9)
df
```

Rename first two columns:

```{r}
colnames(df)[1:2] <- c("Center", "Age_at_Dx")
df
```

## Delete columns or rows

To delete a data.frame column, set it to [NULL](#replacing-with-null):

```{r}
df$Sex <- NULL
df
```

To delete a data.frame row, you can "index it out".  

For example, to remove the third and fifths rows of the above data.frame using an integer index:

```{r}
df <- df[-c(3, 5), ]
df
```

You can similarly exclude a row using a logical index. Logical indexing occurs usually following some filtering condition. 

For example, exclude patients under 20 years old:

```{r}
df <- df[!df$Age < 20, ]
df
```

## `subset()`

`subset()` allows you to 

- **filter** cases that meet certain conditions using the `subset` argument
- **select** columns using the `select` argument  

(`head()` returns the first few lines of a data frame. We use it to avoid printing too many lines)

```{r}
head(iris)
iris_sl.gt.med <- subset(iris, Sepal.Length > median(Sepal.Length))
```

Note: You can use the column name Sepal.Length directly, i.e. unquoted and you don't need to use `iris$Sepal.Length`. This is called Non-Standard Evaluation (NSE).

```{r}
x <- data.frame(one = 1:10,
                two = rnorm(10),
                group = c(rep("alpha", 4),  rep("beta", 6)))
subset(x, subset = two > 0, select = two)
subset(x, two > 0, -one)
subset(x, two > 0, two:one)
subset(x, two > 0, two:group)
```

## `split()`

Split a data frame into multiple data frames by groups defined by a factor:

```{r}
x_by_group <- split(x, x$group)
```

## `with()`

Within a `with()` expression, you can access data.frame columns without quoting or using the `$` operator:

```{r}
with(x, x[group == "alpha", ])
with(x, x[two > 0, ])
```

## Feature transformation with `transform()`

Make up some data:

```{r}
dat <- data.frame(Sex = c(0, 0, 1, 1, 0),
                  Height = c(1.5, 1.6, 1.55, 1.73, 1.8),
                  Weight = c(55, 70, 69, 76, 91))
```

```{r}
dat <- transform(dat, BMI = Weight/Height^2)
dat
```

`transform()` is probably not used too often, because it is trivial to do the same with direct assignment:

```{r}
dat$BMI <- dat$Weight/dat$Height^2
```

but can be useful when adding multiple variables and/or used in a [pipe](#pipe):

```{r}
dat |> 
  subset(Sex == 0) |> 
  transform(DeltaWeightFromMean = Weight - mean(Weight),
            BMI = Weight/Height^2,
            CI = Weight/Height^3)
```
