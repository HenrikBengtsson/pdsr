# Classes and Object-Oriented Programming {#classes}

```{r echo = FALSE}
knitr::opts_chunk$set(fig.width = 10, fig.height = 5,
                      comment = NA, cache = TRUE) 
options(rt.theme = "lightgrid")
options(rt.fit.theme = "lightgrid")
```

```{r, comment="", results="asis", echo=FALSE}
old.hooks <- fansi::set_knit_hooks(knitr::knit_hooks)
options(crayon.enabled = TRUE)
```

Object-Oriented Programming (OOP) is a programming paradigm built around objects with associated data, known as attributes, and functions, known as methods.  
There are 4 main class systems in R:  

* S3: informally defined, minimal, lean, methods dispatch based on class; `base` and `stats` packages use S3 exclusively
* S4: formally defined, allows method dispatch on multiple arguments
* RC: Reference class: Reference semantics; similar to other programming languages; methods are part of the object
* R6: 3rd party class system similar to RC, more lightweight, faster

S3 and S4 methods are part of generic functions. RC and R6 methods are part of the object, but you can (and should) write generic functions for them as well.

## S3

We have already used plenty of S3 objects. Data frames are some of the most common S3 objects.  
Generic functions in R are saved as `functionname.classname` and called automaticaly, based on the class of the first argument. This allows the same function, e.g. `print`, `summary`, `c`, to have a different effect on objects of different classes.
For example, the `print` function applied on a data frame, will actually call `print.data.frame`, while applied on a factor, it will call `print.factor`.  
This means, `print(iris)` calls `print.data.frame(iris)`

Note how the R documentation lists usage information separately for each S3 method, e.g. `## S3 method for class 'factor'`

### `methods()`

To get a list of all available methods defined for a specific class:  
(i.e. "What different functions can I use on this object?")

```{r}
methods(class = "data.frame")
```
Conversely, to get a list of all available methods for a generic function (i.e. which classes have)  
(i.e. "What objects can I use this function on?")

```{r}
methods(generic.function = "plot")
```

### Defining custom S3 classes

It is trivial to create a new class and assign an object to it. There is no formal definition, which means an object is simply assigned to a class by name:

```{r}
x <- 1:10
class(x) <- c("specialvector", "numeric")
class(x)
```

```{r}
print.specialvector <- function(x, ...) {
  cat("This is a special vector of length", length(x), "\n")
  cat("Its mean value is", mean(x, na.rm = TRUE), "and its median is", median(x, na.rm = TRUE))
}
```

```{r}
x
```
