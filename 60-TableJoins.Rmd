# Table joins {#tablejoins}

We often have data from separate sources that we want to combine into a single data.frame. Table joins allow you to specify how to perform such a merge.

Scenario: You have received two tables with clinical data. Each table contains a column with a unique identifier (ID) plus a number of variables which are unique to each table. You want to merge them into one big table so that for each ID you have all available variables. You want to make sure that the same ID number (e.g. 108) corresponds to the same case in both datasets, but not all IDs needs to be present in both datasets.

Let's make up some synthetic data:

```{r}
a <- data.frame(PID = c(101:109),
                Hospital = c("UCSF", "HUP", "Stanford",
                             "Stanford", "UCSF", "HUP", 
                             "HUP", "Stanford", "UCSF"),
                Age = c(22, 34, 41, 19, 53, 21, 63, 22, 19),
                Sex = c(1, 1, 0, 1, 0, 0, 1, 0, 0))

b  <- data.frame(PID = c(106:112),
                 V1 = c(153, 89, 112, 228,  91, 190, 101),
                 Department = c("Neurology", "Radiology",
                                "Emergency", "Cardiology",
                                "Surgery", "Neurology", "Psychiatry"))
a
b
dim(a)
dim(b)
```

There are four main types of join operations:

```{r, echo = FALSE, out.width = "100%", fig.align = "center", fig.cap = "Common Join Operations"}
knitr::include_graphics("R_joins.png")
```

## Inner join

The default arguments of `merge()` perform an **inner join**:

```{r}
(ab.inner <- merge(a, b))
# same as
(ab.inner <- merge(a, b, by = "PID"))
# same as
(ab.inner <- merge(a, b, all = FALSE))
```

Note that the resulting table only contains ***cases found in both datasets***, i.e. IDs 106 through 109

## Outer join

You can perform an **outer join** by specifying `all = TRUE`:

```{r}
(ab.outer <- merge(a, b, all = TRUE))
(ab.outer <- merge(a, b, by = "PID", all = TRUE))
```

Note that the resulting data frame contains ***all cases found in either dataset*** and missing values are represented with `NA`.

## Left outer join

You can perform a **left outer join** by specifying `all.x = TRUE`:

```{r}
(ab.leftOuter <- merge(a, b, all.x = TRUE))
```

Note that the resulting data frame contains ***all cases present in the left input dataset*** (i.e. the one defined first in the arguments) only. 

## Right outer join

You can perform a **right outer join** by specifying `all.y = TRUE`:

```{r}
(ab.rightOuter <- merge(a, b, all.y = TRUE))
```

Note how the resulting data frame contains ***all cases present in the right input dataset*** (i.e. the one defined seecond in the arguments) only.
