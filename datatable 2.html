<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>24 Efficient data analysis with data.table | Programming for Data Science in R</title>

    <meta name="author" content="Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD" />
  
   <meta name="description" content="24 Efficient data analysis with data.table | Programming for Data Science in R is a project to build an online resource for (Bio)statisticians / Epidemiologists / (Health) Data Scientists" />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="24 Efficient data analysis with data.table | Programming for Data Science in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="24 Efficient data analysis with data.table | Programming for Data Science in R is a project to build an online resource for (Bio)statisticians / Epidemiologists / (Health) Data Scientists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="24 Efficient data analysis with data.table | Programming for Data Science in R" />
  
  <meta name="twitter:description" content="24 Efficient data analysis with data.table | Programming for Data Science in R is a project to build an online resource for (Bio)statisticians / Epidemiologists / (Health) Data Scientists" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.3.1/transition.js"></script>
    <script src="libs/bs3compat-0.3.1/tabs.js"></script>
    <script src="libs/bs3compat-0.3.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
    <script src="libs/d3-3.5.6/d3.min.js"></script>
    <link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet" />
    <script src="libs/profvis-0.3.6.9000/profvis.js"></script>
    <script src="libs/profvis-0.3.6.9000/scroll.js"></script>
    <link href="libs/highlight-6.2.0/textmate.css" rel="stylesheet" />
    <script src="libs/highlight-6.2.0/highlight.js"></script>
    <script src="libs/profvis-binding-0.3.7/profvis.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163213745-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-163213745-1');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="bootstrap.lambdamd.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Programming for Data Science in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="datatable" class="section level1" number="24">
<h1><span class="header-section-number">24</span> Efficient data analysis with <strong>data.table</strong></h1>
<STYLE type='text/css' scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</STYLE>
<p>The <a href="https://github.com/Rdatatable/data.table"><strong>data.table</strong></a> package provides a modern and highly optimized version of R’s data.frame structure. It is highly memory efficient and automatically parallelizes internal operations to achieve substantial speed improvements over data.frames. The <strong>data.table</strong> package weighs in at just a few kilobytes, has zero dependencies, and maintains compatibility with R versions going as far back as possible.</p>
<div id="dtinstallation" class="section level3" number="24.0.1">
<h3><span class="header-section-number">24.0.1</span> Installation</h3>
<p>You can install <strong>data.table</strong> from CRAN or GitHub. Check out the <a href="https://github.com/Rdatatable/data.table/wiki/Installation">data.table wiki</a> for more info.</p>
</div>
<div id="data.table-significantly-extends-the-data.frame-structure" class="section level3" number="24.0.2">
<h3><span class="header-section-number">24.0.2</span> <code>data.table</code> significantly extends the <code>data.frame</code> structure</h3>
<p>There are two main ways in which a <code>data.table</code> differs from a <code>data.frame</code>:</p>
<ul>
<li>You can perform many operations <strong><em>“in-place”</em></strong> without creating a copy (i.e. make changes to a <code>data.table</code> without having to assign it back to itself).</li>
<li>There is a lot more than indexing and slicing that you can do within a <code>data.table</code>’s “frame” i.e. the square brackets after a <code>data.table</code>, like applying any custom function to specific columns and/or cases.</li>
</ul>
<div class="sourceCode" id="cb1442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1442-1"><a href="datatable.html#cb1442-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtemis)</span>
<span id="cb1442-2"><a href="datatable.html#cb1442-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<p><code>data.table</code> operations remain as close as possible to <code>data.frame</code> operations, trying to extend rather than replace the latter’s functionality. This is great because a lot of what an R user would already be familiar with in using data.frames is applicable here as well.</p>
</div>
<div id="create-a-data.table" class="section level2" number="24.1">
<h2><span class="header-section-number">24.1</span> Create a <code>data.table</code></h2>
<div id="by-assignment-data.table" class="section level3" number="24.1.1">
<h3><span class="header-section-number">24.1.1</span> By assignment: <code>data.table()</code></h3>
<p>Same syntax as <code>data.frame()</code>:</p>
<div class="sourceCode" id="cb1443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1443-1"><a href="datatable.html#cb1443-1" aria-hidden="true" tabindex="-1"></a>(df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">A =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1443-2"><a href="datatable.html#cb1443-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">B =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span>),</span>
<span id="cb1443-3"><a href="datatable.html#cb1443-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">C =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>)))</span></code></pre></div>
<pre><code>  A   B C
1 1 1.2 a
2 2 4.3 b
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1445-1"><a href="datatable.html#cb1445-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(df)</span></code></pre></div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb1447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1447-1"><a href="datatable.html#cb1447-1" aria-hidden="true" tabindex="-1"></a>(dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">A =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1447-2"><a href="datatable.html#cb1447-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">B =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span>),</span>
<span id="cb1447-3"><a href="datatable.html#cb1447-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">C =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>)))</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;char&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
<div class="sourceCode" id="cb1449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1449-1"><a href="datatable.html#cb1449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dt)</span></code></pre></div>
<pre><code>[1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<p>Notice how <code>data.table</code> inherits from <code>data.frame</code>. This means that if a method does not exist for <code>data.table</code>, the method for <code>data.frame</code> will be used (review <a href="classes.html#classes">classes and generic functions</a>.
One difference from <code>data.frame()</code>, as you can see above, is that <code>stringsAsFactors</code> defaults to FALSE in <code>data.table()</code>. As part of improving efficieny, data.tables do away with row names. Instead of using rownames, you can and should add an extra column with the same information - this is advisable when working with data.frames as well.</p>
<p>A rather convenient option is to have data.tables print each column’s class below the column name. You can pass the argument <code>class = TRUE</code> to <code>print()</code> or set the global option <code>datatable.print.class</code> using <code>options()</code></p>
<div class="sourceCode" id="cb1451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1451-1"><a href="datatable.html#cb1451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datatable.print.class =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1451-2"><a href="datatable.html#cb1451-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;char&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
<div class="sourceCode" id="cb1453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1453-1"><a href="datatable.html#cb1453-1" aria-hidden="true" tabindex="-1"></a>(dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">A =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1453-2"><a href="datatable.html#cb1453-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">B =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span>),</span>
<span id="cb1453-3"><a href="datatable.html#cb1453-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">C =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>),</span>
<span id="cb1453-4"><a href="datatable.html#cb1453-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
</div>
<div id="by-coercion-as.data.table" class="section level3" number="24.1.2">
<h3><span class="header-section-number">24.1.2</span> By coercion: <code>as.data.table()</code></h3>
<div class="sourceCode" id="cb1455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1455-1"><a href="datatable.html#cb1455-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">A =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1455-2"><a href="datatable.html#cb1455-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">B =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span>),</span>
<span id="cb1455-3"><a href="datatable.html#cb1455-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">C =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>))</span>
<span id="cb1455-4"><a href="datatable.html#cb1455-4" aria-hidden="true" tabindex="-1"></a>(dat2 <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat))</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;char&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
</div>
<div id="by-coercion-in-place-setdt" class="section level3" number="24.1.3">
<h3><span class="header-section-number">24.1.3</span> By coercion <strong><em>in-place</em></strong>: <code>setDT()</code></h3>
<p><code>setDT</code> converts a list or data.frame into a <code>data.table</code> in-place. Note: the original object itself is changed, you do not need to assign the output of <code>setDT</code> to a new name.</p>
<div class="sourceCode" id="cb1457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1457-1"><a href="datatable.html#cb1457-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">A =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1457-2"><a href="datatable.html#cb1457-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">B =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span>),</span>
<span id="cb1457-3"><a href="datatable.html#cb1457-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">C =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>))</span>
<span id="cb1457-4"><a href="datatable.html#cb1457-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dat)</span></code></pre></div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1459-1"><a href="datatable.html#cb1459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(dat)</span>
<span id="cb1459-2"><a href="datatable.html#cb1459-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dat)</span></code></pre></div>
<pre><code>[1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<p>You can similarly convert a <code>data.table</code> to a <code>data.frame</code>, in-place:</p>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1461-1"><a href="datatable.html#cb1461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setDF</span>(dat)</span>
<span id="cb1461-2"><a href="datatable.html#cb1461-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dat)</span></code></pre></div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
</div>
<div id="read-into-data.table-from-file" class="section level3" number="24.1.4">
<h3><span class="header-section-number">24.1.4</span> Read into <code>data.table</code> from file</h3>
<p><strong>data.table</strong> includes the <code>fread()</code> function to read data from files, in a similar way as the base functions <code>read.csv()</code> and <code>read.table()</code>. It is orders of magnitude faster for very large data (e.g. thousands to millions of rows) and it can read directly from URLs, and zipped files. The <code>sep</code> arguments defines the separator (same as in <code>read.csv()</code> and <code>read.table()</code>), but when set to <code>"auto"</code> (the default) it does a great job of figuring it out by itself.</p>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1463-1"><a href="datatable.html#cb1463-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;path/to/file.csv&quot;</span>)</span>
<span id="cb1463-2"><a href="datatable.html#cb1463-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;https::/url/to/file.csv.gz&quot;</span>)</span></code></pre></div>
<p>For its speed and convenience, <code>fread()</code> is recommended over <code>read.csv()</code>/<code>read.table()</code> even if you intend to work with a <code>data.frame</code> exclusively, in which case you can pass the argument <code>data.table = FALSE</code> to <code>fread()</code></p>
</div>
<div id="write-a-data.table-to-file-fwrite" class="section level3" number="24.1.5">
<h3><span class="header-section-number">24.1.5</span> Write a <code>data.table</code> to file: <code>fwrite()</code></h3>
<div class="sourceCode" id="cb1464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1464-1"><a href="datatable.html#cb1464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(dt, <span class="st">&quot;/path/to/file.csv&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="combine-data.tables" class="section level2" number="24.2">
<h2><span class="header-section-number">24.2</span> Combine <code>data.table</code>s</h2>
<p><code>cbind()</code> and <code>rbind()</code> work on <code>data.table</code>s the same as on <code>data.frame</code>s:</p>
<div class="sourceCode" id="cb1465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1465-1"><a href="datatable.html#cb1465-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb1465-2"><a href="datatable.html#cb1465-2" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">b =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb1465-3"><a href="datatable.html#cb1465-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(dt1, dt2)</span></code></pre></div>
<pre><code>       a     b
   &lt;int&gt; &lt;int&gt;
1:     1    11
2:     2    12
3:     3    13
4:     4    14
5:     5    15</code></pre>
<div class="sourceCode" id="cb1467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1467-1"><a href="datatable.html#cb1467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(dt1, dt1)</span></code></pre></div>
<pre><code>        a
    &lt;int&gt;
 1:     1
 2:     2
 3:     3
 4:     4
 5:     5
 6:     1
 7:     2
 8:     3
 9:     4
10:     5</code></pre>
</div>
<div id="str-works-the-same-and-you-should-keep-using-it" class="section level2" number="24.3">
<h2><span class="header-section-number">24.3</span> <code>str</code> works the same (and you should keep using it!)</h2>
<div class="sourceCode" id="cb1469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1469-1"><a href="datatable.html#cb1469-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   5 obs. of  3 variables:
 $ A: int  1 2 3 4 5
 $ B: num  1.2 4.3 9.7 5.6 8.1
 $ C: chr  &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;a&quot; ...</code></pre>
<div class="sourceCode" id="cb1471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1471-1"><a href="datatable.html#cb1471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dt)</span></code></pre></div>
<pre><code>Classes &#39;data.table&#39; and &#39;data.frame&#39;:  5 obs. of  3 variables:
 $ A: int  1 2 3 4 5
 $ B: num  1.2 4.3 9.7 5.6 8.1
 $ C: Factor w/ 2 levels &quot;a&quot;,&quot;b&quot;: 1 2 2 1 1
 - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; </code></pre>
</div>
<div id="indexing-a-data.table" class="section level2" number="24.4">
<h2><span class="header-section-number">24.4</span> Indexing a <code>data.table</code></h2>
<p>Indexing is largely unchanged, with a few notable exceptions.<br />
Integer indexing is mostly the same:</p>
<div class="sourceCode" id="cb1473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1473-1"><a href="datatable.html#cb1473-1" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">1</span>, ]</span></code></pre></div>
<pre><code>  A   B C
1 1 1.2 a</code></pre>
<div class="sourceCode" id="cb1475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1475-1"><a href="datatable.html#cb1475-1" aria-hidden="true" tabindex="-1"></a>dt[<span class="dv">1</span>, ]</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt;
1:     1   1.2      a</code></pre>
<p>Selecting a single column with integer indexing in <code>data.table</code> does not drop to a vector (i.e. similar to <code>drop = FALSE</code> in a data.frame):</p>
<div class="sourceCode" id="cb1477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1477-1"><a href="datatable.html#cb1477-1" aria-hidden="true" tabindex="-1"></a>df[, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>[1] 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb1479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1479-1"><a href="datatable.html#cb1479-1" aria-hidden="true" tabindex="-1"></a>df[, <span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
<pre><code>  A
1 1
2 2
3 3
4 4
5 5</code></pre>
<div class="sourceCode" id="cb1481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1481-1"><a href="datatable.html#cb1481-1" aria-hidden="true" tabindex="-1"></a>dt[, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>       A
   &lt;int&gt;
1:     1
2:     2
3:     3
4:     4
5:     5</code></pre>
<p>In <code>data.table</code>, you can access column names directly without quoting or using <code>$</code>:</p>
<div class="sourceCode" id="cb1483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1483-1"><a href="datatable.html#cb1483-1" aria-hidden="true" tabindex="-1"></a>df[, <span class="st">&quot;B&quot;</span>]</span></code></pre></div>
<pre><code>[1] 1.2 4.3 9.7 5.6 8.1</code></pre>
<div class="sourceCode" id="cb1485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1485-1"><a href="datatable.html#cb1485-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>B</span></code></pre></div>
<pre><code>[1] 1.2 4.3 9.7 5.6 8.1</code></pre>
<div class="sourceCode" id="cb1487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1487-1"><a href="datatable.html#cb1487-1" aria-hidden="true" tabindex="-1"></a>dt[, B]</span></code></pre></div>
<pre><code>[1] 1.2 4.3 9.7 5.6 8.1</code></pre>
<div class="sourceCode" id="cb1489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1489-1"><a href="datatable.html#cb1489-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>B <span class="sc">&gt;</span> <span class="dv">5</span>, ]</span></code></pre></div>
<pre><code>  A   B C
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1491-1"><a href="datatable.html#cb1491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(df, df[B <span class="sc">&gt;</span> <span class="dv">5</span>, ])</span></code></pre></div>
<pre><code>  A   B C
3 3 9.7 b
4 4 5.6 a
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1493-1"><a href="datatable.html#cb1493-1" aria-hidden="true" tabindex="-1"></a>dt[B <span class="sc">&gt;</span> <span class="dv">5</span>, ]</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt;
1:     3   9.7      b
2:     4   5.6      a
3:     5   8.1      a</code></pre>
<p>Think of working inside the <code>data.table</code> frame (i.e. the “[…]”) like an environment. You have direct access to the variables within it.<br />
If you want to refer to variables outside the <code>data.table</code>, prefix the variable name with <code>..</code>. This is similar to how you access contents of a directory above your current directory in the terminal:</p>
<div class="sourceCode" id="cb1495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1495-1"><a href="datatable.html#cb1495-1" aria-hidden="true" tabindex="-1"></a>varname <span class="ot">=</span> <span class="st">&quot;C&quot;</span></span>
<span id="cb1495-2"><a href="datatable.html#cb1495-2" aria-hidden="true" tabindex="-1"></a>df[, varname]</span></code></pre></div>
<pre><code>[1] &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;a&quot; &quot;a&quot;</code></pre>
<div class="sourceCode" id="cb1497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1497-1"><a href="datatable.html#cb1497-1" aria-hidden="true" tabindex="-1"></a>dt[, ..varname]</span></code></pre></div>
<pre><code>        C
   &lt;fctr&gt;
1:      a
2:      b
3:      b
4:      a
5:      a</code></pre>
<p>This tells the <code>data.table</code> “don’t look for ‘varname’ in the data.table, go outside to find it”</p>
<div id="conditionally-select-cases" class="section level3" number="24.4.1">
<h3><span class="header-section-number">24.4.1</span> Conditionally select cases:</h3>
<p>It is easy to select cases by combining conditions by using column names directly. Note that <code>data.table</code> does not require you to add “,” to select all columns after you have specified rows - works just the same if you so include it:</p>
<p>There are a few way to conditionally select in a data.frame:</p>
<div class="sourceCode" id="cb1499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1499-1"><a href="datatable.html#cb1499-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>A <span class="sc">&gt;</span> <span class="fu">mean</span>(df<span class="sc">$</span>A) <span class="sc">&amp;</span> df<span class="sc">$</span>B <span class="sc">&gt;</span> <span class="fu">mean</span>(df<span class="sc">$</span>B), ]</span></code></pre></div>
<pre><code>  A   B C
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1501-1"><a href="datatable.html#cb1501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(df, A <span class="sc">&gt;</span> <span class="fu">mean</span>(A) <span class="sc">&amp;</span> B <span class="sc">&gt;</span> <span class="fu">mean</span>(B))</span></code></pre></div>
<pre><code>  A   B C
5 5 8.1 a</code></pre>
<div class="sourceCode" id="cb1503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1503-1"><a href="datatable.html#cb1503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(df, df[A <span class="sc">&gt;</span> <span class="fu">mean</span>(A) <span class="sc">&amp;</span> B <span class="sc">&gt;</span> <span class="fu">mean</span>(B), ])</span></code></pre></div>
<pre><code>  A   B C
5 5 8.1 a</code></pre>
<p>The data.table equivalent is probably simplest:</p>
<div class="sourceCode" id="cb1505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1505-1"><a href="datatable.html#cb1505-1" aria-hidden="true" tabindex="-1"></a>dt[A <span class="sc">&gt;</span> <span class="fu">mean</span>(A) <span class="sc">&amp;</span> B <span class="sc">&gt;</span> <span class="fu">mean</span>(B)]</span></code></pre></div>
<pre><code>       A     B      C
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt;
1:     5   8.1      a</code></pre>
<div class="sourceCode" id="cb1507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1507-1"><a href="datatable.html#cb1507-1" aria-hidden="true" tabindex="-1"></a>(a <span class="ot">&lt;-</span> <span class="fu">rnormmat</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="at">seed =</span> <span class="dv">2020</span>, <span class="at">return.df =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>           V1          V2          V3          V4          V5
1   0.3769721 -0.85312282  2.17436525 -0.81250466  0.90850113
2   0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
3  -1.0980232  1.19637296  0.31822032  1.09534507 -0.30100401
4  -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
5  -2.7965343 -0.12326023  0.83426874  0.38811847 -1.18007703
6   0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
7   0.9391210  1.70399588  1.29784138 -0.28559829 -0.37071130
8  -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
9   1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
10  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364</code></pre>
<div class="sourceCode" id="cb1509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1509-1"><a href="datatable.html#cb1509-1" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">1</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> a[<span class="dv">3</span>, <span class="dv">4</span>] <span class="ot">&lt;-</span> a[<span class="dv">5</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> a[<span class="dv">7</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1509-2"><a href="datatable.html#cb1509-2" aria-hidden="true" tabindex="-1"></a>adt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(a)</span></code></pre></div>
<div class="sourceCode" id="cb1510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1510-1"><a href="datatable.html#cb1510-1" aria-hidden="true" tabindex="-1"></a>a[<span class="sc">!</span><span class="fu">is.na</span>(a<span class="sc">$</span>V3), ]</span></code></pre></div>
<pre><code>           V1          V2          V3          V4          V5
2   0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
3  -1.0980232  1.19637296  0.31822032          NA -0.30100401
4  -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
6   0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
8  -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
9   1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
10  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364</code></pre>
<div class="sourceCode" id="cb1512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1512-1"><a href="datatable.html#cb1512-1" aria-hidden="true" tabindex="-1"></a>adt[<span class="sc">!</span><span class="fu">is.na</span>(V3)]</span></code></pre></div>
<pre><code>           V1          V2          V3          V4          V5
        &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
1:  0.3015484  0.90925918  1.09818265 -0.74370217 -0.50505960
2: -1.0980232  1.19637296  0.31822032          NA -0.30100401
3: -1.1304059 -0.37158390 -0.07314756  2.43537371 -0.72603598
4:  0.7205735  1.80004312  0.19875064  0.29062767  0.25307471
5: -0.2293777 -3.03876461  0.93671831  0.07601472  0.02217956
6:  1.7591313 -2.28897495 -0.14743319 -0.56029860  0.66004412
7:  0.1173668  0.05830349  0.11043199  0.44718837  0.48879364</code></pre>
</div>
<div id="select-columns" class="section level3" number="24.4.2">
<h3><span class="header-section-number">24.4.2</span> Select columns</h3>
<p>by integer index, same as with a data.frame</p>
<div class="sourceCode" id="cb1514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1514-1"><a href="datatable.html#cb1514-1" aria-hidden="true" tabindex="-1"></a>dt[, <span class="dv">2</span>]</span></code></pre></div>
<pre><code>       B
   &lt;num&gt;
1:   1.2
2:   4.3
3:   9.7
4:   5.6
5:   8.1</code></pre>
<div class="sourceCode" id="cb1516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1516-1"><a href="datatable.html#cb1516-1" aria-hidden="true" tabindex="-1"></a>dt[, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>       B      C
   &lt;num&gt; &lt;fctr&gt;
1:   1.2      a
2:   4.3      b
3:   9.7      b
4:   5.6      a
5:   8.1      a</code></pre>
<div class="sourceCode" id="cb1518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1518-1"><a href="datatable.html#cb1518-1" aria-hidden="true" tabindex="-1"></a>dt[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)]</span></code></pre></div>
<pre><code>       A      C
   &lt;int&gt; &lt;fctr&gt;
1:     1      a
2:     2      b
3:     3      b
4:     4      a
5:     5      a</code></pre>
<p>by name: selecting a single column by name returns a vector:</p>
<div class="sourceCode" id="cb1520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1520-1"><a href="datatable.html#cb1520-1" aria-hidden="true" tabindex="-1"></a>dt[, A]</span></code></pre></div>
<pre><code>[1] 1 2 3 4 5</code></pre>
<p>by name: selecting one or more columns by name enclosed in <code>.()</code> which, in this case, is short for <code>list()</code>, return a <code>data.table</code>:</p>
<div class="sourceCode" id="cb1522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1522-1"><a href="datatable.html#cb1522-1" aria-hidden="true" tabindex="-1"></a>dt[, .(A)]</span></code></pre></div>
<pre><code>       A
   &lt;int&gt;
1:     1
2:     2
3:     3
4:     4
5:     5</code></pre>
<div class="sourceCode" id="cb1524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1524-1"><a href="datatable.html#cb1524-1" aria-hidden="true" tabindex="-1"></a>dt[, .(A, B)]</span></code></pre></div>
<pre><code>       A     B
   &lt;int&gt; &lt;num&gt;
1:     1   1.2
2:     2   4.3
3:     3   9.7
4:     4   5.6
5:     5   8.1</code></pre>
</div>
</div>
<div id="add-new-columns-in-place" class="section level2" number="24.5">
<h2><span class="header-section-number">24.5</span> Add new columns <strong><em>in-place</em></strong></h2>
<p>Use <code>:=</code> assignment to add a new column in the existing <code>data.table</code>.
Once again, in-place means you do not have to assign the result to a variable, the existing <code>data.table</code> will be changed.</p>
<div class="sourceCode" id="cb1526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1526-1"><a href="datatable.html#cb1526-1" aria-hidden="true" tabindex="-1"></a>dt[, AplusC <span class="sc">:</span><span class="er">=</span> A <span class="sc">+</span> C]</span></code></pre></div>
<pre><code>Warning in Ops.factor(A, C): &#39;+&#39; not meaningful for factors</code></pre>
<div class="sourceCode" id="cb1528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1528-1"><a href="datatable.html#cb1528-1" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B      C AplusC
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt; &lt;lgcl&gt;
1:     1   1.2      a     NA
2:     2   4.3      b     NA
3:     3   9.7      b     NA
4:     4   5.6      a     NA
5:     5   8.1      a     NA</code></pre>
</div>
<div id="add-multiple-columns-in-place" class="section level2" number="24.6">
<h2><span class="header-section-number">24.6</span> Add multiple columns <strong><em>in-place</em></strong></h2>
<p>To add multiple columns, use <code>:=</code> in a little more awkward notation:</p>
<div class="sourceCode" id="cb1530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1530-1"><a href="datatable.html#cb1530-1" aria-hidden="true" tabindex="-1"></a>dt[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">AminusC =</span> A <span class="sc">-</span> C, <span class="at">AoverC =</span> A <span class="sc">/</span> C)]</span></code></pre></div>
<pre><code>Warning in Ops.factor(A, C): &#39;-&#39; not meaningful for factors</code></pre>
<pre><code>Warning in Ops.factor(A, C): &#39;/&#39; not meaningful for factors</code></pre>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1533-1"><a href="datatable.html#cb1533-1" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B      C AplusC AminusC AoverC
   &lt;int&gt; &lt;num&gt; &lt;fctr&gt; &lt;lgcl&gt;  &lt;lgcl&gt; &lt;lgcl&gt;
1:     1   1.2      a     NA      NA     NA
2:     2   4.3      b     NA      NA     NA
3:     3   9.7      b     NA      NA     NA
4:     4   5.6      a     NA      NA     NA
5:     5   8.1      a     NA      NA     NA</code></pre>
</div>
<div id="convert-column-type" class="section level2" number="24.7">
<h2><span class="header-section-number">24.7</span> Convert column type</h2>
<p>Use any base R coercion function (<code>as.*</code>) to convert a column in-place using the <code>:=</code> notation</p>
<div class="sourceCode" id="cb1535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1535-1"><a href="datatable.html#cb1535-1" aria-hidden="true" tabindex="-1"></a>dt[, A <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(A)]</span>
<span id="cb1535-2"><a href="datatable.html#cb1535-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B      C AplusC AminusC AoverC
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt; &lt;lgcl&gt;  &lt;lgcl&gt; &lt;lgcl&gt;
1:     1   1.2      a     NA      NA     NA
2:     2   4.3      b     NA      NA     NA
3:     3   9.7      b     NA      NA     NA
4:     4   5.6      a     NA      NA     NA
5:     5   8.1      a     NA      NA     NA</code></pre>
</div>
<div id="delete-column-in-place" class="section level2" number="24.8">
<h2><span class="header-section-number">24.8</span> Delete column in-place</h2>
<p>To delete a column, use <code>:=</code> to set it to NULL:</p>
<div class="sourceCode" id="cb1537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1537-1"><a href="datatable.html#cb1537-1" aria-hidden="true" tabindex="-1"></a>dt[, AoverC <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb1537-2"><a href="datatable.html#cb1537-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B      C AplusC AminusC
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt; &lt;lgcl&gt;  &lt;lgcl&gt;
1:     1   1.2      a     NA      NA
2:     2   4.3      b     NA      NA
3:     3   9.7      b     NA      NA
4:     4   5.6      a     NA      NA
5:     5   8.1      a     NA      NA</code></pre>
<p>Same awkward notation as earlier to delete multiple columns:</p>
<div class="sourceCode" id="cb1539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1539-1"><a href="datatable.html#cb1539-1" aria-hidden="true" tabindex="-1"></a>dt[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">AplusC =</span> <span class="cn">NULL</span>, <span class="at">AminusC =</span> <span class="cn">NULL</span>)]</span>
<span id="cb1539-2"><a href="datatable.html#cb1539-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B      C
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;
1:     1   1.2      a
2:     2   4.3      b
3:     3   9.7      b
4:     4   5.6      a
5:     5   8.1      a</code></pre>
</div>
<div id="summarize-2" class="section level2" number="24.9">
<h2><span class="header-section-number">24.9</span> Summarize</h2>
<p>Create a <em>new</em> data.table using any summary function:</p>
<div class="sourceCode" id="cb1541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1541-1"><a href="datatable.html#cb1541-1" aria-hidden="true" tabindex="-1"></a>Asummary <span class="ot">&lt;-</span> dt[, .(<span class="at">Amax =</span> <span class="fu">max</span>(A), <span class="at">Amin =</span> <span class="fu">min</span>(A), <span class="at">Asd =</span> <span class="fu">sd</span>(A))]</span>
<span id="cb1541-2"><a href="datatable.html#cb1541-2" aria-hidden="true" tabindex="-1"></a>Asummary</span></code></pre></div>
<pre><code>    Amax  Amin      Asd
   &lt;num&gt; &lt;num&gt;    &lt;num&gt;
1:     5     1 1.581139</code></pre>
<div id="address-object-location-in-memory" class="section level3" number="24.9.1">
<h3><span class="header-section-number">24.9.1</span> <code>address</code>: Object location in memory</h3>
<p>When you add a new column to an existing data.frame, the data.frame is copied behind the scenes - you can tell becasue its memory address (where it’s physically stored in your computer) changes:</p>
<div class="sourceCode" id="cb1543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1543-1"><a href="datatable.html#cb1543-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">beta =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb1543-2"><a href="datatable.html#cb1543-2" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(df1)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa2308d2c8&quot;</code></pre>
<div class="sourceCode" id="cb1545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1545-1"><a href="datatable.html#cb1545-1" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>gamma <span class="ot">&lt;-</span> df1<span class="sc">$</span>alpha <span class="sc">+</span> df1<span class="sc">$</span>beta</span>
<span id="cb1545-2"><a href="datatable.html#cb1545-2" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(df1)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa238ddfc8&quot;</code></pre>
<p>When you add a new column in a data.table <strong><em>in-place</em></strong> its address remains unchanged:</p>
<div class="sourceCode" id="cb1547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1547-1"><a href="datatable.html#cb1547-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">beta =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb1547-2"><a href="datatable.html#cb1547-2" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(dt1)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa23339800&quot;</code></pre>
<div class="sourceCode" id="cb1549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1549-1"><a href="datatable.html#cb1549-1" aria-hidden="true" tabindex="-1"></a>dt1[, gamma <span class="sc">:</span><span class="er">=</span> alpha <span class="sc">+</span> beta]</span>
<span id="cb1549-2"><a href="datatable.html#cb1549-2" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(dt1)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa23339800&quot;</code></pre>
</div>
<div id="reference-semantics-at-work" class="section level3" number="24.9.2">
<h3><span class="header-section-number">24.9.2</span> Reference semantics at work</h3>
<p>Up to now, you are likely used to working with regular R objects that behave like this:</p>
<div class="sourceCode" id="cb1551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1551-1"><a href="datatable.html#cb1551-1" aria-hidden="true" tabindex="-1"></a>(df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>)))</span></code></pre></div>
<pre><code>  a
1 1
2 1
3 1
4 1
5 1</code></pre>
<div class="sourceCode" id="cb1553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1553-1"><a href="datatable.html#cb1553-1" aria-hidden="true" tabindex="-1"></a>(df2 <span class="ot">&lt;-</span> df1)</span></code></pre></div>
<pre><code>  a
1 1
2 1
3 1
4 1
5 1</code></pre>
<div class="sourceCode" id="cb1555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1555-1"><a href="datatable.html#cb1555-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>a <span class="ot">&lt;-</span> df2<span class="sc">$</span>a<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb1555-2"><a href="datatable.html#cb1555-2" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>  a
1 2
2 2
3 2
4 2
5 2</code></pre>
<div class="sourceCode" id="cb1557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1557-1"><a href="datatable.html#cb1557-1" aria-hidden="true" tabindex="-1"></a>df1</span></code></pre></div>
<pre><code>  a
1 1
2 1
3 1
4 1
5 1</code></pre>
<div class="sourceCode" id="cb1559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1559-1"><a href="datatable.html#cb1559-1" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(df1)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa23bbd988&quot;</code></pre>
<div class="sourceCode" id="cb1561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1561-1"><a href="datatable.html#cb1561-1" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(df2)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa23d383d0&quot;</code></pre>
<p><code>data.table</code> uses “reference semantics” or “pass-by-reference”. Be very careful or you might be mightily confused:</p>
<div class="sourceCode" id="cb1563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1563-1"><a href="datatable.html#cb1563-1" aria-hidden="true" tabindex="-1"></a>(dt1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">a =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>)))</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     1
2:     1
3:     1
4:     1
5:     1</code></pre>
<div class="sourceCode" id="cb1565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1565-1"><a href="datatable.html#cb1565-1" aria-hidden="true" tabindex="-1"></a>(dt2 <span class="ot">&lt;-</span> dt1)</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     1
2:     1
3:     1
4:     1
5:     1</code></pre>
<div class="sourceCode" id="cb1567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1567-1"><a href="datatable.html#cb1567-1" aria-hidden="true" tabindex="-1"></a>dt2[, a <span class="sc">:</span><span class="er">=</span> a <span class="sc">*</span> <span class="dv">2</span>]</span>
<span id="cb1567-2"><a href="datatable.html#cb1567-2" aria-hidden="true" tabindex="-1"></a>dt2</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     2
2:     2
3:     2
4:     2
5:     2</code></pre>
<div class="sourceCode" id="cb1569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1569-1"><a href="datatable.html#cb1569-1" aria-hidden="true" tabindex="-1"></a>dt1</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     2
2:     2
3:     2
4:     2
5:     2</code></pre>
<div class="sourceCode" id="cb1571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1571-1"><a href="datatable.html#cb1571-1" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(dt1)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa23318400&quot;</code></pre>
<div class="sourceCode" id="cb1573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1573-1"><a href="datatable.html#cb1573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(dt2)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa23318400&quot;</code></pre>
<div class="rmdnote">
<p>
If you want to create a copy of a data.table, use <code>copy()</code>:
</p>
</div>
<div class="sourceCode" id="cb1575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1575-1"><a href="datatable.html#cb1575-1" aria-hidden="true" tabindex="-1"></a>(dt3 <span class="ot">&lt;-</span> <span class="fu">copy</span>(dt1))</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     2
2:     2
3:     2
4:     2
5:     2</code></pre>
<div class="sourceCode" id="cb1577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1577-1"><a href="datatable.html#cb1577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(dt3)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa23326e00&quot;</code></pre>
<div class="sourceCode" id="cb1579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1579-1"><a href="datatable.html#cb1579-1" aria-hidden="true" tabindex="-1"></a>dt3[, a <span class="sc">:</span><span class="er">=</span> a <span class="sc">*</span> <span class="dv">2</span>]</span>
<span id="cb1579-2"><a href="datatable.html#cb1579-2" aria-hidden="true" tabindex="-1"></a>dt3</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     4
2:     4
3:     4
4:     4
5:     4</code></pre>
<div class="sourceCode" id="cb1581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1581-1"><a href="datatable.html#cb1581-1" aria-hidden="true" tabindex="-1"></a>dt1</span></code></pre></div>
<pre><code>       a
   &lt;num&gt;
1:     2
2:     2
3:     2
4:     2
5:     2</code></pre>
</div>
</div>
<div id="set-set-attributes-in-place" class="section level2" number="24.10">
<h2><span class="header-section-number">24.10</span> <code>set*()</code>: Set attributes <strong><em>in-place</em></strong></h2>
<p><code>data.table</code> includes a number of function that begin with <code>set*</code>, all of which change their input <em>by reference</em> and as such require no assignment.<br />
You may be surprised to find out that even an inocuous operation like changing the column names of a data.frame, requires a copy:</p>
<div class="sourceCode" id="cb1583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1583-1"><a href="datatable.html#cb1583-1" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(df)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa232baed8&quot;</code></pre>
<div class="sourceCode" id="cb1585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1585-1"><a href="datatable.html#cb1585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;Group&quot;</span>)</span>
<span id="cb1585-2"><a href="datatable.html#cb1585-2" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(df)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa227e13e8&quot;</code></pre>
<p>Use <code>setnames()</code> to edit a <code>data.table</code>’s column names <strong><em>in-place</em></strong>:</p>
<div class="sourceCode" id="cb1587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1587-1"><a href="datatable.html#cb1587-1" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(dt)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa2458a200&quot;</code></pre>
<div class="sourceCode" id="cb1589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1589-1"><a href="datatable.html#cb1589-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(dt, <span class="at">old =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">new =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;Group&quot;</span>))</span>
<span id="cb1589-2"><a href="datatable.html#cb1589-2" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(dt)</span></code></pre></div>
<pre><code>[1] &quot;0x7faa2458a200&quot;</code></pre>
</div>
<div id="setorder-set-order-of-data.table" class="section level2" number="24.11">
<h2><span class="header-section-number">24.11</span> <code>setorder()</code>: Set order of <code>data.table</code></h2>
<p>Since this is a <code>set*</code> function, it changes a <code>data.table</code> in-place. You can order by any number of columns, ascending or descending:<br />
Order by Group and then by A:</p>
<div class="sourceCode" id="cb1591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1591-1"><a href="datatable.html#cb1591-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(dt, Group, A)</span>
<span id="cb1591-2"><a href="datatable.html#cb1591-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B  Group
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;
1:     1   1.2      a
2:     4   5.6      a
3:     5   8.1      a
4:     2   4.3      b
5:     3   9.7      b</code></pre>
<p>Order by Group and then by decreasing B:</p>
<div class="sourceCode" id="cb1593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1593-1"><a href="datatable.html#cb1593-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(dt, Group, <span class="sc">-</span>B)</span>
<span id="cb1593-2"><a href="datatable.html#cb1593-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B  Group
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;
1:     5   8.1      a
2:     4   5.6      a
3:     1   1.2      a
4:     3   9.7      b
5:     2   4.3      b</code></pre>
</div>
<div id="group-according-to-by" class="section level2" number="24.12">
<h2><span class="header-section-number">24.12</span> Group according to <code>by</code></h2>
<p>Up to now, we have learned how to use the <code>data.table</code> frame <code>dat[i, j]</code> to filter cases in <code>i</code> or add/remove/transform columns in-place in <code>j</code>. There is a whole other dimension in the <code>data.table</code> frame: <code>by</code>.</p>
<div class="rmdtip">
<p>
The complete <code>data.table</code> syntax is:
</p>
<p>
<code>dt[i, j, by]</code>
</p>
<ul>
<li>
Take data.table <code>dt</code>
</li>
<li>
Subset rows using <code>i</code>
</li>
<li>
Manipulate columns with <code>j</code>
</li>
<li>
Grouped according to <code>by</code>
</li>
</ul>
</div>
<p>Again, using <code>.()</code> or <code>list()</code> in <code>j</code>, returns a new <code>data.table</code>:</p>
<div class="sourceCode" id="cb1595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1595-1"><a href="datatable.html#cb1595-1" aria-hidden="true" tabindex="-1"></a>dt[, .(<span class="at">meanAbyGroup =</span> <span class="fu">mean</span>(A)), by <span class="ot">=</span> Group]</span></code></pre></div>
<pre><code>    Group meanAbyGroup
   &lt;fctr&gt;        &lt;num&gt;
1:      a     3.333333
2:      b     2.500000</code></pre>
<div class="sourceCode" id="cb1597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1597-1"><a href="datatable.html#cb1597-1" aria-hidden="true" tabindex="-1"></a>dt[, <span class="fu">list</span>(<span class="at">medianBbyGroup =</span> <span class="fu">median</span>(B)), by <span class="ot">=</span> Group]</span></code></pre></div>
<pre><code>    Group medianBbyGroup
   &lt;fctr&gt;          &lt;num&gt;
1:      a            5.6
2:      b            7.0</code></pre>
<p>Making an assignment with <code>:=</code> in <code>j</code>, adds a column in-place. Since here we are grouping, the same value will be assigned to all cases of the group:</p>
<div class="sourceCode" id="cb1599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1599-1"><a href="datatable.html#cb1599-1" aria-hidden="true" tabindex="-1"></a>dt[, meanAbyGroup <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(A), by <span class="ot">=</span> Group]</span>
<span id="cb1599-2"><a href="datatable.html#cb1599-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B  Group meanAbyGroup
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;        &lt;num&gt;
1:     5   8.1      a     3.333333
2:     4   5.6      a     3.333333
3:     1   1.2      a     3.333333
4:     3   9.7      b     2.500000
5:     2   4.3      b     2.500000</code></pre>
<p>For more complex operations, you may need to refer to the slice of the <code>data.table</code> defined by <code>by</code> within <code>j</code>. There is a special notation for this: <code>.SD</code> (think sub-<code>data.table</code>):</p>
<div class="sourceCode" id="cb1601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1601-1"><a href="datatable.html#cb1601-1" aria-hidden="true" tabindex="-1"></a>dt[, A_DiffFromGroupMin <span class="sc">:</span><span class="er">=</span> .SD[, <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">min</span>(.SD[, <span class="dv">1</span>]), by <span class="ot">=</span> Group]</span>
<span id="cb1601-2"><a href="datatable.html#cb1601-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       A     B  Group meanAbyGroup A_DiffFromGroupMin
   &lt;num&gt; &lt;num&gt; &lt;fctr&gt;        &lt;num&gt;              &lt;num&gt;
1:     5   8.1      a     3.333333                  4
2:     4   5.6      a     3.333333                  3
3:     1   1.2      a     3.333333                  0
4:     3   9.7      b     2.500000                  1
5:     2   4.3      b     2.500000                  0</code></pre>
<div class="rmdnote">
<p>
By now, it should be clearer that the <code>data.table</code> frame provides a very flexible way to perform a very wide range of operations with minimal new notation.
</p>
</div>
</div>
<div id="apply-functions-to-columns" class="section level2" number="24.13">
<h2><span class="header-section-number">24.13</span> Apply functions to columns</h2>
<p>Any function that returns a list can be used in <code>j</code> to return a new data.table - therefore lapply is perfect for getting summary on multiple columns:</p>
<div class="sourceCode" id="cb1603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1603-1"><a href="datatable.html#cb1603-1" aria-hidden="true" tabindex="-1"></a>(dt1 <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">rnormmat</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">2020</span>)))</span></code></pre></div>
<pre><code>            V1          V2          V3
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
 1:  0.3769721 -0.85312282  2.17436525
 2:  0.3015484  0.90925918  1.09818265
 3: -1.0980232  1.19637296  0.31822032
 4: -1.1304059 -0.37158390 -0.07314756
 5: -2.7965343 -0.12326023  0.83426874
 6:  0.7205735  1.80004312  0.19875064
 7:  0.9391210  1.70399588  1.29784138
 8: -0.2293777 -3.03876461  0.93671831
 9:  1.7591313 -2.28897495 -0.14743319
10:  0.1173668  0.05830349  0.11043199</code></pre>
<div class="sourceCode" id="cb1605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1605-1"><a href="datatable.html#cb1605-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(dt1, <span class="fu">c</span>(<span class="st">&quot;Alpha&quot;</span>, <span class="st">&quot;Beta&quot;</span>, <span class="st">&quot;Gamma&quot;</span>))</span>
<span id="cb1605-2"><a href="datatable.html#cb1605-2" aria-hidden="true" tabindex="-1"></a>dt1[, <span class="fu">lapply</span>(.SD, mean)]</span></code></pre></div>
<pre><code>        Alpha       Beta     Gamma
        &lt;num&gt;      &lt;num&gt;     &lt;num&gt;
1: -0.1039628 -0.1007732 0.6748199</code></pre>
<p>You can specify which columns to operate on by adding the <code>.SDcols</code> argument:</p>
<div class="sourceCode" id="cb1607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1607-1"><a href="datatable.html#cb1607-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">A =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1607-2"><a href="datatable.html#cb1607-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">B =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">4.3</span>, <span class="fl">9.7</span>, <span class="fl">5.6</span>, <span class="fl">8.1</span>),</span>
<span id="cb1607-3"><a href="datatable.html#cb1607-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">C =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>),</span>
<span id="cb1607-4"><a href="datatable.html#cb1607-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Group =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>))</span>
<span id="cb1607-5"><a href="datatable.html#cb1607-5" aria-hidden="true" tabindex="-1"></a>dt2</span></code></pre></div>
<pre><code>       A     B          C  Group
   &lt;int&gt; &lt;num&gt;      &lt;num&gt; &lt;char&gt;
1:     1   1.2 -0.8125047      a
2:     2   4.3 -0.7437022      b
3:     3   9.7  1.0953451      b
4:     4   5.6  2.4353737      a
5:     5   8.1  0.3881185      a</code></pre>
<div class="sourceCode" id="cb1609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1609-1"><a href="datatable.html#cb1609-1" aria-hidden="true" tabindex="-1"></a>dt2[, <span class="fu">lapply</span>(.SD, mean), .SDcols <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>       A     B
   &lt;num&gt; &lt;num&gt;
1:     3  5.78</code></pre>
<div class="sourceCode" id="cb1611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1611-1"><a href="datatable.html#cb1611-1" aria-hidden="true" tabindex="-1"></a><span class="co"># same as</span></span>
<span id="cb1611-2"><a href="datatable.html#cb1611-2" aria-hidden="true" tabindex="-1"></a>dt2[, <span class="fu">lapply</span>(.SD, mean), .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>)]</span></code></pre></div>
<pre><code>       A     B
   &lt;num&gt; &lt;num&gt;
1:     3  5.78</code></pre>
<div class="sourceCode" id="cb1613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1613-1"><a href="datatable.html#cb1613-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>)</span>
<span id="cb1613-2"><a href="datatable.html#cb1613-2" aria-hidden="true" tabindex="-1"></a>dt2[, <span class="fu">lapply</span>(.SD, mean), .SDcols <span class="ot">=</span> cols]</span></code></pre></div>
<pre><code>       A     B
   &lt;num&gt; &lt;num&gt;
1:     3  5.78</code></pre>
<p>You can combine <code>.SDcols</code> and <code>by</code>:</p>
<div class="sourceCode" id="cb1615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1615-1"><a href="datatable.html#cb1615-1" aria-hidden="true" tabindex="-1"></a>dt2[, <span class="fu">lapply</span>(.SD, median), .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), by <span class="ot">=</span> Group]</span></code></pre></div>
<pre><code>    Group     B         C
   &lt;char&gt; &lt;num&gt;     &lt;num&gt;
1:      a   5.6 0.3881185
2:      b   7.0 0.1758215</code></pre>
<p>Create multiple new columns from transformation of existing and store with custom prefix:</p>
<div class="sourceCode" id="cb1617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1617-1"><a href="datatable.html#cb1617-1" aria-hidden="true" tabindex="-1"></a>dt1</span></code></pre></div>
<pre><code>         Alpha        Beta       Gamma
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
 1:  0.3769721 -0.85312282  2.17436525
 2:  0.3015484  0.90925918  1.09818265
 3: -1.0980232  1.19637296  0.31822032
 4: -1.1304059 -0.37158390 -0.07314756
 5: -2.7965343 -0.12326023  0.83426874
 6:  0.7205735  1.80004312  0.19875064
 7:  0.9391210  1.70399588  1.29784138
 8: -0.2293777 -3.03876461  0.93671831
 9:  1.7591313 -2.28897495 -0.14743319
10:  0.1173668  0.05830349  0.11043199</code></pre>
<div class="sourceCode" id="cb1619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1619-1"><a href="datatable.html#cb1619-1" aria-hidden="true" tabindex="-1"></a>dt1[, <span class="fu">paste0</span>(<span class="fu">names</span>(dt1), <span class="st">&quot;_abs&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, abs)]</span>
<span id="cb1619-2"><a href="datatable.html#cb1619-2" aria-hidden="true" tabindex="-1"></a>dt1</span></code></pre></div>
<pre><code>         Alpha        Beta       Gamma Alpha_abs   Beta_abs  Gamma_abs
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:  0.3769721 -0.85312282  2.17436525 0.3769721 0.85312282 2.17436525
 2:  0.3015484  0.90925918  1.09818265 0.3015484 0.90925918 1.09818265
 3: -1.0980232  1.19637296  0.31822032 1.0980232 1.19637296 0.31822032
 4: -1.1304059 -0.37158390 -0.07314756 1.1304059 0.37158390 0.07314756
 5: -2.7965343 -0.12326023  0.83426874 2.7965343 0.12326023 0.83426874
 6:  0.7205735  1.80004312  0.19875064 0.7205735 1.80004312 0.19875064
 7:  0.9391210  1.70399588  1.29784138 0.9391210 1.70399588 1.29784138
 8: -0.2293777 -3.03876461  0.93671831 0.2293777 3.03876461 0.93671831
 9:  1.7591313 -2.28897495 -0.14743319 1.7591313 2.28897495 0.14743319
10:  0.1173668  0.05830349  0.11043199 0.1173668 0.05830349 0.11043199</code></pre>
<div class="sourceCode" id="cb1621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1621-1"><a href="datatable.html#cb1621-1" aria-hidden="true" tabindex="-1"></a>dt2</span></code></pre></div>
<pre><code>       A     B          C  Group
   &lt;int&gt; &lt;num&gt;      &lt;num&gt; &lt;char&gt;
1:     1   1.2 -0.8125047      a
2:     2   4.3 -0.7437022      b
3:     3   9.7  1.0953451      b
4:     4   5.6  2.4353737      a
5:     5   8.1  0.3881185      a</code></pre>
<div class="sourceCode" id="cb1623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1623-1"><a href="datatable.html#cb1623-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>)</span>
<span id="cb1623-2"><a href="datatable.html#cb1623-2" aria-hidden="true" tabindex="-1"></a>dt2[, <span class="fu">paste0</span>(cols, <span class="st">&quot;_groupMean&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, mean), .SDcols <span class="ot">=</span> cols, by <span class="ot">=</span> Group]</span>
<span id="cb1623-3"><a href="datatable.html#cb1623-3" aria-hidden="true" tabindex="-1"></a>dt2</span></code></pre></div>
<pre><code>       A     B          C  Group A_groupMean C_groupMean
   &lt;int&gt; &lt;num&gt;      &lt;num&gt; &lt;char&gt;       &lt;num&gt;       &lt;num&gt;
1:     1   1.2 -0.8125047      a    3.333333   0.6703292
2:     2   4.3 -0.7437022      b    2.500000   0.1758215
3:     3   9.7  1.0953451      b    2.500000   0.1758215
4:     4   5.6  2.4353737      a    3.333333   0.6703292
5:     5   8.1  0.3881185      a    3.333333   0.6703292</code></pre>
</div>
<div id="row-wise-operations" class="section level2" number="24.14">
<h2><span class="header-section-number">24.14</span> Row-wise operations</h2>
<div class="sourceCode" id="cb1625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1625-1"><a href="datatable.html#cb1625-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">b =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>, <span class="at">c =</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">d =</span> <span class="dv">31</span><span class="sc">:</span><span class="dv">35</span>, <span class="at">e =</span> <span class="dv">41</span><span class="sc">:</span><span class="dv">45</span>)</span>
<span id="cb1625-2"><a href="datatable.html#cb1625-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       a     b     c     d     e
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1:     1    11    21    31    41
2:     2    12    22    32    42
3:     3    13    23    33    43
4:     4    14    24    34    44
5:     5    15    25    35    45</code></pre>
<p>To operate row-wise, we can use <code>by = 1:nrow(dt)</code>.
For example, to add a column, in-place, with row-wise sums of variables b through d:</p>
<div class="sourceCode" id="cb1627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1627-1"><a href="datatable.html#cb1627-1" aria-hidden="true" tabindex="-1"></a>dt[, bcd.sum <span class="sc">:</span><span class="er">=</span> <span class="fu">sum</span>(.SD[, b<span class="sc">:</span>d]), by <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dt)]</span>
<span id="cb1627-2"><a href="datatable.html#cb1627-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>       a     b     c     d     e bcd.sum
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
1:     1    11    21    31    41      63
2:     2    12    22    32    42      66
3:     3    13    23    33    43      69
4:     4    14    24    34    44      72
5:     5    15    25    35    45      75</code></pre>
</div>
<div id="melt" class="section level2" number="24.15">
<h2><span class="header-section-number">24.15</span> Wide &lt;=&gt; Long</h2>
<div id="melt-wide-to-long" class="section level3" number="24.15.1">
<h3><span class="header-section-number">24.15.1</span> <code>melt()</code>: Wide to long</h3>
<div class="sourceCode" id="cb1629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1629-1"><a href="datatable.html#cb1629-1" aria-hidden="true" tabindex="-1"></a>dt_wide <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">Timepoint_A =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">14</span>,</span>
<span id="cb1629-2"><a href="datatable.html#cb1629-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Timepoint_B =</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">24</span>, <span class="at">Timepoint_C =</span> <span class="dv">51</span><span class="sc">:</span><span class="dv">54</span>)</span>
<span id="cb1629-3"><a href="datatable.html#cb1629-3" aria-hidden="true" tabindex="-1"></a>dt_wide</span></code></pre></div>
<pre><code>      ID Timepoint_A Timepoint_B Timepoint_C
   &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
1:     1          11          21          51
2:     2          12          22          52
3:     3          13          23          53
4:     4          14          24          54</code></pre>
<div class="sourceCode" id="cb1631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1631-1"><a href="datatable.html#cb1631-1" aria-hidden="true" tabindex="-1"></a>dt_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(dt_wide, <span class="at">id.vars =</span> <span class="st">&quot;ID&quot;</span>,</span>
<span id="cb1631-2"><a href="datatable.html#cb1631-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">measure.vars =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="co"># defaults to all non-id columns</span></span>
<span id="cb1631-3"><a href="datatable.html#cb1631-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">variable.name =</span> <span class="st">&quot;Timepoint&quot;</span>,</span>
<span id="cb1631-4"><a href="datatable.html#cb1631-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">value.name =</span> <span class="fu">c</span>(<span class="st">&quot;Score&quot;</span>))</span>
<span id="cb1631-5"><a href="datatable.html#cb1631-5" aria-hidden="true" tabindex="-1"></a>dt_long</span></code></pre></div>
<pre><code>       ID   Timepoint Score
    &lt;int&gt;      &lt;fctr&gt; &lt;int&gt;
 1:     1 Timepoint_A    11
 2:     2 Timepoint_A    12
 3:     3 Timepoint_A    13
 4:     4 Timepoint_A    14
 5:     1 Timepoint_B    21
 6:     2 Timepoint_B    22
 7:     3 Timepoint_B    23
 8:     4 Timepoint_B    24
 9:     1 Timepoint_C    51
10:     2 Timepoint_C    52
11:     3 Timepoint_C    53
12:     4 Timepoint_C    54</code></pre>
</div>
<div id="dcast-long-to-wide" class="section level3" number="24.15.2">
<h3><span class="header-section-number">24.15.2</span> <code>dcast()</code>: Long to wide</h3>
<div class="sourceCode" id="cb1633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1633-1"><a href="datatable.html#cb1633-1" aria-hidden="true" tabindex="-1"></a>dt_long</span></code></pre></div>
<pre><code>       ID   Timepoint Score
    &lt;int&gt;      &lt;fctr&gt; &lt;int&gt;
 1:     1 Timepoint_A    11
 2:     2 Timepoint_A    12
 3:     3 Timepoint_A    13
 4:     4 Timepoint_A    14
 5:     1 Timepoint_B    21
 6:     2 Timepoint_B    22
 7:     3 Timepoint_B    23
 8:     4 Timepoint_B    24
 9:     1 Timepoint_C    51
10:     2 Timepoint_C    52
11:     3 Timepoint_C    53
12:     4 Timepoint_C    54</code></pre>
<div class="sourceCode" id="cb1635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1635-1"><a href="datatable.html#cb1635-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(dt_long, ID <span class="sc">~</span> Timepoint,</span>
<span id="cb1635-2"><a href="datatable.html#cb1635-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">value.var =</span> <span class="st">&quot;Score&quot;</span>)</span></code></pre></div>
<pre><code>Key: &lt;ID&gt;
      ID Timepoint_A Timepoint_B Timepoint_C
   &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
1:     1          11          21          51
2:     2          12          22          52
3:     3          13          23          53
4:     4          14          24          54</code></pre>
<div id="dcast-aggregate" class="section level4" number="24.15.2.1">
<h4><span class="header-section-number">24.15.2.1</span> <code>dcast()</code> + aggregate</h4>
<p>If your <code>ID ~ Timepoint</code> combination does not define a unique row in your input dataset, you need to specify an aggregate function.</p>
<p>For example, suppose you have four subjects with IDs “A”, “B”, “C”, “D” who had a couple variables measured 3 times in the AM and 3 times in the PM.</p>
<div class="sourceCode" id="cb1637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1637-1"><a href="datatable.html#cb1637-1" aria-hidden="true" tabindex="-1"></a>dt_long2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">ID =</span> <span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">each =</span> <span class="dv">6</span>),</span>
<span id="cb1637-2"><a href="datatable.html#cb1637-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Timepoint =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;AM&quot;</span>, <span class="st">&quot;PM&quot;</span>), <span class="at">length.out =</span> <span class="dv">24</span>, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb1637-3"><a href="datatable.html#cb1637-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Var1 =</span> <span class="fu">rnorm</span>(<span class="dv">24</span>, <span class="dv">10</span>),</span>
<span id="cb1637-4"><a href="datatable.html#cb1637-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Var2 =</span> <span class="fu">rnorm</span>(<span class="dv">24</span>, <span class="dv">20</span>))</span>
<span id="cb1637-5"><a href="datatable.html#cb1637-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1637-6"><a href="datatable.html#cb1637-6" aria-hidden="true" tabindex="-1"></a>dt_long2[<span class="fu">sample</span>(<span class="dv">24</span>, <span class="dv">4</span>), Var1 <span class="sc">:</span><span class="er">=</span> <span class="cn">NA</span>]</span>
<span id="cb1637-7"><a href="datatable.html#cb1637-7" aria-hidden="true" tabindex="-1"></a>dt_long2[<span class="fu">sample</span>(<span class="dv">24</span>, <span class="dv">4</span>), Var2 <span class="sc">:</span><span class="er">=</span> <span class="cn">NA</span>]</span>
<span id="cb1637-8"><a href="datatable.html#cb1637-8" aria-hidden="true" tabindex="-1"></a>dt_long2</span></code></pre></div>
<pre><code>        ID Timepoint      Var1     Var2
    &lt;char&gt;    &lt;char&gt;     &lt;num&gt;    &lt;num&gt;
 1:      A        AM 10.290628 20.57883
 2:      A        AM        NA 21.90904
 3:      A        AM 10.076015 20.25076
 4:      A        PM  9.439701 18.40168
 5:      A        PM        NA 23.20163
 6:      A        PM 10.908501 20.95524
 7:      B        AM  9.494940 20.36864
 8:      B        AM  9.698996 20.92292
 9:      B        AM  9.273964 19.79448
10:      B        PM  8.819923       NA
11:      B        PM 10.253075       NA
12:      B        PM  9.629289 20.79584
13:      C        AM 10.022180 21.64601
14:      C        AM 10.660044 18.28308
15:      C        AM 10.488794       NA
16:      C        PM  9.811210 19.09586
17:      C        PM        NA 19.29601
18:      C        PM  9.326240 18.22190
19:      D        AM 10.476050       NA
20:      D        AM 10.118753 20.04615
21:      D        AM 10.121226 20.24366
22:      D        PM  9.813953 20.62833
23:      D        PM        NA 19.97536
24:      D        PM  9.433077 22.31415
        ID Timepoint      Var1     Var2</code></pre>
<p>If you wanted to convert the above data.table to wide format and get mean AM and PM values using the <code>fun.aggregate</code> argument:</p>
<div class="sourceCode" id="cb1639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1639-1"><a href="datatable.html#cb1639-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(dt_long2,</span>
<span id="cb1639-2"><a href="datatable.html#cb1639-2" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">~</span> Timepoint,</span>
<span id="cb1639-3"><a href="datatable.html#cb1639-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">&quot;Var1&quot;</span>, <span class="st">&quot;Var2&quot;</span>),</span>
<span id="cb1639-4"><a href="datatable.html#cb1639-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun.aggregate =</span> mean, <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>Key: &lt;ID&gt;
       ID  Var1_AM   Var1_PM  Var2_AM  Var2_PM
   &lt;char&gt;    &lt;num&gt;     &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1:      A 10.18332 10.174101 20.91288 20.85285
2:      B  9.48930  9.567429 20.36201 20.79584
3:      C 10.39034  9.568725 19.96454 18.87126
4:      D 10.23868  9.623515 20.14491 20.97262</code></pre>
<p>You can apply multiple aggregating functions by passing a list to <code>fun.aggregate</code>:</p>
<div class="sourceCode" id="cb1641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1641-1"><a href="datatable.html#cb1641-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(dt_long2,</span>
<span id="cb1641-2"><a href="datatable.html#cb1641-2" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">~</span> Timepoint,</span>
<span id="cb1641-3"><a href="datatable.html#cb1641-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">&quot;Var1&quot;</span>, <span class="st">&quot;Var2&quot;</span>),</span>
<span id="cb1641-4"><a href="datatable.html#cb1641-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun.aggregate =</span> <span class="fu">list</span>(mean, max, min), <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>Key: &lt;ID&gt;
       ID Var1_mean_AM Var1_mean_PM Var2_mean_AM Var2_mean_PM Var1_max_AM
   &lt;char&gt;        &lt;num&gt;        &lt;num&gt;        &lt;num&gt;        &lt;num&gt;       &lt;num&gt;
1:      A     10.18332    10.174101     20.91288     20.85285   10.290628
2:      B      9.48930     9.567429     20.36201     20.79584    9.698996
3:      C     10.39034     9.568725     19.96454     18.87126   10.660044
4:      D     10.23868     9.623515     20.14491     20.97262   10.476050
   Var1_max_PM Var2_max_AM Var2_max_PM Var1_min_AM Var1_min_PM Var2_min_AM
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
1:   10.908501    21.90904    23.20163   10.076015    9.439701    20.25076
2:   10.253075    20.92292    20.79584    9.273964    8.819923    19.79448
3:    9.811210    21.64601    19.29601   10.022180    9.326240    18.28308
4:    9.813953    20.24366    22.31415   10.118753    9.433077    20.04615
   Var2_min_PM
         &lt;num&gt;
1:    18.40168
2:    20.79584
3:    18.22190
4:    19.97536</code></pre>
<p>Note how <code>na.rm = T</code> was successfully applied to all aggregating functions</p>
</div>
</div>
</div>
<div id="table-joins" class="section level2" number="24.16">
<h2><span class="header-section-number">24.16</span> Table Joins</h2>
<p><code>data.table</code> allow you to perform table joins with the base <code>merge()</code> function using the same syntax as for data.frame objects or the “data.table way” using bracket notation:</p>
<div class="sourceCode" id="cb1643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1643-1"><a href="datatable.html#cb1643-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">PID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb1643-2"><a href="datatable.html#cb1643-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">Hospital =</span> <span class="fu">c</span>(<span class="st">&quot;UCSF&quot;</span>, <span class="st">&quot;HUP&quot;</span>, <span class="st">&quot;Stanford&quot;</span>, </span>
<span id="cb1643-3"><a href="datatable.html#cb1643-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Stanford&quot;</span>, <span class="st">&quot;UCSF&quot;</span>, <span class="st">&quot;HUP&quot;</span>, </span>
<span id="cb1643-4"><a href="datatable.html#cb1643-4" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;HUP&quot;</span>, <span class="st">&quot;Stanford&quot;</span>, <span class="st">&quot;UCSF&quot;</span>),</span>
<span id="cb1643-5"><a href="datatable.html#cb1643-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">Age =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">34</span>, <span class="dv">41</span>, <span class="dv">19</span>, <span class="dv">53</span>, <span class="dv">21</span>, <span class="dv">63</span>, <span class="dv">22</span>, <span class="dv">19</span>),</span>
<span id="cb1643-6"><a href="datatable.html#cb1643-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">Sex =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1643-7"><a href="datatable.html#cb1643-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">key =</span> <span class="st">&quot;PID&quot;</span>)</span>
<span id="cb1643-8"><a href="datatable.html#cb1643-8" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;
1:     1     UCSF    22     1
2:     2      HUP    34     1
3:     3 Stanford    41     0
4:     4 Stanford    19     1
5:     5     UCSF    53     0
6:     6      HUP    21     0
7:     7      HUP    63     1
8:     8 Stanford    22     0
9:     9     UCSF    19     0</code></pre>
<div class="sourceCode" id="cb1645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1645-1"><a href="datatable.html#cb1645-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">PID =</span> <span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>),</span>
<span id="cb1645-2"><a href="datatable.html#cb1645-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">V1 =</span> <span class="fu">c</span>(<span class="dv">153</span>, <span class="dv">89</span>, <span class="dv">112</span>, <span class="dv">228</span>,  <span class="dv">91</span>, <span class="dv">190</span>, <span class="dv">101</span>),</span>
<span id="cb1645-3"><a href="datatable.html#cb1645-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">Department =</span> <span class="fu">c</span>(<span class="st">&quot;Neurology&quot;</span>, <span class="st">&quot;Radiology&quot;</span>, <span class="st">&quot;Emergency&quot;</span>,</span>
<span id="cb1645-4"><a href="datatable.html#cb1645-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Cardiology&quot;</span>, <span class="st">&quot;Surgery&quot;</span>, <span class="st">&quot;Neurology&quot;</span>,</span>
<span id="cb1645-5"><a href="datatable.html#cb1645-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Psychiatry&quot;</span>),</span>
<span id="cb1645-6"><a href="datatable.html#cb1645-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">key =</span> <span class="st">&quot;PID&quot;</span>)</span>
<span id="cb1645-7"><a href="datatable.html#cb1645-7" aria-hidden="true" tabindex="-1"></a>b</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID    V1 Department
   &lt;int&gt; &lt;num&gt;     &lt;char&gt;
1:     6   153  Neurology
2:     7    89  Radiology
3:     8   112  Emergency
4:     9   228 Cardiology
5:    10    91    Surgery
6:    11   190  Neurology
7:    12   101 Psychiatry</code></pre>
<p>In the above command we use the <code>key</code> argument to set <code>PID</code> as key. This can be performed after the <code>data.table</code> has been created using the <code>setkey()</code> command:</p>
<div class="sourceCode" id="cb1647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1647-1"><a href="datatable.html#cb1647-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(a, PID)</span></code></pre></div>
<p>Multiple keys can be set, in order, with the same <code>setkey()</code> command, separated by commas, e.g.:</p>
<div class="sourceCode" id="cb1648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1648-1"><a href="datatable.html#cb1648-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(a, PID, Hospital)</span></code></pre></div>
<p>Keys sort the data.table by the corresponding columns and can be used to perform left and right joins with bracket notation seen later.</p>
<div id="inner" class="section level3" number="24.16.1">
<h3><span class="header-section-number">24.16.1</span> Inner</h3>
<div class="sourceCode" id="cb1649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1649-1"><a href="datatable.html#cb1649-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(a, b)</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex    V1 Department
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology</code></pre>
</div>
<div id="outer" class="section level3" number="24.16.2">
<h3><span class="header-section-number">24.16.2</span> Outer</h3>
<div class="sourceCode" id="cb1651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1651-1"><a href="datatable.html#cb1651-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(a, b, <span class="at">all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
      PID Hospital   Age   Sex    V1 Department
    &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
 1:     1     UCSF    22     1    NA       &lt;NA&gt;
 2:     2      HUP    34     1    NA       &lt;NA&gt;
 3:     3 Stanford    41     0    NA       &lt;NA&gt;
 4:     4 Stanford    19     1    NA       &lt;NA&gt;
 5:     5     UCSF    53     0    NA       &lt;NA&gt;
 6:     6      HUP    21     0   153  Neurology
 7:     7      HUP    63     1    89  Radiology
 8:     8 Stanford    22     0   112  Emergency
 9:     9     UCSF    19     0   228 Cardiology
10:    10     &lt;NA&gt;    NA    NA    91    Surgery
11:    11     &lt;NA&gt;    NA    NA   190  Neurology
12:    12     &lt;NA&gt;    NA    NA   101 Psychiatry</code></pre>
</div>
<div id="left-outer" class="section level3" number="24.16.3">
<h3><span class="header-section-number">24.16.3</span> Left outer</h3>
<p>Using <code>merge()</code>:</p>
<div class="sourceCode" id="cb1653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1653-1"><a href="datatable.html#cb1653-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(a, b, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex    V1 Department
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
1:     1     UCSF    22     1    NA       &lt;NA&gt;
2:     2      HUP    34     1    NA       &lt;NA&gt;
3:     3 Stanford    41     0    NA       &lt;NA&gt;
4:     4 Stanford    19     1    NA       &lt;NA&gt;
5:     5     UCSF    53     0    NA       &lt;NA&gt;
6:     6      HUP    21     0   153  Neurology
7:     7      HUP    63     1    89  Radiology
8:     8 Stanford    22     0   112  Emergency
9:     9     UCSF    19     0   228 Cardiology</code></pre>
<p>Using bracket notation:</p>
<div class="sourceCode" id="cb1655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1655-1"><a href="datatable.html#cb1655-1" aria-hidden="true" tabindex="-1"></a>b[a, ]</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID    V1 Department Hospital   Age   Sex
   &lt;int&gt; &lt;num&gt;     &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;
1:     1    NA       &lt;NA&gt;     UCSF    22     1
2:     2    NA       &lt;NA&gt;      HUP    34     1
3:     3    NA       &lt;NA&gt; Stanford    41     0
4:     4    NA       &lt;NA&gt; Stanford    19     1
5:     5    NA       &lt;NA&gt;     UCSF    53     0
6:     6   153  Neurology      HUP    21     0
7:     7    89  Radiology      HUP    63     1
8:     8   112  Emergency Stanford    22     0
9:     9   228 Cardiology     UCSF    19     0</code></pre>
<p>If keys were not set for a and b, you could specify the column to match on using the <code>on</code> argument:</p>
<div class="sourceCode" id="cb1657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1657-1"><a href="datatable.html#cb1657-1" aria-hidden="true" tabindex="-1"></a>b[a, on <span class="ot">=</span> <span class="st">&quot;PID&quot;</span>]</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID    V1 Department Hospital   Age   Sex
   &lt;int&gt; &lt;num&gt;     &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;
1:     1    NA       &lt;NA&gt;     UCSF    22     1
2:     2    NA       &lt;NA&gt;      HUP    34     1
3:     3    NA       &lt;NA&gt; Stanford    41     0
4:     4    NA       &lt;NA&gt; Stanford    19     1
5:     5    NA       &lt;NA&gt;     UCSF    53     0
6:     6   153  Neurology      HUP    21     0
7:     7    89  Radiology      HUP    63     1
8:     8   112  Emergency Stanford    22     0
9:     9   228 Cardiology     UCSF    19     0</code></pre>
<div class="rmdnote">
<p>
The easy way to understand the bracket notation merges is to think that the data.table inside the bracket is used to index the data.table on the outside, therefore the resulting table will have rows dictated by the inside table’s key.
</p>
</div>
</div>
<div id="right-outer" class="section level3" number="24.16.4">
<h3><span class="header-section-number">24.16.4</span> Right outer</h3>
<div class="sourceCode" id="cb1659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1659-1"><a href="datatable.html#cb1659-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(a, b, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex    V1 Department
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology
5:    10     &lt;NA&gt;    NA    NA    91    Surgery
6:    11     &lt;NA&gt;    NA    NA   190  Neurology
7:    12     &lt;NA&gt;    NA    NA   101 Psychiatry</code></pre>
<p>Using bracket notation:</p>
<div class="sourceCode" id="cb1661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1661-1"><a href="datatable.html#cb1661-1" aria-hidden="true" tabindex="-1"></a>a[b, ]</span></code></pre></div>
<pre><code>Key: &lt;PID&gt;
     PID Hospital   Age   Sex    V1 Department
   &lt;int&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;char&gt;
1:     6      HUP    21     0   153  Neurology
2:     7      HUP    63     1    89  Radiology
3:     8 Stanford    22     0   112  Emergency
4:     9     UCSF    19     0   228 Cardiology
5:    10     &lt;NA&gt;    NA    NA    91    Surgery
6:    11     &lt;NA&gt;    NA    NA   190  Neurology
7:    12     &lt;NA&gt;    NA    NA   101 Psychiatry</code></pre>

</div>
</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Programming for Data Science in R</strong>" was written by Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD. It was last built on 2021-11-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
